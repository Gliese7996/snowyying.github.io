<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Snowyying</title>
  <subtitle>Learn and live.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://snowyying.github.io/"/>
  <updated>2016-11-14T07:21:58.353Z</updated>
  <id>http://snowyying.github.io/</id>
  
  <author>
    <name>Snowyying</name>
    <email>marvin.nps@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>UML 概述</title>
    <link href="http://snowyying.github.io/2016/uml-overview/"/>
    <id>http://snowyying.github.io/2016/uml-overview/</id>
    <published>2016-11-14T06:43:23.000Z</published>
    <updated>2016-11-14T07:21:58.353Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x7248;&#x6743;&#x58F0;&#x660E;&#xFF1A;&#x672C;&#x6587;&#x4E3A;&#x535A;&#x4E3B;&#x539F;&#x521B;&#x6587;&#x7AE0;&#xFF0C;&#x8F6C;&#x8F7D;&#x8BF7;&#x6CE8;&#x660E;&#x51FA;&#x5904;&#x3002;</p>
</blockquote>
<p><img src="/2016/uml-overview/UML.png" alt="UML"></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&amp;#x7248;&amp;#x6743;&amp;#x58F0;&amp;#x660E;&amp;#xFF1A;&amp;#x672C;&amp;#x6587;&amp;#x4E3A;&amp;#x535A;&amp;#x4E3B;&amp;#x539F;&amp;#x521B;&amp;#x6587;&amp;#x7AE0;&amp;#xFF0C;&amp;#x8
    
    </summary>
    
      <category term="Software Engineering" scheme="http://snowyying.github.io/categories/Software-Engineering/"/>
    
    
      <category term="UML" scheme="http://snowyying.github.io/tags/UML/"/>
    
      <category term="统一建模语言" scheme="http://snowyying.github.io/tags/%E7%BB%9F%E4%B8%80%E5%BB%BA%E6%A8%A1%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>SQuaRE 概览</title>
    <link href="http://snowyying.github.io/2016/square-overview/"/>
    <id>http://snowyying.github.io/2016/square-overview/</id>
    <published>2016-11-14T06:43:23.000Z</published>
    <updated>2016-11-16T14:38:03.840Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x7248;&#x6743;&#x58F0;&#x660E;&#xFF1A;&#x672C;&#x6587;&#x4E3A;&#x535A;&#x4E3B;&#x539F;&#x521B;&#x6587;&#x7AE0;&#xFF0C;&#x8F6C;&#x8F7D;&#x8BF7;&#x6CE8;&#x660E;&#x51FA;&#x5904;&#x3002;</p>
</blockquote>
<p><img src="/2016/square-overview/SQuaRE.png" alt="SQuaRE"></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&amp;#x7248;&amp;#x6743;&amp;#x58F0;&amp;#x660E;&amp;#xFF1A;&amp;#x672C;&amp;#x6587;&amp;#x4E3A;&amp;#x535A;&amp;#x4E3B;&amp;#x539F;&amp;#x521B;&amp;#x6587;&amp;#x7AE0;&amp;#xFF0C;&amp;#x8
    
    </summary>
    
      <category term="Software Engineering" scheme="http://snowyying.github.io/categories/Software-Engineering/"/>
    
    
      <category term="SQuaRE" scheme="http://snowyying.github.io/tags/SQuaRE/"/>
    
  </entry>
  
  <entry>
    <title>swebok 概览</title>
    <link href="http://snowyying.github.io/2016/swebok-overview/"/>
    <id>http://snowyying.github.io/2016/swebok-overview/</id>
    <published>2016-11-14T06:39:07.000Z</published>
    <updated>2016-11-16T14:38:05.771Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="Software Engineering" scheme="http://snowyying.github.io/categories/Software-Engineering/"/>
    
    
      <category term="SWE" scheme="http://snowyying.github.io/tags/SWE/"/>
    
      <category term="swebok" scheme="http://snowyying.github.io/tags/swebok/"/>
    
  </entry>
  
  <entry>
    <title>设计模式概述</title>
    <link href="http://snowyying.github.io/2016/design-pattern/"/>
    <id>http://snowyying.github.io/2016/design-pattern/</id>
    <published>2016-11-14T01:33:56.000Z</published>
    <updated>2016-11-15T02:39:04.718Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x8BBE;&#x8BA1;&#x539F;&#x5219;"><a href="#&#x8BBE;&#x8BA1;&#x539F;&#x5219;" class="headerlink" title="&#x8BBE;&#x8BA1;&#x539F;&#x5219;"></a>&#x8BBE;&#x8BA1;&#x539F;&#x5219;</h2><p><img src="/2016/design-pattern/Design-principles.png" alt="&#x8BBE;&#x8BA1;&#x539F;&#x5219;"></p>
<h6 id="1-&#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219;-SRP"><a href="#1-&#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219;-SRP" class="headerlink" title="1. &#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219;(SRP)"></a>1. &#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219;(SRP)</h6><p>&#x539F;&#x5219;: &#x5E94;&#x8BE5;&#x6709;&#x4E14;&#x4EC5;&#x6709;&#x4E00;&#x4E2A;&#x539F;&#x56E0;&#x5F15;&#x8D77;&#x7C7B;&#x7684;&#x53D8;&#x66F4;.<br>&#x9002;&#x7528;&#x4E8E; &#x63A5;&#x53E3;, &#x7C7B;, &#x65B9;&#x6CD5; &#x2026;<br>&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x5C3D;&#x53EF;&#x80FD;&#x53EA;&#x505A;&#x4E00;&#x4EF6;&#x4E8B;, &#x4E0D;&#x8981;&#x8BA9;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;&#x62C5;&#x4EFB;&#x591A;&#x4E2A;&#x804C;&#x8D23;.<br>&#x5982;: &#x5C5E;&#x6027; &#x548C; &#x884C;&#x4E3A; &#x5206;&#x79BB;</p>
<h6 id="2-&#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;-LSP"><a href="#2-&#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;-LSP" class="headerlink" title="2. &#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;(LSP)"></a>2. &#x91CC;&#x6C0F;&#x66FF;&#x6362;&#x539F;&#x5219;(LSP)</h6><p>Overload &#x91CD;&#x8F7D;<br>Override &#x8986;&#x5199;<br>Design by Contract &#x5951;&#x7EA6;&#x8BBE;&#x8BA1;<br>&#x539F;&#x5219;: &#x53EA;&#x8981;&#x7236;&#x7C7B;&#x51FA;&#x73B0;&#x7684;&#x5730;&#x65B9;&#x5B50;&#x7C7B;&#x5C31;&#x53EF;&#x4EE5;&#x51FA;&#x73B0;, &#x800C;&#x4E14;&#x66FF;&#x6362;&#x4E3A;&#x5B50;&#x7C7B;&#x4E0D;&#x4F1A;&#x4EA7;&#x751F;&#x4EFB;&#x4F55;&#x9519;&#x8BEF;&#x6216;&#x5F02;&#x5E38;.<br>&#x76EE;&#x7684;: &#x589E;&#x5F3A;&#x7A0B;&#x5E8F;&#x7684;&#x5065;&#x58EE;&#x6027;, &#x7248;&#x672C;&#x5347;&#x7EA7;&#x4E5F;&#x53EF;&#x4EE5;&#x4FDD;&#x6301;&#x597D;&#x7684;&#x517C;&#x5BB9;&#x6027;.</p>
<h6 id="3-&#x4F9D;&#x8D56;&#x5012;&#x7F6E;&#x539F;&#x5219;-DIP"><a href="#3-&#x4F9D;&#x8D56;&#x5012;&#x7F6E;&#x539F;&#x5219;-DIP" class="headerlink" title="3. &#x4F9D;&#x8D56;&#x5012;&#x7F6E;&#x539F;&#x5219;(DIP)"></a>3. &#x4F9D;&#x8D56;&#x5012;&#x7F6E;&#x539F;&#x5219;(DIP)</h6><p>&#x672C;&#x8D28;: &#x901A;&#x8FC7;&#x62BD;&#x8C61;(&#x63A5;&#x53E3;&#x6216;&#x62BD;&#x8C61;&#x7C7B;)&#x4F7F;&#x5404;&#x4E2A;&#x7C7B;&#x6216;&#x6A21;&#x5757;&#x7684;&#x5B9E;&#x73B0;&#x5F7C;&#x6B64;&#x72EC;&#x7ACB;, &#x5B9E;&#x73B0;&#x6A21;&#x5757;&#x677E;&#x8026;&#x5408;<br>&#x9762;&#x5411;&#x63A5;&#x53E3;&#x7F16;&#x7A0B;<br>&#x4F9D;&#x8D56;&#x62BD;&#x8C61;, &#x4E0D;&#x8BE5;&#x4F9D;&#x8D56;&#x7EC6;&#x8282;</p>
<h6 id="4-&#x63A5;&#x53E3;&#x9694;&#x79BB;&#x539F;&#x5219;"><a href="#4-&#x63A5;&#x53E3;&#x9694;&#x79BB;&#x539F;&#x5219;" class="headerlink" title="4. &#x63A5;&#x53E3;&#x9694;&#x79BB;&#x539F;&#x5219;"></a>4. &#x63A5;&#x53E3;&#x9694;&#x79BB;&#x539F;&#x5219;</h6><p>&#x539F;&#x5219;: &#x63A5;&#x53E3;&#x548C;&#x7C7B;&#x7684;&#x5B9A;&#x4E49;&#x5C3D;&#x91CF;&#x4F7F;&#x7528;&#x539F;&#x5B50;&#x63A5;&#x53E3;&#x6216;&#x539F;&#x5B50;&#x7C7B;<br>&#x548C;&#x5355;&#x4E00;&#x804C;&#x8D23;&#x539F;&#x5219;&#x7684;&#x5BA1;&#x89C6;&#x89D2;&#x5EA6;&#x4E0D;&#x540C;</p>
<h6 id="5-&#x8FEA;&#x7C73;&#x7279;&#x6CD5;&#x5219;-LoD-&#x6700;&#x5C11;&#x77E5;&#x8BC6;&#x539F;&#x5219;-LKP"><a href="#5-&#x8FEA;&#x7C73;&#x7279;&#x6CD5;&#x5219;-LoD-&#x6700;&#x5C11;&#x77E5;&#x8BC6;&#x539F;&#x5219;-LKP" class="headerlink" title="5. &#x8FEA;&#x7C73;&#x7279;&#x6CD5;&#x5219;(LoD) / &#x6700;&#x5C11;&#x77E5;&#x8BC6;&#x539F;&#x5219;(LKP)"></a>5. &#x8FEA;&#x7C73;&#x7279;&#x6CD5;&#x5219;(LoD) / &#x6700;&#x5C11;&#x77E5;&#x8BC6;&#x539F;&#x5219;(LKP)</h6><p>&#x5BF9;&#x8C61;&#x5E94;&#x8BE5;&#x5BF9;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x6709;&#x6700;&#x5C11;&#x7684;&#x4E86;&#x89E3;<br>&#x7C7B;&#x95F4;&#x89E3;&#x8026;, &#x5F31;&#x8026;&#x5408;</p>
<h6 id="6-&#x5F00;&#x95ED;&#x539F;&#x5219;"><a href="#6-&#x5F00;&#x95ED;&#x539F;&#x5219;" class="headerlink" title="6. &#x5F00;&#x95ED;&#x539F;&#x5219;"></a>6. &#x5F00;&#x95ED;&#x539F;&#x5219;</h6><p>&#x5BF9;&#x6269;&#x5C55;&#x5F00;&#x653E;, &#x5BF9;&#x4FEE;&#x6539;&#x5173;&#x95ED;<br>&#x524D;5&#x4E2A;&#x90FD;&#x662F;&#x5F00;&#x95ED;&#x539F;&#x5219;&#x7684;&#x5177;&#x4F53;&#x5F62;&#x6001;<br>&#x5F00;&#x95ED;&#x539F;&#x5219;&#x662F;&#x5176;&#x7CBE;&#x795E;&#x9886;&#x8896;</p>
<a id="more"></a>
<h2 id="&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;"><a href="#&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;" class="headerlink" title="&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;"></a>&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;</h2><p><img src="/2016/design-pattern/Design-pattern.png" alt="&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;"></p>
<h4 id="&#x521B;&#x5EFA;&#x6A21;&#x5F0F;"><a href="#&#x521B;&#x5EFA;&#x6A21;&#x5F0F;" class="headerlink" title="&#x521B;&#x5EFA;&#x6A21;&#x5F0F;"></a>&#x521B;&#x5EFA;&#x6A21;&#x5F0F;</h4><ol>
<li><p><strong>Abstract Factory&#xFF08;&#x62BD;&#x8C61;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x521B;&#x5EFA;&#x4E00;&#x7CFB;&#x5217;&#x76F8;&#x5173;&#x6216;&#x76F8;&#x4E92;&#x4F9D;&#x8D56;&#x5BF9;&#x8C61;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x6307;&#x5B9A;&#x5B83;&#x4EEC;&#x5177;&#x4F53;&#x7684;&#x7C7B;&#x3002;</p>
</li>
<li><p><strong>Builder&#xFF08;&#x5EFA;&#x9020;&#x8005;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5C06;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x5BF9;&#x8C61;&#x7684;&#x6784;&#x5EFA;&#x4E0E;&#x5B83;&#x7684;&#x8868;&#x793A;&#x5206;&#x79BB;&#xFF0C;&#x4F7F;&#x5F97;&#x540C;&#x6837;&#x7684;&#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x8868;&#x793A;&#x3002;</p>
</li>
<li><p><strong>Factory Method&#xFF08;&#x5DE5;&#x5382;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x8BA9;&#x5B50;&#x7C7B;&#x51B3;&#x5B9A;&#x5C06;&#x54EA;&#x4E00;&#x4E2A;&#x7C7B;&#x5B9E;&#x4F8B;&#x5316;&#x3002;Factory Method&#x4F7F;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x5B9E;&#x4F8B;&#x5316;&#x5EF6;&#x8FDF;&#x5230;&#x5176;&#x5B50;&#x7C7B;&#x3002;</p>
</li>
<li><p><strong>Prototype&#xFF08;&#x539F;&#x578B;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x7528;&#x539F;&#x578B;&#x5B9E;&#x4F8B;&#x6307;&#x5B9A;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x7684;&#x79CD;&#x7C7B;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x8FC7;&#x62F7;&#x8D1D;&#x8FD9;&#x4E2A;&#x539F;&#x578B;&#x6765;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
</li>
<li><p><strong>Singleton&#xFF08;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x4FDD;&#x8BC1;&#x4E00;&#x4E2A;&#x7C7B;&#x4EC5;&#x6709;&#x4E00;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x8BBF;&#x95EE;&#x5B83;&#x7684;&#x5168;&#x5C40;&#x8BBF;&#x95EE;&#x70B9;&#x3002; &#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x4E4B;&#x4E00;&#xFF0C;&#x4F46;&#x662F;&#x5BF9;&#x4E8E;Java&#x7684;&#x5F00;&#x53D1;&#x8005;&#x6765;&#x8BF4;&#xFF0C;&#x5B83;&#x5374;&#x6709;&#x5F88;&#x591A;&#x7F3A;&#x9677;&#x3002;&#x5728;&#x4E5D;&#x6708;&#x7684;&#x4E13;&#x680F;&#x4E2D;&#xFF0C;David Geary&#x63A2;&#x8BA8;&#x4E86;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x4EE5;&#x53CA;&#x5728;&#x9762;&#x5BF9;&#x591A;&#x7EBF;&#x7A0B;&#xFF08;multi-threading&#xFF09;&#x3001;&#x7C7B;&#x88C5;&#x8F7D;&#x5668;&#xFF08;class loaders&#xFF09;&#x548C;&#x5E8F;&#x5217;&#x5316;&#xFF08;serialization&#xFF09;&#x65F6;&#x5982;&#x4F55;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x7F3A;&#x9677;&#x3002;</p>
</li>
</ol>
<h4 id="&#x7ED3;&#x6784;&#x6A21;&#x5F0F;"><a href="#&#x7ED3;&#x6784;&#x6A21;&#x5F0F;" class="headerlink" title="&#x7ED3;&#x6784;&#x6A21;&#x5F0F;"></a>&#x7ED3;&#x6784;&#x6A21;&#x5F0F;</h4><ol>
<li><p><strong>Adapter&#xFF08;&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5C06;&#x4E00;&#x4E2A;&#x7C7B;&#x7684;&#x63A5;&#x53E3;&#x8F6C;&#x6362;&#x6210;&#x5BA2;&#x6237;&#x5E0C;&#x671B;&#x7684;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x63A5;&#x53E3;&#x3002;Adapter&#x6A21;&#x5F0F;&#x4F7F;&#x5F97;&#x539F;&#x672C;&#x7531;&#x4E8E;&#x63A5;&#x53E3;&#x4E0D;&#x517C;&#x5BB9;&#x800C;&#x4E0D;&#x80FD;&#x4E00;&#x8D77;&#x5DE5;&#x4F5C;&#x7684;&#x90A3;&#x4E9B;&#x7C7B;&#x53EF;&#x4EE5;&#x4E00;&#x8D77;&#x5DE5;&#x4F5C;&#x3002;</p>
</li>
<li><p><strong>Bridge&#xFF08;&#x6865;&#x63A5;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5C06;&#x62BD;&#x8C61;&#x90E8;&#x5206;&#x4E0E;&#x5B83;&#x7684;&#x5B9E;&#x73B0;&#x90E8;&#x5206;&#x5206;&#x79BB;&#xFF0C;&#x4F7F;&#x5B83;&#x4EEC;&#x90FD;&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x5730;&#x53D8;&#x5316;&#x3002;<br>Builder&#xFF08;&#x5EFA;&#x9020;&#x8005;&#x6A21;&#x5F0F;&#xFF09;&#xFF1A;&#x5C06;&#x4E00;&#x4E2A;&#x590D;&#x6742;&#x5BF9;&#x8C61;&#x7684;&#x6784;&#x5EFA;&#x4E0E;&#x5B83;&#x7684;&#x8868;&#x793A;&#x5206;&#x79BB;&#xFF0C;&#x4F7F;&#x5F97;&#x540C;&#x6837;&#x7684;&#x6784;&#x5EFA;&#x8FC7;&#x7A0B;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E0D;&#x540C;&#x7684;&#x8868;&#x793A;&#x3002;</p>
</li>
<li><p><strong>Composite&#xFF08;&#x7EC4;&#x5408;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5C06;&#x5BF9;&#x8C61;&#x7EC4;&#x5408;&#x6210;&#x6811;&#x5F62;&#x7ED3;&#x6784;&#x4EE5;&#x8868;&#x793A;&#x201C;&#x90E8;&#x5206;-&#x6574;&#x4F53;&#x201D;&#x7684;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x3002;&#x5B83;&#x4F7F;&#x5F97;&#x5BA2;&#x6237;&#x5BF9;&#x5355;&#x4E2A;&#x5BF9;&#x8C61;&#x548C;&#x590D;&#x5408;&#x5BF9;&#x8C61;&#x7684;&#x4F7F;&#x7528;&#x5177;&#x6709;&#x4E00;&#x81F4;&#x6027;&#x3002;</p>
</li>
<li><p><strong>Decorator&#xFF08;&#x88C5;&#x9970;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x52A8;&#x6001;&#x5730;&#x7ED9;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x804C;&#x8D23;&#x3002;&#x5C31;&#x6269;&#x5C55;&#x529F;&#x80FD;&#x800C;&#x8A00;&#xFF0C; &#x5B83;&#x6BD4;&#x751F;&#x6210;&#x5B50;&#x7C7B;&#x65B9;&#x5F0F;&#x66F4;&#x4E3A;&#x7075;&#x6D3B;&#x3002;</p>
</li>
<li><p><strong>Facade&#xFF08;&#x5916;&#x89C2;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x4E3A;&#x5B50;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;&#x4E00;&#x7EC4;&#x63A5;&#x53E3;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x4E00;&#x81F4;&#x7684;&#x754C;&#x9762;&#xFF0C;Facade&#x6A21;&#x5F0F;&#x5B9A;&#x4E49;&#x4E86;&#x4E00;&#x4E2A;&#x9AD8;&#x5C42;&#x63A5;&#x53E3;&#xFF0C;&#x8FD9;&#x4E2A;&#x63A5;&#x53E3;&#x4F7F;&#x5F97;&#x8FD9;&#x4E00;&#x5B50;&#x7CFB;&#x7EDF;&#x66F4;&#x52A0;&#x5BB9;&#x6613;&#x4F7F;&#x7528;&#x3002;</p>
</li>
<li><p><strong>Flyweight&#xFF08;&#x4EAB;&#x5143;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x8FD0;&#x7528;&#x5171;&#x4EAB;&#x6280;&#x672F;&#x6709;&#x6548;&#x5730;&#x652F;&#x6301;&#x5927;&#x91CF;&#x7EC6;&#x7C92;&#x5EA6;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
</li>
<li><p><strong>Proxy&#xFF08;&#x4EE3;&#x7406;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x4E3A;&#x5176;&#x4ED6;&#x5BF9;&#x8C61;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x4EE3;&#x7406;&#x4EE5;&#x63A7;&#x5236;&#x5BF9;&#x8FD9;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x8BBF;&#x95EE;&#x3002;</p>
</li>
</ol>
<h4 id="&#x884C;&#x4E3A;&#x6A21;&#x5F0F;"><a href="#&#x884C;&#x4E3A;&#x6A21;&#x5F0F;" class="headerlink" title="&#x884C;&#x4E3A;&#x6A21;&#x5F0F;"></a>&#x884C;&#x4E3A;&#x6A21;&#x5F0F;</h4><ol>
<li><p><strong>Chain of Responsibility&#xFF08;&#x804C;&#x8D23;&#x94FE;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x4E3A;&#x89E3;&#x9664;&#x8BF7;&#x6C42;&#x7684;&#x53D1;&#x9001;&#x8005;&#x548C;&#x63A5;&#x6536;&#x8005;&#x4E4B;&#x95F4;&#x8026;&#x5408;&#xFF0C;&#x800C;&#x4F7F;&#x591A;&#x4E2A;&#x5BF9;&#x8C61;&#x90FD;&#x6709;&#x673A;&#x4F1A;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;&#x5C06;&#x8FD9;&#x4E9B;&#x5BF9;&#x8C61;&#x8FDE;&#x6210;&#x4E00;&#x6761;&#x94FE;&#xFF0C;&#x5E76;&#x6CBF;&#x7740;&#x8FD9;&#x6761;&#x94FE;&#x4F20;&#x9012;&#x8BE5;&#x8BF7;&#x6C42;&#xFF0C;&#x76F4;&#x5230;&#x6709;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5904;&#x7406;&#x5B83;&#x3002;</p>
</li>
<li><p><strong>Command&#xFF08;&#x547D;&#x4EE4;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5C06;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x5C01;&#x88C5;&#x4E3A;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x4F60;&#x53EF;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x8BF7;&#x6C42;&#x5BF9;&#x5BA2;&#x6237;&#x8FDB;&#x884C;&#x53C2;&#x6570;&#x5316;&#xFF1B;&#x5BF9;&#x8BF7;&#x6C42;&#x6392;&#x961F;&#x6216;&#x8BB0;&#x5F55;&#x8BF7;&#x6C42;&#x65E5;&#x5FD7;&#xFF0C;&#x4EE5;&#x53CA;&#x652F;&#x6301;&#x53EF;&#x53D6;&#x6D88;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
</li>
<li><p><strong>Interpreter&#xFF08;&#x89E3;&#x6790;&#x5668;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A;&#x8BED;&#x8A00;, &#x5B9A;&#x4E49;&#x5B83;&#x7684;&#x6587;&#x6CD5;&#x7684;&#x4E00;&#x79CD;&#x8868;&#x793A;&#xFF0C;&#x5E76;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x89E3;&#x91CA;&#x5668;, &#x8BE5;&#x89E3;&#x91CA;&#x5668;&#x4F7F;&#x7528;&#x8BE5;&#x8868;&#x793A;&#x6765;&#x89E3;&#x91CA;&#x8BED;&#x8A00;&#x4E2D;&#x7684;&#x53E5;&#x5B50;&#x3002;</p>
</li>
<li><p><strong>Iterator&#xFF08;&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x987A;&#x5E8F;&#x8BBF;&#x95EE;&#x4E00;&#x4E2A;&#x805A;&#x5408;&#x5BF9;&#x8C61;&#x4E2D;&#x5404;&#x4E2A;&#x5143;&#x7D20;&#xFF0C;&#x800C;&#x53C8;&#x4E0D;&#x9700;&#x66B4;&#x9732;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x90E8;&#x8868;&#x793A;&#x3002;</p>
</li>
<li><p><strong>Mediator&#xFF08;&#x4E2D;&#x4ECB;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x7528;&#x4E00;&#x4E2A;&#x4E2D;&#x4ECB;&#x5BF9;&#x8C61;&#x6765;&#x5C01;&#x88C5;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x5BF9;&#x8C61;&#x4EA4;&#x4E92;&#x3002;&#x4E2D;&#x4ECB;&#x8005;&#x4F7F;&#x5404;&#x5BF9;&#x8C61;&#x4E0D;&#x9700;&#x8981;&#x663E;&#x5F0F;&#x5730;&#x76F8;&#x4E92;&#x5F15;&#x7528;&#xFF0C;&#x4ECE;&#x800C;&#x4F7F;&#x5176;&#x8026;&#x5408;&#x677E;&#x6563;&#xFF0C;&#x800C;&#x4E14;&#x53EF;&#x4EE5;&#x72EC;&#x7ACB;&#x5730;&#x6539;&#x53D8;&#x5B83;&#x4EEC;&#x4E4B;&#x95F4;&#x7684;&#x4EA4;&#x4E92;&#x3002;</p>
</li>
<li><p><strong>Memento&#xFF08;&#x5907;&#x5FD8;&#x5F55;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5728;&#x4E0D;&#x7834;&#x574F;&#x5C01;&#x88C5;&#x6027;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#xFF0C;&#x6355;&#x83B7;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x5185;&#x90E8;&#x72B6;&#x6001;&#xFF0C;&#x5E76;&#x5728;&#x8BE5;&#x5BF9;&#x8C61;&#x4E4B;&#x5916;&#x4FDD;&#x5B58;&#x8FD9;&#x4E2A;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x6837;&#x4EE5;&#x540E;&#x5C31;&#x53EF;&#x5C06;&#x8BE5;&#x5BF9;&#x8C61;&#x6062;&#x590D;&#x5230;&#x4FDD;&#x5B58;&#x7684;&#x72B6;&#x6001;&#x3002;</p>
</li>
<li><p><strong>Observer&#xFF08;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5B9A;&#x4E49;&#x5BF9;&#x8C61;&#x95F4;&#x7684;&#x4E00;&#x79CD;&#x4E00;&#x5BF9;&#x591A;&#x7684;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;,&#x4EE5;&#x4FBF;&#x5F53;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x72B6;&#x6001;&#x53D1;&#x751F;&#x6539;&#x53D8;&#x65F6;,&#x6240;&#x6709;&#x4F9D;&#x8D56;&#x4E8E;&#x5B83;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x5F97;&#x5230;&#x901A;&#x77E5;&#x5E76;&#x81EA;&#x52A8;&#x5237;&#x65B0;&#x3002;</p>
</li>
<li><p><strong>State&#xFF08;&#x72B6;&#x6001;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5141;&#x8BB8;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5728;&#x5176;&#x5185;&#x90E8;&#x72B6;&#x6001;&#x6539;&#x53D8;&#x65F6;&#x6539;&#x53D8;&#x5B83;&#x7684;&#x884C;&#x4E3A;&#x3002;&#x5BF9;&#x8C61;&#x770B;&#x8D77;&#x6765;&#x4F3C;&#x4E4E;&#x4FEE;&#x6539;&#x4E86;&#x5B83;&#x6240;&#x5C5E;&#x7684;&#x7C7B;&#x3002;</p>
</li>
<li><p><strong>Strategy&#xFF08;&#x7B56;&#x7565;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5B9A;&#x4E49;&#x4E00;&#x7CFB;&#x5217;&#x7684;&#x7B97;&#x6CD5;,&#x628A;&#x5B83;&#x4EEC;&#x4E00;&#x4E2A;&#x4E2A;&#x5C01;&#x88C5;&#x8D77;&#x6765;, &#x5E76;&#x4E14;&#x4F7F;&#x5B83;&#x4EEC;&#x53EF;&#x76F8;&#x4E92;&#x66FF;&#x6362;&#x3002;&#x672C;&#x6A21;&#x5F0F;&#x4F7F;&#x5F97;&#x7B97;&#x6CD5;&#x7684;&#x53D8;&#x5316;&#x53EF;&#x72EC;&#x7ACB;&#x4E8E;&#x4F7F;&#x7528;&#x5B83;&#x7684;&#x5BA2;&#x6237;&#x3002;</p>
</li>
<li><p><strong>Template Method&#xFF08;&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x5B9A;&#x4E49;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x4E2D;&#x7684;&#x7B97;&#x6CD5;&#x7684;&#x9AA8;&#x67B6;&#xFF0C;&#x800C;&#x5C06;&#x4E00;&#x4E9B;&#x6B65;&#x9AA4;&#x5EF6;&#x8FDF;&#x5230;&#x5B50;&#x7C7B;&#x4E2D;&#x3002;Template Method&#x4F7F;&#x5F97;&#x5B50;&#x7C7B;&#x53EF;&#x4EE5;&#x4E0D;&#x6539;&#x53D8;&#x4E00;&#x4E2A;&#x7B97;&#x6CD5;&#x7684;&#x7ED3;&#x6784;&#x5373;&#x53EF;&#x91CD;&#x5B9A;&#x4E49;&#x8BE5;&#x7B97;&#x6CD5;&#x7684;&#x67D0;&#x4E9B;&#x7279;&#x5B9A;&#x6B65;&#x9AA4;&#x3002;</p>
</li>
<li><p><strong>Visitor&#xFF08;&#x8BBF;&#x95EE;&#x8005;&#x6A21;&#x5F0F;&#xFF09;</strong>&#xFF1A;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x4F5C;&#x7528;&#x4E8E;&#x67D0;&#x5BF9;&#x8C61;&#x7ED3;&#x6784;&#x4E2D;&#x7684;&#x5404;&#x5143;&#x7D20;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5B83;&#x4F7F;&#x4F60;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x6539;&#x53D8;&#x5404;&#x5143;&#x7D20;&#x7684;&#x7C7B;&#x7684;&#x524D;&#x63D0;&#x4E0B;&#x5B9A;&#x4E49;&#x4F5C;&#x7528;&#x4E8E;&#x8FD9;&#x4E9B;&#x5143;&#x7D20;&#x7684;&#x65B0;&#x64CD;&#x4F5C;&#x3002;</p>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;&amp;#x8BBE;&amp;#x8BA1;&amp;#x539F;&amp;#x5219;&quot;&gt;&lt;a href=&quot;#&amp;#x8BBE;&amp;#x8BA1;&amp;#x539F;&amp;#x5219;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x8BBE;&amp;#x8BA1;&amp;#x539F;&amp;#x5219;&quot;&gt;&lt;/a&gt;&amp;#x8BBE;&amp;#x8BA1;&amp;#x539F;&amp;#x5219;&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;/2016/design-pattern/Design-principles.png&quot; alt=&quot;&amp;#x8BBE;&amp;#x8BA1;&amp;#x539F;&amp;#x5219;&quot;&gt;&lt;/p&gt;
&lt;h6 id=&quot;1-&amp;#x5355;&amp;#x4E00;&amp;#x804C;&amp;#x8D23;&amp;#x539F;&amp;#x5219;-SRP&quot;&gt;&lt;a href=&quot;#1-&amp;#x5355;&amp;#x4E00;&amp;#x804C;&amp;#x8D23;&amp;#x539F;&amp;#x5219;-SRP&quot; class=&quot;headerlink&quot; title=&quot;1. &amp;#x5355;&amp;#x4E00;&amp;#x804C;&amp;#x8D23;&amp;#x539F;&amp;#x5219;(SRP)&quot;&gt;&lt;/a&gt;1. &amp;#x5355;&amp;#x4E00;&amp;#x804C;&amp;#x8D23;&amp;#x539F;&amp;#x5219;(SRP)&lt;/h6&gt;&lt;p&gt;&amp;#x539F;&amp;#x5219;: &amp;#x5E94;&amp;#x8BE5;&amp;#x6709;&amp;#x4E14;&amp;#x4EC5;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x539F;&amp;#x56E0;&amp;#x5F15;&amp;#x8D77;&amp;#x7C7B;&amp;#x7684;&amp;#x53D8;&amp;#x66F4;.&lt;br&gt;&amp;#x9002;&amp;#x7528;&amp;#x4E8E; &amp;#x63A5;&amp;#x53E3;, &amp;#x7C7B;, &amp;#x65B9;&amp;#x6CD5; &amp;#x2026;&lt;br&gt;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B9;&amp;#x6CD5;&amp;#x5C3D;&amp;#x53EF;&amp;#x80FD;&amp;#x53EA;&amp;#x505A;&amp;#x4E00;&amp;#x4EF6;&amp;#x4E8B;, &amp;#x4E0D;&amp;#x8981;&amp;#x8BA9;&amp;#x4E00;&amp;#x4E2A;&amp;#x65B9;&amp;#x6CD5;&amp;#x62C5;&amp;#x4EFB;&amp;#x591A;&amp;#x4E2A;&amp;#x804C;&amp;#x8D23;.&lt;br&gt;&amp;#x5982;: &amp;#x5C5E;&amp;#x6027; &amp;#x548C; &amp;#x884C;&amp;#x4E3A; &amp;#x5206;&amp;#x79BB;&lt;/p&gt;
&lt;h6 id=&quot;2-&amp;#x91CC;&amp;#x6C0F;&amp;#x66FF;&amp;#x6362;&amp;#x539F;&amp;#x5219;-LSP&quot;&gt;&lt;a href=&quot;#2-&amp;#x91CC;&amp;#x6C0F;&amp;#x66FF;&amp;#x6362;&amp;#x539F;&amp;#x5219;-LSP&quot; class=&quot;headerlink&quot; title=&quot;2. &amp;#x91CC;&amp;#x6C0F;&amp;#x66FF;&amp;#x6362;&amp;#x539F;&amp;#x5219;(LSP)&quot;&gt;&lt;/a&gt;2. &amp;#x91CC;&amp;#x6C0F;&amp;#x66FF;&amp;#x6362;&amp;#x539F;&amp;#x5219;(LSP)&lt;/h6&gt;&lt;p&gt;Overload &amp;#x91CD;&amp;#x8F7D;&lt;br&gt;Override &amp;#x8986;&amp;#x5199;&lt;br&gt;Design by Contract &amp;#x5951;&amp;#x7EA6;&amp;#x8BBE;&amp;#x8BA1;&lt;br&gt;&amp;#x539F;&amp;#x5219;: &amp;#x53EA;&amp;#x8981;&amp;#x7236;&amp;#x7C7B;&amp;#x51FA;&amp;#x73B0;&amp;#x7684;&amp;#x5730;&amp;#x65B9;&amp;#x5B50;&amp;#x7C7B;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x51FA;&amp;#x73B0;, &amp;#x800C;&amp;#x4E14;&amp;#x66FF;&amp;#x6362;&amp;#x4E3A;&amp;#x5B50;&amp;#x7C7B;&amp;#x4E0D;&amp;#x4F1A;&amp;#x4EA7;&amp;#x751F;&amp;#x4EFB;&amp;#x4F55;&amp;#x9519;&amp;#x8BEF;&amp;#x6216;&amp;#x5F02;&amp;#x5E38;.&lt;br&gt;&amp;#x76EE;&amp;#x7684;: &amp;#x589E;&amp;#x5F3A;&amp;#x7A0B;&amp;#x5E8F;&amp;#x7684;&amp;#x5065;&amp;#x58EE;&amp;#x6027;, &amp;#x7248;&amp;#x672C;&amp;#x5347;&amp;#x7EA7;&amp;#x4E5F;&amp;#x53EF;&amp;#x4EE5;&amp;#x4FDD;&amp;#x6301;&amp;#x597D;&amp;#x7684;&amp;#x517C;&amp;#x5BB9;&amp;#x6027;.&lt;/p&gt;
&lt;h6 id=&quot;3-&amp;#x4F9D;&amp;#x8D56;&amp;#x5012;&amp;#x7F6E;&amp;#x539F;&amp;#x5219;-DIP&quot;&gt;&lt;a href=&quot;#3-&amp;#x4F9D;&amp;#x8D56;&amp;#x5012;&amp;#x7F6E;&amp;#x539F;&amp;#x5219;-DIP&quot; class=&quot;headerlink&quot; title=&quot;3. &amp;#x4F9D;&amp;#x8D56;&amp;#x5012;&amp;#x7F6E;&amp;#x539F;&amp;#x5219;(DIP)&quot;&gt;&lt;/a&gt;3. &amp;#x4F9D;&amp;#x8D56;&amp;#x5012;&amp;#x7F6E;&amp;#x539F;&amp;#x5219;(DIP)&lt;/h6&gt;&lt;p&gt;&amp;#x672C;&amp;#x8D28;: &amp;#x901A;&amp;#x8FC7;&amp;#x62BD;&amp;#x8C61;(&amp;#x63A5;&amp;#x53E3;&amp;#x6216;&amp;#x62BD;&amp;#x8C61;&amp;#x7C7B;)&amp;#x4F7F;&amp;#x5404;&amp;#x4E2A;&amp;#x7C7B;&amp;#x6216;&amp;#x6A21;&amp;#x5757;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x5F7C;&amp;#x6B64;&amp;#x72EC;&amp;#x7ACB;, &amp;#x5B9E;&amp;#x73B0;&amp;#x6A21;&amp;#x5757;&amp;#x677E;&amp;#x8026;&amp;#x5408;&lt;br&gt;&amp;#x9762;&amp;#x5411;&amp;#x63A5;&amp;#x53E3;&amp;#x7F16;&amp;#x7A0B;&lt;br&gt;&amp;#x4F9D;&amp;#x8D56;&amp;#x62BD;&amp;#x8C61;, &amp;#x4E0D;&amp;#x8BE5;&amp;#x4F9D;&amp;#x8D56;&amp;#x7EC6;&amp;#x8282;&lt;/p&gt;
&lt;h6 id=&quot;4-&amp;#x63A5;&amp;#x53E3;&amp;#x9694;&amp;#x79BB;&amp;#x539F;&amp;#x5219;&quot;&gt;&lt;a href=&quot;#4-&amp;#x63A5;&amp;#x53E3;&amp;#x9694;&amp;#x79BB;&amp;#x539F;&amp;#x5219;&quot; class=&quot;headerlink&quot; title=&quot;4. &amp;#x63A5;&amp;#x53E3;&amp;#x9694;&amp;#x79BB;&amp;#x539F;&amp;#x5219;&quot;&gt;&lt;/a&gt;4. &amp;#x63A5;&amp;#x53E3;&amp;#x9694;&amp;#x79BB;&amp;#x539F;&amp;#x5219;&lt;/h6&gt;&lt;p&gt;&amp;#x539F;&amp;#x5219;: &amp;#x63A5;&amp;#x53E3;&amp;#x548C;&amp;#x7C7B;&amp;#x7684;&amp;#x5B9A;&amp;#x4E49;&amp;#x5C3D;&amp;#x91CF;&amp;#x4F7F;&amp;#x7528;&amp;#x539F;&amp;#x5B50;&amp;#x63A5;&amp;#x53E3;&amp;#x6216;&amp;#x539F;&amp;#x5B50;&amp;#x7C7B;&lt;br&gt;&amp;#x548C;&amp;#x5355;&amp;#x4E00;&amp;#x804C;&amp;#x8D23;&amp;#x539F;&amp;#x5219;&amp;#x7684;&amp;#x5BA1;&amp;#x89C6;&amp;#x89D2;&amp;#x5EA6;&amp;#x4E0D;&amp;#x540C;&lt;/p&gt;
&lt;h6 id=&quot;5-&amp;#x8FEA;&amp;#x7C73;&amp;#x7279;&amp;#x6CD5;&amp;#x5219;-LoD-&amp;#x6700;&amp;#x5C11;&amp;#x77E5;&amp;#x8BC6;&amp;#x539F;&amp;#x5219;-LKP&quot;&gt;&lt;a href=&quot;#5-&amp;#x8FEA;&amp;#x7C73;&amp;#x7279;&amp;#x6CD5;&amp;#x5219;-LoD-&amp;#x6700;&amp;#x5C11;&amp;#x77E5;&amp;#x8BC6;&amp;#x539F;&amp;#x5219;-LKP&quot; class=&quot;headerlink&quot; title=&quot;5. &amp;#x8FEA;&amp;#x7C73;&amp;#x7279;&amp;#x6CD5;&amp;#x5219;(LoD) / &amp;#x6700;&amp;#x5C11;&amp;#x77E5;&amp;#x8BC6;&amp;#x539F;&amp;#x5219;(LKP)&quot;&gt;&lt;/a&gt;5. &amp;#x8FEA;&amp;#x7C73;&amp;#x7279;&amp;#x6CD5;&amp;#x5219;(LoD) / &amp;#x6700;&amp;#x5C11;&amp;#x77E5;&amp;#x8BC6;&amp;#x539F;&amp;#x5219;(LKP)&lt;/h6&gt;&lt;p&gt;&amp;#x5BF9;&amp;#x8C61;&amp;#x5E94;&amp;#x8BE5;&amp;#x5BF9;&amp;#x5176;&amp;#x4ED6;&amp;#x5BF9;&amp;#x8C61;&amp;#x6709;&amp;#x6700;&amp;#x5C11;&amp;#x7684;&amp;#x4E86;&amp;#x89E3;&lt;br&gt;&amp;#x7C7B;&amp;#x95F4;&amp;#x89E3;&amp;#x8026;, &amp;#x5F31;&amp;#x8026;&amp;#x5408;&lt;/p&gt;
&lt;h6 id=&quot;6-&amp;#x5F00;&amp;#x95ED;&amp;#x539F;&amp;#x5219;&quot;&gt;&lt;a href=&quot;#6-&amp;#x5F00;&amp;#x95ED;&amp;#x539F;&amp;#x5219;&quot; class=&quot;headerlink&quot; title=&quot;6. &amp;#x5F00;&amp;#x95ED;&amp;#x539F;&amp;#x5219;&quot;&gt;&lt;/a&gt;6. &amp;#x5F00;&amp;#x95ED;&amp;#x539F;&amp;#x5219;&lt;/h6&gt;&lt;p&gt;&amp;#x5BF9;&amp;#x6269;&amp;#x5C55;&amp;#x5F00;&amp;#x653E;, &amp;#x5BF9;&amp;#x4FEE;&amp;#x6539;&amp;#x5173;&amp;#x95ED;&lt;br&gt;&amp;#x524D;5&amp;#x4E2A;&amp;#x90FD;&amp;#x662F;&amp;#x5F00;&amp;#x95ED;&amp;#x539F;&amp;#x5219;&amp;#x7684;&amp;#x5177;&amp;#x4F53;&amp;#x5F62;&amp;#x6001;&lt;br&gt;&amp;#x5F00;&amp;#x95ED;&amp;#x539F;&amp;#x5219;&amp;#x662F;&amp;#x5176;&amp;#x7CBE;&amp;#x795E;&amp;#x9886;&amp;#x8896;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>trace route 网络命令原理</title>
    <link href="http://snowyying.github.io/2016/trace-route/"/>
    <id>http://snowyying.github.io/2016/trace-route/</id>
    <published>2016-11-10T09:22:24.000Z</published>
    <updated>2016-11-14T07:03:02.530Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/2016/trace-route/Windows_tracert.png" alt="Windows_tracert"></p>
<p>&#x3000;&#x3000;traceroute&#xFF0C; &#x4E5F;&#x5C31;&#x662F; trace route&#xFF0C;&#x8DDF;&#x8E2A;&#x8DEF;&#x7531;&#x3002;&#x8FD9;&#x4E2A;&#x7A0B;&#x5E8F;&#x6700;&#x65E9;&#x662F;Van Jacobson&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x6E90;&#x7801;&#x5728;&#x7F51;&#x4E0A;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#xFF0C;&#x4E0D;&#x8FC7;&#x6211;&#x8FD8;&#x6CA1;&#x6709;&#x53BB;&#x627E;&#x3002;&#x4E3B;&#x8981;&#x7684;&#x539F;&#x7406;&#x662F;IP&#x8DEF;&#x7531;&#x8FC7;&#x7A0B;&#x4E2D;&#x5BF9;&#x6570;&#x636E;&#x5305;TTL(Time to Live&#xFF0C;&#x5B58;&#x6D3B;&#x65F6;&#x95F4;)&#x7684;&#x5904;&#x7406;&#x3002;&#x5F53;&#x8DEF;&#x7531;&#x5668;&#x6536;&#x5230;&#x4E00;&#x4E2A;IP&#x5305;&#x65F6;&#xFF0C;&#x4F1A;&#x4FEE;&#x6539;IP&#x5305;&#x7684;TTL&#xFF08;&#x53CA;&#x7531;&#x6B64;&#x9020;&#x6210;&#x7684;&#x5934;&#x90E8;&#x68C0;&#x9A8C;&#x548C;checksum&#x53D8;&#x5316;&#xFF09;&#x3002;&#x6BCF;&#x6536;&#x5230;&#x4E00;&#x4E2A;&#x5305;&#xFF0C;&#x68C0;&#x67E5;&#x8FD9;&#x4E2A; &#x7684;TTL&#x662F;&#x5426;&#x662F;0&#x6216;1&#x3002;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x8868;&#x660E;&#x8FD9;&#x4E2A;&#x5305;&#x8FD8;&#x6CA1;&#x6709;&#x5230;&#x8FBE;&#x76EE;&#x7684;&#x5730;&#xFF0C;&#x800C;&#x4E14;&#x5269;&#x4F59;&#x65F6;&#x95F4;&#x4E0D;&#x591A;&#x4E86;&#xFF0C;&#x80AF;&#x5B9A;&#x662F;&#x5230;&#x4E0D;&#x4E86;&#x76EE;&#x7684;&#x5730;&#x4E86;&#x3002;&#x8FD9;&#x6837;&#x8DEF;&#x7531;&#x5668;&#x5C31;&#x7B80;&#x5355;&#x5730;&#x4E22;&#x5F03;&#x8FD9;&#x4E2A;&#x5305;&#xFF0C;&#x5E76;&#x7ED9;&#x6E90;&#x4E3B;&#x673A;&#x53D1;&#x9001; ICMP&#x901A;&#x77E5;&#xFF0C;&#x8BF4;&#x8FD9;&#x4E2A;&#x5305;&#x5DF2;&#x7ECF;&#x8D85;&#x65F6;&#x4E86;&#x3002;ICMP&#x7684;&#x901A;&#x77E5;&#x4FE1;&#x606F;&#x91CC;&#x5305;&#x542B;&#x5F53;&#x524D;&#x8DEF;&#x7531;&#x5668;&#x53D1;&#x9001;&#x65F6;&#x6240;&#x7528;&#x7684;IP&#x3002;</p>
<p>&#x3000;&#x3000;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x6784;&#x9020;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x6765;&#x95F4;&#x63A5;&#x68C0;&#x67E5;&#x5230; &#x8FBE;&#x4E00;&#x4E2A;&#x4E3B;&#x673A;&#x65F6;&#x7ECF;&#x8FC7;&#x4E86;&#x54EA;&#x4E9B;&#x8DEF;&#x7531;&#x3002;&#x4E00;&#x5F00;&#x59CB;&#x53D1;&#x9001;&#x4E00;&#x4E2A;TTL&#x4E3A;1&#x7684;&#x5305;&#xFF0C;&#x8FD9;&#x6837;&#x5230;&#x8FBE;&#x7B2C;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5DF2;&#x7ECF;&#x8D85;&#x65F6;&#x4E86;&#xFF0C;&#x7B2C;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x5C31;&#x53D1;&#x901A;&#x77E5;&#x8BF4;&#x5305;&#x8D85;&#x65F6;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x8BB0;&#x5F55;&#x4E0B; &#x6240;&#x7ECF;&#x8FC7;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x7684;IP&#x3002;&#x7136;&#x540E;TTL&#x52A0;1&#xFF0C;&#x5B89;&#x5168;&#x901A;&#x8FC7;&#x7B2C;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#xFF0C;&#x800C;&#x7B2C;&#x4E8C;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x7684;&#x7684;&#x5904;&#x7406;&#x4E0E;&#x7B2C;&#x4E00;&#x4E2A;&#x76F8;&#x540C;&#xFF0C;&#x4E22;&#x5305;&#xFF0C;&#x53D1;&#x901A;&#x77E5;&#x8BF4;&#x5305;&#x8D85;&#x65F6;&#x4E86;&#xFF0C;&#x8FD9;&#x6837;&#x8BB0;&#x5F55;&#x4E0B;&#x7B2C;&#x4E8C;&#x4E2A;&#x8DEF; &#x7531;&#x5668;IP&#xFF0C;&#x7531;&#x6B64;&#x53EF;&#x4EE5;&#x4E00;&#x76F4;&#x8FDB;&#x884C;&#x4E0B;&#x53BB;&#xFF0C;&#x76F4;&#x5230;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x5230;&#x8FBE;&#x76EE;&#x6807;&#x4E3B;&#x673A;&#xFF0C;&#x7531;&#x6B64;&#x6253;&#x5370;&#x51FA;&#x6240;&#x6709;&#x7ECF;&#x8FC7;&#x7684;&#x8DEF;&#x7531;&#x5668;&#x3002;</p>
<a id="more"></a> 
<p>&#x3000;&#x3000;&#x5728;&#x901A;&#x4FE1;&#x4E2D;&#xFF0C;IP&#x5C42;&#x53EA;&#x8D1F;&#x8D23;&#x6570;&#x636E;&#x7684;&#x8DEF;&#x7531;&#x4E0E;&#x4F20; &#x8F93;&#xFF0C;&#x5E76;&#x4E0D;&#x5904;&#x7406;&#x6570;&#x636E;&#x5305;&#x7684;&#x5185;&#x5BB9;&#x3002;&#x4F8B;&#x5982;ICMP&#xFF0C;&#x6216;TCP&#xFF0C;UDP&#xFF0C;&#x8FD9;&#x4E9B;&#x534F;&#x8BAE;&#x662F;&#x4F9D;&#x8D56;IP&#x5C42;&#x7684;&#x4F20;&#x8F93;&#x529F;&#x80FD;&#x6765;&#x4F20;&#x9001;&#x6570;&#x636E;&#x7684;&#x3002;&#x5728;&#x901A;&#x4FE1;&#x53CC;&#x65B9;&#x7684;&#x4E3B;&#x673A;&#x4E2D;&#xFF0C;&#x6536;&#x5230;&#x8FD9;&#x4E9B;&#x534F;&#x8BAE;&#x7684;&#x6570;&#x636E;&#x5305; &#x540E;&#xFF0C;&#x4E00;&#x822C;&#x5728;&#x901A;&#x4FE1;&#x7684;&#x5BF9;&#x5E94;&#x4E3B;&#x673A;&#x4E0A;&#xFF0C;&#x4F1A;&#x6709;&#x7A0B;&#x5E8F;&#x6765;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x3002;&#x800C;&#x76F4;&#x63A5;&#x7684;IP&#x6570;&#x636E;&#x62A5;&#x662F;&#x6CA1;&#x6709;&#x7528;&#x5904;&#x7684;&#xFF08;win2000&#x7684;&#x9A71;&#x52A8;&#x5C42;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;IP&#x62A5;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x52A0;&#x4E0A;&#x5176;&#x4ED6;&#x534F; &#x8BAE;&#xFF0C;&#x4F46;&#x662F;&#x4E00;&#x822C;&#x662F;&#x4E0D;&#x4F1A;&#x8FD9;&#x6837;&#x7528;&#x7684;&#xFF09;&#x3002;&#x56E0;&#x6B64;traceroute&#x7A0B;&#x5E8F;&#x53D1;&#x9001;&#x4E00;&#x4E2A;UDP&#x5305;&#x6765;&#x8BD5;&#x63A2;&#x3002;&#x5BF9;&#x8DEF;&#x7531;&#x5668;&#x6765;&#x8BF4;&#xFF0C;UDP&#x6570;&#x636E;&#x62A5;&#x53EA;&#x662F;IP&#x6570;&#x636E;&#x62A5;&#x7684;&#x4E00;&#x79CD;&#xFF0C;&#x5B83;&#x5E76;&#x4E0D;&#x5173;&#x5FC3; UDP&#x6570;&#x636E;&#x62A5;&#x7684;&#x5177;&#x4F53;&#x5185;&#x5BB9;&#x3002;&#x76F4;&#x5230;&#x8FD9;&#x4E2A;&#x5305;&#x5230;&#x8FBE;&#x76EE;&#x7684;&#x7AEF;&#x7684;&#x4E3B;&#x673A;&#x4F1A;&#xFF0C;&#x76EE;&#x7684;&#x4E3B;&#x673A;&#x7684;&#x5185;&#x6838;&#x4F1A;&#x89E3;&#x6790;UDP&#x6570;&#x636E;&#x62A5;&#xFF0C;&#x5E76;&#x67E5;&#x627E;&#x6570;&#x636E;&#x62A5;&#x4E2D;&#x8981;&#x6C42;&#x7AEF;&#x53E3;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x6709;&#x8FDB;&#x7A0B;&#x5728;&#x4F7F;&#x7528;&#x3002;&#x5982;&#x679C;&#x627E;&#x5230;&#xFF0C;&#x5219; &#x901A;&#x77E5;&#x8FDB;&#x7A0B;&#x6709;&#x6570;&#x636E;&#x5230;&#x8FBE;&#x3002;&#x800C;&#x5982;&#x679C;&#x627E;&#x4E0D;&#x5230;&#xFF0C;&#x5219;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x201D;&#x76EE;&#x7684;&#x7AEF;&#x53E3;&#x4E0D;&#x53EF;&#x8FBE;&#x201D;&#x7684;ICMP&#x9519;&#x8BEF;&#x6570;&#x636E;&#x56DE;&#x5230;&#x6E90;&#x4E3B;&#x673A;&#x3002;</p>
<p>&#x3000;&#x3000;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5B8C;&#x5168;&#x786E;&#x5B9A;&#x4E0B;&#x6765;&#x3002;trcertroute&#x5EFA;&#x7ACB;&#x4E00;&#x4E2A;UDP&#x6570;&#x636E;&#x5305;&#xFF0C;&#x4E0D;&#x65AD;&#x4FEE;&#x6539;TTL&#x503C;&#x5E76;&#x53D1;&#x9001;&#x51FA;&#x53BB;&#xFF0C;&#x5982;&#x679C;&#x6536;&#x5230;&#x201D;&#x8D85;&#x65F6;&#x9519;&#x201D;&#xFF0C;&#x8868;&#x793A;&#x521A;&#x521A;&#x5230;&#x8FBE;&#x7684;&#x662F;&#x8DEF;&#x7531;&#x5668;&#xFF0C;&#x800C;&#x5982;&#x679C;&#x6536;&#x5230;&#x7684;&#x662F;&#x201D;&#x7AEF;&#x53E3;&#x4E0D;&#x53EF;&#x8FBE;&#x201D;&#x9519;&#x8BEF;&#xFF0C;&#x8868;&#x793A;&#x521A;&#x521A;&#x5230;&#x8FBE;&#x7684;&#x5C31;&#x662F;&#x76EE;&#x7684;&#x4E3B;&#x673A;&#x3002;&#x8FD9;&#x6837;&#x8DEF;&#x7531;&#x8DDF;&#x8E2A;&#x5B8C;&#x6210;&#xFF0C;&#x7A0B;&#x5E8F;&#x7ED3;&#x675F;&#x3002;</p>
<p>&#x6709;&#x51E0;&#x4E2A;&#x7EC6;&#x8282;&#xFF1A;</p>
<ol>
<li>&#x5C40;&#x57DF;&#x7F51;&#x7684;&#x8DEF;&#x7531;&#x662F;&#x76F8;&#x5BF9;&#x7A33;&#x5B9A;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x7528;traceroute&#x6253;&#x5370;&#x51FA;&#x6765;&#x7684;&#x54CD;&#x5E94;&#x65F6;&#x95F4;&#x76F8;&#x5DEE;&#x4E0D;&#x5927;&#x3002;&#x800C;&#x5982;&#x679C;&#x7528;&#x6765;&#x8DDF;&#x8E2A;&#x5E7F;&#x57DF;&#x7F51;&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x7531;&#x4E8E;&#x5E7F;&#x57DF;&#x7F51;&#x7684;&#x8DEF;&#x7531;&#x4FE1;&#x606F;&#x662F;&#x52A8;&#x6001;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x5E76;&#x4E0D;&#x80FD;&#x786E;&#x5B9A;&#x662F;&#x53D1;&#x9001;&#x8DEF;&#x5F84;&#x8017;&#x65F6;&#x8FD8;&#x662F;&#x8FD4;&#x56DE;&#x8DEF;&#x5F84;&#x8017;&#x65F6;&#x8F83;&#x591A;&#xFF0C;&#x56E0;&#x6B64;&#x65F6;&#x95F4;&#x4E0E;&#x8DEF;&#x7531;&#x4FE1;&#x606F;&#x53EA;&#x80FD;&#x505A;&#x4E3A;&#x53C2;&#x8003;&#x3002;</li>
<li>TTL &#x7684;&#x9009;&#x62E9;&#x3002;&#x5982;&#x679C;&#x628A;TTL&#x8BBE;&#x5F97;&#x8DB3;&#x591F;&#x5927;&#xFF0C;&#x662F;&#x4E0D;&#x662F;&#x4E00;&#x5B9A;&#x53EF;&#x4EE5;&#x6253;&#x5370;&#x51FA;&#x6240;&#x6709;&#x8DEF;&#x7531;&#xFF0C;&#x6BD4;&#x5982;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x7ECF;&#x8FC7;300&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x624D;&#x5230;&#x8FBE;&#x76EE;&#x7684;&#x7AEF;&#x3002;&#x5F53;&#x7136;&#x5728;&#x73B0;&#x6709;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x4E0B;&#x4E0D;&#x592A;&#x53EF;&#x80FD;&#x51FA;&#x73B0;&#x8981;&#x7ECF; &#x8FC7;&#x8FD9;&#x4E48;&#x591A;&#x8DEF;&#x7531;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x800C;TTL&#x4FE1;&#x606F;&#x5728;IP&#x6570;&#x636E;&#x62A5;&#x4E2D;&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6700;&#x591A;&#x80FD;&#x8BBE;&#x5B9A;&#x5230;255&#xFF08;256&#x4EE5;&#x540E;&#x53C8;&#x91CD;&#x65B0;&#x4ECE;0&#x5F00;&#x59CB;&#xFF09;&#x3002;&#x8BBE;&#x5B9A;&#x8FD9;&#x4E2A;&#x4FE1;&#x606F;&#x7684;&#x76EE;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x9632;&#x6B62;&#x4E00; &#x4E9B;&#x50F5;&#x800C;&#x4E0D;&#x5316;&#x7684;&#x6570;&#x636E;&#x62A5;&#x5728;&#x7F51;&#x7EDC;&#x6F2B;&#x4E0A;&#x65E0;&#x76EE;&#x7684;&#x7684;&#x6E38;&#x8361;&#x800C;&#x4E0D;&#x6D88;&#x5931;&#x3002;&#x6570;&#x636E;&#x62A5;&#x6BCF;&#x7ECF;&#x8FC7;&#x4E00;&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#xFF0C;&#x8DEF;&#x7531;&#x5668;&#x5C31;&#x628A;TTL&#x51CF;1&#xFF08;&#x6216;&#x5728;&#x8BE5;&#x8DEF;&#x7531;&#x5668;&#x88AB;&#x5904;&#x7406;&#x524D;&#x7ECF;&#x8FC7;&#x7684;&#x79D2;&#x6570;&#xFF09;&#xFF0C;&#x603B;&#x6709;&#x4E00;&#x4E2A;&#x65F6;&#x5019;&#x4F1A; &#x88AB;&#x51CF;&#x5230;1&#xFF0C;&#x7136;&#x540E;&#x8DEF;&#x7531;&#x5668;&#x4F1A;&#x628A;&#x5B83;&#x4E22;&#x5F03;&#x3002;</li>
<li>traceroute&#x7684;&#x662F;&#x4EE5;&#x6536;&#x5230;&#x201D;&#x7AEF;&#x53E3;&#x4E0D;&#x53EF;&#x8FBE;&#x201D;&#x4E3A;&#x6807;&#x5FD7;&#x6765;&#x7ED3;&#x675F;&#x7684;&#x3002;&#x524D;&#x63D0;&#x662F;&#x53D1;&#x51FA;&#x7684;UDP&#x6570;&#x636E;&#x62A5;&#x4E2D;&#x8981;&#x6C42; &#x7684;&#x7AEF;&#x53E3;&#x5728;&#x76EE;&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#x6CA1;&#x6709;&#x8FDB;&#x7A0B;&#x5728;&#x4F7F;&#x7528;&#x3002;&#x800C;&#x5982;&#x679C;&#x76EE;&#x7684;&#x4E3B;&#x673A;&#x4E0A;&#x6B63;&#x597D;&#x6709;&#x8FDB;&#x7A0B;&#x5728;&#x4F7F;&#x7528;&#x8FD9;&#x4E2A;&#x7AEF;&#x53E3;&#xFF0C;&#x63A5;&#x6536;&#x8FD9;&#x4E2A;&#x5305;&#x5E76;&#x6309;&#x6B63;&#x5E38;&#x65B9;&#x5F0F;&#x5904;&#x7406;&#xFF0C;&#x8FD9;&#x6837;traceroute&#x5C31;&#x6536;&#x4E0D;&#x5230;&#x201D;&#x7AEF;&#x53E3;&#x4E0D; &#x53EF;&#x8FBE;&#x201D;&#x7684;&#x9519;&#x8BEF;&#x4E86;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#xFF0C;UDP&#x6570;&#x636E;&#x62A5;&#x7684;&#x7AEF;&#x53E3;&#x5F88;&#x9AD8;&#xFF08;&#x4E66;&#x4E2D;&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x521D;&#x59CB;&#x503C;33435&#xFF0C;&#x4EE5;&#x540E;&#x6BCF;&#x53D1;&#x9001;&#x4E00;&#x6B21;&#x518D;&#x52A0;1&#xFF0C;&#x7AEF;&#x53E3;&#x53F7;&#x6700;&#x5927;&#x53EF;&#x4EE5;&#x5230;65535&#xFF09;&#x3002; &#x666E;&#x901A;&#x7A0B;&#x5E8F;&#x4E00;&#x822C;&#x4E0D;&#x4F1A;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x9AD8;&#x7AEF;&#x53E3;&#x3002;&#x95EE;&#x9898;&#x662F;&#x5047;&#x5982;&#x771F;&#x7684;&#x5B58;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x65F6;&#xFF0C;traceroute&#x4F1A;&#x600E;&#x4E48;&#x5904;&#x7406;&#xFF1F;&#x800C;&#x597D;&#x50CF;Solaris&#x7CFB;&#x7EDF;&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x7528;&#x9AD8;&#x7AEF;&#x53E3;&#xFF0C;&#x8FD9;&#x65F6;&#x53C8;&#x600E; &#x4E48;&#x6837;&#x3002;</li>
<li>&#x5728;&#x53D1;&#x9001;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x8981;&#x7ECF;&#x8FC7;&#x8BB8;&#x591A;&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x5230;&#x8FBE;&#x76EE;&#x7684;&#x4E3B;&#x673A;&#x524D;&#xFF0C;&#x53EF;&#x80FD;&#x8FD8;&#x8981;&#x7ECF;&#x8FC7;&#x7F51;&#x5173;&#xFF0C;&#x9632;&#x706B;&#x5899;&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x4ED6;&#x4F8B;&#x5982;IDS&#x7684;&#x8FC7;&#x6EE4;&#xFF0C;&#x53D1;&#x9001;&#x5305;&#x80FD;&#x4E0D;&#x80FD;&#x5230;&#x8FBE;&#x76EE;&#x7684;&#x4E3B;&#x673A;&#x8FD8;&#x662F;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x800C;&#x5373;&#x4F7F;&#x5230; &#x8FBE;&#x4E86;&#xFF0C;&#x53D1;&#x9001;&#x7684;ICMP&#x4FE1;&#x606F;&#x80FD;&#x4E0D;&#x80FD;&#x8FD4;&#x56DE;&#x4E5F;&#x662F;&#x4E2A;&#x95EE;&#x9898;&#x3002;&#x56E0;&#x4E3A;&#x6CBF;&#x9014;&#x7ECF;&#x8FC7;&#x7684;&#x5173;&#x5361;&#x592A;&#x591A;&#xFF0C;&#x9047;&#x4E0A;&#x9ED1;&#x6D1E;&#x8DEF;&#x7531;&#x5668;&#xFF0C;&#x4E0D;&#x8F6C;&#x53D1;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#x7684;&#x8BDD;&#xFF0C;&#x90A3;&#x5C31;&#x4E00;&#x70B9;&#x529E;&#x6CD5;&#x4E5F;&#x6CA1;&#x6709;&#x4E86;&#x3002;</li>
</ol>
<p>&#x3000; &#x3000;&#x4E66;&#x4E2D;&#x8FD8;&#x63D0;&#x5230;&#x539F;&#x6765;&#x7684;traceroute&#x91CC;&#x6709;&#x4E00;&#x4E2A;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6570;&#x636E;&#x5305;&#x7ECF;&#x8FC7;&#x7684;&#x8DEF;&#x7531;&#x5668;&#x3002;&#x5982;&#x679C;&#x662F;&#x5BBD;&#x8DEF;&#x7531;&#xFF0C;&#x5219;&#x53EA;&#x8981;&#x7ECF;&#x8FC7;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x7531;&#x5373;&#x53EF;&#x3002;&#x800C;&#x5982;&#x679C;&#x662F;&#x4E25;&#x8DEF;&#x7531;&#xFF0C;&#x5219;&#x5FC5;&#x987B;&#x6309; &#x6307;&#x5B9A;&#x7684;&#x987A;&#x5E8F;&#x7ECF;&#x8FC7;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x7531;&#x5668;&#x3002;&#x56E0;&#x4E3A;&#x8FD9;&#x4E2A;&#x9009;&#x9879;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x67D0;&#x4E2A;&#x56FA;&#x5B9A;&#x7684;&#x8DEF;&#x7531;&#x5904;&#x7406;&#x4FE1;&#x606F;&#x592A;&#x591A;&#xFF0C;&#x5728;&#x516C;&#x5E03;&#x7684;&#x6E90;&#x7801;&#x91CC;&#x5DF2;&#x7ECF;&#x53D6;&#x6D88;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x8865;&#x4E01;&#xFF0C;&#x8FD8;&#x662F;&#x53EF;&#x4EE5;&#x7528;&#x8D77;&#x6765;&#x7684;&#x3002;&#x4ECE;&#x6BD4;&#x8F83; &#x7684;&#x7ED3;&#x679C;&#x770B;&#xFF0C;&#x4F3C;&#x4E4E;&#x6307;&#x5B9A;&#x8DEF;&#x7531;&#x5668;&#x53CD;&#x800C;&#x4E0D;&#x5982;&#x8BA9;&#x8DEF;&#x7531;&#x5668;&#x91C7;&#x7528;&#x9ED8;&#x8BA4;&#x8DEF;&#x7531;&#x5904;&#x7406;&#x5F97;&#x5FEB;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x4E25;&#x8DEF;&#x7531;&#x6765;&#x8BF4;&#xFF0C;&#x8981;&#x6210;&#x529F;&#x5C31;&#x8981;&#x66F4;&#x96BE;&#x4E00;&#x4E9B;&#xFF0C;&#x56E0;&#x4E3A;&#x5E76;&#x4E0D;&#x4E00;&#x5B9A;&#x4F60;&#x6307;&#x5B9A;&#x7684;&#x8DEF;&#x7531;&#x5668;&#x6B63;&#x597D;&#x6709;&#x6761;&#x76EE;&#x5230;&#x63A5;&#x4E0B;&#x6765; &#x7684;&#x8DEF;&#x7531;&#x5668;&#x3002;</p>
<p>&#x3000; &#x3000;ping&#x7A0B;&#x5E8F;&#x662F;&#x5229;&#x7528;icmp&#x7684;&#x56DE;&#x590D;&#x8BF7;&#x6C42;&#x6765;&#x63A2;&#x6D4B;&#x8FDC;&#x7AEF;&#x4E3B;&#x673A;&#x662F;&#x5426;&#x53EF;&#x8FBE;&#x3002;&#xFF08;&#x5E76;&#x4E0D;&#x80FD;&#x7EE7;&#x7EED;&#x5224;&#x65AD;&#x7AEF;&#x53E3;&#x662F;&#x5426;&#x53EF;&#x8FBE;&#x3002;&#x8981;&#x60F3;&#x67E5;&#x770B;&#x7AEF;&#x53E3;&#xFF0C;&#x5C31;&#x8981;&#x4F7F;&#x7528;&#x626B;&#x63CF;&#x5668;&#x4E86;&#x3002;&#xFF09;win2000&#x91CC;&#x7684;&#x7F51;&#x7EDC;&#x5E93;&#x91CC;&#x5DF2; &#x7ECF;&#x63D0;&#x4F9B;&#x7F51;&#x7EDC;&#x51FD;&#x6570;&#x5E93;(icmp.dll)&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x5229;&#x7528;icmp&#x6765;&#x63A2;&#x6D4B;&#x8FDC;&#x7AEF;&#x4E3B;&#x673A;&#x3002;&#x76F8;&#x6BD4;&#x8D77;&#x4F7F;&#x7528;&#x7BA1;&#x9053;&#x6765;&#x8BFB;ping&#x7684;&#x7ED3;&#x679C;&#xFF0C;&#x6216;&#x8005;&#x5D4C;&#x5165;ping&#x6E90;&#x7801;&#xFF0C;&#x8FD9;&#x4E2A;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#x65B9; &#x6CD5;&#x4E86;&#xFF08;&#x6CA1;&#x529E;&#x6CD5;&#xFF0C;&#x4EBA;&#x61D2;&#xFF09;&#x3002;ping&#x5176;&#x5B9E;&#x8FD8;&#x6709;&#x4E00;&#x4E2A;R&#x9009;&#x9879;&#xFF0C;&#x7528;&#x6765;&#x8BB0;&#x5F55;&#x7ECF;&#x8FC7;&#x7684;&#x8DEF;&#x7531;&#xFF0C;&#x4EE5;&#x524D;&#x4E00;&#x76F4;&#x4E0D;&#x77E5;&#x9053;&#x3002;(pingwww.google.com-r 7)&#x8BB0;&#x5F55;&#x7ECF;&#x8FC7;&#x7684;7&#x4E2A;&#x8DEF;&#x7531;&#x5668;&#x3002;&#x6309;&#x7167;&#x5206;&#x6790;&#xFF0C;&#x6839;&#x636E;&#x6240;&#x5728;&#x73AF;&#x5883;&#x9650;&#x5236;&#x6700;&#x591A;&#x53EF;&#x4EE5;&#x8BB0;&#x5F55;8~9&#x4E2A;&#x9879;&#x76EE;&#x3002;</p>
<p>&#x3000;&#x3000;&#x9664;&#x4E86;&#x56DE;&#x663E;&#x8BF7;&#x6C42;&#x5916;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5229;&#x7528;icmp&#x6765;&#x5B9E;&#x73B0;&#x65F6;&#x95F4;&#x8BF7;&#x6C42;&#x3002;&#x5728;icmp&#x7684;&#x6570;&#x636E;&#x5305;&#x4E2D;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x53D1;&#x9001;&#x65F6;&#x95F4;&#xFF0C;&#x76EE;&#x7684;&#x4E3B;&#x673A;&#x6536;&#x5230;&#x540E;&#x518D;&#x9644;&#x4E0A;&#x81EA;&#x8EAB;&#x5F53;&#x65F6;&#x65F6;&#x95F4;&#x624D;&#x53D1;&#x56DE;&#x3002;&#x8FD9;&#x6837;&#x53EF;&#x4EE5;&#x505A;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#x6821;&#x9A8C;&#xFF0C;&#x5E76;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x6E90;&#x4E0E;&#x76EE;&#x7684;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x8BAF;&#x901F;&#x5EA6;&#x3002;&#x7531;&#x4E8E;&#x5177;&#x4F53;&#x7684;&#x5185;&#x5BB9;&#x90E8;&#x5206;&#x6BD4;&#x8F83;&#x70E6;&#xFF0C;&#x7C7B;&#x578B;&#x592A;&#x591A;&#xFF0C;&#x4E00;&#x4E0B;&#x5B50;&#x8BB0;&#x4E0D;&#x4F4F;&#x5404;&#x4E2A;&#x7C7B;&#x578B;&#x7684;&#x610F;&#x601D;&#x3002;<br>&#x3000;&#x3000;&#x4E00;&#x822C;&#x7528;ping&#x7684;&#x65F6;&#x5019;&#x53EA;&#x662F;&#x7528;&#x4E86;&#x5B83;&#x7684;&#x6700;&#x7B80;&#x5355;&#x7684;&#x529F;&#x80FD;&#xFF1A;&#x68C0;&#x67E5;&#x4E3B;&#x673A;&#x80FD;&#x4E0D;&#x80FD;&#x8FDE;&#x5230;&#x3002;&#x5176;&#x5B9E;&#x4F7F;&#x7528;&#x5B83;&#x6240;&#x63D0;&#x4F9B;&#x7684;&#x5176;&#x4ED6;&#x9009;&#x9879;&#xFF0C;&#x53EF;&#x4EE5;&#x5B9E;&#x73B0;&#x8BB8;&#x591A;&#x7EC6;&#x8282;&#x4E0A;&#x7684;&#x63A7;&#x5236;&#xFF0C;&#x4F8B;&#x5982;&#x6570;&#x636E;&#x5305;&#x957F;&#x5EA6;&#xFF0C;TTL&#xFF0C;&#x8DEF;&#x7531;&#x8BB0;&#x5F55;&#xFF0C;&#x5BBD;/&#x4E25;&#x8DEF;&#x7531;&#x7ECF;&#x8FC7;&#x8DEF;&#x7531;&#x7B49;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/2016/trace-route/Windows_tracert.png&quot; alt=&quot;Windows_tracert&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x3000;&amp;#x3000;traceroute&amp;#xFF0C; &amp;#x4E5F;&amp;#x5C31;&amp;#x662F; trace route&amp;#xFF0C;&amp;#x8DDF;&amp;#x8E2A;&amp;#x8DEF;&amp;#x7531;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7A0B;&amp;#x5E8F;&amp;#x6700;&amp;#x65E9;&amp;#x662F;Van Jacobson&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#x3002;&amp;#x6E90;&amp;#x7801;&amp;#x5728;&amp;#x7F51;&amp;#x4E0A;&amp;#x53EF;&amp;#x4EE5;&amp;#x627E;&amp;#x5230;&amp;#xFF0C;&amp;#x4E0D;&amp;#x8FC7;&amp;#x6211;&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x53BB;&amp;#x627E;&amp;#x3002;&amp;#x4E3B;&amp;#x8981;&amp;#x7684;&amp;#x539F;&amp;#x7406;&amp;#x662F;IP&amp;#x8DEF;&amp;#x7531;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E2D;&amp;#x5BF9;&amp;#x6570;&amp;#x636E;&amp;#x5305;TTL(Time to Live&amp;#xFF0C;&amp;#x5B58;&amp;#x6D3B;&amp;#x65F6;&amp;#x95F4;)&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x3002;&amp;#x5F53;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#x6536;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;IP&amp;#x5305;&amp;#x65F6;&amp;#xFF0C;&amp;#x4F1A;&amp;#x4FEE;&amp;#x6539;IP&amp;#x5305;&amp;#x7684;TTL&amp;#xFF08;&amp;#x53CA;&amp;#x7531;&amp;#x6B64;&amp;#x9020;&amp;#x6210;&amp;#x7684;&amp;#x5934;&amp;#x90E8;&amp;#x68C0;&amp;#x9A8C;&amp;#x548C;checksum&amp;#x53D8;&amp;#x5316;&amp;#xFF09;&amp;#x3002;&amp;#x6BCF;&amp;#x6536;&amp;#x5230;&amp;#x4E00;&amp;#x4E2A;&amp;#x5305;&amp;#xFF0C;&amp;#x68C0;&amp;#x67E5;&amp;#x8FD9;&amp;#x4E2A; &amp;#x7684;TTL&amp;#x662F;&amp;#x5426;&amp;#x662F;0&amp;#x6216;1&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x662F;&amp;#xFF0C;&amp;#x8868;&amp;#x660E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5305;&amp;#x8FD8;&amp;#x6CA1;&amp;#x6709;&amp;#x5230;&amp;#x8FBE;&amp;#x76EE;&amp;#x7684;&amp;#x5730;&amp;#xFF0C;&amp;#x800C;&amp;#x4E14;&amp;#x5269;&amp;#x4F59;&amp;#x65F6;&amp;#x95F4;&amp;#x4E0D;&amp;#x591A;&amp;#x4E86;&amp;#xFF0C;&amp;#x80AF;&amp;#x5B9A;&amp;#x662F;&amp;#x5230;&amp;#x4E0D;&amp;#x4E86;&amp;#x76EE;&amp;#x7684;&amp;#x5730;&amp;#x4E86;&amp;#x3002;&amp;#x8FD9;&amp;#x6837;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#x5C31;&amp;#x7B80;&amp;#x5355;&amp;#x5730;&amp;#x4E22;&amp;#x5F03;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5305;&amp;#xFF0C;&amp;#x5E76;&amp;#x7ED9;&amp;#x6E90;&amp;#x4E3B;&amp;#x673A;&amp;#x53D1;&amp;#x9001; ICMP&amp;#x901A;&amp;#x77E5;&amp;#xFF0C;&amp;#x8BF4;&amp;#x8FD9;&amp;#x4E2A;&amp;#x5305;&amp;#x5DF2;&amp;#x7ECF;&amp;#x8D85;&amp;#x65F6;&amp;#x4E86;&amp;#x3002;ICMP&amp;#x7684;&amp;#x901A;&amp;#x77E5;&amp;#x4FE1;&amp;#x606F;&amp;#x91CC;&amp;#x5305;&amp;#x542B;&amp;#x5F53;&amp;#x524D;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#x53D1;&amp;#x9001;&amp;#x65F6;&amp;#x6240;&amp;#x7528;&amp;#x7684;IP&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x3000;&amp;#x3000;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x901A;&amp;#x8FC7;&amp;#x6784;&amp;#x9020;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#xFF0C;&amp;#x6765;&amp;#x95F4;&amp;#x63A5;&amp;#x68C0;&amp;#x67E5;&amp;#x5230; &amp;#x8FBE;&amp;#x4E00;&amp;#x4E2A;&amp;#x4E3B;&amp;#x673A;&amp;#x65F6;&amp;#x7ECF;&amp;#x8FC7;&amp;#x4E86;&amp;#x54EA;&amp;#x4E9B;&amp;#x8DEF;&amp;#x7531;&amp;#x3002;&amp;#x4E00;&amp;#x5F00;&amp;#x59CB;&amp;#x53D1;&amp;#x9001;&amp;#x4E00;&amp;#x4E2A;TTL&amp;#x4E3A;1&amp;#x7684;&amp;#x5305;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5230;&amp;#x8FBE;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x5C31;&amp;#x5DF2;&amp;#x7ECF;&amp;#x8D85;&amp;#x65F6;&amp;#x4E86;&amp;#xFF0C;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#x5C31;&amp;#x53D1;&amp;#x901A;&amp;#x77E5;&amp;#x8BF4;&amp;#x5305;&amp;#x8D85;&amp;#x65F6;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x5C31;&amp;#x53EF;&amp;#x4EE5;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E0B; &amp;#x6240;&amp;#x7ECF;&amp;#x8FC7;&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#x7684;IP&amp;#x3002;&amp;#x7136;&amp;#x540E;TTL&amp;#x52A0;1&amp;#xFF0C;&amp;#x5B89;&amp;#x5168;&amp;#x901A;&amp;#x8FC7;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#xFF0C;&amp;#x800C;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#x7684;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x4E0E;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x76F8;&amp;#x540C;&amp;#xFF0C;&amp;#x4E22;&amp;#x5305;&amp;#xFF0C;&amp;#x53D1;&amp;#x901A;&amp;#x77E5;&amp;#x8BF4;&amp;#x5305;&amp;#x8D85;&amp;#x65F6;&amp;#x4E86;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6837;&amp;#x8BB0;&amp;#x5F55;&amp;#x4E0B;&amp;#x7B2C;&amp;#x4E8C;&amp;#x4E2A;&amp;#x8DEF; &amp;#x7531;&amp;#x5668;IP&amp;#xFF0C;&amp;#x7531;&amp;#x6B64;&amp;#x53EF;&amp;#x4EE5;&amp;#x4E00;&amp;#x76F4;&amp;#x8FDB;&amp;#x884C;&amp;#x4E0B;&amp;#x53BB;&amp;#xFF0C;&amp;#x76F4;&amp;#x5230;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x5230;&amp;#x8FBE;&amp;#x76EE;&amp;#x6807;&amp;#x4E3B;&amp;#x673A;&amp;#xFF0C;&amp;#x7531;&amp;#x6B64;&amp;#x6253;&amp;#x5370;&amp;#x51FA;&amp;#x6240;&amp;#x6709;&amp;#x7ECF;&amp;#x8FC7;&amp;#x7684;&amp;#x8DEF;&amp;#x7531;&amp;#x5668;&amp;#x3002;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>p2p 概览</title>
    <link href="http://snowyying.github.io/2016/p2p-overview/"/>
    <id>http://snowyying.github.io/2016/p2p-overview/</id>
    <published>2016-11-10T02:50:41.000Z</published>
    <updated>2016-11-16T14:41:10.071Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-NAT-amp-NATP"><a href="#1-NAT-amp-NATP" class="headerlink" title="1 NAT&amp;NATP"></a>1 NAT&amp;NATP</h2><p>NAT&#x5927;&#x81F4;&#x5206;&#x4E3A;&#x4E0B;&#x9762;&#x56DB;&#x7C7B;</p>
<ol>
<li><p>Full Cone<br>&#x8FD9;&#x79CD;NAT&#x5185;&#x90E8;&#x7684;&#x673A;&#x5668;A&#x8FDE;&#x63A5;&#x8FC7;&#x5916;&#x7F51;&#x673A;&#x5668;C&#x540E;,NAT&#x4F1A;&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;.&#x7136;&#x540E;&#x5916;&#x7F51;&#x7684;&#x4EFB;&#x4F55;&#x53D1;&#x5230;&#x8FD9;&#x4E2A;&#x6253;&#x5F00;&#x7684;&#x7AEF;&#x53E3;&#x7684;UDP&#x6570;&#x636E;&#x62A5;&#x90FD;&#x53EF;&#x4EE5;&#x5230;&#x8FBE;A.&#x4E0D;&#x7BA1;&#x662F;&#x4E0D;&#x662F;C&#x53D1;&#x8FC7;&#x6765;&#x7684;.<br>&#x4F8B;&#x5982; A:192.168.8.100 NAT:202.100.100.100 C:292.88.88.88<br>A(192.168.8.100:5000) -&gt; NAT(202.100.100.100 : 8000) -&gt; C(292.88.88.88:2000)<br>&#x4EFB;&#x4F55;&#x53D1;&#x9001;&#x5230; NAT(202.100.100.100:8000)&#x7684;&#x6570;&#x636E;&#x90FD;&#x53EF;&#x4EE5;&#x5230;&#x8FBE;A(192.168.8.100:5000)</p>
</li>
<li><p>Restricted Cone<br>&#x8FD9;&#x79CD;NAT&#x5185;&#x90E8;&#x7684;&#x673A;&#x5668;A&#x8FDE;&#x63A5;&#x8FC7;&#x5916;&#x7F51;&#x7684;&#x673A;&#x5668;C&#x540E;,NAT&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;.&#x7136;&#x540E;C&#x53EF;&#x4EE5;&#x7528;&#x4EFB;&#x4F55;&#x7AEF;&#x53E3;&#x548C;A&#x901A;&#x4FE1;.&#x5176;&#x4ED6;&#x7684;&#x5916;&#x7F51;&#x673A;&#x5668;&#x4E0D;&#x884C;.<br>&#x4F8B;&#x5982; A:192.168.8.100 NAT:202.100.100.100 C:292.88.88.88<br>A(192.168.8.100:5000) -&gt; NAT(202.100.100.100 : 8000) -&gt; C(292.88.88.88:2000)<br>&#x4EFB;&#x4F55;&#x4ECE;C&#x53D1;&#x9001;&#x5230; NAT(202.100.100.100:8000)&#x7684;&#x6570;&#x636E;&#x90FD;&#x53EF;&#x4EE5;&#x5230;&#x8FBE;A(192.168.8.100:5000)</p>
</li>
<li><p>Port Restricted Cone<br>&#x8FD9;&#x79CD;NAT&#x5185;&#x90E8;&#x7684;&#x673A;&#x5668;A&#x8FDE;&#x63A5;&#x8FC7;&#x5916;&#x7F51;&#x7684;&#x673A;&#x5668;C&#x540E;,NAT&#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;.&#x7136;&#x540E;C&#x53EF;&#x4EE5;&#x7528;&#x539F;&#x6765;&#x7684;&#x7AEF;&#x53E3;&#x548C;A&#x901A;&#x4FE1;.&#x5176;&#x4ED6;&#x7684;&#x5916;&#x7F51;&#x673A;&#x5668;&#x4E0D;&#x884C;.<br>&#x4F8B;&#x5982; A:192.168.8.100 NAT:202.100.100.100 C:292.88.88.88<br>A(192.168.8.100:5000) -&gt; NAT(202.100.100.100 : 8000) -&gt; C(292.88.88.88:2000)<br>C(202.88.88.88:2000)&#x53D1;&#x9001;&#x5230; NAT(202.100.100.100:8000)&#x7684;&#x6570;&#x636E;&#x90FD;&#x53EF;&#x4EE5;&#x5230;&#x8FBE;A(192.168.8.100:5000)<br><em>&#x4EE5;&#x4E0A;&#x4E09;&#x79CD;NAT&#x901A;&#x79F0;Cone NAT.&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x7528;&#x8FD9;&#x79CD;NAT&#x8FDB;&#x884C;UDP&#x6253;&#x6D1E;.</em></p>
</li>
<li><p>Symmetic<br>&#x5BF9;&#x4E8E;&#x8FD9;&#x79CD;NAT.&#x8FDE;&#x63A5;&#x4E0D;&#x540C;&#x7684;&#x5916;&#x90E8;&#x76EE;&#x6807;.&#x539F;&#x6765;NAT&#x6253;&#x5F00;&#x7684;&#x7AEF;&#x53E3;&#x4F1A;&#x53D8;&#x5316;.&#x800C;Cone NAT&#x4E0D;&#x4F1A;.&#x867D;&#x7136;&#x53EF;&#x4EE5;&#x7528;&#x7AEF;&#x53E3;&#x731C;&#x6D4B;.&#x4F46;&#x662F;&#x6210;&#x529F;&#x7684;&#x6982;&#x7387;&#x5F88;&#x5C0F;.&#x56E0;&#x6B64;&#x653E;&#x5F03;&#x8FD9;&#x79CD;NAT&#x7684;UDP&#x6253;&#x6D1E;.</p>
</li>
</ol>
<p><img src="/2016/p2p-overview/12101539_K5KU.gif" alt="NAT &#x68C0;&#x6D4B;&#x6D41;&#x7A0B;"></p>
<h2 id="2-UPNP"><a href="#2-UPNP" class="headerlink" title="2 UPNP"></a>2 UPNP</h2><h2 id="3-STUN-amp-TURN-amp-ICE"><a href="#3-STUN-amp-TURN-amp-ICE" class="headerlink" title="3 STUN&amp;TURN&amp;ICE"></a>3 STUN&amp;TURN&amp;ICE</h2>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-NAT-amp-NATP&quot;&gt;&lt;a href=&quot;#1-NAT-amp-NATP&quot; class=&quot;headerlink&quot; title=&quot;1 NAT&amp;amp;NATP&quot;&gt;&lt;/a&gt;1 NAT&amp;amp;NATP&lt;/h2&gt;&lt;p&gt;NAT&amp;#x5927;&amp;#x81F4;&amp;#x
    
    </summary>
    
      <category term="Network" scheme="http://snowyying.github.io/categories/Network/"/>
    
    
      <category term="Network" scheme="http://snowyying.github.io/tags/Network/"/>
    
      <category term="p2p" scheme="http://snowyying.github.io/tags/p2p/"/>
    
      <category term="NTP" scheme="http://snowyying.github.io/tags/NTP/"/>
    
      <category term="NATP" scheme="http://snowyying.github.io/tags/NATP/"/>
    
      <category term="UPNP" scheme="http://snowyying.github.io/tags/UPNP/"/>
    
      <category term="STUN" scheme="http://snowyying.github.io/tags/STUN/"/>
    
      <category term="TRUN" scheme="http://snowyying.github.io/tags/TRUN/"/>
    
      <category term="ICE" scheme="http://snowyying.github.io/tags/ICE/"/>
    
  </entry>
  
  <entry>
    <title>使用ffmepg解码h264流过程</title>
    <link href="http://snowyying.github.io/2016/ffmepg-h264-decode/"/>
    <id>http://snowyying.github.io/2016/ffmepg-h264-decode/</id>
    <published>2016-11-01T10:49:29.000Z</published>
    <updated>2016-11-14T07:24:37.388Z</updated>
    
    <content type="html"><![CDATA[<p>&#x4EE5;ffmpeg-3.1.5&#x4E3A;&#x4F8B;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></div><div class="line">{</div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;libavutil\opt.h&quot;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;libavcodec\avcodec.h&quot;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;libavformat\avformat.h&quot;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;libswscale\swscale.h&quot;</span>  </span></div><div class="line">};</div></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// &#x4F2A;&#x4EE3;&#x7801; - &#x4EC5;&#x793A;&#x610F;&#x6D41;&#x7A0B;</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ffmpeg_process</span><span class="params">()</span></span></div><div class="line">{</div><div class="line">    AVCodec *codec;</div><div class="line">    AVCodecContext *c = <span class="literal">NULL</span>;</div><div class="line">    AVFrame *frame;</div><div class="line">    <span class="keyword">uint8_t</span> *inbuf;</div><div class="line">    AVPacket avpkt;</div><div class="line"></div><div class="line">    <span class="comment">/* register all the codecs */</span></div><div class="line">    avcodec_register_all();</div><div class="line"></div><div class="line">    av_init_packet(&amp;avpkt);</div><div class="line"></div><div class="line">    <span class="comment">/* set end of buffer to 0 (this ensures that no overreading happens for damaged MPEG streams) */</span></div><div class="line">    <span class="built_in">memset</span>(inbuf + INBUF_SIZE, <span class="number">0</span>, AV_INPUT_BUFFER_PADDING_SIZE);</div><div class="line"></div><div class="line">    <span class="comment">//printf(&quot;Decode video file %s to %s\n&quot;, filename, outfilename);</span></div><div class="line"></div><div class="line">    <span class="comment">/* find the MPEG-1 video decoder */</span></div><div class="line">    codec = avcodec_find_decoder(AV_CODEC_ID_H264);</div><div class="line">    <span class="keyword">if</span> (!codec)</div><div class="line">    {</div><div class="line">    	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Codec not found\n&quot;</span>);</div><div class="line">    	<span class="keyword">return</span> HFS_ERROR;<span class="comment">//exit(1);</span></div><div class="line">    }</div><div class="line"></div><div class="line">    c = avcodec_alloc_context3(codec);</div><div class="line">    <span class="keyword">if</span> (!c)</div><div class="line">    {</div><div class="line">    	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Could not allocate video codec context\n&quot;</span>);</div><div class="line">    	<span class="keyword">return</span> HFS_ERROR;<span class="comment">//exit(1);</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (codec-&gt;capabilities &amp; AV_CODEC_CAP_TRUNCATED)</div><div class="line">    {</div><div class="line">    	c-&gt;flags |= AV_CODEC_FLAG_TRUNCATED; <span class="comment">// we do not send complete frames</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">/* For some codecs, such as msmpeg4 and mpeg4, width and height</span></div><div class="line">    MUST be initialized there because this information is not</div><div class="line">    available in the bitstream. */</div><div class="line"></div><div class="line">    <span class="comment">/* open it */</span></div><div class="line">    <span class="keyword">if</span> (avcodec_open2(c, codec, <span class="literal">NULL</span>) &lt; <span class="number">0</span>)</div><div class="line">    {</div><div class="line">    	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Could not open codec\n&quot;</span>);</div><div class="line">    	<span class="keyword">return</span> HFS_ERROR;<span class="comment">//exit(1);</span></div><div class="line">    }</div><div class="line"></div><div class="line">    frame = av_frame_alloc();</div><div class="line">    <span class="keyword">if</span> (!frame)</div><div class="line">    {</div><div class="line">    	<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Could not allocate video frame\n&quot;</span>);</div><div class="line">    	<span class="keyword">return</span> HFS_ERROR;<span class="comment">//exit(1);</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// LOOP Start</span></div><div class="line"></div><div class="line">    <span class="comment">//avcodec_decode_video2(c, frame, &amp;got_image, &amp;avpkt);</span></div><div class="line">    avpkt.data = (<span class="keyword">uint8_t</span> *)buf;</div><div class="line">    avpkt.size = len;</div><div class="line"></div><div class="line">    ret = avcodec_send_packet(c, &amp;avpkt);</div><div class="line">    <span class="comment">//...</span></div><div class="line">    ret = avcodec_receive_frame(c, frame);</div><div class="line">    <span class="comment">//...</span></div><div class="line"></div><div class="line">    <span class="comment">// LOOP End</span></div><div class="line"></div><div class="line">    avcodec_close(c);</div><div class="line">    av_free(c);</div><div class="line">    av_frame_free(&amp;frame);</div><div class="line">}</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x4EE5;ffmpeg-3.1.5&amp;#x4E3A;&amp;#x4F8B;&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div cla
    
    </summary>
    
      <category term="Media" scheme="http://snowyying.github.io/categories/Media/"/>
    
    
      <category term="C" scheme="http://snowyying.github.io/tags/C/"/>
    
      <category term="ffmpeg" scheme="http://snowyying.github.io/tags/ffmpeg/"/>
    
      <category term="h264" scheme="http://snowyying.github.io/tags/h264/"/>
    
      <category term="decode" scheme="http://snowyying.github.io/tags/decode/"/>
    
  </entry>
  
  <entry>
    <title>ffxxxx 使用</title>
    <link href="http://snowyying.github.io/2016/ffxxxx/"/>
    <id>http://snowyying.github.io/2016/ffxxxx/</id>
    <published>2016-10-29T07:16:37.000Z</published>
    <updated>2016-11-14T07:25:19.650Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h2><p>ffmpeg -i test.h264 test.yuv</p>
<h2 id="ffplay"><a href="#ffplay" class="headerlink" title="ffplay"></a>ffplay</h2><h2 id="ffprobe"><a href="#ffprobe" class="headerlink" title="ffprobe"></a>ffprobe</h2>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;ffmpeg&quot;&gt;&lt;a href=&quot;#ffmpeg&quot; class=&quot;headerlink&quot; title=&quot;ffmpeg&quot;&gt;&lt;/a&gt;ffmpeg&lt;/h2&gt;&lt;p&gt;ffmpeg -i test.h264 test.yuv&lt;/p&gt;
&lt;h2 id=&quot;ffplay&quot;&gt;&lt;a hr
    
    </summary>
    
      <category term="Media" scheme="http://snowyying.github.io/categories/Media/"/>
    
    
      <category term="ffmpeg" scheme="http://snowyying.github.io/tags/ffmpeg/"/>
    
      <category term="ffplay" scheme="http://snowyying.github.io/tags/ffplay/"/>
    
      <category term="ffprobe" scheme="http://snowyying.github.io/tags/ffprobe/"/>
    
  </entry>
  
  <entry>
    <title>轻松记住大端小端的含义 (附对大端和小端的解释)</title>
    <link href="http://snowyying.github.io/2016/Big-Endian-Little-Endian/"/>
    <id>http://snowyying.github.io/2016/Big-Endian-Little-Endian/</id>
    <published>2016-10-29T07:16:12.000Z</published>
    <updated>2016-11-14T07:38:21.677Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x8F6C;&#x81EA;: http://www.cnblogs.com/wuyuegb2312/archive/2013/06/08/3126510.html 2013-06-08</code></p>
<p>&#x3000;&#x3000;&#x6216;&#x8BB8;&#x4F60;&#x66FE;&#x7ECF;&#x4ED4;&#x7EC6;&#x4E86;&#x89E3;&#x8FC7;&#x4EC0;&#x4E48;&#x662F;&#x5927;&#x7AEF;&#x5C0F;&#x7AEF;&#xFF0C;&#x4E5F;&#x52A8;&#x624B;&#x7F16;&#x5199;&#x4E86;&#x6D4B;&#x8BD5;&#x624B;&#x5934;&#x4E0A;&#x7684;&#x673A;&#x5668;&#x4E0A;&#x662F;&#x5927;&#x7AEF;&#x8FD8;&#x662F;&#x5C0F;&#x7AEF;&#x7684;&#x7A0B;&#x5E8F;&#xFF0C;&#x751A;&#x81F3;&#x8FD8;&#x7F16;&#x5199;&#x4E86;&#x5927;&#x7AEF;&#x5C0F;&#x7AEF;&#x8F6C;&#x6362;&#x7A0B;&#x5E8F;&#xFF1B;&#x4F46;&#x8FC7;&#x4E86;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x4E4B;&#x540E;&#xFF0C;&#x5F53;&#x4F60;&#x518D;&#x770B;&#x5230;&#x5927;&#x7AEF;&#x548C;&#x5C0F;&#x7AEF;&#x8FD9;&#x4E24;&#x4E2A;&#x5B57;&#x773C;&#xFF0C;&#x4F60;&#x7684;&#x8111;&#x4E2D;&#x5F88;&#x5FEB;&#x6D6E;&#x8D77;&#x4E86;&#x81EA;&#x5DF1;&#x66FE;&#x7ECF;&#x505A;&#x8FC7;&#x7684;&#x5DE5;&#x4F5C;&#xFF0C;&#x5374;&#x603B;&#x662F;&#x60F3;&#x4E0D;&#x8D77;&#x7A76;&#x7ADF;&#x54EA;&#x79CD;&#x662F;&#x5927;&#x7AEF;&#x3001;&#x54EA;&#x79CD;&#x662F;&#x5C0F;&#x7AEF;&#xFF0C;&#x7136;&#x540E;&#x53C8;&#x53BB;&#x67E5;&#x4EE5;&#x524D;&#x5199;&#x7684;&#x8BB0;&#x5F55;&#xFF1F;&#x66F4;&#x8BA9;&#x4EBA;&#x4E0D;&#x5FEB;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x79CD;&#x7ECF;&#x5386;&#x53CD;&#x53CD;&#x590D;&#x590D;&#xFF0C;&#x8BA9;&#x4F60;&#x5341;&#x5206;&#x56F0;&#x6270;&#x3002;&#x5982;&#x679C;&#x4F60;&#x548C;&#x4EE5;&#x524D;&#x7684;&#x7B14;&#x8005;&#x4E00;&#x6837;&#xFF0C;&#x6709;&#x8FC7;&#x8FD9;&#x79CD;&#x4E0D;&#x5FEB;&#x7684;&#x7ECF;&#x5386;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x5E0C;&#x671B;&#x80FD;&#x5E2E;&#x4F60;&#x5F7B;&#x5E95;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x82E6;&#x607C;&#xFF0C;&#x8BA9;&#x4F60;&#x5F7B;&#x5E95;&#x8BB0;&#x4F4F;&#x5B83;&#x4EEC;&#x3002;&#x3000;</p>
<a id="more"></a>
<p>&#x3000;&#x3000;&#x5982;&#x679C;&#x4F60;&#x5728;&#x5DE5;&#x4F5C;&#x4E2D;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x5230;&#x5927;&#x7AEF;&#x548C;&#x5C0F;&#x7AEF;&#x4EE5;&#x81F3;&#x4E8E;&#x5BF9;&#x5B83;&#x4EEC;&#x5341;&#x5206;&#x719F;&#x6089;&#xFF0C;&#x6216;&#x8005;&#x4F60;&#x7684;&#x8BB0;&#x5FC6;&#x529B;&#x5728;&#x4FDD;&#x6301;&#x65F6;&#x95F4;&#x7684;&#x957F;&#x5EA6;&#x548C;&#x7CBE;&#x51C6;&#x5EA6;&#x4E0A;&#x90FD;&#x5341;&#x5206;&#x4F18;&#x79C0;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x4E0D;&#x9700;&#x8981;&#x501F;&#x52A9;&#x5176;&#x4ED6;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4E0D;&#x9002;&#x5408;&#x4F60;&#x3002;</p>
<p>&#x3000;&#x3000;&#x5982;&#x679C;&#x4F60;&#x5728;&#x770B;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x524D;&#x5B8C;&#x5168;&#x4E0D;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x662F;&#x5927;&#x7AEF;&#x548C;&#x5C0F;&#x7AEF;&#xFF0C;&#x90A3;&#x4E48;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x672C;&#x6587;&#x7684;&#x9644;&#x5F55;&#x6216;&#x8005;&#x5176;&#x4ED6;&#x7684;&#x535A;&#x6587;&#xFF0C;&#x76F8;&#x5173;&#x7684;&#x4ECB;&#x7ECD;&#x975E;&#x5E38;&#x4E4B;&#x591A;&#xFF0C;&#x800C;&#x9644;&#x5F55;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x5F88;&#x5E38;&#x89C1;&#x89E3;&#x91CA;&#x548C;&#x4E00;&#x6BB5;&#x6D4B;&#x8BD5;&#x7A0B;&#x5E8F;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x6765;&#x770B;&#x6B63;&#x6587;&#x3002;</p>
<p>&#x3000;&#x3000;&#x4E3A;&#x4E86;&#x5E2E;&#x52A9;&#x8BB0;&#x5FC6;&#xFF0C;&#x7406;&#x89E3;&#x662F;&#x5FC5;&#x8981;&#x7684;&#xFF1B;&#x800C;&#x8BB0;&#x5FC6;&#x7684;&#x76EE;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x8BB0;&#x4F4F;&#x5B83;&#xFF0C;&#x662F;&#x66F4;&#x91CD;&#x8981;&#x7684;&#x3002;&#x6216;&#x8BB8;&#x4F60;&#x4F1A;&#x95EE;&#xFF0C;&#x5148;&#x4E86;&#x89E3;&#x6982;&#x5FF5;&#xFF0C;&#x7528;&#x7684;&#x65F6;&#x5019;&#x518D;&#x67E5;&#xFF0C;&#x4E0D;&#x884C;&#x4E48;&#xFF1F;&#x5176;&#x5B9E;&#x6211;&#x4E4B;&#x524D;&#x4E5F;&#x662F;&#x8FD9;&#x4E48;&#x8BA4;&#x4E3A;&#x7684;&#x3002;&#x5927;&#x7AEF;&#x548C;&#x5C0F;&#x7AEF;&#x8FD9;&#x4E24;&#x4E2A;&#x540D;&#x8BCD;&#xFF0C;&#x4F60;&#x4F1A;&#x5728;&#x5F88;&#x591A;&#x6709;&#x5173;&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#x3001;&#x7CFB;&#x7EDF;&#x8BBE;&#x8BA1;&#x3001;&#x751A;&#x81F3;&#x662F;&#x4EE3;&#x7801;&#x5199;&#x4F5C;&#x7684;&#x4E66;&#x4E0A;&#x770B;&#x5230;&#xFF0C;&#x800C;&#x4E14;&#x5B83;&#x4E5F;&#x662F;&#x5F88;&#x591A;&#x516C;&#x53F8;&#x7684;&#x7B14;&#x8BD5;&#x9898;&#x3001;&#x9762;&#x8BD5;&#x9898;&#x70ED;&#x95E8;&#x5185;&#x5BB9;&#xFF0C;&#x53EF;&#x89C1;&#x5B83;&#x5728;&#x4E00;&#x4E9B;&#x9886;&#x57DF;&#x662F;&#x5F88;&#x5E38;&#x7528;&#x3002;&#x5982;&#x679C;&#x7B49;&#x5230;&#x4F60;&#x7528;&#x7684;&#x65F6;&#x5019;&#x518D;&#x67E5;&#xFF0C;&#x4E00;&#x65B9;&#x9762;&#x8981;&#x964D;&#x4F4E;&#x4F60;&#x7684;&#x5DE5;&#x4F5C;&#x6548;&#x7387;&#xFF0C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x5E94;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x4E0D;&#x662F;&#x4F60;&#x60F3;&#x67E5;&#x5C31;&#x80FD;&#x67E5;&#x7684;&#xFF1B;&#x5176;&#x5B9E;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x638C;&#x63E1;&#x89C4;&#x5F8B;&#x540E;&#xFF0C;&#x8BB0;&#x4F4F;&#x5B83;&#x4EEC;&#x5E76;&#x4E0D;&#x56F0;&#x96BE;&#x3002;</p>
<p>&#x3000;&#x3000;&#x73B0;&#x5728;&#x5148;&#x6765;&#x7406;&#x89E3;&#x8FD9;&#x5BF9;&#x6982;&#x5FF5;&#xFF0C;&#x5927;&#x7AEF;&#x548C;&#x5C0F;&#x7AEF;&#x8FD9;&#x4E24;&#x4E2A;&#x4EE4;&#x4EBA;&#x8FF7;&#x60D1;&#x7684;&#x672F;&#x8BED;&#x7A76;&#x7ADF;&#x662F;&#x5982;&#x4F55;&#x4EA7;&#x751F;&#x7684;&#xFF1F;&#x300A;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x5B9E;&#x8DF5;&#x300B;&#x7B2C;9&#x7AE0;&#x4E2D;&#x63D0;&#x5230;&#xFF0C;&#x201C;&#x5927;&#x7AEF;&#x201D;&#x548C;&#x201C;&#x5C0F;&#x7AEF;&#x201D;&#x53EF;&#x4EE5;&#x8FFD;&#x6EAF;&#x5230;1726&#x5E74;&#x7684;Jonathan Swift&#x7684;&#x300A;&#x683C;&#x5217;&#x4F5B;&#x6E38;&#x8BB0;&#x300B;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x7BC7;&#x8BB2;&#x5230;&#x6709;&#x4E24;&#x4E2A;&#x56FD;&#x5BB6;&#x56E0;&#x4E3A;&#x5403;&#x9E21;&#x86CB;&#x7A76;&#x7ADF;&#x662F;&#x5148;&#x6253;&#x7834;&#x8F83;&#x5927;&#x7684;&#x4E00;&#x7AEF;&#x8FD8;&#x662F;&#x5148;&#x6253;&#x7834;&#x8F83;&#x5C0F;&#x7684;&#x4E00;&#x7AEF;&#x800C;&#x4E89;&#x6267;&#x4E0D;&#x4F11;&#xFF0C;&#x751A;&#x81F3;&#x7206;&#x53D1;&#x4E86;&#x6218;&#x4E89;&#x3002;1981&#x5E74;10&#x6708;&#xFF0C;Danny Cohen&#x7684;&#x6587;&#x7AE0;&#x300A;&#x8BBA;&#x5723;&#x6218;&#x4EE5;&#x53CA;&#x5BF9;&#x548C;&#x5E73;&#x7684;&#x7948;&#x7977;&#x300B;&#xFF08;On holy wars and a plea for peace&#xFF09;&#x5C06;&#x8FD9;&#x4E00;&#x5BF9;&#x8BCD;&#x8BED;&#x5F15;&#x5165;&#x4E86;&#x8BA1;&#x7B97;&#x673A;&#x754C;&#x3002;&#x8FD9;&#x4E48;&#x770B;&#x6765;&#xFF0C;&#x6240;&#x8C13;&#x5927;&#x7AEF;&#x548C;&#x5C0F;&#x7AEF;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;big-endian&#x548C;little-endian&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x4ECE;&#x63CF;&#x8FF0;&#x9E21;&#x86CB;&#x7684;&#x90E8;&#x4F4D;&#x800C;&#x5F15;&#x7533;&#x5230;&#x8BA1;&#x7B97;&#x673A;&#x5730;&#x5740;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x8BF4;&#xFF0C;&#x662F;&#x4ECE;&#x4E00;&#x4E2A;&#x4FDA;&#x8BED;&#x884D;&#x5316;&#x6765;&#x7684;&#x8BA1;&#x7B97;&#x673A;&#x672F;&#x8BED;&#x3002;&#x7A0D;&#x6709;&#x4E9B;&#x82F1;&#x8BED;&#x5E38;&#x8BC6;&#x7684;&#x4EBA;&#x90FD;&#x4F1A;&#x77E5;&#x9053;&#xFF0C;&#x5982;&#x679C;&#x5355;&#x9760;&#x5B57;&#x9762;&#x610F;&#x601D;&#x6765;&#x7406;&#x89E3;&#x4FDA;&#x8BED;&#xFF0C;&#x90A3;&#x662F;&#x5F88;&#x96BE;&#x731C;&#x5230;&#x5B83;&#x7684;&#x6B63;&#x786E;&#x542B;&#x4E49;&#x7684;&#x3002;&#x5728;&#x8BA1;&#x7B97;&#x673A;&#x91CC;&#xFF0C;&#x5BF9;&#x4E8E;&#x5730;&#x5740;&#x7684;&#x63CF;&#x8FF0;&#xFF0C;&#x5F88;&#x5C11;&#x7528;&#x201C;&#x5927;&#x201D;&#x548C;&#x201C;&#x5C0F;&#x201D;&#x6765;&#x5F62;&#x5BB9;&#xFF1B;&#x5BF9;&#x5E94;&#x5730;&#xFF0C;&#x7528;&#x7684;&#x66F4;&#x591A;&#x7684;&#x662F;&#x201C;&#x9AD8;&#x201D;&#x548C;&#x201C;&#x4F4E;&#x201D;&#xFF1B;&#x5F88;&#x4E0D;&#x5E78;&#x5730;&#xFF0C;&#x8FD9;&#x5BF9;&#x672F;&#x8BED;&#x76F4;&#x63A5;&#x6309;&#x5B57;&#x9762;&#x7FFB;&#x8BD1;&#x8FC7;&#x6765;&#x5C31;&#x6210;&#x4E86;&#x201C;&#x5927;&#x7AEF;&#x201D;&#x548C;&#x201C;&#x5C0F;&#x7AEF;&#x201D;&#xFF0C;&#x8BA9;&#x4EBA;&#x4EA7;&#x751F;&#x8FF7;&#x60D1;&#x4E5F;&#x4E0D;&#x662F;&#x5F88;&#x5947;&#x602A;&#x7684;&#x4E8B;&#x4E86;&#x3002;</p>
<p>&#x3000;&#x3000;&#x4E0D;&#x8FC7;&#x7ED9;&#x6211;&#x542F;&#x53D1;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x88D8;&#x5B97;&#x71D5;&#x7FFB;&#x8BD1;&#x7684;&#x300A;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x5B9E;&#x8DF5;&#x300B;&#x91CC;&#xFF0C;&#x8FD9;&#x5BF9;&#x672F;&#x8BED;&#x5E76;&#x6CA1;&#x6709;&#x7FFB;&#x8BD1;&#x4E3A;&#x201C;&#x5927;&#x7AEF;&#x201D;&#x548C;&#x5C0F;&#x7AEF;&#xFF0C;&#x800C;&#x662F;&#x201C;&#x9AD8;&#x5C3E;&#x7AEF;&#x201D;&#x548C;&#x201C;&#x4F4E;&#x5C3E;&#x7AEF;&#x201D;&#xFF0C;&#x8FD9;&#x5C31;&#x597D;&#x7406;&#x89E3;&#x4E86;&#xFF1A;&#x5982;&#x679C;&#x628A;&#x4E00;&#x4E2A;&#x6570;&#x770B;&#x6210;&#x4E00;&#x4E2A;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x6BD4;&#x5982;11223344&#x770B;&#x6210;&#x201D;11223344&#x201D;&#xFF0C;&#x672B;&#x5C3E;&#x662F;&#x4E2A;&#x2019;\0&#x2019;&#xFF0C;&#x2019;11&#x2019;&#x5230;&#x2019;44&#x2019;&#x4E2A;&#x5360;&#x7528;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#x5355;&#x5143;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x7684;&#x5C3E;&#x7AEF;&#x5F88;&#x663E;&#x7136;&#x662F;44&#xFF0C;&#x524D;&#x9762;&#x7684;&#x9AD8;&#x8FD8;&#x662F;&#x4F4E;&#x5C31;&#x8868;&#x793A;&#x5C3E;&#x7AEF;&#x653E;&#x5728;&#x9AD8;&#x5730;&#x5740;&#x8FD8;&#x662F;&#x4F4E;&#x5730;&#x5740;&#xFF0C;&#x5B83;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x653E;&#x6CD5;&#x975E;&#x5E38;&#x76F4;&#x89C2;&#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#xFF1A;</p>
<p><img src="/2016/Big-Endian-Little-Endian/08153946-05d0c7f220ec42da8f854f37c9719947.png" alt=""></p>
<p>&#x3000;&#x3000;&#x201C;&#x9AD8;/&#x4F4E;&#x5C3E;&#x7AEF;&#x201D;&#x6BD4;&#x201C;&#x5927;/&#x5C0F;&#x7AEF;&#x201D;&#x66F4;&#x4E0D;&#x5BB9;&#x6613;&#x8BA9;&#x4EBA;&#x8FF7;&#x60D1;&#x3002;&#x4F46;&#x662F;&#x6839;&#x636E;&#x4E2A;&#x4EBA;&#x7ECF;&#x9A8C;&#xFF0C;&#x5728;&#x5E02;&#x9762;&#x4E0A;&#x7684;&#x4E66;&#x7C4D;&#x3001;&#x7F51;&#x7EDC;&#x4E0A;&#x7684;&#x5404;&#x79CD;&#x8D44;&#x6599;&#x4E2D;&#xFF0C;&#x5F88;&#x9057;&#x61BE;&#xFF0C;&#x524D;&#x8005;&#x5DF2;&#x7ECF;&#x5F88;&#x5C11;&#x89C1;&#x4E86;&#xFF0C;&#x591A;&#x89C1;&#x7684;&#x662F;&#x540E;&#x8005;&#x3002;&#x597D;&#x5728;&#x8FD9;&#x4E24;&#x5BF9;&#x5F62;&#x5BB9;&#x8BCD;&#x4E2D;&#xFF0C;&#x6070;&#x597D;&#x201C;&#x9AD8;&#x201D;&#x548C;&#x201C;&#x5927;&#x201D;&#x5BF9;&#x5E94;&#xFF0C;&#x201C;&#x4F4E;&#x201D;&#x548C;&#x201C;&#x5C0F;&#x201D;&#x5BF9;&#x5E94;&#xFF1B;&#x65E2;&#x7136;&#x9AD8;&#x5C3E;&#x7AEF;&#x5BF9;&#x5E94;&#x7684;&#x662F;&#x5927;&#x7AEF;&#xFF0C;&#x4F4E;&#x5C3E;&#x7AEF;&#x5BF9;&#x5E94;&#x7684;&#x662F;&#x5C0F;&#x7AEF;&#xFF0C;&#x90A3;&#x4E48;&#x5F53;&#x4F60;&#x518D;&#x89C1;&#x5230;&#x5927;&#x7AEF;&#x548C;&#x5C0F;&#x7AEF;&#x8FD9;&#x4E00;&#x5BF9;&#x672F;&#x8BED;&#xFF0C;&#x5C31;&#x53EF;&#x4EE5;&#x5728;&#x8111;&#x4E2D;&#x628A;&#x5B83;&#x4EEC;&#x8F6C;&#x5316;&#x6210;&#x9AD8;&#x5C3E;&#x7AEF;&#x548C;&#x4F4E;&#x5C3E;&#x7AEF;&#xFF0C;&#x8FD9;&#x65F6;&#x51ED;&#x7740;&#x4E4B;&#x524D;&#x7684;&#x7406;&#x89E3;&#xFF0C;&#x751A;&#x81F3;&#x4E0D;&#x7528;&#x56DE;&#x5FC6;&#xFF0C;&#x60F3;&#x7740;&#x9AD8;&#x4F4E;&#x7684;&#x5B57;&#x9762;&#x542B;&#x4E49;&#x5C31;&#x80FD;&#x56DE;&#x60F3;&#x8D77;&#x5B83;&#x4EEC;&#x7684;&#x542B;&#x4E49;&#x3002;&#x4F46;&#x662F;&#x5F88;&#x5947;&#x602A;&#x7684;&#x662F;&#xFF0C;&#x540C;&#x6837;&#x662F;&#x88D8;&#x5B97;&#x71D5;&#x7FFB;&#x8BD1;&#x7684;&#x300A;&#x7F16;&#x7A0B;&#x539F;&#x672C;&#x300B;&#xFF08;Elements of Programming&#xFF09;&#xFF0C;&#x5374;&#x628A;big-endian&#x7FFB;&#x8BD1;&#x6210;&#x5927;&#x5C3E;&#x683C;&#x5F0F;&#xFF08;&#x7B2C;&#x4E00;&#x7AE0;&#xFF09;&#x3002;</p>
<p>&#x3000;  &#x7406;&#x89E3;&#x4E4B;&#x540E;&#xFF0C;&#x603B;&#x7ED3;&#x4E00;&#x4E0B;&#xFF0C;&#x8BB0;&#x5FC6;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#xFF1A;</p>
<pre><code>&#xFF08;&#x6570;&#x636E;&#x770B;&#x6210;&#x5B57;&#x7B26;&#x4E32;&#xFF09;&#x5927;&#x7AEF;&#x2014;&#x2014;&#x9AD8;&#x5C3E;&#x7AEF;&#xFF0C;&#x5C0F;&#x7AEF;&#x2014;&#x2014;&#x4F4E;&#x5C3E;&#x7AEF;
</code></pre><p>&#x3000;&#x3000;&#x7A0D;&#x4E00;&#x601D;&#x7D22;&#x4EC0;&#x4E48;&#x662F;&#x201C;&#x9AD8;&#x201D;&#x3001;&#x4EC0;&#x4E48;&#x662F;&#x201D;&#x4F4E;&#x201D;&#xFF0C;&#x201D;&#x5C3E;&#x7AEF;&#x201D;&#x53C8;&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x95EE;&#x9898;&#x8FCE;&#x5203;&#x800C;&#x89E3;&#xFF0C;&#x518D;&#x4E0D;&#x7528;&#x62C5;&#x5FC3;&#x88AB;&#x201C;&#x5927;&#x7AEF;&#x201D;&#x548C;&#x201C;&#x5C0F;&#x7AEF;&#x201D;&#x8FF7;&#x60D1;&#x3002;&#x7528;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#xFF0C;&#x662F;&#x65F6;&#x5019;&#x653E;&#x5F03;&#x539F;&#x5148;&#x7684;&#x6B7B;&#x8BB0;&#x786C;&#x80CC;&#x548C;&#x5BB9;&#x6613;&#x628A;&#x81EA;&#x5DF1;&#x7ED5;&#x8FDB;&#x53BB;&#x800C;&#x53D1;&#x751F;&#x8FF7;&#x60D1;&#x7684;&#x7406;&#x89E3;&#x4E86;&#x3002;</p>
<p>&#x9644;&#x5F55;&#xFF1A;&#x4EC0;&#x4E48;&#x662F;&#x201C;&#x5927;&#x7AEF;&#x201D;&#x548C;&#x201C;&#x5C0F;&#x7AEF;&#x201D;&#x53CA;&#x4E00;&#x6BB5;&#x6D4B;&#x8BD5;&#x672C;&#x673A;&#x5927;&#x7AEF;&#x8FD8;&#x662F;&#x5C0F;&#x7AEF;&#x7684;&#x4EE3;&#x7801;</p>
<p>&#x3000;&#x3000;&#xFF08;&#x8FD9;&#x6BB5;&#x6587;&#x5B57;&#x662F;&#x300A;UNIX&#x7F51;&#x7EDC;&#x7F16;&#x7A0B;&#xB7;&#x5377;&#x4E00;&#x300B;&#x7684;&#x5173;&#x4E8E;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x7684;&#x6982;&#x62EC;&#xFF1B;&#x4E0D;&#x4EC5;&#x9650;&#x4E8E;&#x8FD9;&#x672C;&#x4E66;&#xFF0C;&#x5F88;&#x591A;&#x8BA1;&#x7B97;&#x673A;&#x4E66;&#x7C4D;&#x90FD;&#x662F;&#x8FD9;&#x4E48;&#x4ECB;&#x7ECD;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x7684;&#xFF0C;&#x4F60;&#x4F1A;&#x5728;&#x548C;&#x8BA1;&#x7B97;&#x673A;&#x76F8;&#x5173;&#x4E0D;&#x540C;&#x9886;&#x57DF;&#x7684;&#x4E66;&#x4E2D;&#x9047;&#x5230;&#x5B83;&#x4EEC;&#x3002;&#x5C3D;&#x7BA1;&#x5F88;&#x4EE4;&#x4EBA;&#x7591;&#x60D1;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x9605;&#x8BFB;&#x6B63;&#x6587;&#x524D;&#xFF0C;&#x4F60;&#x6700;&#x597D;&#x5BF9;&#x8FD9;&#x4E24;&#x4E2A;&#x8BCD;&#x8BED;&#x7684;&#x6982;&#x5FF5;&#x6709;&#x6240;&#x7406;&#x89E3;&#x3002;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x4F60;&#x4EE5;&#x524D;&#x5411;&#x6B63;&#x6587;&#x4E2D;&#x63CF;&#x8FF0;&#x7684;&#x4E00;&#x6837;&#x63A5;&#x89E6;&#x8FC7;&#x5B83;&#x4EEC;&#xFF0C;&#x90A3;&#x5C31;&#x4E0D;&#x5FC5;&#x8BFB;&#x8FD9;&#x4E00;&#x90E8;&#x5206;&#x4E86;&#x3002;&#x8BFB;&#x5B8C;&#x540E;&#x4F60;&#x4F1A;&#x53D1;&#x73B0;&#xFF0C;&#x4F60;&#x867D;&#x7136;&#x7406;&#x89E3;&#x4E86;&#x542B;&#x4E49;&#xFF0C;&#x4F46;&#x5F88;&#x5BB9;&#x6613;&#x5FD8;&#x6389;&#xFF0C;&#x8FD9;&#x65F6;&#x4F60;&#x5C31;&#x53EF;&#x4EE5;&#x770B;&#x6B63;&#x6587;&#x90E8;&#x5206;&#x4E86;&#xFF09;</p>
<p>&#x3000;&#x3000;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x7531;2&#x4E2A;&#x5B57;&#x8282;&#x7EC4;&#x6210;&#x7684;16&#x4F4D;&#x6574;&#x6570;&#xFF0C;&#x5728;&#x5185;&#x5B58;&#x4E2D;&#x5B58;&#x50A8;&#x8FD9;&#x4E24;&#x4E2A;&#x5B57;&#x8282;&#x6709;&#x4E24;&#x79CD;&#x65B9;&#x6CD5;&#xFF1A;&#x4E00;&#x79CD;&#x662F;&#x5C06;&#x4F4E;&#x5E8F;&#x5B57;&#x8282;&#x5B58;&#x50A8;&#x5728;&#x8D77;&#x59CB;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x79F0;&#x4E3A;&#x5C0F;&#x7AEF;(little-endian)&#x5B57;&#x8282;&#x5E8F;&#xFF1B;&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x6CD5;&#x662F;&#x5C06;&#x9AD8;&#x5E8F;&#x5B57;&#x8282;&#x5B58;&#x50A8;&#x5728;&#x8D77;&#x59CB;&#x5730;&#x5740;&#xFF0C;&#x8FD9;&#x79F0;&#x4E3A;&#x5927;&#x7AEF;(big-endian)&#x5B57;&#x8282;&#x5E8F;&#x3002;</p>
<p><img src="/2016/Big-Endian-Little-Endian/08165259-3348937a49f34cbc996959ff2b23568e.jpg" alt=""></p>
<p>&#x3000;&#x3000;&#x5728;&#x56FE;&#x4E2D;&#xFF0C;&#x9876;&#x90E8;&#x8868;&#x660E;&#x5185;&#x5B58;&#x5730;&#x5740;&#x589E;&#x957F;&#x65B9;&#x5411;&#x4ECE;&#x53F3;&#x5230;&#x5DE6;&#xFF0C;&#x5728;&#x5E95;&#x90E8;&#x6807;&#x660E;&#x5185;&#x5B58;&#x5730;&#x5740;&#x589E;&#x957F;&#x7684;&#x65B9;&#x5411;&#x4E3A;&#x4ECE;&#x5DE6;&#x5230;&#x53F3;&#x3002;&#x5E76;&#x4E14;&#x8FD8;&#x6807;&#x660E;&#x6700;&#x9AD8;&#x6709;&#x6548;&#x4F4D;(most significant bit&#xFF0C;MSB)&#x662F;&#x8FD9;&#x4E2A;16&#x4F4D;&#x503C;&#x6700;&#x5DE6;&#x8FB9;&#x4E00;&#x4F4D;&#xFF0C;&#x6700;&#x4F4E;&#x6709;&#x6548;&#x4F4D;(least significant bit, LSB)&#x662F;&#x8FD9;&#x4E2A;16&#x4F4D;&#x503C;&#x6700;&#x53F3;&#x8FB9;&#x4E00;&#x4F4D;&#x3002;&#x672F;&#x8BED;&#x201C;&#x5C0F;&#x7AEF;&#x201D;&#x548C;&#x201C;&#x5927;&#x7AEF;&#x201D;&#x8868;&#x793A;&#x591A;&#x4E2A;&#x5B57;&#x8282;&#x503C;&#x7684;&#x54EA;&#x4E00;&#x7AEF;&#xFF08;&#x5C0F;&#x7AEF;&#x6216;&#x5927;&#x7AEF;&#xFF09;&#x5B58;&#x50A8;&#x5728;&#x8BE5;&#x503C;&#x7684;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x3002;</p>
<p>&#x3000;&#x3000;&#x8FD9;&#x4E24;&#x79CD;&#x5B57;&#x8282;&#x5E8F;&#x6CA1;&#x6709;&#x6807;&#x51C6;&#x53EF;&#x5FAA;&#xFF0C;&#x90FD;&#x6709;&#x7CFB;&#x7EDF;&#x5728;&#x4F7F;&#x7528;&#x3002;&#x628A;&#x67D0;&#x4E2A;&#x7ED9;&#x5B9A;&#x7CFB;&#x7EDF;&#x6240;&#x7528;&#x7684;&#x5B57;&#x8282;&#x5E8F;&#x79F0;&#x4E3A;&#x4E3B;&#x673A;&#x5B57;&#x8282;&#x5E8F;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x4EE5;&#x4E0B;&#x7A0B;&#x5E8F;&#x8F93;&#x51FA;&#x4E3B;&#x673A;&#x5B57;&#x8282;&#x5E8F;&#x3002;&#x65B9;&#x6CD5;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#x77ED;&#x6574;&#x6570;&#x53D8;&#x91CF;&#x4E2D;&#x5B58;&#x653E;2&#x5B57;&#x8282;&#x7684;&#x503C;0x0102&#xFF0C;&#x7136;&#x540E;&#x67E5;&#x770B;&#x5B83;&#x7684;&#x8FDE;&#x7EED;&#x5B57;&#x8282;c[0]&#xFF08;&#x5BF9;&#x5E94;&#x4E0A;&#x56FE;&#x5730;&#x5740;A&#xFF09;&#x548C;c<a href="&#x5BF9;&#x5E94;&#x4E0A;&#x56FE;&#x5730;&#x5740;A+1">1</a>&#xFF0C;&#x4EE5;&#x6B64;&#x786E;&#x5B9A;&#x5B57;&#x8282;&#x5E8F;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x8F6C;&amp;#x81EA;: http://www.cnblogs.com/wuyuegb2312/archive/2013/06/08/3126510.html 2013-06-08&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x3000;&amp;#x3000;&amp;#x6216;&amp;#x8BB8;&amp;#x4F60;&amp;#x66FE;&amp;#x7ECF;&amp;#x4ED4;&amp;#x7EC6;&amp;#x4E86;&amp;#x89E3;&amp;#x8FC7;&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;&amp;#x5927;&amp;#x7AEF;&amp;#x5C0F;&amp;#x7AEF;&amp;#xFF0C;&amp;#x4E5F;&amp;#x52A8;&amp;#x624B;&amp;#x7F16;&amp;#x5199;&amp;#x4E86;&amp;#x6D4B;&amp;#x8BD5;&amp;#x624B;&amp;#x5934;&amp;#x4E0A;&amp;#x7684;&amp;#x673A;&amp;#x5668;&amp;#x4E0A;&amp;#x662F;&amp;#x5927;&amp;#x7AEF;&amp;#x8FD8;&amp;#x662F;&amp;#x5C0F;&amp;#x7AEF;&amp;#x7684;&amp;#x7A0B;&amp;#x5E8F;&amp;#xFF0C;&amp;#x751A;&amp;#x81F3;&amp;#x8FD8;&amp;#x7F16;&amp;#x5199;&amp;#x4E86;&amp;#x5927;&amp;#x7AEF;&amp;#x5C0F;&amp;#x7AEF;&amp;#x8F6C;&amp;#x6362;&amp;#x7A0B;&amp;#x5E8F;&amp;#xFF1B;&amp;#x4F46;&amp;#x8FC7;&amp;#x4E86;&amp;#x4E00;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x5F53;&amp;#x4F60;&amp;#x518D;&amp;#x770B;&amp;#x5230;&amp;#x5927;&amp;#x7AEF;&amp;#x548C;&amp;#x5C0F;&amp;#x7AEF;&amp;#x8FD9;&amp;#x4E24;&amp;#x4E2A;&amp;#x5B57;&amp;#x773C;&amp;#xFF0C;&amp;#x4F60;&amp;#x7684;&amp;#x8111;&amp;#x4E2D;&amp;#x5F88;&amp;#x5FEB;&amp;#x6D6E;&amp;#x8D77;&amp;#x4E86;&amp;#x81EA;&amp;#x5DF1;&amp;#x66FE;&amp;#x7ECF;&amp;#x505A;&amp;#x8FC7;&amp;#x7684;&amp;#x5DE5;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5374;&amp;#x603B;&amp;#x662F;&amp;#x60F3;&amp;#x4E0D;&amp;#x8D77;&amp;#x7A76;&amp;#x7ADF;&amp;#x54EA;&amp;#x79CD;&amp;#x662F;&amp;#x5927;&amp;#x7AEF;&amp;#x3001;&amp;#x54EA;&amp;#x79CD;&amp;#x662F;&amp;#x5C0F;&amp;#x7AEF;&amp;#xFF0C;&amp;#x7136;&amp;#x540E;&amp;#x53C8;&amp;#x53BB;&amp;#x67E5;&amp;#x4EE5;&amp;#x524D;&amp;#x5199;&amp;#x7684;&amp;#x8BB0;&amp;#x5F55;&amp;#xFF1F;&amp;#x66F4;&amp;#x8BA9;&amp;#x4EBA;&amp;#x4E0D;&amp;#x5FEB;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x79CD;&amp;#x7ECF;&amp;#x5386;&amp;#x53CD;&amp;#x53CD;&amp;#x590D;&amp;#x590D;&amp;#xFF0C;&amp;#x8BA9;&amp;#x4F60;&amp;#x5341;&amp;#x5206;&amp;#x56F0;&amp;#x6270;&amp;#x3002;&amp;#x5982;&amp;#x679C;&amp;#x4F60;&amp;#x548C;&amp;#x4EE5;&amp;#x524D;&amp;#x7684;&amp;#x7B14;&amp;#x8005;&amp;#x4E00;&amp;#x6837;&amp;#xFF0C;&amp;#x6709;&amp;#x8FC7;&amp;#x8FD9;&amp;#x79CD;&amp;#x4E0D;&amp;#x5FEB;&amp;#x7684;&amp;#x7ECF;&amp;#x5386;&amp;#xFF0C;&amp;#x90A3;&amp;#x4E48;&amp;#x8FD9;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x5E0C;&amp;#x671B;&amp;#x80FD;&amp;#x5E2E;&amp;#x4F60;&amp;#x5F7B;&amp;#x5E95;&amp;#x89E3;&amp;#x51B3;&amp;#x8FD9;&amp;#x4E2A;&amp;#x82E6;&amp;#x607C;&amp;#xFF0C;&amp;#x8BA9;&amp;#x4F60;&amp;#x5F7B;&amp;#x5E95;&amp;#x8BB0;&amp;#x4F4F;&amp;#x5B83;&amp;#x4EEC;&amp;#x3002;&amp;#x3000;&lt;/p&gt;
    
    </summary>
    
      <category term="Theory" scheme="http://snowyying.github.io/categories/Theory/"/>
    
    
      <category term="Big-Endian" scheme="http://snowyying.github.io/tags/Big-Endian/"/>
    
      <category term="Little-Endian" scheme="http://snowyying.github.io/tags/Little-Endian/"/>
    
  </entry>
  
  <entry>
    <title>通过 API 获取 GUID(UUID)</title>
    <link href="http://snowyying.github.io/2016/generate-guid-uuid/"/>
    <id>http://snowyying.github.io/2016/generate-guid-uuid/</id>
    <published>2016-10-27T08:26:33.000Z</published>
    <updated>2016-11-14T07:39:22.630Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><p>&#x4F7F;&#x7528; CoCreateGuid &#x51FD;&#x6570; (GUID)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;objbase.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> GUID_LEN 64</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">{  </div><div class="line">    <span class="keyword">char</span> buffer[GUID_LEN] = { <span class="number">0</span> };</div><div class="line">    GUID guid;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (CoCreateGuid(&amp;guid))</div><div class="line">    {</div><div class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;create guid error\n&quot;</span>);</div><div class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="number">_</span><span class="built_in">snprintf</span>(buffer, <span class="keyword">sizeof</span>(buffer),</div><div class="line">        <span class="string">&quot;%08X-%04X-%04x-%02X%02X-%02X%02X%02X%02X%02X%02X&quot;</span>,</div><div class="line">        guid.Data1, guid.Data2, guid.Data3,</div><div class="line">        guid.Data4[<span class="number">0</span>], guid.Data4[<span class="number">1</span>], guid.Data4[<span class="number">2</span>],</div><div class="line">        guid.Data4[<span class="number">3</span>], guid.Data4[<span class="number">4</span>], guid.Data4[<span class="number">5</span>],</div><div class="line">        guid.Data4[<span class="number">6</span>], guid.Data4[<span class="number">7</span>]);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">&quot;guid: %s\n&quot;</span>, buffer);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>&#x4F7F;&#x7528; uuid_generate &#x51FD;&#x6570; (UUID)</p>
<p>&#x7F16;&#x8BD1;&#x547D;&#x4EE4;&#xFF1A;<code>gcc atemp.c -o atemp -luuid</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span>  </span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;uuid/uuid.h&gt;</span>  </span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span>   </span></div><div class="line">{   </div><div class="line">    <span class="keyword">uuid_t</span> uuid;  </div><div class="line">    <span class="keyword">int</span> i;  </div><div class="line">    uuid_generate(uuid);</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">16</span>; i++)</div><div class="line">    {   </div><div class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02X&quot;</span>,uuid[i]);</div><div class="line">    }</div><div class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;   </div><div class="line">}</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Windows&quot;&gt;&lt;a href=&quot;#Windows&quot; class=&quot;headerlink&quot; title=&quot;Windows&quot;&gt;&lt;/a&gt;Windows&lt;/h2&gt;&lt;p&gt;&amp;#x4F7F;&amp;#x7528; CoCreateGuid &amp;#x51FD;&amp;#x6570; (GU
    
    </summary>
    
      <category term="C/C++" scheme="http://snowyying.github.io/categories/C-C/"/>
    
    
      <category term="C++" scheme="http://snowyying.github.io/tags/C/"/>
    
      <category term="GUID" scheme="http://snowyying.github.io/tags/GUID/"/>
    
      <category term="UUID" scheme="http://snowyying.github.io/tags/UUID/"/>
    
  </entry>
  
  <entry>
    <title>Visual Studio 编译和使用 Boost</title>
    <link href="http://snowyying.github.io/2016/boost-vs-windows/"/>
    <id>http://snowyying.github.io/2016/boost-vs-windows/</id>
    <published>2016-10-19T06:44:28.000Z</published>
    <updated>2016-11-14T07:20:20.738Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>&#x4EE5; 1.58.0 &#x7248;&#x672C; boost &#x548C; Visual Studio 2013 &#x4E3A;&#x4F8B;, &#x5F53;&#x524D;&#x7CFB;&#x7EDF;&#x7248;&#x672C;&#x4E3A; Windows 8.1 x64</p>
</blockquote>
<h2 id="1-&#x7F16;&#x8BD1;boost"><a href="#1-&#x7F16;&#x8BD1;boost" class="headerlink" title="1 &#x7F16;&#x8BD1;boost"></a>1 &#x7F16;&#x8BD1;boost</h2><h6 id="1-&#x6253;&#x5F00;VS2013&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x7B26;"><a href="#1-&#x6253;&#x5F00;VS2013&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x7B26;" class="headerlink" title="1) &#x6253;&#x5F00;VS2013&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x7B26;"></a>1) &#x6253;&#x5F00;VS2013&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x7B26;</h6><h6 id="2-&#x8FD0;&#x884C;-bootstrap-bat"><a href="#2-&#x8FD0;&#x884C;-bootstrap-bat" class="headerlink" title="2) &#x8FD0;&#x884C; bootstrap.bat"></a>2) &#x8FD0;&#x884C; bootstrap.bat</h6><p><strong>&#x6CE8;&#x610F;: &#x5168;&#x7A0B;&#x4E0D;&#x8981;&#x5173;&#x95ED;&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x7B26;, &#x6240;&#x6709;&#x64CD;&#x4F5C;&#x5747;&#x5728;&#x6B64;&#x4E2D;&#x5B8C;&#x6210;</strong></p>
<h6 id="3-&#x8FD0;&#x884C;-b2-exe-&#x6216;-bjam-exe"><a href="#3-&#x8FD0;&#x884C;-b2-exe-&#x6216;-bjam-exe" class="headerlink" title="3) &#x8FD0;&#x884C; b2.exe &#x6216; bjam.exe"></a>3) &#x8FD0;&#x884C; b2.exe &#x6216; bjam.exe</h6><p>&#x2460; &#x67E5;&#x770B;&#x7F16;&#x8BD1;&#x9009;&#x9879;, &#x5728;&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x7B26;&#x4E0B;&#x8F93;&#x5165;&#x201D;b2 &#x2013;help&#x201D;</p>
<p>&#x8BF7;&#x6CE8;&#x610F;&#x4EE5;&#x4E0B;&#x51E0;&#x4E2A;&#x7F16;&#x8BD1;&#x9009;&#x9879;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Properties:</div><div class="line"></div><div class="line">toolset=toolset</div><div class="line">Indicate the toolset to build with.</div><div class="line"></div><div class="line">variant=debug|release</div><div class="line">Select the build variant</div><div class="line"></div><div class="line">link=static|shared</div><div class="line">Whether to build static or shared libraries</div><div class="line"></div><div class="line">threading=single|multi</div><div class="line">Whether to build single or multithreaded binaries</div><div class="line"></div><div class="line">runtime-link=static|shared</div><div class="line">Whether to link to static or shared C and C++ runtime.</div></pre></td></tr></table></figure>
<p>&#x2461; &#x7F16;&#x8BD1;, &#x5728;&#x547D;&#x4EE4;&#x63D0;&#x793A;&#x7B26;&#x4E0B;&#x8F93;&#x5165;&#x201D;b2 link=static threading=multi&#x201D;</p>
<p><strong>&#x6CE8;&#x610F;: &#x6B64;&#x5904;&#x7684;&#x9009;&#x9879;&#x8981;&#x6839;&#x636E;&#x5DE5;&#x7A0B;&#x7684;&#x9700;&#x8981;&#x53BB;&#x7F16;&#x8BD1;, &#x5982;&#x679C;&#x4EC5;&#x4EC5;&#x4E3A;&#x4E86;&#x6D4B;&#x8BD5;&#x7F16;&#x8BD1;&#x8FC7;&#x7A0B;, &#x53EF;&#x4EE5;&#x4E0D;&#x5E26;&#x4EFB;&#x4F55;&#x53C2;&#x6570;</strong></p>
<h2 id="2-&#x4F7F;&#x7528;boost"><a href="#2-&#x4F7F;&#x7528;boost" class="headerlink" title="2 &#x4F7F;&#x7528;boost"></a>2 &#x4F7F;&#x7528;boost</h2><p>&#x5728;&#x5DE5;&#x7A0B;&#x7684;&#x5C5E;&#x6027;&#x8BBE;&#x7F6E;&#x201D;VC++ Directories&#x201D;&#x4E2D;&#x7684;Include&#x548C;Library&#x4E2D;&#x589E;&#x52A0;boost, &#x5982;&#x4E0B;&#x56FE;&#x914D;&#x7F6E;</p>
<h2 id="3-&#x6CE8;&#x610F;&#x4E8B;&#x9879;"><a href="#3-&#x6CE8;&#x610F;&#x4E8B;&#x9879;" class="headerlink" title="3 &#x6CE8;&#x610F;&#x4E8B;&#x9879;"></a>3 &#x6CE8;&#x610F;&#x4E8B;&#x9879;</h2><p>1) &#x94FE;&#x63A5;&#x4E0D;&#x6210;&#x529F;, &#x627E;&#x4E0D;&#x5230;xxx.lib</p>
<p>&#x53EF;&#x80FD;&#x662F;&#x7F16;&#x8BD1;&#x9009;&#x9879;&#x548C;boost&#x7684;&#x7F16;&#x8BD1;&#x9009;&#x9879;&#x4E0D;&#x4E00;&#x81F4;&#x5BFC;&#x81F4;&#x7684;,</p>
<p>&#x8BF7;&#x6309;&#x7167;&#x5DE5;&#x7A0B;&#x7684;&#x7F16;&#x8BD1;&#x9009;&#x9879;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;boost&#x6216;&#x4FEE;&#x6539;vs&#x7684;&#x914D;&#x7F6E;&#x548C;boost&#x4E2D;&#x914D;&#x7F6E;&#x4E00;&#x81F4;.</p>
<p>2) &#x591A;&#x6B21;&#x7F16;&#x8BD1;boost, &#x4F7F;&#x7528;b2&#x7F16;&#x8BD1;&#x65F6;, &#x53EF;&#x4E0D;&#x505A;&#x6E05;&#x7406;, &#x53EF;&#x540C;&#x65F6;&#x7F16;&#x8BD1;&#x51FA;debug&#x548C;release&#x7248;&#x672C;, &#x591A;&#x7EBF;&#x7A0B;&#x548C;&#x5355;&#x7EBF;&#x7A0B;&#x7248;&#x672C;</p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&amp;#x4EE5; 1.58.0 &amp;#x7248;&amp;#x672C; boost &amp;#x548C; Visual Studio 2013 &amp;#x4E3A;&amp;#x4F8B;, &amp;#x5F53;&amp;#x524D;&amp;#x7CFB;&amp;#x7EDF;&amp;#x7248
    
    </summary>
    
      <category term="C/C++" scheme="http://snowyying.github.io/categories/C-C/"/>
    
    
      <category term="C++" scheme="http://snowyying.github.io/tags/C/"/>
    
      <category term="Boost" scheme="http://snowyying.github.io/tags/Boost/"/>
    
      <category term="Windows" scheme="http://snowyying.github.io/tags/Windows/"/>
    
      <category term="VS" scheme="http://snowyying.github.io/tags/VS/"/>
    
  </entry>
  
  <entry>
    <title>函数不定参数的定义与解析</title>
    <link href="http://snowyying.github.io/2016/variadic-functions/"/>
    <id>http://snowyying.github.io/2016/variadic-functions/</id>
    <published>2016-09-08T02:45:23.000Z</published>
    <updated>2016-09-10T08:44:16.544Z</updated>
    
    <content type="html"><![CDATA[<h2 id="va-list-va-start-va-arg-va-end"><a href="#va-list-va-start-va-arg-va-end" class="headerlink" title="va_list, va_start / va_arg / va_end"></a>va_list, va_start / va_arg / va_end</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">ErrMsg</span><span class="params">(LPTSTR szFormat,...)</span></span></div><div class="line">{</div><div class="line">	<span class="keyword">static</span> TCHAR szBuffer[<span class="number">2048</span>] = {<span class="number">0</span>};</div><div class="line">	<span class="keyword">const</span> <span class="keyword">size_t</span> NUMCHARS = <span class="keyword">sizeof</span>(szBuffer) / <span class="keyword">sizeof</span>(szBuffer[<span class="number">0</span>]);</div><div class="line">	<span class="keyword">const</span> <span class="keyword">int</span> LASTCHAR = NUMCHARS - <span class="number">1</span>;</div><div class="line">	va_list pArgs;</div><div class="line">	va_start(pArgs, szFormat);</div><div class="line"></div><div class="line">	<span class="comment">// Use a bounded buffer size to prevent buffer overruns.  Limit count to</span></div><div class="line">	<span class="comment">// character size minus one to allow for a NULL terminating character.</span></div><div class="line">	<span class="number">_</span>vsntprintf(szBuffer, NUMCHARS - <span class="number">1</span>, szFormat, pArgs);</div><div class="line">	va_end(pArgs);</div><div class="line">}</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;va-list-va-start-va-arg-va-end&quot;&gt;&lt;a href=&quot;#va-list-va-start-va-arg-va-end&quot; class=&quot;headerlink&quot; title=&quot;va_list, va_start / va_arg / va_
    
    </summary>
    
      <category term="C/C++" scheme="http://snowyying.github.io/categories/C-C/"/>
    
    
      <category term="C/C++" scheme="http://snowyying.github.io/tags/C-C/"/>
    
      <category term="不定参数" scheme="http://snowyying.github.io/tags/%E4%B8%8D%E5%AE%9A%E5%8F%82%E6%95%B0/"/>
    
      <category term="函数" scheme="http://snowyying.github.io/tags/%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>使用 NTPD 进行时间同步</title>
    <link href="http://snowyying.github.io/2016/ntp-time/"/>
    <id>http://snowyying.github.io/2016/ntp-time/</id>
    <published>2016-09-07T09:00:02.000Z</published>
    <updated>2016-11-14T07:40:21.922Z</updated>
    
    <content type="html"><![CDATA[<h2 id="NTPD"><a href="#NTPD" class="headerlink" title="NTPD"></a>NTPD</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">root@OpenWrt:~# ntpd --help</div><div class="line">BusyBox v1.22.1 (2014-09-20 22:01:35 CEST) multi-call binary.</div><div class="line"></div><div class="line">Usage: ntpd [-dnqNwl] [-S PROG] [-p PEER]...</div><div class="line"></div><div class="line">NTP client/server</div><div class="line"></div><div class="line">        -d      Verbose</div><div class="line">        -n      Do not daemonize</div><div class="line">        -q      Quit after clock is set</div><div class="line">        -N      Run at high priority</div><div class="line">        -w      Do not set time (only query peers), implies -n</div><div class="line">        -l      Run as server on port 123</div><div class="line">        -S PROG Run PROG after stepping time, stratum change, and every 11 mins</div><div class="line">        -p PEER Obtain time from PEER (may be repeated)</div><div class="line"></div><div class="line">root@OpenWrt:~# ntpd -dnw -p ntp5.aliyun.com</div><div class="line">ntpd: resolved peer ntp5.aliyun.com to 182.92.12.11</div><div class="line">ntpd: sending query to 182.92.12.11</div><div class="line">ntpd: reply from 182.92.12.11: offset:-0.004123 delay:0.037180 status:0x24 strat:2 refid:0x0a892656 rootdelay:0.000107 reach:0x01</div><div class="line">ntpd: sending query to 182.92.12.11</div><div class="line">ntpd: reply from 182.92.12.11: offset:-0.005355 delay:0.043251 status:0x24 strat:2 refid:0x0a892656 rootdelay:0.000107 reach:0x03</div><div class="line">ntpd: sending query to 182.92.12.11</div><div class="line">ntpd: reply from 182.92.12.11: offset:-0.001800 delay:0.039695 status:0x24 strat:2 refid:0x0a892656 rootdelay:0.000107 reach:0x07</div><div class="line">ntpd: sending query to 182.92.12.11</div><div class="line">ntpd: reply from 182.92.12.11: offset:-0.005965 delay:0.039983 status:0x24 strat:2 refid:0x0a892656 rootdelay:0.000107 reach:0x0f</div><div class="line">^C</div><div class="line">root@OpenWrt:~#</div></pre></td></tr></table></figure>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ntpd -dn -p ntp5.aliyun.com</div><div class="line">ntpd -dn -p pool.ntp.org time.nist.gov</div><div class="line">ntpd -dnq -p pool.ntp.org</div></pre></td></tr></table></figure>
<h2 id="Localtime"><a href="#Localtime" class="headerlink" title="Localtime"></a>Localtime</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># vi /etc/sysconfig/clock ZONE=Asia/Shanghai UTC=false ARC=false</div><div class="line"># rm /etc/localtime</div><div class="line"># ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;NTPD&quot;&gt;&lt;a href=&quot;#NTPD&quot; class=&quot;headerlink&quot; title=&quot;NTPD&quot;&gt;&lt;/a&gt;NTPD&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;root@OpenWrt:~# ntpd --help&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;BusyBox v1.22.1 (2014-09-20 22:01:35 CEST) multi-call binary.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Usage: ntpd [-dnqNwl] [-S PROG] [-p PEER]...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;NTP client/server&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        -d      Verbose&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        -n      Do not daemonize&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        -q      Quit after clock is set&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        -N      Run at high priority&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        -w      Do not set time (only query peers), implies -n&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        -l      Run as server on port 123&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        -S PROG Run PROG after stepping time, stratum change, and every 11 mins&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        -p PEER Obtain time from PEER (may be repeated)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root@OpenWrt:~# ntpd -dnw -p ntp5.aliyun.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: resolved peer ntp5.aliyun.com to 182.92.12.11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: sending query to 182.92.12.11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: reply from 182.92.12.11: offset:-0.004123 delay:0.037180 status:0x24 strat:2 refid:0x0a892656 rootdelay:0.000107 reach:0x01&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: sending query to 182.92.12.11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: reply from 182.92.12.11: offset:-0.005355 delay:0.043251 status:0x24 strat:2 refid:0x0a892656 rootdelay:0.000107 reach:0x03&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: sending query to 182.92.12.11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: reply from 182.92.12.11: offset:-0.001800 delay:0.039695 status:0x24 strat:2 refid:0x0a892656 rootdelay:0.000107 reach:0x07&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: sending query to 182.92.12.11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;ntpd: reply from 182.92.12.11: offset:-0.005965 delay:0.039983 status:0x24 strat:2 refid:0x0a892656 rootdelay:0.000107 reach:0x0f&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;^C&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;root@OpenWrt:~#&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Network" scheme="http://snowyying.github.io/categories/Network/"/>
    
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="NTP" scheme="http://snowyying.github.io/tags/NTP/"/>
    
      <category term="时间" scheme="http://snowyying.github.io/tags/%E6%97%B6%E9%97%B4/"/>
    
      <category term="同步" scheme="http://snowyying.github.io/tags/%E5%90%8C%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>ARM 交叉编译</title>
    <link href="http://snowyying.github.io/2016/arm-cross-compile/"/>
    <id>http://snowyying.github.io/2016/arm-cross-compile/</id>
    <published>2016-08-27T10:13:05.000Z</published>
    <updated>2016-09-10T08:34:53.625Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Configure"><a href="#Configure" class="headerlink" title="Configure"></a>Configure</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">./configure --host=arm-linux \</div><div class="line">CC=arm-none-linux-gnueabi-gcc \</div><div class="line">CPP=arm-none-linux-gnueabi-cpp \</div><div class="line">CXX=arm-none-linux-gnueabi-g++ \</div><div class="line">AR=arm-none-linux-gnueabi-ar \</div><div class="line">RANLIB=arm-none-linux-gnueabi-ranlib</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Configure&quot;&gt;&lt;a href=&quot;#Configure&quot; class=&quot;headerlink&quot; title=&quot;Configure&quot;&gt;&lt;/a&gt;Configure&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;t
    
    </summary>
    
      <category term="Embedded" scheme="http://snowyying.github.io/categories/Embedded/"/>
    
    
      <category term="ARM" scheme="http://snowyying.github.io/tags/ARM/"/>
    
      <category term="Linux" scheme="http://snowyying.github.io/tags/Linux/"/>
    
      <category term="嵌入式" scheme="http://snowyying.github.io/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
      <category term="交叉编译" scheme="http://snowyying.github.io/tags/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/"/>
    
  </entry>
  
  <entry>
    <title>Sqlite3 使用总结</title>
    <link href="http://snowyying.github.io/2016/sqlite3-usage-summary/"/>
    <id>http://snowyying.github.io/2016/sqlite3-usage-summary/</id>
    <published>2016-08-27T10:06:34.000Z</published>
    <updated>2016-11-14T07:40:53.535Z</updated>
    
    <content type="html"><![CDATA[<h2 id="&#x4F7F;&#x7528;-Callback"><a href="#&#x4F7F;&#x7528;-Callback" class="headerlink" title="&#x4F7F;&#x7528; Callback"></a>&#x4F7F;&#x7528; Callback</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdafx.h&quot;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sqlite3.h&quot;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line">sqlite3 *smh_db = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">smh_callback</span><span class="params">(<span class="keyword">void</span>* user, <span class="keyword">int</span> column, <span class="keyword">char</span>** value, <span class="keyword">char</span>** name)</span></span></div><div class="line">{</div><div class="line">  <span class="built_in">printf</span>(<span class="string">&quot;SQL data: [%d] %s - %s\n&quot;</span>, column, value[<span class="number">1</span>], name[<span class="number">1</span>]);</div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">int</span> rc = sqlite3_open(<span class="string">&quot;E:/share/smh.db&quot;</span>, &amp;smh_db);</div><div class="line">    <span class="keyword">if</span> (rc != SQLITE_OK)</div><div class="line">    {</div><div class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SQL open: Can&apos;t open database: %s\n&quot;</span>, sqlite3_errmsg(smh_db));</div><div class="line">        sqlite3_close(smh_db);</div><div class="line">        smh_db = <span class="literal">NULL</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">char</span> *zErrMsg = <span class="number">0</span>;</div><div class="line">    <span class="keyword">char</span> *sql = <span class="string">&quot;select * from scene_info&quot;</span>;</div><div class="line"></div><div class="line">    rc = sqlite3_exec(smh_db, sql, smh_callback, <span class="number">0</span>, &amp;zErrMsg);</div><div class="line">    <span class="keyword">if</span> (rc != SQLITE_OK)</div><div class="line">    {</div><div class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SQL error: %s\n&quot;</span>, zErrMsg);</div><div class="line">        sqlite3_free(zErrMsg);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (smh_db != <span class="literal">NULL</span>)</div><div class="line">    {</div><div class="line">        sqlite3_close(smh_db);</div><div class="line">        smh_db = <span class="literal">NULL</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x4F7F;&#x7528;-bind"><a href="#&#x4F7F;&#x7528;-bind" class="headerlink" title="&#x4F7F;&#x7528; bind"></a>&#x4F7F;&#x7528; bind</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stdafx.h&quot;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sqlite3.h&quot;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line">sqlite3 *smh_db = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">smh_callback</span><span class="params">(<span class="keyword">void</span>* user, <span class="keyword">int</span> column, <span class="keyword">char</span>** value, <span class="keyword">char</span>** name)</span></span></div><div class="line">{</div><div class="line">    <span class="built_in">printf</span>(<span class="string">&quot;SQL data: [%d] %s - %s\n&quot;</span>, column, value[<span class="number">1</span>], name[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">int</span> rc = sqlite3_open(<span class="string">&quot;E:/share/smh.db&quot;</span>, &amp;smh_db);</div><div class="line">    <span class="keyword">if</span> (rc != SQLITE_OK)</div><div class="line">    {</div><div class="line">        <span class="built_in">printf</span>(<span class="string">&quot;SQL open: Can&apos;t open database: %s\n&quot;</span>, sqlite3_errmsg(smh_db));</div><div class="line">        sqlite3_close(smh_db);</div><div class="line">        smh_db = <span class="literal">NULL</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">char</span> *zErrMsg = <span class="number">0</span>;</div><div class="line">    <span class="keyword">char</span> *sql = <span class="string">&quot;select * from scene_info&quot;</span>;</div><div class="line">    <span class="comment">/*</span></div><div class="line">    rc = sqlite3_exec(smh_db, sql, smh_callback, 0, &amp;zErrMsg);</div><div class="line">    if (rc != SQLITE_OK)</div><div class="line">    {</div><div class="line">        printf(&quot;SQL error: %s\n&quot;, zErrMsg);</div><div class="line">        sqlite3_free(zErrMsg);</div><div class="line">    }</div><div class="line">    */</div><div class="line">    sqlite3_stmt *pStmt = <span class="literal">NULL</span>;</div><div class="line">    sqlite3_prepare_v2(smh_db, sql, <span class="number">-1</span>, &amp;pStmt, (<span class="keyword">const</span> <span class="keyword">char</span> **)&amp;zErrMsg);</div><div class="line">    <span class="comment">//int sqlite3_bind_text(sqlite3_stmt*, int, const char*, int n, void(*)(void*));</span></div><div class="line">    <span class="keyword">while</span> (sqlite3_step(pStmt) == SQLITE_ROW)</div><div class="line">    {</div><div class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>, sqlite3_column_int(pStmt, <span class="number">0</span>));</div><div class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s;&quot;</span>, sqlite3_column_text(pStmt, <span class="number">1</span>));</div><div class="line">    }</div><div class="line"></div><div class="line">    sqlite3_finalize(pStmt);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (smh_db != <span class="literal">NULL</span>)</div><div class="line">    {</div><div class="line">        sqlite3_close(smh_db);</div><div class="line">        smh_db = <span class="literal">NULL</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;&amp;#x4F7F;&amp;#x7528;-Callback&quot;&gt;&lt;a href=&quot;#&amp;#x4F7F;&amp;#x7528;-Callback&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4F7F;&amp;#x7528; Callback&quot;&gt;&lt;/a&gt;&amp;#x4F7F;&amp;#x
    
    </summary>
    
      <category term="Database" scheme="http://snowyying.github.io/categories/Database/"/>
    
    
      <category term="SQLite" scheme="http://snowyying.github.io/tags/SQLite/"/>
    
      <category term="数据库" scheme="http://snowyying.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
      <category term="C/C++" scheme="http://snowyying.github.io/tags/C-C/"/>
    
  </entry>
  
  <entry>
    <title>理解TCP/IP网络栈&amp;编写网络应用 (下)</title>
    <link href="http://snowyying.github.io/2016/Understand-TCP-IP-network-2/"/>
    <id>http://snowyying.github.io/2016/Understand-TCP-IP-network-2/</id>
    <published>2016-08-16T13:36:11.000Z</published>
    <updated>2016-08-25T04:03:19.555Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x6765;&#x81EA;: &#x535A;&#x5BA2; Axb&#x7684;&#x81EA;&#x6211;&#x4FEE;&#x517B; http://blog.2baxb.me/archives/1190 2015/05/01</code></p>
<h2 id="&#x4E00;-&#x6458;&#x8981;"><a href="#&#x4E00;-&#x6458;&#x8981;" class="headerlink" title="&#x4E00; &#x6458;&#x8981;"></a>&#x4E00; &#x6458;&#x8981;</h2><p>&#x8FD9;&#x662F;&#x300A;&#x7FFB;&#x8BD1;&#xFF1A;&#x7406;&#x89E3;TCP/IP&#x7F51;&#x7EDC;&#x6808;&amp;&#x7F16;&#x5199;&#x7F51;&#x7EDC;&#x5E94;&#x7528;&#x300B;&#x7684;&#x4E0B;&#x7BC7;&#xFF0C;&#x6587;&#x7AE0;&#x4E2D;&#x4F1A;&#x901A;&#x8FC7;&#x8BB2;&#x89E3;TCP&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5E2E;&#x52A9;&#x5927;&#x5BB6;&#x7406;&#x89E3;&#x53D1;&#x9001;&#x3001;&#x63A5;&#x6536;&#x6570;&#x636E;&#x7684;&#x6D41;&#x7A0B;&#xFF0C;&#x4E5F;&#x63CF;&#x8FF0;&#x4E86;&#x4E00;&#x4E9B;&#x7F51;&#x5361;&#x3001;&#x9A71;&#x52A8;&#x7B49;&#x7F51;&#x7EDC;&#x6808;&#x5E95;&#x5C42;&#x7684;&#x539F;&#x7406;&#x3002;</p>
<blockquote>
<p>&#x539F;&#x6587;&#x5730;&#x5740;&#xFF1A;<a href="http://www.cubrid.org/blog/dev-platform/understanding-tcp-ip-network-stack/" target="_blank" rel="external">http://www.cubrid.org/blog/dev-platform/understanding-tcp-ip-network-stack/</a></p>
<p>&#x539F;&#x4F5C;&#x8005;&#xFF1A;Hyeongyeop Kim</p>
<p>&#x7FFB;&#x8BD1;&#xFF1A;@&#x86CB;&#x75BC;&#x7684;axb <a href="http://2baxb.me" target="_blank" rel="external">http://2baxb.me</a></p>
</blockquote>
<h2 id="&#x4E8C;-&#x6570;&#x636E;&#x7ED3;&#x6784;"><a href="#&#x4E8C;-&#x6570;&#x636E;&#x7ED3;&#x6784;" class="headerlink" title="&#x4E8C; &#x6570;&#x636E;&#x7ED3;&#x6784;"></a>&#x4E8C; &#x6570;&#x636E;&#x7ED3;&#x6784;</h2><p>&#x4EE5;&#x4E0B;&#x662F;&#x4E00;&#x4E9B;&#x5173;&#x952E;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x518D;&#x5F00;&#x59CB;&#x67E5;&#x770B;&#x4EE3;&#x7801;&#x3002;</p>
<h4 id="1-sk-buff-structure"><a href="#1-sk-buff-structure" class="headerlink" title="1. sk_buff_structure"></a>1. sk_buff_structure</h4><p>&#x9996;&#x5148;&#xFF0C;<strong>sk_buff</strong> &#x7ED3;&#x6784;&#x6216; <strong>skb</strong> &#x7ED3;&#x6784;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x3002;<strong>&#x56FE;6</strong> &#x5C55;&#x73B0;&#x4E86; <strong>sk_buff</strong> &#x4E2D;&#x7684;&#x4E00;&#x4E9B;&#x7ED3;&#x6784;&#x3002;&#x968F;&#x7740;&#x529F;&#x80FD;&#x53D8;&#x5F97;&#x66F4;&#x5F3A;&#x5927;&#xFF0C;&#x5B83;&#x4EEC;&#x4E5F;&#x53D8;&#x5F97;&#x66F4;&#x590D;&#x6742;&#x4E86;&#x3002;&#x4F46;&#x662F;&#x8FD8;&#x662F;&#x6709;&#x4E00;&#x4E9B;&#x4EFB;&#x4F55;&#x4EBA;&#x90FD;&#x80FD;&#x60F3;&#x5230;&#x7684;&#x57FA;&#x672C;&#x529F;&#x80FD;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-2/packet_structure_sk_buff.png" alt="img"></p>
<center>&#x56FE;6&#xFF1A;&#x6570;&#x636E;&#x5305;&#x7ED3;&#x6784;</center>

<h6 id="2-&#x5305;&#x542B;&#x6570;&#x636E;&#x548C;&#x5143;&#x6570;&#x636E;"><a href="#2-&#x5305;&#x542B;&#x6570;&#x636E;&#x548C;&#x5143;&#x6570;&#x636E;" class="headerlink" title="2. &#x5305;&#x542B;&#x6570;&#x636E;&#x548C;&#x5143;&#x6570;&#x636E;"></a>2. &#x5305;&#x542B;&#x6570;&#x636E;&#x548C;&#x5143;&#x6570;&#x636E;</h6><p>&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x76F4;&#x63A5;&#x5305;&#x542B;&#x6216;&#x8005;&#x901A;&#x8FC7;&#x6307;&#x9488;&#x5F15;&#x7528;&#x4E86;&#x6570;&#x636E;&#x5305;&#x3002;&#x5728; <strong>&#x56FE;6</strong> &#x4E2D;&#xFF0C;&#x4E00;&#x4E9B;&#x6570;&#x636E;&#x5305;&#xFF08;&#x4ECE;Ethernet&#x5230;Buffer&#x90E8;&#x5206;&#xFF09;&#x4F7F;&#x7528;&#x4E86;&#x6307;&#x9488;&#xFF0C;&#x4E00;&#x4E9B;&#x989D;&#x5916;&#x7684;&#x6570;&#x636E;(frags&#xFF09;&#x5F15;&#x7528;&#x4E86;&#x5B9E;&#x9645;&#x7684;&#x5185;&#x5B58;&#x9875;&#x3002;</p>
<p>&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x4FE1;&#x606F;&#x6BD4;&#x5982;&#x5934;&#x548C;&#x5185;&#x5BB9;&#x957F;&#x5EA6;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x5143;&#x6570;&#x636E;&#x533A;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5728; <strong>&#x56FE;6</strong> &#x4E2D;&#xFF0C;mac_header&#x3001;network_header&#x548C;transport_header&#x90FD;&#x6709;&#x76F8;&#x5E94;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;&#x94FE;&#x8DEF;&#x5934;&#x3001;IP&#x5934;&#x548C;TCP&#x5934;&#x7684;&#x8D77;&#x59CB;&#x5730;&#x5740;&#x3002;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x8BA9;TCP&#x534F;&#x8BAE;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x53D8;&#x5F97;&#x7B80;&#x5355;&#x3002;</p>
<h6 id="3-&#x5982;&#x4F55;&#x589E;&#x52A0;&#x6216;&#x5220;&#x9664;&#x5934;"><a href="#3-&#x5982;&#x4F55;&#x589E;&#x52A0;&#x6216;&#x5220;&#x9664;&#x5934;" class="headerlink" title="3. &#x5982;&#x4F55;&#x589E;&#x52A0;&#x6216;&#x5220;&#x9664;&#x5934;"></a>3. &#x5982;&#x4F55;&#x589E;&#x52A0;&#x6216;&#x5220;&#x9664;&#x5934;</h6><p>&#x6570;&#x636E;&#x5305;&#x5728;&#x7F51;&#x7EDC;&#x6808;&#x7684;&#x5404;&#x5C42;&#x4E2D;&#x4E0A;&#x5347;&#x6216;&#x4E0B;&#x964D;&#x65F6;&#x4F1A;&#x589E;&#x52A0;&#x6216;&#x5220;&#x9664;&#x6570;&#x636E;&#x5934;&#x3002;&#x4E3A;&#x4E86;&#x66F4;&#x6709;&#x6548;&#x7387;&#x7684;&#x5904;&#x7406;&#x800C;&#x4F7F;&#x7528;&#x4E86;&#x6307;&#x9488;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x8981;&#x5220;&#x9664;&#x94FE;&#x8DEF;&#x5934;&#x53EA;&#x9700;&#x8981;&#x4FEE;&#x6539;head pointer&#x7684;&#x503C;&#x3002;</p>
<h6 id="4-&#x5982;&#x4F55;&#x5408;&#x5E76;&#x6216;&#x5207;&#x5206;&#x6570;&#x636E;&#x5305;"><a href="#4-&#x5982;&#x4F55;&#x5408;&#x5E76;&#x6216;&#x5207;&#x5206;&#x6570;&#x636E;&#x5305;" class="headerlink" title="4. &#x5982;&#x4F55;&#x5408;&#x5E76;&#x6216;&#x5207;&#x5206;&#x6570;&#x636E;&#x5305;"></a>4. &#x5982;&#x4F55;&#x5408;&#x5E76;&#x6216;&#x5207;&#x5206;&#x6570;&#x636E;&#x5305;</h6><p>&#x4E3A;&#x4E86;&#x66F4;&#x6709;&#x6548;&#x7387;&#x7684;&#x6267;&#x884C;&#x628A;&#x6570;&#x636E;&#x5305;&#x589E;&#x5230;&#x6216;&#x4ECE;socket&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x5220;&#x9664;&#x8FD9;&#x7C7B;&#x64CD;&#x4F5C;&#x800C;&#x4F7F;&#x7528;&#x4E86;&#x94FE;&#x8868;&#xFF0C;&#x6216;&#x8005;&#x53EB;&#x6570;&#x636E;&#x5305;&#x94FE;&#x3002;next&#x548C;prev&#x6307;&#x9488;&#x7528;&#x4E8E;&#x8FD9;&#x4E2A;&#x573A;&#x666F;&#x3002;</p>
<h6 id="5-&#x5FEB;&#x901F;&#x5206;&#x914D;&#x548C;&#x91CA;&#x653E;"><a href="#5-&#x5FEB;&#x901F;&#x5206;&#x914D;&#x548C;&#x91CA;&#x653E;" class="headerlink" title="5. &#x5FEB;&#x901F;&#x5206;&#x914D;&#x548C;&#x91CA;&#x653E;"></a>5. &#x5FEB;&#x901F;&#x5206;&#x914D;&#x548C;&#x91CA;&#x653E;</h6><p>&#x65E0;&#x8BBA;&#x4F55;&#x65F6;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5305;&#x90FD;&#x4F1A;&#x5206;&#x914D;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x6B64;&#x65F6;&#x4F1A;&#x7528;&#x5230;&#x5FEB;&#x901F;&#x5206;&#x914D;&#x5668;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x901A;&#x8FC7;10Gb&#x7684;&#x4EE5;&#x592A;&#x7F51;&#x4F20;&#x8F93;&#xFF0C;&#x6BCF;&#x79D2;&#x4F1A;&#x6709;&#x8D85;&#x8FC7;&#x4E00;&#x767E;&#x4E07;&#x4E2A;&#x5BF9;&#x8C61;&#x88AB;&#x521B;&#x5EFA;&#x548C;&#x9500;&#x6BC1;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x4E09;-TCP&#x63A7;&#x5236;&#x5757;&#xFF08;TCP-Control-Block&#xFF09;"><a href="#&#x4E09;-TCP&#x63A7;&#x5236;&#x5757;&#xFF08;TCP-Control-Block&#xFF09;" class="headerlink" title="&#x4E09; TCP&#x63A7;&#x5236;&#x5757;&#xFF08;TCP Control Block&#xFF09;"></a>&#x4E09; TCP&#x63A7;&#x5236;&#x5757;&#xFF08;TCP Control Block&#xFF09;</h2><p>&#x5176;&#x6B21;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x8868;&#x793A;TCP&#x8FDE;&#x63A5;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x4E4B;&#x524D;&#x5B83;&#x88AB;&#x62BD;&#x8C61;&#x7684;&#x53EB;&#x505A;TCP&#x63A7;&#x5236;&#x5757;&#x3002;Linux&#x4F7F;&#x7528;&#x4E86;tcp_sock&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x5728; <strong>&#x56FE;7</strong> &#x4E2D;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#x6587;&#x4EF6;&#x3001;socket&#x548C; <strong>tcp_socket</strong> &#x7684;&#x5173;&#x7CFB;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-2/tcp_connection_structure.png" alt="img"></p>
<center>&#x56FE;7&#xFF1A;TCP Connection&#x7ED3;&#x6784;</center>

<p>&#x5F53;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53D1;&#x751F;&#x540E;&#xFF0C;&#x5B83;&#x4F1A;&#x627E;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5728;&#x8FDB;&#x884C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x65F6;&#x4F7F;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x3002;&#x5BF9;Unix&#x7CFB;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6765;&#x8BF4;&#xFF0C;&#x6587;&#x4EF6;&#x672C;&#x8EAB;&#x548C;&#x901A;&#x7528;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x5B58;&#x50A8;&#x7684;&#x8BBE;&#x5907;&#x90FD;&#x88AB;&#x62BD;&#x8C61;&#x6210;&#x4E86;&#x6587;&#x4EF6;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x5305;&#x542B;&#x4E86;&#x5FC5;&#x8981;&#x7684;&#x4FE1;&#x606F;&#x3002;&#x5BF9;&#x4E8E;socket&#x6765;&#x8BF4;&#xFF0C;&#x4F7F;&#x7528;&#x72EC;&#x7ACB;&#x7684;socket&#x7ED3;&#x6784;&#x4FDD;&#x5B58;socket&#x76F8;&#x5173;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x901A;&#x8FC7;&#x6307;&#x9488;&#x6765;&#x5F15;&#x7528;socket&#x3002;socket&#x53C8;&#x5F15;&#x7528;&#x4E86;tcp_sock&#x3002;tcp_sock&#x53EF;&#x4EE5;&#x5206;&#x4E3A;sock,inet_sock&#x7B49;&#x7B49;,&#x7528;&#x6765;&#x652F;&#x6301;&#x9664;&#x4E86;TCP&#x4E4B;&#x5916;&#x7684;&#x534F;&#x8BAE;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x8FD9;&#x662F;&#x4E00;&#x79CD;&#x591A;&#x6001;&#x3002;</p>
<p>&#x6240;&#x6709;TCP&#x534F;&#x8BAE;&#x7528;&#x5230;&#x7684;&#x72B6;&#x6001;&#x4FE1;&#x606F;&#x90FD;&#x88AB;&#x5B58;&#x5728;tcp_sock&#x91CC;&#x3002;&#x4F8B;&#x5982;&#x987A;&#x5E8F;&#x53F7;&#x3001;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#x3001;&#x963B;&#x585E;&#x63A7;&#x5236;&#x548C;&#x91CD;&#x53D1;&#x9001;&#x5B9A;&#x65F6;&#x5668;&#x90FD;&#x4FDD;&#x5B58;&#x5728;tcp_sock&#x4E2D;&#x3002;</p>
<p>socket&#x7684;&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x533A;&#x548C;&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x7531;sk_buff&#x94FE;&#x8868;&#x7EC4;&#x6210;&#x5E76;&#x88AB;&#x5305;&#x542B;&#x5728;tcp_sock&#x4E2D;&#x3002;&#x4E3A;&#x9632;&#x6B62;&#x9891;&#x7E41;&#x67E5;&#x627E;&#x8DEF;&#x7531;&#xFF0C;&#x4E5F;&#x4F1A;&#x5728;tcp_sock&#x4E2D;&#x5F15;&#x7528;IP&#x8DEF;&#x7531;&#x7ED3;&#x679C;dst_entry&#x3002;&#x901A;&#x8FC7;dst_entry&#x53EF;&#x4EE5;&#x7B80;&#x5355;&#x7684;&#x67E5;&#x627E;&#x5230;&#x76EE;&#x6807;&#x7684;MAC&#x5730;&#x5740;&#x4E4B;&#x7C7B;&#x7684;ARP&#x7684;&#x7ED3;&#x679C;&#x3002;dst_entry&#x662F;&#x8DEF;&#x7531;&#x8868;&#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x800C;&#x8DEF;&#x7531;&#x8868;&#x662F;&#x4E2A;&#x5F88;&#x590D;&#x6742;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x6863;&#x91CC;&#x5C31;&#x4E0D;&#x518D;&#x8BA8;&#x8BBA;&#x4E86;&#x3002;&#x7528;&#x6765;&#x4F20;&#x9001;&#x6570;&#x636E;&#x7684;&#x7F51;&#x5361;(NIC)&#x53EF;&#x4EE5;&#x901A;&#x8FC7;dst_entry&#x627E;&#x5230;&#x3002;&#x7F51;&#x5361;&#x901A;&#x8FC7;net_device&#x63CF;&#x8FF0;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x4EC5;&#x901A;&#x8FC7;&#x67E5;&#x627E;&#x6587;&#x4EF6;&#x548C;&#x6307;&#x9488;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x7B80;&#x5355;&#x7684;&#x67E5;&#x627E;&#x5230;&#x5904;&#x7406;TCP&#x8FDE;&#x63A5;&#x7684;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF08;&#x4ECE;&#x6587;&#x4EF6;&#x5230;&#x9A71;&#x52A8;&#xFF09;&#x3002;&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#x5927;&#x5C0F;&#x5C31;&#x662F;&#x6BCF;&#x4E2A;TCP&#x8FDE;&#x63A5;&#x5360;&#x7528;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x3002;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x53EA;&#x6709;&#x51E0;kb&#x5927;&#x5C0F;&#xFF08;&#x6392;&#x9664;&#x4E86;&#x6570;&#x636E;&#x5305;&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF09;&#x3002;&#x4F46;&#x968F;&#x7740;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#x88AB;&#x52A0;&#x5165;&#xFF0C;&#x5185;&#x5B58;&#x5360;&#x7528;&#x4E5F;&#x5728;&#x9010;&#x6E10;&#x589E;&#x52A0;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B;TCP&#x8FDE;&#x63A5;&#x67E5;&#x627E;&#x8868;&#xFF08;TCP connection lookup table&#xFF09;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7528;&#x6765;&#x67E5;&#x627E;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x5BF9;&#x5E94;tcp&#x8FDE;&#x63A5;&#x7684;&#x54C8;&#x5E0C;&#x8868;&#x3002;&#x7CFB;&#x7EDF;&#x4F1A;&#x7528;&#x6570;&#x636E;&#x5305;&#x7684;&lt;&#x6765;&#x6E90;ip&#xFF0C;&#x76EE;&#x6807;ip&#xFF0C;&#x6765;&#x6E90;&#x7AEF;&#x53E3;&#xFF0C;&#x76EE;&#x6807;&#x7AEF;&#x53E3;&gt;&#x548C;Jenkins&#x54C8;&#x5E0C;&#x7B97;&#x6CD5;&#x53BB;&#x8BA1;&#x7B97;&#x54C8;&#x5E0C;&#x503C;&#x3002;&#x9009;&#x62E9;&#x8FD9;&#x4E2A;&#x54C8;&#x5E0C;&#x51FD;&#x6570;&#x7684;&#x539F;&#x56E0;&#x662F;&#x4E3A;&#x4E86;&#x9632;&#x6B62;&#x5BF9;&#x54C8;&#x5E0C;&#x8868;&#x7684;&#x653B;&#x51FB;&#x3002;</p>
<h2 id="&#x56DB;-&#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#xFF1A;&#x5982;&#x4F55;&#x4F20;&#x8F93;&#x6570;&#x636E;"><a href="#&#x56DB;-&#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#xFF1A;&#x5982;&#x4F55;&#x4F20;&#x8F93;&#x6570;&#x636E;" class="headerlink" title="&#x56DB; &#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#xFF1A;&#x5982;&#x4F55;&#x4F20;&#x8F93;&#x6570;&#x636E;"></a>&#x56DB; &#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#xFF1A;&#x5982;&#x4F55;&#x4F20;&#x8F93;&#x6570;&#x636E;</h2><p>&#x6211;&#x4EEC;&#x5C06;&#x4F1A;&#x901A;&#x8FC7;&#x8FFD;&#x8E2A;&#x5B9E;&#x9645;&#x7684;Linux&#x5185;&#x6838;&#x6E90;&#x7801;&#x53BB;&#x68C0;&#x67E5;&#x534F;&#x8BAE;&#x6808;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x5173;&#x952E;&#x4EFB;&#x52A1;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x4F1A;&#x89C2;&#x5BDF;&#x7ECF;&#x5E38;&#x4F7F;&#x7528;&#x7684;&#x4E24;&#x6761;&#x8DEF;&#x5F84;&#x3002;</p>
<p>&#x9996;&#x5148;&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x4E86;write&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x65F6;&#x7684;&#x6267;&#x884C;&#x8DEF;&#x5F84;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">SYSCALL_DEFINE3(write, <span class="keyword">unsigned</span> <span class="keyword">int</span>, fd, <span class="keyword">const</span> <span class="keyword">char</span> <span class="number">__u</span>ser *, buf, ...)</div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">struct</span> file *file;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">file = fget_light(fd, &amp;fput_needed);</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">ret = filp-&gt;f_op-&gt;aio_write(&amp;kiocb, &amp;iov, <span class="number">1</span>, kiocb.ki_pos);</div><div class="line"></div><div class="line"><span class="keyword">struct</span> file_operations {</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">ssize_t</span> (*aio_read) (<span class="keyword">struct</span> kiocb *, <span class="keyword">const</span> <span class="keyword">struct</span> iovec *, ...)</div><div class="line"></div><div class="line"><span class="keyword">ssize_t</span> (*aio_write) (<span class="keyword">struct</span> kiocb *, <span class="keyword">const</span> <span class="keyword">struct</span> iovec *, ...)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct</span> file_operations socket_file_ops = {</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">.aio_read = sock_aio_read,</div><div class="line"></div><div class="line">.aio_write = sock_aio_write,</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>
<p>&#x5F53;&#x5E94;&#x7528;&#x8C03;&#x7528;&#x4E86;write&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x5185;&#x6838;&#x5C06;&#x5728;&#x6587;&#x4EF6;&#x5C42;&#x6267;&#x884C;write()&#x51FD;&#x6570;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x5185;&#x6838;&#x4F1A;&#x53D6;&#x51FA;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x8C03;&#x7528;aio_write&#xFF0C;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6307;&#x9488;&#x3002;&#x5728;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#xFF0C;&#x4F60;&#x53EF;&#x4EE5;&#x770B;&#x5230;file_perations&#x7ED3;&#x6784;&#x4F53;&#x6307;&#x9488;&#x3002;&#x8FD9;&#x4E2A;&#x7ED3;&#x6784;&#x88AB;&#x901A;&#x79F0;&#x4E3A;&#x51FD;&#x6570;&#x8868;&#xFF08;function table&#xFF09;&#xFF0C;&#x5176;&#x4E2D;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E9B;&#x51FD;&#x6570;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x6BD4;&#x5982;aio_read&#x6216;&#x8005;aio_write&#x3002;&#x5BF9;&#x4E8E;socket&#x6765;&#x8BF4;&#xFF0C;&#x5B9E;&#x9645;&#x7684;&#x8868;&#x662F;socket_file_ops&#xFF0C;aio_write&#x5BF9;&#x5E94;&#x7684;&#x51FD;&#x6570;&#x662F;sock_aio_write&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x51FD;&#x6570;&#x8868;&#x7684;&#x4F5C;&#x7528;&#x7C7B;&#x4F3C;&#x4E8E;java&#x4E2D;&#x7684;interface&#xFF0C;&#x5185;&#x6838;&#x4F7F;&#x7528;&#x8FD9;&#x79CD;&#x673A;&#x5236;&#x8FDB;&#x884C;&#x4EE3;&#x7801;&#x62BD;&#x8C61;&#x6216;&#x91CD;&#x6784;&#x3002;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> ssize_t <span class="title">sock_aio_write</span><span class="params">(<span class="keyword">struct</span> kiocb *iocb, <span class="keyword">const</span> <span class="keyword">struct</span> iovec *iov, ..)</span></span></div><div class="line">{</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">struct</span> socket *sock = file-&gt;private_data;</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line"><span class="keyword">return</span> sock-&gt;ops-&gt;sendmsg(iocb, sock, msg, size);</div><div class="line"></div><div class="line"><span class="keyword">struct</span> socket {</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">struct</span> file *file;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> sock *sk;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">struct</span> proto_ops *ops;</div><div class="line"></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">struct</span> proto_ops inet_stream_ops = {</div><div class="line"></div><div class="line">.family = PF_INET,</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">.connect = inet_stream_connect,</div><div class="line"></div><div class="line">.accept = inet_accept,</div><div class="line"></div><div class="line">.listen = inet_listen, .sendmsg = tcp_sendmsg,</div><div class="line"></div><div class="line">.recvmsg = inet_recvmsg,</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">struct</span> proto_ops {</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">int</span> (*connect) (<span class="keyword">struct</span> socket *sock, ...)</div><div class="line"></div><div class="line"><span class="keyword">int</span> (*accept) (<span class="keyword">struct</span> socket *sock, ...)</div><div class="line"></div><div class="line"><span class="keyword">int</span> (*listen) (<span class="keyword">struct</span> socket *sock, <span class="keyword">int</span> len);</div><div class="line"></div><div class="line"><span class="keyword">int</span> (*sendmsg) (<span class="keyword">struct</span> kiocb *iocb, <span class="keyword">struct</span> socket *sock, ...)</div><div class="line"></div><div class="line"><span class="keyword">int</span> (*recvmsg) (<span class="keyword">struct</span> kiocb *iocb, <span class="keyword">struct</span> socket *sock, ...)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>
<p>sock_aio_write()&#x51FD;&#x6570;&#x4F1A;&#x4ECE;&#x6587;&#x4EF6;&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#x53D6;&#x51FA;socket&#x7ED3;&#x6784;&#x4F53;&#x5E76;&#x8C03;&#x7528;sendmsg&#xFF0C;&#x8FD9;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x6307;&#x9488;&#x3002;socket&#x7ED3;&#x6784;&#x4F53;&#x4E2D;&#x5305;&#x542B;&#x4E86;proto_ops&#x51FD;&#x6570;&#x8868;&#x3002;IPv4&#x7684;TCP&#x5B9E;&#x73B0;&#x4E2D;&#xFF0C;proto_ops&#x7684;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x662F;inet_stream_ops&#xFF0C;sendmsg&#x7684;&#x5B9E;&#x73B0;&#x662F;tcp_sendmsg&#x3002;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcp_sendmsg</span><span class="params">(<span class="keyword">struct</span> kiocb *iocb, <span class="keyword">struct</span> socket *sock, <span class="keyword">struct</span> msghdr *msg, <span class="keyword">size_t</span> size)</span></span></div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">struct</span> sock *sk = sock-&gt;sk;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> iovec *iov;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> tcp_sock *tp = tcp_sk(sk);</div><div class="line"></div><div class="line"><span class="keyword">struct</span> sk_buff *skb;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">mss_now = tcp_send_mss(sk, &amp;size_goal, flags);</div><div class="line"></div><div class="line"><span class="comment">/* Ok commence sending. */</span></div><div class="line"></div><div class="line">iovlen = msg-&gt;msg_iovlen;</div><div class="line"></div><div class="line">iov = msg-&gt;msg_iov;</div><div class="line"></div><div class="line">copied = <span class="number">0</span>;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">while</span> (--iovlen &gt;= <span class="number">0</span>) {</div><div class="line"></div><div class="line"><span class="keyword">int</span> seglen = iov-&gt;iov_len;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="number">__u</span>ser *from = iov-&gt;iov_base;</div><div class="line"></div><div class="line">iov++;</div><div class="line"></div><div class="line"><span class="keyword">while</span> (seglen &gt; <span class="number">0</span>) {</div><div class="line"></div><div class="line"><span class="keyword">int</span> copy = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> max = size_goal;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">skb = sk_stream_alloc_skb(sk, select_size(sk, sg), sk-&gt;sk_allocation);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!skb)</div><div class="line"></div><div class="line"><span class="keyword">goto</span> wait_for_memory;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">* Check whether we can use HW checksum.</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="keyword">if</span> (sk-&gt;sk_route_caps &amp; NETIF_F_ALL_CSUM)</div><div class="line"></div><div class="line">skb-&gt;ip_summed = CHECKSUM_PARTIAL;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">skb_entail(sk, skb);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="comment">/* Where to copy to? */</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> (skb_tailroom(skb) &gt; <span class="number">0</span>) {</div><div class="line"></div><div class="line"><span class="comment">/* We have some space in skb head. Superb! */</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> (copy &gt; skb_tailroom(skb))</div><div class="line"></div><div class="line">copy = skb_tailroom(skb);</div><div class="line"></div><div class="line"><span class="keyword">if</span> ((err = skb_add_data(skb, from, copy)) != <span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="keyword">goto</span> do_fault;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">if</span> (copied)</div><div class="line"></div><div class="line">tcp_push(sk, flags, mss_now, tp-&gt;nonagle);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>
<p>tcp_sendmsg&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x5199;&#x7684;&#x662F;tcp_sengmsg&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#x7B14;&#x8BEF;)&#x4F1A;&#x4ECE;socket&#x4E2D;&#x53D6;&#x5F97;tcp_sock&#xFF08;&#x4E5F;&#x5C31;&#x662F;TCP&#x63A7;&#x5236;&#x5757;&#xFF0C;TCB&#xFF09;&#xFF0C;&#x5E76;&#x628A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8BF7;&#x6C42;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;socket&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x4E2D;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x5C31;&#x662F;&#x6839;&#x636E;&#x53D1;&#x9001;&#x6570;&#x636E;&#x521B;&#x5EFA;sk_buff&#x94FE;&#x8868;&#xFF09;&#x3002;&#x5F53;&#x628A;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;sk_buff&#x4E2D;&#x65F6;&#xFF0C;&#x6BCF;&#x4E2A;sk_buff&#x4F1A;&#x5305;&#x542B;&#x591A;&#x5C11;&#x5B57;&#x8282;&#x6570;&#x636E;&#xFF1F;&#x5728;&#x4EE3;&#x7801;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5305;&#x65F6;&#xFF0C;&#x6BCF;&#x4E2A;sk_buff&#x4E2D;&#x4F1A;&#x5305;&#x542B;MSS&#x5B57;&#x8282;(&#x901A;&#x8FC7;tcp_send_mss&#x51FD;&#x6570;&#x83B7;&#x53D6;)&#xFF0C;&#x5728;&#x8FD9;&#x91CC;MSS&#x8868;&#x793A;&#x6BCF;&#x4E2A;TCP&#x6570;&#x636E;&#x5305;&#x80FD;&#x643A;&#x5E26;&#x6570;&#x636E;&#x7684;&#x6700;&#x5927;&#x503C;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;TSO(TCP Segment Offload)&#x548C;GSO(Generic Segmentation Offload)&#x6280;&#x672F;&#xFF0C;&#x4E00;&#x4E2A;sk_buff&#x53EF;&#x4EE5;&#x4FDD;&#x5B58;&#x5927;&#x4E8E;MSS&#x7684;&#x6570;&#x636E;&#x3002;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x91CC;&#x5C31;&#x4E0D;&#x8BE6;&#x7EC6;&#x89E3;&#x91CA;&#x4E86;&#x3002;</p>
<p>sk_stream_alloc_skb&#x51FD;&#x6570;&#x4F1A;&#x521B;&#x5EFA;&#x65B0;&#x7684;sk_buff&#xFF0C;&#x4E4B;&#x540E;&#x901A;&#x8FC7;skb_entail&#x628A;&#x65B0;&#x521B;&#x5EFA;&#x7684;sk_buff&#x653E;&#x5230;send_socket_buffer&#x7684;&#x672B;&#x5C3E;&#x3002;skb_add_data&#x51FD;&#x6570;&#x4F1A;&#x628A;&#x5E94;&#x7528;&#x5C42;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;sk_buff&#x7684;buffer&#x4E2D;&#x3002;&#x901A;&#x8FC7;&#x91CD;&#x590D;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF08;&#x521B;&#x5EFA;sk_buff&#x7136;&#x540E;&#x628A;&#x5B83;&#x52A0;&#x5165;&#x5230;socket&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x533A;&#xFF09;&#x5B8C;&#x6210;&#x6240;&#x6709;&#x6570;&#x636E;&#x7684;&#x62F7;&#x8D1D;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5927;&#x5C0F;&#x662F;MSS&#x7684;&#x591A;&#x4E2A;sk_buff&#x4F1A;&#x5728;socket&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x5F62;&#x6210;&#x4E00;&#x4E2A;&#x94FE;&#x8868;&#x3002;&#x6700;&#x7EC8;&#x8C03;&#x7528;tcp_push&#x628A;&#x5F85;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x505A;&#x6210;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x5E76;&#x4E14;&#x53D1;&#x9001;&#x51FA;&#x53BB;&#x3002;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">static inline void tcp_push(struct sock *sk, int flags, int mss_now, ...)</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">static int tcp_write_xmit(struct sock *sk, unsigned int mss_now, ...)</div><div class="line"></div><div class="line">int nonagle,</div><div class="line">{</div><div class="line"></div><div class="line">struct tcp_sock *tp = tcp_sk(sk);</div><div class="line"></div><div class="line">struct sk_buff *skb;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">while ((skb = tcp_send_head(sk))) {</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">cwnd_quota = tcp_cwnd_test(tp, skb);</div><div class="line"></div><div class="line">if (!cwnd_quota)</div><div class="line"></div><div class="line">break;</div><div class="line"></div><div class="line">if (unlikely(!tcp_snd_wnd_test(tp, skb, mss_now)))</div><div class="line"></div><div class="line">break;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">if (unlikely(tcp_transmit_skb(sk, skb, 1, gfp)))</div><div class="line"></div><div class="line">break;</div><div class="line"></div><div class="line">/* Advance the send_head. This one is sent out.</div><div class="line">* This call will increment packets_out.</div><div class="line">*/</div><div class="line"></div><div class="line">tcp_event_new_data_sent(sk, skb);</div><div class="line"></div><div class="line">[...]</div></pre></td></tr></table></figure>
<p>tcp_push&#x51FD;&#x6570;&#x4F1A;&#x5728;TCP&#x5141;&#x8BB8;&#x7684;&#x8303;&#x56F4;&#x5185;&#x987A;&#x5E8F;&#x53D1;&#x9001;&#x5C3D;&#x53EF;&#x80FD;&#x591A;&#x7684;sk_buff&#x6570;&#x636E;&#x3002;&#x9996;&#x5148;&#x4F1A;&#x8C03;&#x7528;tcp_send_head&#x53D6;&#x5F97;&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x7B2C;&#x4E00;&#x4E2A;sk_buff&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;tcp_cwnd_test&#x548C;tcp_send_wnd_test&#x68C0;&#x67E5;&#x5835;&#x585E;&#x7A97;&#x53E3;&#x548C;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#xFF0C;&#x5224;&#x65AD;&#x63A5;&#x6536;&#x65B9;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x63A5;&#x6536;&#x65B0;&#x6570;&#x636E;&#x3002;&#x4E4B;&#x540E;&#x8C03;&#x7528;tcp_transmit_skb&#x51FD;&#x6570;&#x6765;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5305;&#x3002;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">tcp_transmit_skb</span><span class="params">(<span class="keyword">struct</span> sock *sk,</span></span></div><div class="line">  <span class="keyword">struct</span> sk_buff *skb, <span class="keyword">int</span> clone_it, <span class="keyword">gfp_t</span> gfp_mask)</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">struct</span> inet_connection_sock *icsk = inet_csk(sk);</div><div class="line"></div><div class="line"><span class="keyword">struct</span> inet_sock *inet;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> tcp_sock *tp;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">if</span> (likely(clone_it)) {</div><div class="line"></div><div class="line"><span class="keyword">if</span> (unlikely(skb_cloned(skb)))</div><div class="line"></div><div class="line">skb = pskb_copy(skb, gfp_mask);</div><div class="line"></div><div class="line"><span class="keyword">else</span></div><div class="line"></div><div class="line">skb = skb_clone(skb, gfp_mask);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (unlikely(!skb))</div><div class="line"></div><div class="line"><span class="keyword">return</span> -ENOBUFS;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">skb_push(skb, tcp_header_size);</div><div class="line"></div><div class="line">skb_reset_transport_header(skb);</div><div class="line"></div><div class="line">skb_set_owner_w(skb, sk);</div><div class="line"></div><div class="line"><span class="comment">/* Build TCP header and checksum it. */</span></div><div class="line"></div><div class="line">th = tcp_hdr(skb);</div><div class="line"></div><div class="line">th-&gt;source = inet-&gt;inet_sport;</div><div class="line"></div><div class="line">th-&gt;dest = inet-&gt;inet_dport;</div><div class="line"></div><div class="line">th-&gt;seq = htonl(tcb-&gt;seq);</div><div class="line"></div><div class="line">th-&gt;ack_seq = htonl(tp-&gt;rcv_nxt);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">icsk-&gt;icsk_af_ops-&gt;send_check(sk, skb);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">err = icsk-&gt;icsk_af_ops-&gt;queue_xmit(skb);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (likely(err &lt;= <span class="number">0</span>))</div><div class="line"></div><div class="line"><span class="keyword">return</span> err;</div><div class="line"></div><div class="line">tcp_enter_cwr(sk, <span class="number">1</span>);</div><div class="line"></div><div class="line"><span class="keyword">return</span> net_xmit_eval(err);</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>
<p>tcp_transmit_skb&#x4F1A;&#x521B;&#x5EFA;&#x6307;&#x5B9A;sk_buff&#x7684;&#x62F7;&#x8D1D;&#xFF08;&#x901A;&#x8FC7;pskb_copy)&#xFF0C;&#x4F46;&#x5B83;&#x4E0D;&#x4F1A;&#x62F7;&#x8D1D;&#x5E94;&#x7528;&#x5C42;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x800C;&#x662F;&#x62F7;&#x8D1D;&#x4E00;&#x4E9B;&#x5143;&#x6570;&#x636E;&#x3002;&#x4E4B;&#x540E;&#x4F1A;&#x8C03;&#x7528;skb_push&#x6765;&#x786E;&#x4FDD;&#x548C;&#x8BB0;&#x5F55;&#x5934;&#x90E8;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#x3002;send_check&#x8BA1;&#x7B97;TCP&#x6821;&#x9A8C;&#x548C;&#xFF08;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x6821;&#x9A8C;&#x548C;&#x5378;&#x8F7D;checksum offload&#x6280;&#x672F;&#x5219;&#x4E0D;&#x4F1A;&#x505A;&#x8FD9;&#x4E00;&#x6B65;&#x8BA1;&#x7B97;&#xFF09;&#x3002;&#x6700;&#x7EC8;&#x8C03;&#x7528;queue_xmit&#x628A;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5230;IP&#x5C42;&#x3002;IPv4&#x4E2D;queue_xmit&#x7684;&#x5B9E;&#x73B0;&#x51FD;&#x6570;&#x662F;ip_queue_xmit&#x3002;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">int ip_queue_xmit(struct sk_buff *skb)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">rt = (struct rtable *)__sk_dst_check(sk, 0);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">/* OK, we know where to send it, allocate and build IP header. */</div><div class="line"></div><div class="line">skb_push(skb, sizeof(struct iphdr) + (opt ? opt-&gt;optlen : 0));</div><div class="line"></div><div class="line">skb_reset_network_header(skb);</div><div class="line"></div><div class="line">iph = ip_hdr(skb);</div><div class="line"></div><div class="line">*((__be16 *)iph) = htons((4 &lt;&lt; 12) | (5 &lt;&lt; 8) | (inet-&gt;tos &amp; 0xff));</div><div class="line"></div><div class="line">if (ip_dont_fragment(sk, &amp;rt-&gt;dst) &amp;&amp; !skb-&gt;local_df)</div><div class="line"></div><div class="line">iph-&gt;frag_off = htons(IP_DF);</div><div class="line"></div><div class="line">else</div><div class="line"></div><div class="line">iph-&gt;frag_off = 0;</div><div class="line"></div><div class="line">iph-&gt;ttl = ip_select_ttl(inet, &amp;rt-&gt;dst);</div><div class="line"></div><div class="line">iph-&gt;protocol = sk-&gt;sk_protocol;</div><div class="line"></div><div class="line">iph-&gt;saddr = rt-&gt;rt_src;</div><div class="line"></div><div class="line">iph-&gt;daddr = rt-&gt;rt_dst;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">res = ip_local_out(skb);</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">int __ip_local_out(struct sk_buff *skb)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">ip_send_check(iph);</div><div class="line"></div><div class="line">return nf_hook(NFPROTO_IPV4, NF_INET_LOCAL_OUT, skb, NULL, skb_dst(skb)-&gt;dev, dst_output);</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">int ip_output(struct sk_buff *skb)</div><div class="line">{</div><div class="line"></div><div class="line">struct net_device *dev = skb_dst(skb)-&gt;dev;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">skb-&gt;dev = dev;</div><div class="line"></div><div class="line">skb-&gt;protocol = htons(ETH_P_IP);</div><div class="line"></div><div class="line">return NF_HOOK_COND(NFPROTO_IPV4, NF_INET_POST_ROUTING, skb, NULL, dev, ip_finish_output,</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">static int ip_finish_output(struct sk_buff *skb)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">if (skb-&gt;len &gt; ip_skb_dst_mtu(skb) &amp;&amp; !skb_is_gso(skb))</div><div class="line"></div><div class="line">return ip_fragment(skb, ip_finish_output2);</div><div class="line"></div><div class="line">else</div><div class="line"></div><div class="line">return ip_finish_output2(skb);</div></pre></td></tr></table></figure>
<p>ip_queue_xmit&#x51FD;&#x6570;&#x6267;&#x884C;IP&#x5C42;&#x7684;&#x4E00;&#x4E9B;&#x5FC5;&#x8981;&#x7684;&#x4EFB;&#x52A1;&#x3002;__sk_dst_check&#x68C0;&#x67E5;&#x7F13;&#x5B58;&#x7684;&#x8DEF;&#x7531;&#x662F;&#x5426;&#x6709;&#x6548;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x88AB;&#x7F13;&#x5B58;&#x7684;&#x8DEF;&#x7531;&#x9879;&#xFF0C;&#x6216;&#x8005;&#x8DEF;&#x7531;&#x65E0;&#x6548;&#xFF0C;&#x5B83;&#x5C06;&#x4F1A;&#x6267;&#x884C;IP&#x8DEF;&#x7531;&#x9009;&#x62E9;&#xFF08;IP routing)&#x3002;&#x4E4B;&#x540E;&#x8C03;&#x7528;skb_push&#x6765;&#x8BA1;&#x7B97;&#x548C;&#x8BB0;&#x5F55;IP&#x5934;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#x3002;&#x4E4B;&#x540E;&#xFF0C;&#x968F;&#x7740;&#x51FD;&#x6570;&#x6267;&#x884C;&#xFF0C;ip_send_check&#x8BA1;&#x7B97;IP&#x5934;&#x6821;&#x9A8C;&#x548C;&#x5E76;&#x4E14;&#x8C03;&#x7528;netfilter&#x529F;&#x80FD;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x8FD9;&#x662F;&#x5185;&#x6838;&#x7684;&#x4E00;&#x4E2A;&#x6A21;&#x5757;&#xFF09;&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528;ip_finish_output&#x51FD;&#x6570;&#x4F1A;&#x521B;&#x5EFA;IP&#x6570;&#x636E;&#x5206;&#x7247;&#xFF0C;&#x4F46;&#x5728;&#x4F7F;&#x7528;TCP&#x534F;&#x8BAE;&#x65F6;&#x4E0D;&#x4F1A;&#x521B;&#x5EFA;&#x5206;&#x7247;&#xFF0C;&#x56E0;&#x6B64;&#x5185;&#x6838;&#x4F1A;&#x76F4;&#x63A5;&#x8C03;&#x7528;ip_finish_output2&#x6765;&#x589E;&#x52A0;&#x94FE;&#x8DEF;&#x5934;&#xFF0C;&#x5E76;&#x5B8C;&#x6210;&#x6570;&#x636E;&#x5305;&#x7684;&#x521B;&#x5EFA;&#x3002;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">int dev_queue_xmit(struct sk_buff *skb)</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">static inline int __dev_xmit_skb(struct sk_buff *skb, struct Qdisc *q, ...)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">if (...) {</div><div class="line"></div><div class="line">....</div><div class="line"></div><div class="line">} else</div><div class="line"></div><div class="line">if ((q-&gt;flags &amp; TCQ_F_CAN_BYPASS) &amp;&amp; !qdisc_qlen(q) &amp;&amp; qdisc_run_begin(q)) {</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">if (sch_direct_xmit(skb, q, dev, txq, root_lock)) {</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">int sch_direct_xmit(struct sk_buff *skb, struct Qdisc *q, ...)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">HARD_TX_LOCK(dev, txq, smp_processor_id());</div><div class="line"></div><div class="line">if (!netif_tx_queue_frozen_or_stopped(txq))</div><div class="line"></div><div class="line">ret = dev_hard_start_xmit(skb, dev, txq);</div><div class="line"></div><div class="line">HARD_TX_UNLOCK(dev, txq);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">int dev_hard_start_xmit(struct sk_buff *skb, struct net_device *dev, ...)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">if (!list_empty(&amp;ptype_all))</div><div class="line"></div><div class="line">dev_queue_xmit_nit(skb, dev);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">rc = ops-&gt;ndo_start_xmit(skb, dev);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x6700;&#x7EC8;&#x7684;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x901A;&#x8FC7;dev_queue_xmit&#x51FD;&#x6570;&#x5B8C;&#x6210;&#x4F20;&#x8F93;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x901A;&#x8FC7;&#x6392;&#x961F;&#x89C4;&#x5219;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;qdisc&#xFF0C;&#x4E0A;&#x7BC7;&#x6587;&#x7AE0;&#x7B80;&#x5355;&#x4ECB;&#x7ECD;&#x8FC7;&#xFF09;&#x4F20;&#x9012;&#x3002;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;&#x9ED8;&#x8BA4;&#x7684;&#x6392;&#x961F;&#x89C4;&#x5219;&#x5E76;&#x4E14;&#x961F;&#x5217;&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x8DF3;&#x8FC7;&#x961F;&#x5217;&#x800C;&#x76F4;&#x63A5;&#x8C03;&#x7528;sch_direct_xmit&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x5230;&#x9A71;&#x52A8;&#x3002;dev_hard_start_xmit&#x4F1A;&#x8C03;&#x7528;&#x5B9E;&#x9645;&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;&#x5728;&#x8C03;&#x7528;&#x9A71;&#x52A8;&#x4E4B;&#x524D;&#xFF0C;&#x8BBE;&#x5907;&#x7684;&#x53D1;&#x9001;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;TX&#xFF0C;transmit&#xFF09;&#x88AB;&#x9501;&#x5B9A;&#xFF0C;&#x9632;&#x6B62;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x540C;&#x65F6;&#x4F7F;&#x7528;&#x8BBE;&#x5907;&#x3002;&#x7531;&#x4E8E;&#x5185;&#x6838;&#x9501;&#x5B9A;&#x4E86;&#x8BBE;&#x5907;&#x7684;&#x53D1;&#x9001;&#xFF0C;&#x9A71;&#x52A8;&#x53D1;&#x9001;&#x6570;&#x636E;&#x76F8;&#x5173;&#x7684;&#x4EE3;&#x7801;&#x5C31;&#x4E0D;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x9501;&#x4E86;&#x3002;&#x8FD9;&#x91CC;&#x4E0B;&#x6B21;&#x8981;&#x8BB2;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x662F;&#x8BF4;&#x539F;&#x4F5C;&#x8005;&#x7684;&#x4E0B;&#x7BC7;&#x6587;&#x7AE0;&#xFF09;&#x7684;&#x5E76;&#x884C;&#x5F00;&#x53D1;&#x6709;&#x5F88;&#x5927;&#x5173;&#x7CFB;&#x3002;</p>
<p>ndo_start_xmit&#x51FD;&#x6570;&#x4F1A;&#x8C03;&#x7528;&#x9A71;&#x52A8;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5728;&#x8FD9;&#x4E4B;&#x524D;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;ptype_all&#x548C;dev_queue_xmit_nit&#x3002;ptype_all&#x662F;&#x4E2A;&#x5305;&#x542B;&#x4E86;&#x4E00;&#x4E9B;&#x6A21;&#x5757;&#x7684;&#x5217;&#x8868;&#xFF08;&#x6BD4;&#x5982;&#x6570;&#x636E;&#x5305;&#x6355;&#x83B7;&#xFF09;&#x3002;&#x5982;&#x679C;&#x6355;&#x83B7;&#x7A0B;&#x5E8F;&#x6B63;&#x5728;&#x8FD0;&#x884C;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x88AB;ptype_all&#x62F7;&#x8D1D;&#x5230;&#x5176;&#x5B83;&#x7A0B;&#x5E8F;&#x4E2D;&#x3002;&#x56E0;&#x6B64;&#xFF0C;tcpdump&#x4E2D;&#x663E;&#x793A;&#x7684;&#x90FD;&#x662F;&#x53D1;&#x9001;&#x7ED9;&#x9A71;&#x52A8;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;&#x5F53;&#x4F7F;&#x7528;&#x4E86;&#x6821;&#x9A8C;&#x548C;&#x5378;&#x8F7D;(checksum offload)&#x6216;TSO(TCP Segment Offload)&#x8FD9;&#x4E9B;&#x6280;&#x672F;&#x65F6;&#xFF0C;&#x7F51;&#x5361;&#xFF08;NIC&#xFF09;&#x4F1A;&#x64CD;&#x4F5C;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x6240;&#x4EE5;tcpdump&#x5F97;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x548C;&#x5B9E;&#x9645;&#x53D1;&#x9001;&#x5230;&#x7F51;&#x7EDC;&#x7684;&#x6570;&#x636E;&#x5305;&#x6709;&#x53EF;&#x80FD;&#x4E0D;&#x4E00;&#x81F4;&#x3002;&#x5728;&#x7ED3;&#x675F;&#x4E86;&#x6570;&#x636E;&#x5305;&#x4F20;&#x8F93;&#x4EE5;&#x540E;&#xFF0C;&#x9A71;&#x52A8;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4F1A;&#x8FD4;&#x56DE;&#x53D1;&#x9001;&#x4E86;&#x7684;sk_buff&#x3002;</p>
<h2 id="&#x4E94;-&#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#xFF1A;&#x5982;&#x4F55;&#x63A5;&#x6536;&#x6570;&#x636E;"><a href="#&#x4E94;-&#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#xFF1A;&#x5982;&#x4F55;&#x63A5;&#x6536;&#x6570;&#x636E;" class="headerlink" title="&#x4E94; &#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#xFF1A;&#x5982;&#x4F55;&#x63A5;&#x6536;&#x6570;&#x636E;"></a>&#x4E94; &#x8FFD;&#x8E2A;&#x4EE3;&#x7801;&#xFF1A;&#x5982;&#x4F55;&#x63A5;&#x6536;&#x6570;&#x636E;</h2><p>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x7684;&#x6267;&#x884C;&#x8DEF;&#x5F84;&#x662F;&#x63A5;&#x6536;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x5E76;&#x628A;&#x6570;&#x636E;&#x52A0;&#x5165;&#x5230;socket&#x7684;&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x5728;&#x6267;&#x884C;&#x4E86;&#x9A71;&#x52A8;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4E4B;&#x540E;&#xFF0C;&#x9996;&#x5148;&#x6267;&#x884C;&#x7684;&#x662F;napi poll&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line">static void net_rx_action(struct softirq_action *h)</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line">struct softnet_data *sd = &amp;__get_cpu_var(softnet_data);</div><div class="line"></div><div class="line">unsigned long time_limit = jiffies + 2;</div><div class="line"></div><div class="line">int budget = netdev_budget;</div><div class="line"></div><div class="line">void *have;</div><div class="line"></div><div class="line">local_irq_disable();</div><div class="line"></div><div class="line">while (!list_empty(&amp;sd-&gt;poll_list)) {</div><div class="line"></div><div class="line">struct napi_struct *n;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">n = list_first_entry(&amp;sd-&gt;poll_list, struct napi_struct,</div><div class="line"></div><div class="line">poll_list);</div><div class="line"></div><div class="line">if (test_bit(NAPI_STATE_SCHED, &amp;n-&gt;state)) {</div><div class="line"></div><div class="line">work = n-&gt;poll(n, weight);</div><div class="line"></div><div class="line">trace_napi_poll(n);</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">int netif_receive_skb(struct sk_buff *skb)</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">static int __netif_receive_skb(struct sk_buff *skb)</div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line">struct packet_type *ptype, *pt_prev;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">__be16 type;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">list_for_each_entry_rcu(ptype, &amp;ptype_all, list) {</div><div class="line"></div><div class="line">if (!ptype-&gt;dev || ptype-&gt;dev == skb-&gt;dev) {</div><div class="line"></div><div class="line">if (pt_prev)</div><div class="line"></div><div class="line">ret = deliver_skb(skb, pt_prev, orig_dev);</div><div class="line"></div><div class="line">pt_prev = ptype;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">type = skb-&gt;protocol;</div><div class="line"></div><div class="line">list_for_each_entry_rcu(ptype,</div><div class="line"></div><div class="line">&amp;ptype_base[ntohs(type) &amp; PTYPE_HASH_MASK], list) {</div><div class="line"></div><div class="line">if (ptype-&gt;type == type &amp;&amp;</div><div class="line"></div><div class="line">(ptype-&gt;dev == null_or_dev || ptype-&gt;dev == skb-&gt;dev ||</div><div class="line"></div><div class="line">ptype-&gt;dev == orig_dev)) {</div><div class="line"></div><div class="line">if (pt_prev)</div><div class="line"></div><div class="line">ret = deliver_skb(skb, pt_prev, orig_dev);</div><div class="line"></div><div class="line">pt_prev = ptype;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line">if (pt_prev) {</div><div class="line"></div><div class="line">ret = pt_prev-&gt;func(skb, skb-&gt;dev, pt_prev, orig_dev);</div><div class="line"></div><div class="line">static struct packet_type ip_packet_type __read_mostly = {</div><div class="line"></div><div class="line">.type = cpu_to_be16(ETH_P_IP),</div><div class="line"></div><div class="line">.func = ip_rcv,</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>
<p>&#x5C31;&#x50CF;&#x4E4B;&#x524D;&#x8BF4;&#x7684;&#xFF0C;net_rx_action&#x51FD;&#x6570;&#x662F;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x6570;&#x636E;&#x7684;&#x8F6F;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x8BF7;&#x6C42;napi poll&#x7684;&#x9A71;&#x52A8;&#x4F1A;&#x68C0;&#x7D22;poll_list&#xFF0C;&#x5E76;&#x4E14;&#x8C03;&#x7528;&#x9A71;&#x52A8;&#x7684;poll&#x5904;&#x7406;&#x7A0B;&#x5E8F;(poll handler)&#x3002;&#x9A71;&#x52A8;&#x4F1A;&#x628A;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x5305;&#x88C5;&#x6210;sk_buff&#xFF0C;&#x4E4B;&#x540E;&#x8C03;&#x7528;netif_receive_skb&#x3002;</p>
<p>&#x5982;&#x679C;&#x6709;&#x6A21;&#x5757;&#x5728;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x90A3;&#x4E48;netif_receive_skb&#x4F1A;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x7ED9;&#x90A3;&#x4E2A;&#x6A21;&#x5757;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;&#x4E4B;&#x524D;&#x8BA8;&#x8BBA;&#x8FC7;&#x7684;&#x53D1;&#x9001;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x9A71;&#x52A8;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x53D1;&#x9001;&#x7ED9;&#x6CE8;&#x518C;&#x5230;ptype_all&#x5217;&#x8868;&#x7684;&#x90A3;&#x4E9B;&#x6A21;&#x5757;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x5728;&#x8FD9;&#x91CC;&#x88AB;&#x6355;&#x83B7;&#x3002;</p>
<p>&#x4E4B;&#x540E;&#xFF0C;&#x6839;&#x636E;&#x6570;&#x636E;&#x5305;&#x7684;&#x7C7B;&#x578B;&#xFF0C;&#x4E0D;&#x540C;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x88AB;&#x4F20;&#x8F93;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x4E0A;&#x5C42;&#x3002;&#x94FE;&#x8DEF;&#x5934;&#x4E2D;&#x5305;&#x542B;&#x4E86;2&#x5B57;&#x8282;&#x7684;&#x4EE5;&#x592A;&#x7F51;&#x7C7B;&#x578B;(ethertype)&#x5B57;&#x6BB5;&#xFF0C;&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x7684;&#x503C;&#x6807;&#x8BC6;&#x4E86;&#x6570;&#x636E;&#x5305;&#x7684;&#x7C7B;&#x578B;&#x3002;&#x9A71;&#x52A8;&#x4F1A;&#x628A;&#x8FD9;&#x4E2A;&#x503C;&#x8BB0;&#x5F55;&#x5230;sk_buff&#x4E2D;&#xFF08;skb-&gt;protocol)&#x3002;&#x6BCF;&#x4E00;&#x79CD;&#x534F;&#x8BAE;&#x6709;&#x81EA;&#x5DF1;&#x7684;packet_type&#x7ED3;&#x6784;&#x4F53;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x628A;&#x6307;&#x5411;&#x7ED3;&#x6784;&#x4F53;&#x7684;&#x6307;&#x9488;&#x653E;&#x5165;ptype_base&#x54C8;&#x5E0C;&#x8868;&#x4E2D;&#x3002;IPv4&#x4F7F;&#x7528;&#x7684;&#x662F;ip_packate_type&#xFF0C;&#x7C7B;&#x578B;&#x5B57;&#x6BB5;&#x4E2D;&#x7684;&#x503C;&#x662F;IPv4&#x7C7B;&#x578B;(ETH_P_IP&#xFF09;&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;IPv4&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x8C03;&#x7528;ip_recv&#x51FD;&#x6570;&#x3002;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ip_rcv</span><span class="params">(<span class="keyword">struct</span> sk_buff *skb, <span class="keyword">struct</span> net_device *dev, ...)</span></span></div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">struct</span> iphdr *iph;</div><div class="line"></div><div class="line">u32 len;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">iph = ip_hdr(skb);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">if</span> (iph-&gt;ihl &lt; <span class="number">5</span> || iph-&gt;version != <span class="number">4</span>)</div><div class="line"></div><div class="line"><span class="keyword">goto</span> inhdr_error;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!pskb_may_pull(skb, iph-&gt;ihl*<span class="number">4</span>))</div><div class="line"></div><div class="line"><span class="keyword">goto</span> inhdr_error;</div><div class="line"></div><div class="line">iph = ip_hdr(skb);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (unlikely(ip_fast_csum((u8 *)iph, iph-&gt;ihl)))</div><div class="line"></div><div class="line"><span class="keyword">goto</span> inhdr_error;</div><div class="line"></div><div class="line">len = ntohs(iph-&gt;tot_len);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (skb-&gt;len &lt; len) {</div><div class="line"></div><div class="line">IP_INC_STATS_BH(dev_net(dev), IPSTATS_MIB_INTRUNCATEDPKTS);</div><div class="line"></div><div class="line"><span class="keyword">goto</span> drop;</div><div class="line"></div><div class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (len &lt; (iph-&gt;ihl*<span class="number">4</span>))</div><div class="line"></div><div class="line"><span class="keyword">goto</span> inhdr_error;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">return</span> NF_HOOK(NFPROTO_IPV4, NF_INET_PRE_ROUTING, skb, dev, <span class="literal">NULL</span>,</div><div class="line"></div><div class="line">ip_rcv_finish);</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line"><span class="keyword">int</span> ip_local_deliver(<span class="keyword">struct</span> sk_buff *skb)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">if</span> (ip_hdr(skb)-&gt;frag_off &amp; htons(IP_MF | IP_OFFSET)) {</div><div class="line"></div><div class="line"><span class="keyword">if</span> (ip_defrag(skb, IP_DEFRAG_LOCAL_DELIVER))</div><div class="line"></div><div class="line"><span class="keyword">return</span> <span class="number">0</span>;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">return</span> NF_HOOK(NFPROTO_IPV4, NF_INET_LOCAL_IN, skb, skb-&gt;dev, <span class="literal">NULL</span>,</div><div class="line"></div><div class="line">ip_local_deliver_finish);</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> ip_local_deliver_finish(<span class="keyword">struct</span> sk_buff *skb)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="number">__</span>skb_pull(skb, ip_hdrlen(skb));</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line"><span class="keyword">int</span> protocol = ip_hdr(skb)-&gt;protocol;</div><div class="line"></div><div class="line"><span class="keyword">int</span> hash, raw;</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">struct</span> net_protocol *ipprot;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">hash = protocol &amp; (MAX_INET_PROTOS - <span class="number">1</span>);</div><div class="line"></div><div class="line">ipprot = rcu_dereference(inet_protos[hash]);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (ipprot != <span class="literal">NULL</span>) {</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">ret = ipprot-&gt;handler(skb);</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct</span> net_protocol tcp_protocol = {</div><div class="line"></div><div class="line">.handler = tcp_v4_rcv,</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">};</div></pre></td></tr></table></figure>
<p>ip_rcv&#x51FD;&#x6570;&#x6267;&#x884C;IP&#x5C42;&#x5FC5;&#x8981;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x5B83;&#x4F1A;&#x89E3;&#x6790;&#x6570;&#x636E;&#x5305;&#x4E2D;&#x7684;&#x957F;&#x5EA6;&#x548C;IP&#x5934;&#x6821;&#x9A8C;&#x548C;&#x3002;&#x5728;&#x7ECF;&#x8FC7;netfilter&#x4EE3;&#x7801;&#x65F6;&#x4F1A;&#x6267;&#x884C;ip_local_deliver&#x51FD;&#x6570;&#x3002;&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x8FD8;&#x4F1A;&#x88C5;&#x914D;IP&#x5206;&#x7247;&#x3002;&#x4E4B;&#x540E;&#x4F1A;&#x901A;&#x8FC7;netfilter&#x7684;&#x4EE3;&#x7801;&#x8C03;&#x7528;ip_local_deliver_finish&#x51FD;&#x6570;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x901A;&#x8FC7;&#x8C03;&#x7528;__skb_pull&#x79FB;&#x9664;IP&#x5934;&#xFF0C;&#x5E76;&#x4E14;&#x901A;&#x8FC7;IP&#x5934;&#x7684;protocol&#x503C;&#x67E5;&#x627E;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;&#x6807;&#x8BB0;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;ptype_base&#xFF0C;&#x6BCF;&#x4E2A;&#x4F20;&#x8F93;&#x5C42;&#x534F;&#x8BAE;&#x4F1A;&#x5728;inet_protos&#x4E2D;&#x6CE8;&#x518C;&#x81EA;&#x5DF1;&#x7684;net_protocol&#x7ED3;&#x6784;&#x4F53;&#x3002;IPv4 TCP&#x4F7F;&#x7528;tcp_protocol&#xFF0C;&#x4E8E;&#x662F;&#x4F1A;&#x8C03;&#x7528;tcp_v4_rcv&#x51FD;&#x6570;&#x7EE7;&#x7EED;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5F53;&#x6570;&#x636E;&#x5305;&#x5230;&#x8FBE;TCP&#x5C42;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x7684;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x53D6;&#x51B3;&#x4E8E;TCP&#x72B6;&#x6001;&#x548C;&#x5305;&#x7C7B;&#x578B;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x770B;&#x5230;TCP&#x8FDE;&#x63A5;&#x5904;&#x4E8E;ESTABLISHED&#x72B6;&#x6001;&#x65F6;&#x5904;&#x7406;&#x5230;&#x8FBE;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x5728;&#x6CA1;&#x6709;&#x51FA;&#x73B0;&#x51FA;&#x73B0;&#x4E22;&#x5305;&#x6216;&#x8005;&#x4E71;&#x5E8F;&#x7B49;&#x5F02;&#x5E38;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x9891;&#x7E41;&#x7684;&#x6267;&#x884C;&#x8FD9;&#x6761;&#x8DEF;&#x5F84;&#x3002;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcp_v4_rcv</span><span class="params">(<span class="keyword">struct</span> sk_buff *skb)</span></span></div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">struct</span> iphdr *iph;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> tcphdr *th;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> sock *sk;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">th = tcp_hdr(skb);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (th-&gt;doff &lt; <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tcphdr) / <span class="number">4</span>)</div><div class="line"></div><div class="line"><span class="keyword">goto</span> bad_packet;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!pskb_may_pull(skb, th-&gt;doff * <span class="number">4</span>))</div><div class="line"></div><div class="line"><span class="keyword">goto</span> discard_it;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">th = tcp_hdr(skb);</div><div class="line"></div><div class="line">iph = ip_hdr(skb);</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;seq = ntohl(th-&gt;seq);</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;end_seq = (TCP_SKB_CB(skb)-&gt;seq + th-&gt;syn + th-&gt;fin +</div><div class="line"></div><div class="line">skb-&gt;len - th-&gt;doff * <span class="number">4</span>);</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;ack_seq = ntohl(th-&gt;ack_seq);</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;when = <span class="number">0</span>;</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;flags = iph-&gt;tos;</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;sacked = <span class="number">0</span>;</div><div class="line"></div><div class="line">sk = <span class="number">__</span>inet_lookup_skb(&amp;tcp_hashinfo, skb, th-&gt;source, th-&gt;dest);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">ret = tcp_v4_do_rcv(sk, skb);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">tcp_v4_rcv</span><span class="params">(<span class="keyword">struct</span> sk_buff *skb)</span></span></div><div class="line"></div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">struct</span> iphdr *iph;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> tcphdr *th;</div><div class="line"></div><div class="line"><span class="keyword">struct</span> sock *sk;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">th = tcp_hdr(skb);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (th-&gt;doff &lt; <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tcphdr) / <span class="number">4</span>)</div><div class="line"></div><div class="line"><span class="keyword">goto</span> bad_packet;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!pskb_may_pull(skb, th-&gt;doff * <span class="number">4</span>))</div><div class="line"></div><div class="line"><span class="keyword">goto</span> discard_it;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">th = tcp_hdr(skb);</div><div class="line"></div><div class="line">iph = ip_hdr(skb);</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;seq = ntohl(th-&gt;seq);</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;end_seq = (TCP_SKB_CB(skb)-&gt;seq + th-&gt;syn + th-&gt;fin +</div><div class="line"></div><div class="line">skb-&gt;len - th-&gt;doff * <span class="number">4</span>);</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;ack_seq = ntohl(th-&gt;ack_seq);</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;when = <span class="number">0</span>;</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;flags = iph-&gt;tos;</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;sacked = <span class="number">0</span>;</div><div class="line"></div><div class="line">sk = <span class="number">__</span>inet_lookup_skb(&amp;tcp_hashinfo, skb, th-&gt;source, th-&gt;dest);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">ret = tcp_v4_do_rcv(sk, skb);</div></pre></td></tr></table></figure>
<p>&#x9996;&#x5148;&#xFF0C;tcp_v4_rcv&#x51FD;&#x6570;&#x9A8C;&#x8BC1;&#x5305;&#x7684;&#x6709;&#x6548;&#x6027;&#xFF0C;&#x5982;&#x679C;tcp&#x5934;&#x7684;&#x5927;&#x5C0F;&#x6BD4;&#x6570;&#x636E;&#x7684;&#x504F;&#x79FB;&#x5927;&#x65F6;(th-&gt;doff &lt; sizeof(struct tcphdr) /4)&#x5219;&#x8BF4;&#x660E;&#x5305;&#x5934;&#x6709;&#x9519;&#x8BEF;&#x3002;&#xFF08;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x9519;&#x8BEF;&#xFF09;&#x4E4B;&#x540E;&#x4F1A;&#x8C03;&#x7528;__inet_lookup_skb&#x5728;&#x5B58;&#x653E;TCP&#x8FDE;&#x63A5;&#x7684;&#x54C8;&#x5E0C;&#x8868;&#x91CC;&#x67E5;&#x627E;&#x6570;&#x636E;&#x5305;&#x6240;&#x5C5E;&#x7684;&#x8FDE;&#x63A5;&#x3002;&#x4ECE;&#x67E5;&#x627E;&#x5230;&#x7684;sock&#x7ED3;&#x6784;&#x4F53;&#x53EF;&#x4EE5;&#x627E;&#x5230;&#x6240;&#x6709;&#x9700;&#x8981;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF08;&#x6BD4;&#x5982;tcp_sock&#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x53D6;&#x5F97;&#x5BF9;&#x5E94;&#x7684;socket&#x3002;</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">int tcp_v4_do_rcv(struct sock *sk, struct sk_buff *skb)</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">if (sk-&gt;sk_state == TCP_ESTABLISHED) { /* Fast path */</div><div class="line"></div><div class="line">sock_rps_save_rxhash(sk, skb-&gt;rxhash);</div><div class="line"></div><div class="line">if (tcp_rcv_established(sk, skb, tcp_hdr(skb), skb-&gt;len)) {</div><div class="line"></div><div class="line">[...] ===&gt;</div><div class="line"></div><div class="line">int tcp_rcv_established(struct sock *sk, struct sk_buff *skb,</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">/*</div><div class="line">* Header prediction.</div><div class="line">*/</div><div class="line"></div><div class="line">if ((tcp_flag_word(th) &amp; TCP_HP_BITS) == tp-&gt;pred_flags &amp;&amp;</div><div class="line"></div><div class="line">TCP_SKB_CB(skb)-&gt;seq == tp-&gt;rcv_nxt &amp;&amp;</div><div class="line"></div><div class="line">!after(TCP_SKB_CB(skb)-&gt;ack_seq, tp-&gt;snd_nxt))) {</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">if ((int)skb-&gt;truesize &gt; sk-&gt;sk_forward_alloc)</div><div class="line"></div><div class="line">goto step5;</div><div class="line"></div><div class="line">NET_INC_STATS_BH(sock_net(sk), LINUX_MIB_TCPHPHITS);</div><div class="line"></div><div class="line">/* Bulk data transfer: receiver */</div><div class="line"></div><div class="line">__skb_pull(skb, tcp_header_len);</div><div class="line"></div><div class="line">__skb_queue_tail(&amp;sk-&gt;sk_receive_queue, skb);</div><div class="line"></div><div class="line">skb_set_owner_r(skb, sk);</div><div class="line"></div><div class="line">tp-&gt;rcv_nxt = TCP_SKB_CB(skb)-&gt;end_seq;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">if (!copied_early || tp-&gt;rcv_nxt != tp-&gt;rcv_wup)</div><div class="line"></div><div class="line">__tcp_ack_snd_check(sk, 0);</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">step5:</div><div class="line"></div><div class="line">if (th-&gt;ack &amp;&amp; tcp_ack(sk, skb, FLAG_SLOWPATH) &lt; 0)</div><div class="line"></div><div class="line">goto discard;</div><div class="line"></div><div class="line">tcp_rcv_rtt_measure_ts(sk, skb);</div><div class="line"></div><div class="line">/* Process urgent data. */</div><div class="line"></div><div class="line">tcp_urg(sk, skb, th);</div><div class="line"></div><div class="line">/* step 7: process the segment text */</div><div class="line"></div><div class="line">tcp_data_queue(sk, skb);</div><div class="line"></div><div class="line">tcp_data_snd_check(sk);</div><div class="line"></div><div class="line">tcp_ack_snd_check(sk);</div><div class="line"></div><div class="line">return 0;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x5B9E;&#x9645;&#x7684;&#x534F;&#x8BAE;&#x5728;tcp_v4_do_rcv&#x51FD;&#x6570;&#x4E2D;&#x5904;&#x7406;&#x3002;&#x5982;&#x679C;TCP&#x6B63;&#x5904;&#x4E8E;ESTABLISHED&#x72B6;&#x6001;&#x5219;&#x4F1A;&#x8C03;&#x7528;tcp_rcv_established&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x539F;&#x6587;&#x5199;&#x7684;&#x662F;tcp_rcv_esablished&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#x7B14;&#x8BEF;&#xFF09;&#x3002;&#x7531;&#x4E8E;ESTABLISHED&#x662F;&#x6700;&#x5E38;&#x7528;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x88AB;&#x5355;&#x72EC;&#x5904;&#x7406;&#x548C;&#x4F18;&#x5316;&#x4E86;&#x3002; tcp_rcv_established&#x9996;&#x5148;&#x4F1A;&#x6267;&#x884C;&#x5934;&#x90E8;&#x9884;&#x6D4B;&#xFF08;header prediction)&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5934;&#x90E8;&#x9884;&#x6D4B;&#x4F1A;&#x5FEB;&#x901F;&#x68C0;&#x6D4B;&#x548C;&#x5904;&#x7406;&#x5E38;&#x89C1;&#x60C5;&#x51B5;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#x5E38;&#x89C1;&#x7684;&#x60C5;&#x51B5;&#x662F;&#x6CA1;&#x6709;&#x5728;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x5B9E;&#x9645;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x6B63;&#x662F;&#x5E94;&#x8BE5;&#x6536;&#x5230;&#x7684;&#x4E0B;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x4F8B;&#x5982;TCP&#x63A5;&#x6536;&#x5230;&#x4E86;&#x5B83;&#x671F;&#x671B;&#x6536;&#x5230;&#x7684;&#x90A3;&#x4E2A;&#x987A;&#x5E8F;&#x53F7;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#x5728;&#x628A;&#x6570;&#x636E;&#x52A0;&#x5165;&#x5230;socket&#x7F13;&#x51B2;&#x533A;&#x3001;&#x53D1;&#x9001;ack&#x4E4B;&#x540E;&#x5B8C;&#x6210;&#x5904;&#x7406;&#x3002;</p>
<p>&#x5F80;&#x524D;&#x7FFB;&#x7684;&#x8BDD;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x6BD4;&#x8F83;truesize&#x548C;sk_forward_allow&#x7684;&#x8BED;&#x53E5;&#x3002;&#x8FD9;&#x4E2A;&#x7528;&#x6765;&#x68C0;&#x67E5;socket&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x662F;&#x5426;&#x8FD8;&#x6709;&#x7A7A;&#x95F2;&#x7A7A;&#x95F4;&#x6765;&#x5B58;&#x653E;&#x521A;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#xFF0C;&#x5934;&#x90E8;&#x9884;&#x6D4B;&#x4E3A;&#x201C;&#x547D;&#x4E2D;&#x201D;&#xFF08;&#x9884;&#x6D4B;&#x6210;&#x529F;&#xFF09;&#x3002;&#x4E4B;&#x540E;&#x8C03;&#x7528;<strong>skb_pull&#x6765;&#x5220;&#x9664;TCP&#x5934;&#x3002;&#x518D;&#x4E4B;&#x540E;&#x8C03;&#x7528;</strong>skb_queue_tail&#x6765;&#x628A;&#x6570;&#x636E;&#x5305;&#x589E;&#x52A0;&#x5230;socket&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x6700;&#x7EC8;&#x4F1A;&#x89C6;&#x60C5;&#x51B5;&#x8C03;&#x7528;__tcp_ack_snd_check&#x53D1;&#x9001;ACK&#x3002;&#x6B64;&#x65F6;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x8DB3;&#x591F;&#x7684;&#x7A7A;&#x95F4;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x8D70;&#x4E00;&#x6761;&#x6BD4;&#x8F83;&#x6162;&#x7684;&#x8DEF;&#x5F84;&#x3002;tcp_data_queue&#x51FD;&#x6570;&#x4F1A;&#x65B0;&#x5206;&#x914D;socket&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x7A7A;&#x95F4;&#x5E76;&#x628A;&#x6570;&#x636E;&#x589E;&#x52A0;&#x5230;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x3002;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x63A5;&#x53D7;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5927;&#x5C0F;&#x5728;&#x9700;&#x8981;&#x65F6;&#x4F1A;&#x81EA;&#x52A8;&#x589E;&#x52A0;&#x3002;&#x548C;&#x4E0A;&#x4E00;&#x6BB5;&#x8BF4;&#x7684;&#x5FEB;&#x901F;&#x8DEF;&#x5F84;&#x4E0D;&#x540C;&#xFF0C;&#x6B64;&#x65F6;&#x4F1A;&#x5728;&#x53EF;&#x884C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x8C03;&#x7528;tcp_data_snd_check&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x6570;&#x636E;&#x56DE;&#x5305;&#x3002;&#x6700;&#x7EC8;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x7684;&#x8BDD;&#x4F1A;&#x8C03;&#x7528;tcp_ack_snd_check&#x6765;&#x53D1;&#x9001;&#x4E00;&#x4E2A;ACK&#x5305;&#x3002;</p>
<p>&#x8FD9;&#x4E24;&#x6761;&#x8DEF;&#x5F84;&#x4E0B;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x91CF;&#x4E0D;&#x5927;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x91CC;&#x8BA8;&#x8BBA;&#x7684;&#x90FD;&#x662F;&#x901A;&#x5E38;&#x60C5;&#x51B5;&#x3002;&#x6216;&#x8005;&#x8BF4;&#xFF0C;&#x5176;&#x5B83;&#x7279;&#x6B8A;&#x60C5;&#x51B5;&#x7684;&#x5904;&#x7406;&#x4F1A;&#x6162;&#x7684;&#x591A;&#xFF0C;&#x6BD4;&#x5982;&#x63A5;&#x6536;&#x4E71;&#x5E8F;&#x8FD9;&#x7C7B;&#x60C5;&#x51B5;&#x3002;</p>
<h2 id="&#x516D;-&#x9A71;&#x52A8;&#x548C;&#x7F51;&#x5361;&#x5982;&#x4F55;&#x901A;&#x8BAF;"><a href="#&#x516D;-&#x9A71;&#x52A8;&#x548C;&#x7F51;&#x5361;&#x5982;&#x4F55;&#x901A;&#x8BAF;" class="headerlink" title="&#x516D; &#x9A71;&#x52A8;&#x548C;&#x7F51;&#x5361;&#x5982;&#x4F55;&#x901A;&#x8BAF;"></a>&#x516D; &#x9A71;&#x52A8;&#x548C;&#x7F51;&#x5361;&#x5982;&#x4F55;&#x901A;&#x8BAF;</h2><p>&#x9A71;&#x52A8;&#xFF08;driver&#xFF09;&#x548C;&#x7F51;&#x5361;&#xFF08;nic&#xFF09;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x8BAF;&#x5904;&#x4E8E;&#x534F;&#x8BAE;&#x6808;&#x7684;&#x5E95;&#x5C42;&#xFF0C;&#x5927;&#x591A;&#x6570;&#x4EBA;&#x5E76;&#x4E0D;&#x5173;&#x5FC3;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x6027;&#x80FD;&#x95EE;&#x9898;&#xFF0C;&#x7F51;&#x5361;&#x4F1A;&#x5904;&#x7406;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x4EFB;&#x52A1;&#x3002;&#x7406;&#x89E3;&#x57FA;&#x7840;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x4F1A;&#x5E2E;&#x52A9;&#x4F60;&#x7406;&#x89E3;&#x989D;&#x5916;&#x8FD9;&#x4E9B;&#x4F18;&#x5316;&#x6280;&#x672F;&#x3002;</p>
<p>&#x7F51;&#x5361;&#x548C;&#x9A71;&#x52A8;&#x4E4B;&#x95F4;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x901A;&#x8BAF;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x9A71;&#x52A8;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x65F6;CPU&#x4E0D;&#x4F1A;&#x7B49;&#x5F85;&#x7ED3;&#x679C;&#x800C;&#x662F;&#x4F1A;&#x7EE7;&#x7EED;&#x5904;&#x7406;&#x5176;&#x5B83;&#x4EFB;&#x52A1;&#xFF0C;&#x4E4B;&#x540E;&#x7F51;&#x5361;&#x53D1;&#x9001;&#x6570;&#x636E;&#x5305;&#x5E76;&#x901A;&#x77E5;CPU&#xFF0C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x8FD4;&#x56DE;&#x901A;&#x8FC7;&#x4E8B;&#x4EF6;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF08;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x5305;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x662F;&#x5F02;&#x6B65;&#x53D1;&#x9001;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF09;&#x3002;</p>
<p>&#x548C;&#x6570;&#x636E;&#x5305;&#x4F20;&#x8F93;&#x7C7B;&#x4F3C;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x7684;&#x63A5;&#x6536;&#x4E5F;&#x662F;&#x5F02;&#x6B65;&#x7684;&#x3002;&#x9996;&#x5148;&#x9A71;&#x52A8;&#x8BF7;&#x6C42;&#x63A5;&#x53D7;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7136;&#x540E;CPU&#x53BB;&#x6267;&#x884C;&#x5176;&#x5B83;&#x4EFB;&#x52A1;&#xFF0C;&#x4E4B;&#x540E;&#x7F51;&#x5361;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x5E76;&#x901A;&#x77E5;CPU&#xFF0C;&#x7136;&#x540E;&#x9A71;&#x52A8;&#x5904;&#x7406;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF08;&#x8FD4;&#x56DE;&#x6570;&#x636E;&#xFF09;&#x3002;</p>
<p>&#x56E0;&#x6B64;&#x9700;&#x8981;&#x6709;&#x4E00;&#x4E2A;&#x7A7A;&#x95F4;&#x6765;&#x4FDD;&#x5B58;&#x8BF7;&#x6C42;&#x548C;&#x54CD;&#x5E94;&#xFF08;request and response&#xFF09;&#x3002;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x7F51;&#x5361;&#x4F1A;&#x4F7F;&#x7528;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF08;ring structure&#xFF09;&#x3002;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x7C7B;&#x4F3C;&#x4E8E;&#x666E;&#x901A;&#x7684;&#x961F;&#x5217;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x56FA;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x5143;&#x7D20;&#xFF0C;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x4F1A;&#x4FDD;&#x5B58;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x6216;&#x4E00;&#x4E2A;&#x76F8;&#x5E94;&#x6570;&#x636E;&#x3002;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x4E2D;&#x5143;&#x7D20;&#x662F;&#x987A;&#x5E8F;&#x7684;&#xFF0C;&#x201C;&#x73AF;&#x5F62;&#x201D;&#x7684;&#x610F;&#x601D;&#x662F;&#x961F;&#x5217;&#x867D;&#x7136;&#x662F;&#x5B9A;&#x957F;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x5176;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x4F1A;&#x6309;&#x987A;&#x5E8F;&#x91CD;&#x7528;&#x3002;</p>
<p><strong>&#x56FE;8</strong> &#x5C55;&#x793A;&#x4E86;&#x6570;&#x636E;&#x5305;&#x4F20;&#x8F93;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x5982;&#x4F55;&#x4F7F;&#x7528;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-2/driver_nic_communication_how_to_transmit_packet.png" alt="img"></p>
<center>&#x56FE;8&#xFF1A;&#x9A71;&#x52A8;&#x548C;&#x7F51;&#x5361;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x8BAF;&#xFF1A;&#x5982;&#x4F55;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x5305;</center>

<p>&#x9A71;&#x52A8;&#x63A5;&#x6536;&#x5230;&#x4E0A;&#x5C42;&#x53D1;&#x6765;&#x7684;&#x6570;&#x636E;&#x5305;&#x5E76;&#x521B;&#x5EFA;&#x7F51;&#x5361;&#x80FD;&#x591F;&#x8BC6;&#x522B;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#x3002;&#x53D1;&#x9001;&#x63CF;&#x8FF0;&#x7B26;&#xFF08;send descriptor&#xFF09;&#x9ED8;&#x8BA4;&#x4F1A;&#x5305;&#x542B;&#x6570;&#x636E;&#x5305;&#x7684;&#x5927;&#x5C0F;&#x548C;&#x5185;&#x5B58;&#x5730;&#x5740;&#x3002;&#x8FD9;&#x91CC;&#x7F51;&#x5361;&#x9700;&#x8981;&#x7684;&#x662F;&#x5185;&#x5B58;&#x4E2D;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#xFF0C;&#x9A71;&#x52A8;&#x9700;&#x8981;&#x628A;&#x6570;&#x636E;&#x5305;&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;&#x8F6C;&#x6362;&#x6210;&#x7269;&#x7406;&#x5730;&#x5740;&#x3002;&#x4E4B;&#x540E;&#xFF0C;&#x9A71;&#x52A8;&#x4F1A;&#x628A;&#x53D1;&#x9001;&#x63CF;&#x8FF0;&#x7B26;&#x6DFB;&#x52A0;&#x5230;&#x53D1;&#x9001;&#x73AF;&#x5F62;&#x961F;&#x5217;&#xFF08;TX ring&#xFF09;&#xFF08;1&#xFF09;&#xFF0C;&#x53D1;&#x9001;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x5B9E;&#x9645;&#x662F;&#x53D1;&#x9001;&#x63CF;&#x8FF0;&#x7B26;&#x3002;</p>
<p>&#x4E4B;&#x540E;&#xFF0C;&#x9A71;&#x52A8;&#x4F1A;&#x628A;&#x8BF7;&#x6C42;&#x901A;&#x77E5;&#x7ED9;&#x7F51;&#x5361;&#xFF08;2&#xFF09;&#x3002;&#x9A71;&#x52A8;&#x76F4;&#x63A5;&#x628A;&#x6570;&#x636E;&#x5199;&#x5165;&#x6307;&#x5B9A;&#x7684;&#x7F51;&#x5361;&#x5185;&#x5B58;&#x5730;&#x5740;&#x4E2D;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x8FD9;&#x91CC;&#x5E94;&#x8BE5;&#x662F;&#x7F51;&#x5361;&#x7684;&#x5BC4;&#x5B58;&#x5668;&#x5730;&#x5740;&#xFF0C;&#x5199;&#x5165;&#x7684;&#x662F;&#x901A;&#x77E5;&#x800C;&#x4E0D;&#x662F;&#x6570;&#x636E;&#x5305;&#xFF09;&#x3002;&#x8FD9;&#x79CD;CPU&#x76F4;&#x63A5;&#x5411;&#x8BBE;&#x5907;&#x53D1;&#x9001;&#x6570;&#x636E;&#x7684;&#x4F20;&#x8F93;&#x65B9;&#x5F0F;&#x53EB;&#x505A;&#x7A0B;&#x5E8F;&#x5316;I/O&#xFF08;Programmed I/O&#xFF0C;PIO&#xFF09;&#x3002;</p>
<p>&#x7F51;&#x5361;&#x88AB;&#x901A;&#x77E5;&#x540E;&#x4ECE;&#x4E3B;&#x673A;&#x7684;&#x53D1;&#x9001;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x5F97;&#x53D1;&#x9001;&#x63CF;&#x8FF0;&#x7B26;&#xFF08;3&#xFF09;&#x3002;&#x8FD9;&#x79CD;&#x8BBE;&#x5907;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x5185;&#x5B58;&#x800C;&#x4E0D;&#x9700;&#x8981;&#x8C03;&#x7528;CPU&#x7684;&#x5185;&#x5B58;&#x8BBF;&#x95EE;&#x65B9;&#x5F0F;&#x53EB;&#x505A;&#x76F4;&#x63A5;&#x5185;&#x5B58;&#x8BBF;&#x95EE;&#xFF08;Direct Memory Access&#xFF0C;DMA&#xFF09;&#x3002;</p>
<p>&#x5728;&#x53D6;&#x5F97;&#x53D1;&#x9001;&#x63CF;&#x8FF0;&#x7B26;&#x540E;&#xFF0C;&#x7F51;&#x5361;&#x4F1A;&#x5F97;&#x5230;&#x6570;&#x636E;&#x5305;&#x7684;&#x5730;&#x5740;&#x548C;&#x5927;&#x5C0F;&#x5E76;&#x4E14;&#x4ECE;&#x4E3B;&#x673A;&#x5185;&#x5B58;&#x4E2D;&#x53D6;&#x5F97;&#x5B9E;&#x9645;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF08;4&#xFF09;&#x3002;&#x5982;&#x679C;&#x6709;&#x6821;&#x9A8C;&#x548C;&#x5378;&#x8F7D;&#xFF08;checksum offload&#xFF09;&#x7684;&#x8BDD;&#xFF0C;&#x7F51;&#x5361;&#x4F1A;&#x5728;&#x62FF;&#x5230;&#x6570;&#x636E;&#x540E;&#x8BA1;&#x7B97;&#x6570;&#x636E;&#x5305;&#x7684;&#x6821;&#x9A8C;&#x548C;&#xFF0C;&#x56E0;&#x6B64;&#x5F00;&#x9500;&#x4E0D;&#x5927;&#x3002;</p>
<p>&#x7F51;&#x5361;&#x53D1;&#x9001;&#x6570;&#x636E;&#x5305;&#xFF08;5&#xFF09;&#x4E4B;&#x540E;&#x628A;&#x53D1;&#x9001;&#x6570;&#x636E;&#x5305;&#x7684;&#x6570;&#x91CF;&#x5199;&#x5165;&#x4E3B;&#x673A;&#x5185;&#x5B58;&#xFF08;6&#xFF09;&#x3002;&#x4E4B;&#x540E;&#x5B83;&#x4F1A;&#x89E6;&#x53D1;&#x4E00;&#x6B21;&#x4E2D;&#x65AD;&#xFF0C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4F1A;&#x8BFB;&#x53D6;&#x53D1;&#x9001;&#x6570;&#x636E;&#x5305;&#x7684;&#x6570;&#x91CF;&#x5E76;&#x6839;&#x636E;&#x6570;&#x91CF;&#x8FD4;&#x56DE;&#x5DF2;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;</p>
<p>&#x5728; <strong>&#x56FE;9</strong> &#x4E2D;&#xFF0C;&#x4F60;&#x4F1A;&#x770B;&#x5230;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x6D41;&#x7A0B;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-2/driver_nic_cmomunication_how_to_receive_packets.png" alt="img"></p>
<center>&#x56FE;9&#xFF1A;&#x9A71;&#x52A8;&#x548C;&#x7F51;&#x5361;&#x4E4B;&#x95F4;&#x7684;&#x901A;&#x8BAF;&#xFF1A;&#x5982;&#x4F55;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;</center>

<p>&#x9996;&#x5148;&#xFF0C;&#x9A71;&#x52A8;&#x4F1A;&#x5728;&#x4E3B;&#x673A;&#x5185;&#x5B58;&#x4E2D;&#x5206;&#x914D;&#x4E00;&#x5757;&#x7F13;&#x51B2;&#x533A;&#x7528;&#x6765;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x4E4B;&#x540E;&#x521B;&#x5EFA;&#x63A5;&#x6536;&#x63CF;&#x8FF0;&#x7B26;&#xFF08;receive descriptor&#xFF09;&#x3002;&#x63A5;&#x6536;&#x63CF;&#x8FF0;&#x7B26;&#x9ED8;&#x8BA4;&#x4F1A;&#x5305;&#x542B;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5927;&#x5C0F;&#x548C;&#x5730;&#x5740;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;&#x53D1;&#x9001;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x63A5;&#x6536;&#x63CF;&#x8FF0;&#x7B26;&#x4E2D;&#x4FDD;&#x5B58;&#x7684;&#x4E5F;&#x662F;DMA&#x4F7F;&#x7528;&#x7684;&#x7269;&#x7406;&#x5730;&#x5740;&#x3002;&#x4E4B;&#x540E;&#xFF0C;&#x9A71;&#x52A8;&#x4F1A;&#x628A;&#x63A5;&#x6536;&#x63CF;&#x8FF0;&#x7B26;&#x52A0;&#x5165;&#x5230;&#x63A5;&#x6536;&#x73AF;&#x5F62;&#x961F;&#x5217;&#xFF08;RX ring&#xFF09;&#xFF08;1&#xFF09;&#xFF0C;&#x63A5;&#x6536;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x4FDD;&#x5B58;&#x7684;&#x90FD;&#x662F;&#x63A5;&#x6536;&#x6570;&#x636E;&#x7684;&#x8BF7;&#x6C42;&#x3002;</p>
<p>&#x901A;&#x8FC7;PIO&#xFF0C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x901A;&#x77E5;&#x7F51;&#x5361;&#x6709;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#xFF08;2&#xFF09;&#xFF0C;&#x7F51;&#x5361;&#x4F1A;&#x628A;&#x65B0;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#x4ECE;&#x63A5;&#x6536;&#x961F;&#x5217;&#x4E2D;&#x53D6;&#x51FA;&#x6765;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5927;&#x5C0F;&#x548C;&#x5730;&#x5740;&#x4FDD;&#x5B58;&#x5230;&#x7F51;&#x5361;&#x5185;&#x5B58;&#x4E2D;&#xFF08;3&#xFF09;&#x3002;</p>
<p>&#x5728;&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x5305;&#x65F6;&#xFF0C;&#x7F51;&#x5361;&#x4F1A;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x5230;&#x4E3B;&#x673A;&#x5185;&#x5B58;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#xFF08;5&#xFF09;&#x3002;&#x5982;&#x679C;&#x5B58;&#x5728;&#x6821;&#x9A8C;&#x548C;&#x5378;&#x8F7D;&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;&#x7F51;&#x5361;&#x4F1A;&#x5728;&#x6B64;&#x65F6;&#x8BA1;&#x7B97;&#x6821;&#x9A8C;&#x548C;&#x3002;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x5B9E;&#x9645;&#x5927;&#x5C0F;&#x3001;&#x6821;&#x9A8C;&#x548C;&#x7ED3;&#x679C;&#x548C;&#x5176;&#x4ED6;&#x4FE1;&#x606F;&#x4F1A;&#x4FDD;&#x5B58;&#x5728;&#x72EC;&#x7ACB;&#x7684;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x4E2D;&#xFF08;&#x63A5;&#x6536;&#x8FD4;&#x56DE;&#x73AF;&#x5F62;&#x961F;&#x5217;&#xFF0C;receive return ring&#xFF09;&#xFF08;6&#xFF09;&#x3002;&#x63A5;&#x6536;&#x8FD4;&#x56DE;&#x961F;&#x5217;&#x4FDD;&#x5B58;&#x4E86;&#x63A5;&#x6536;&#x8BF7;&#x6C42;&#x7684;&#x5904;&#x7406;&#x7ED3;&#x679C;&#xFF0C;&#x6216;&#x8005;&#x53EB;&#x54CD;&#x5E94;&#xFF08;response&#xFF09;&#x3002;&#x4E4B;&#x540E;&#x7F51;&#x5361;&#x4F1A;&#x53D1;&#x51FA;&#x4E00;&#x4E2A;&#x4E2D;&#x65AD;&#xFF08;7&#xFF09;&#x3002;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4ECE;&#x63A5;&#x6536;&#x8FD4;&#x56DE;&#x961F;&#x5217;&#x4E2D;&#x83B7;&#x53D6;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x5982;&#x679C;&#x5FC5;&#x8981;&#x7684;&#x8BDD;&#xFF0C;&#x8FD8;&#x4F1A;&#x5206;&#x914D;&#x65B0;&#x5185;&#x5B58;&#x7F13;&#x51B2;&#x533A;&#x5E76;&#x91CD;&#x590D;&#xFF08;1&#xFF09;&#x548C;&#xFF08;2&#xFF09;&#x3002;</p>
<p>&#x8C03;&#x4F18;&#x7F51;&#x7EDC;&#x6808;&#x65F6;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x4F1A;&#x8BF4;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x548C;&#x4E2D;&#x65AD;&#x7684;&#x8BBE;&#x7F6E;&#x9700;&#x8981;&#x88AB;&#x8C03;&#x6574;&#x3002;&#x5F53;&#x53D1;&#x9001;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x5F88;&#x5927;&#x65F6;&#xFF0C;&#x5F88;&#x591A;&#x6B21;&#x7684;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x53EF;&#x4EE5;&#x4E00;&#x6B21;&#x5B8C;&#x6210;&#xFF1B;&#x5F53;&#x63A5;&#x6536;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x5F88;&#x5927;&#xFF0C;&#x53EF;&#x4EE5;&#x4E00;&#x6B21;&#x6027;&#x63A5;&#x6536;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x3002;&#x66F4;&#x5927;&#x7684;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x5BF9;&#x4E8E;&#x5927;&#x6D41;&#x91CF;&#x6570;&#x636E;&#x5305;&#x63A5;&#x6536;/&#x53D1;&#x9001;&#x662F;&#x5F88;&#x6709;&#x7528;&#x7684;&#x3002;&#x7531;&#x4E8E;CPU&#x5728;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x65F6;&#x6709;&#x5927;&#x91CF;&#x5F00;&#x9500;&#xFF0C;&#x5927;&#x91CF;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x7F51;&#x5361;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x8BA1;&#x65F6;&#x5668;&#x6765;&#x51CF;&#x5C11;&#x4E2D;&#x65AD;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x5BF9;&#x5BBF;&#x4E3B;&#x673A;&#x8FC7;&#x591A;&#x7684;&#x4E2D;&#x65AD;&#xFF0C;&#x53D1;&#x9001;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x65F6;&#x5019;&#x4E2D;&#x65AD;&#x4F1A;&#x88AB;&#x6536;&#x96C6;&#x8D77;&#x6765;&#x5E76;&#x4E14;&#x5B9A;&#x671F;&#x8C03;&#x7528;&#xFF08;interrupt coalescing&#xFF0C;&#x4E2D;&#x65AD;&#x805A;&#x5408;&#xFF09;&#x3002;</p>
<h2 id="&#x4E03;-&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x548C;&#x6D41;&#x91CF;&#x63A7;&#x5236;"><a href="#&#x4E03;-&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x548C;&#x6D41;&#x91CF;&#x63A7;&#x5236;" class="headerlink" title="&#x4E03; &#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x548C;&#x6D41;&#x91CF;&#x63A7;&#x5236;"></a>&#x4E03; &#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x548C;&#x6D41;&#x91CF;&#x63A7;&#x5236;</h2><p>&#x5728;&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x5728;&#x51E0;&#x4E2A;&#x9636;&#x6BB5;&#x88AB;&#x6267;&#x884C;&#x3002;<strong>&#x56FE;10</strong> &#x5C55;&#x793A;&#x4E86;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x65F6;&#x7684;&#x4E00;&#x4E9B;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x5E94;&#x7528;&#x4F1A;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5E76;&#x628A;&#x6570;&#x636E;&#x52A0;&#x5165;&#x5230;socket&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x5982;&#x679C;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x6CA1;&#x6709;&#x5269;&#x4F59;&#x7A7A;&#x95F4;&#x7684;&#x8BDD;&#xFF0C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4F1A;&#x5931;&#x8D25;&#x6216;&#x963B;&#x585E;&#x5E94;&#x7528;&#x8FDB;&#x7A0B;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5230;&#x5185;&#x6838;&#x7684;&#x53D1;&#x9001;&#x901F;&#x7387;&#x7531;socket&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#x6765;&#x9650;&#x5236;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-2/buffers_related_to_packet_transmission.png" alt="img"></p>
<center>&#x56FE;10&#xFF1A;&#x6570;&#x636E;&#x53D1;&#x9001;&#x76F8;&#x5173;&#x7684;&#x7F13;&#x51B2;</center>

<p>TCP&#x901A;&#x8FC7;&#x4F20;&#x8F93;&#x961F;&#x5217;&#xFF08;qdisc&#xFF09;&#x521B;&#x5EFA;&#x5E76;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x7ED9;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x5178;&#x578B;&#x7684;&#x5148;&#x5165;&#x5148;&#x51FA;&#x961F;&#x5217;&#xFF0C;&#x961F;&#x5217;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x662F;txqueuelen&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;ifconfig&#x547D;&#x4EE4;&#x6765;&#x67E5;&#x770B;&#x5B9E;&#x9645;&#x5927;&#x5C0F;&#x3002;&#x901A;&#x5E38;&#x6765;&#x8BF4;&#xFF0C;&#x5927;&#x7EA6;&#x6709;&#x51E0;&#x5343;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x3002;</p>
<p>&#x9A71;&#x52A8;&#x548C;&#x7F51;&#x5361;&#x4E4B;&#x95F4;&#x662F;&#x4F20;&#x8F93;&#x73AF;&#x5F62;&#x961F;&#x5217;&#xFF08;TX ring&#xFF09;&#xFF0C;&#x5B83;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x4F20;&#x8F93;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#xFF08;transmission request queue&#xFF09;&#x3002;&#x5982;&#x679C;&#x961F;&#x5217;&#x4E2D;&#x6CA1;&#x6709;&#x5269;&#x4F59;&#x7A7A;&#x95F4;&#x7684;&#x8BDD;&#x5C31;&#x4E0D;&#x4F1A;&#x518D;&#x7EE7;&#x7EED;&#x521B;&#x5EFA;&#x4F20;&#x8F93;&#x8BF7;&#x6C42;&#xFF0C;&#x5E76;&#x4E14;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x79EF;&#x7D2F;&#x5728;&#x4F20;&#x8F93;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x5305;&#x79EF;&#x7D2F;&#x7684;&#x592A;&#x591A;&#xFF0C;&#x90A3;&#x4E48;&#x65B0;&#x7684;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x88AB;&#x4E22;&#x5F03;&#x3002;</p>
<p>&#x7F51;&#x5361;&#x4F1A;&#x628A;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x5305;&#x4FDD;&#x5B58;&#x5728;&#x5185;&#x90E8;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x3002;&#x8FD9;&#x4E2A;&#x961F;&#x5217;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x5305;&#x901F;&#x5EA6;&#x53D7;&#x7F51;&#x5361;&#x7269;&#x7406;&#x901F;&#x5EA6;&#x7684;&#x5F71;&#x54CD;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;1Gb/s&#x7684;&#x7F51;&#x5361;&#x4E0D;&#x80FD;&#x627F;&#x62C5;10Gb/s&#x7684;&#x6027;&#x80FD;&#xFF09;&#x3002;&#x6839;&#x636E;&#x4EE5;&#x592A;&#x7F51;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#xFF0C;&#x5F53;&#x7F51;&#x5361;&#x7684;&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x6CA1;&#x6709;&#x7A7A;&#x95F4;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x4F20;&#x8F93;&#x4F1A;&#x88AB;&#x505C;&#x6B62;&#x3002;</p>
<p>&#x5F53;&#x5185;&#x6838;&#x901F;&#x5EA6;&#x5927;&#x4E8E;&#x7F51;&#x5361;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x5806;&#x79EF;&#x5728;&#x7F51;&#x5361;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x6CA1;&#x6709;&#x7A7A;&#x95F4;&#x65F6;&#x4F1A;&#x505C;&#x6B62;&#x5904;&#x7406;&#x4F20;&#x8F93;&#x73AF;&#x5F62;&#x961F;&#x5217;&#xFF08;TX ring&#xFF09;&#x3002;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x7684;&#x8BF7;&#x6C42;&#x5806;&#x79EF;&#x5728;&#x4F20;&#x8F93;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x4E2D;&#xFF0C;&#x6700;&#x7EC8;&#x961F;&#x5217;&#x4E2D;&#x7A7A;&#x95F4;&#x88AB;&#x8017;&#x5C3D;&#x3002;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E0D;&#x80FD;&#x518D;&#x7EE7;&#x7EED;&#x521B;&#x5EFA;&#x4F20;&#x8F93;&#x8BF7;&#x6C42;&#x6570;&#x636E;&#x5305;&#x4F1A;&#x5806;&#x79EF;&#x5728;&#x4F20;&#x8F93;&#x961F;&#x5217;&#xFF08;transmit queue&#xFF09;&#x4E2D;&#x3002;&#x538B;&#x529B;&#x901A;&#x8FC7;&#x5404;&#x79CD;&#x7F13;&#x51B2;&#x4ECE;&#x5E95;&#x5411;&#x4E0A;&#x9010;&#x7EA7;&#x53CD;&#x9988;&#x3002;</p>
<p><strong>&#x56FE;11</strong> &#x5C55;&#x793A;&#x4E86;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7ECF;&#x8FC7;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x6570;&#x636E;&#x5305;&#x5148;&#x88AB;&#x4FDD;&#x5B58;&#x5728;&#x7F51;&#x5361;&#x7684;&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x3002;&#x4ECE;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x7684;&#x89C6;&#x89D2;&#x6765;&#x770B;&#xFF0C;&#x9A71;&#x52A8;&#x548C;&#x7F51;&#x5361;&#x4E4B;&#x95F4;&#x7684;&#x63A5;&#x6536;&#x73AF;&#x5F62;&#x7F13;&#x51B2;&#x533A;(RX ring)&#x53EF;&#x4EE5;&#x88AB;&#x770B;&#x4F5C;&#x662F;&#x6570;&#x636E;&#x5305;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4ECE;&#x73AF;&#x5F62;&#x7F13;&#x51B2;&#x533A;&#x53D6;&#x5F97;&#x6570;&#x636E;&#x5305;&#x5E76;&#x628A;&#x5B83;&#x4EEC;&#x53D1;&#x9001;&#x5230;&#x4E0A;&#x5C42;&#x3002;&#x670D;&#x52A1;&#x5668;&#x7CFB;&#x7EDF;&#x7684;&#x7F51;&#x5361;&#x9A71;&#x52A8;&#x9ED8;&#x8BA4;&#x4F1A;&#x4F7F;&#x7528;NAPI&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x9A71;&#x52A8;&#x548C;&#x4E0A;&#x5C42;&#x4E4B;&#x95F4;&#x6CA1;&#x6709;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA4;&#x4E3A;&#x4E0A;&#x5C42;&#x76F4;&#x63A5;&#x4ECE;&#x63A5;&#x6536;&#x73AF;&#x5F62;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x53D6;&#x5F97;&#x6570;&#x636E;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x7684;&#x6570;&#x636E;&#x90E8;&#x5206;&#x88AB;&#x4FDD;&#x5B58;&#x5728;socket&#x7684;&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x3002;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4ECE;socket&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x53D6;&#x5F97;&#x6570;&#x636E;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-2/buffers_related_to_packaet_receiving.png" alt="img"></p>
<center>&#x56FE;11&#xFF1A;&#x4E0E;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x76F8;&#x5173;&#x7684;&#x7F13;&#x51B2;</center>

<p>&#x4E0D;&#x652F;&#x6301;NAPI&#x7684;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4F1A;&#x628A;&#x6570;&#x636E;&#x5305;&#x4FDD;&#x5B58;&#x5728;&#x79EF;&#x538B;&#x961F;&#x5217;&#xFF08;backlog queue&#xFF09;&#x4E2D;&#x3002;&#x4E4B;&#x540E;&#xFF0C;NAPI&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x53D6;&#x5F97;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x56E0;&#x6B64;&#x79EF;&#x538B;&#x961F;&#x5217;&#x53EF;&#x4EE5;&#x88AB;&#x8BA4;&#x4E3A;&#x662F;&#x5728;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x548C;&#x4E0A;&#x5C42;&#x4E4B;&#x95F4;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5185;&#x6838;&#x5904;&#x7406;&#x6570;&#x636E;&#x5305;&#x7684;&#x901F;&#x5EA6;&#x4F4E;&#x4E8E;&#x7F51;&#x5361;&#x7684;&#x901F;&#x5EA6;&#xFF0C;&#x63A5;&#x6536;&#x5FAA;&#x73AF;&#x7F13;&#x51B2;&#x533A;&#x961F;&#x5217;(RX ring)&#x4F1A;&#x88AB;&#x5199;&#x6EE1;&#xFF0C;&#x7F51;&#x5361;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x7A7A;&#x95F4;(NIC internal buffer)&#x4E5F;&#x4F1A;&#x88AB;&#x5199;&#x6EE1;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;&#x4E86;&#x4EE5;&#x592A;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#xFF08;Ethernet flow control&#xFF09;&#x65F6;&#xFF0C;&#x63A5;&#x6536;&#x65B9;&#x7F51;&#x5361;&#x4F1A;&#x5411;&#x53D1;&#x9001;&#x65B9;&#x7F51;&#x5361;&#x53D1;&#x9001;&#x8BF7;&#x6C42;&#x6765;&#x505C;&#x6B62;&#x4F20;&#x8F93;&#x6216;&#x4E22;&#x5F03;&#x6570;&#x636E;&#x5305;&#x3002;</p>
<p>&#x56E0;&#x4E3A;TCP&#x652F;&#x6301;&#x7AEF;&#x5BF9;&#x7AEF;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x51FA;&#x73B0;&#x7531;&#x4E8E;socket&#x63A5;&#x6536;&#x961F;&#x5217;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x800C;&#x4E22;&#x5305;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x5F53;&#x4F7F;&#x7528;UDP&#x534F;&#x8BAE;&#x65F6;&#xFF0C;&#x56E0;&#x4E3A;UDP&#x534F;&#x8BAE;&#x4E0D;&#x652F;&#x6301;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#xFF0C;&#x5982;&#x679C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5904;&#x7406;&#x901F;&#x5EA6;&#x4E0D;&#x591F;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x51FA;&#x73B0;socket&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x800C;&#x4E22;&#x5305;&#x7684;&#x60C5;&#x51B5;&#x3002;</p>
<p>&#x5728; <strong>&#x56FE;10</strong> &#x548C; <strong>&#x56FE;11</strong> &#x4E2D;&#x5C55;&#x793A;&#x7684;&#x4F20;&#x8F93;&#x73AF;&#x5F62;&#x961F;&#x5217;&#xFF08;TX ring&#xFF09;&#x548C;&#x63A5;&#x6536;&#x73AF;&#x5F62;&#x961F;&#x5217;&#xFF08;RX ring&#xFF09;&#x7684;&#x5927;&#x5C0F;&#x53EF;&#x4EE5;&#x7528;ethtool&#x67E5;&#x770B;&#x3002;&#x5728;&#x5927;&#x591A;&#x6570;&#x770B;&#x91CD;&#x541E;&#x5410;&#x91CF;&#x7684;&#x8D1F;&#x8F7D;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x589E;&#x52A0;&#x73AF;&#x5F62;&#x961F;&#x5217;&#x7684;&#x5927;&#x5C0F;&#x548C;socket&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#x4F1A;&#x6709;&#x4E00;&#x4E9B;&#x5E2E;&#x52A9;&#x3002;&#x589E;&#x52A0;&#x5927;&#x5C0F;&#x4F1A;&#x51CF;&#x5C11;&#x9AD8;&#x901F;&#x6536;&#x53D1;&#x6570;&#x636E;&#x5305;&#x65F6;&#x7531;&#x4E8E;&#x7F13;&#x51B2;&#x533A;&#x7A7A;&#x95F4;&#x4E0D;&#x8DB3;&#x800C;&#x9020;&#x6210;&#x7684;&#x5F02;&#x5E38;&#x3002;</p>
<h2 id="&#x516B;-&#x7ED3;&#x8BBA;"><a href="#&#x516B;-&#x7ED3;&#x8BBA;" class="headerlink" title="&#x516B; &#x7ED3;&#x8BBA;"></a>&#x516B; &#x7ED3;&#x8BBA;</h2><p>&#x6700;&#x521D;&#xFF0C;&#x6211;&#x8BA1;&#x5212;&#x53EA;&#x89E3;&#x91CA;&#x90A3;&#x4E9B;&#x4F1A;&#x5BF9;&#x4F60;&#x7F16;&#x5199;&#x7F51;&#x7EDC;&#x7A0B;&#x5E8F;&#x6709;&#x5E2E;&#x52A9;&#x7684;&#x4E1C;&#x897F;&#xFF0C;&#x6267;&#x884C;&#x6027;&#x80FD;&#x6D4B;&#x8BD5;&#x548C;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x3002;&#x5373;&#x4F7F;&#x662F;&#x6211;&#x6700;&#x521D;&#x7684;&#x8BA1;&#x5212;&#xFF0C;&#x5728;&#x8FD9;&#x7BC7;&#x6587;&#x6863;&#x4E2D;&#x5305;&#x542B;&#x7684;&#x5185;&#x5BB9;&#x4E5F;&#x4F1A;&#x5F88;&#x591A;&#x3002;&#x6211;&#x5E0C;&#x671B;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x4F1A;&#x5E2E;&#x52A9;&#x4F60;&#x5F00;&#x53D1;&#x7F51;&#x7EDC;&#x7A0B;&#x5E8F;&#x5E76;&#x76D1;&#x63A7;&#x5B83;&#x4EEC;&#x7684;&#x6027;&#x80FD;&#x3002;TCP/IP&#x534F;&#x8BAE;&#x672C;&#x8EAB;&#x5C31;&#x5341;&#x5206;&#x590D;&#x6742;&#x5E76;&#x6709;&#x5F88;&#x591A;&#x5F02;&#x5E38;&#x60C5;&#x51B5;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x4F60;&#x4E0D;&#x9700;&#x8981;&#x7406;&#x89E3;OS&#x4E2D;TCP/IP&#x534F;&#x8BAE;&#x76F8;&#x5173;&#x7684;&#x6BCF;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x6765;&#x7406;&#x89E3;&#x6027;&#x80FD;&#x548C;&#x5206;&#x6790;&#x73B0;&#x8C61;&#x3002;&#x53EA;&#x9700;&#x8981;&#x7406;&#x89E3;&#x5B83;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5BF9;&#x4F60;&#x5C31;&#x4F1A;&#x5341;&#x5206;&#x6709;&#x5E2E;&#x52A9;&#x3002;</p>
<p>&#x968F;&#x7740;&#x7CFB;&#x7EDF;&#x6027;&#x80FD;&#x548C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7F51;&#x7EDC;&#x6808;&#x5B9E;&#x73B0;&#x7684;&#x6301;&#x7EED;&#x63D0;&#x5347;&#xFF0C;&#x6700;&#x8FD1;&#x7684;&#x670D;&#x52A1;&#x5668;&#x80FD;&#x627F;&#x53D7;10-20Gb/s&#x7684;TCP&#x541E;&#x5410;&#x91CF;&#x800C;&#x4E0D;&#x51FA;&#x73B0;&#x4EFB;&#x4F55;&#x95EE;&#x9898;&#x3002;&#x8FD1;&#x671F;&#x4E5F;&#x51FA;&#x73B0;&#x4E86;&#x4E0E;&#x6027;&#x80FD;&#x76F8;&#x5173;&#x7684;&#x5F88;&#x591A;&#x7684;&#x65B0;&#x6280;&#x672F;&#xFF0C;&#x4F8B;&#x5982;TSO, LRO, RSS, GSO, GRO, UFO, XPS, IOAT, DDIO, TOE&#x7B49;&#x7B49;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x8FD9;&#x4E9B;&#x6211;&#x5C31;&#x4E0D;&#x7FFB;&#x8BD1;&#x4E86;&#x2026;&#x2026;&#xFF09;&#xFF0C;&#x8BA9;&#x6211;&#x4EEC;&#x6709;&#x4E9B;&#x56F0;&#x60D1;&#x3002;</p>
<p>&#x5728;&#x4E0B;&#x7BC7;&#x6587;&#x7AE0;&#x4E2D;&#xFF0C;&#x6211;&#x4F1A;&#x4ECE;&#x6027;&#x80FD;&#x7684;&#x89C2;&#x70B9;&#x89E3;&#x91CA;&#x5173;&#x4E8E;&#x7F51;&#x7EDC;&#x6808;&#xFF0C;&#x5E76;&#x4E14;&#x8BA8;&#x8BBA;&#x8FD9;&#x4E9B;&#x6280;&#x672F;&#x7684;&#x95EE;&#x9898;&#x548C;&#x6536;&#x76CA;&#x3002;</p>
<p>By Hyeongyeop Kim, Senior Engineer at Performance Engineering Lab, NHN Corporation.</p>
<h2 id="&#x4E5D;-&#x8BD1;&#x8005;&#x6700;&#x540E;&#x8BF4;&#x51E0;&#x53E5;"><a href="#&#x4E5D;-&#x8BD1;&#x8005;&#x6700;&#x540E;&#x8BF4;&#x51E0;&#x53E5;" class="headerlink" title="&#x4E5D; &#x8BD1;&#x8005;&#x6700;&#x540E;&#x8BF4;&#x51E0;&#x53E5;"></a>&#x4E5D; &#x8BD1;&#x8005;&#x6700;&#x540E;&#x8BF4;&#x51E0;&#x53E5;</h2><p>&#x672C;&#x6765;&#x770B;&#x7740;&#x6587;&#x7AE0;&#x5185;&#x5BB9;&#x4E0D;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x5B9E;&#x9645;&#x7FFB;&#x8BD1;&#x4E0B;&#x6765;&#x624D;&#x53D1;&#x73B0;&#x6709;&#x8FD9;&#x4E48;&#x591A;&#x5B57;&#x2026;&#x2026;&#x7FFB;&#x8BD1;&#x8FC7;&#x7A0B;&#x4E2D;&#x53D1;&#x73B0;&#x6709;&#x5F88;&#x591A;&#x5730;&#x65B9;&#x81EA;&#x5DF1;&#x4E4B;&#x524D;&#x7684;&#x7406;&#x89E3;&#x4E5F;&#x6709;&#x4E00;&#x4E9B;&#x9519;&#x8BEF;&#xFF0C;&#x5982;&#x679C;&#x5404;&#x4F4D;&#x53D1;&#x73B0;&#x54EA;&#x91CC;&#x7FFB;&#x8BD1;&#x7684;&#x6709;&#x95EE;&#x9898;&#x7684;&#x8BDD;&#x9EBB;&#x70E6;&#x544A;&#x77E5;&#x4E00;&#x4E0B;&#xFF0C;&#x611F;&#x6FC0;&#x4E0D;&#x5C3D;~~</p>
<p>&#x5BF9;&#x4E8E;TCP&#x534F;&#x8BAE;&#x6765;&#x8BF4;&#xFF0C;&#x867D;&#x7136;&#x5DF2;&#x7ECF;&#x770B;&#x8FC7;&#x5F88;&#x591A;&#x76F8;&#x5173;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x4F46;&#x662F;&#x771F;&#x6B63;&#x8981;&#x5B8C;&#x6574;&#x7684;&#x63CF;&#x8FF0;&#x4E00;&#x6B21;tcp&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x548C;&#x63A5;&#x6536;&#x7684;&#x8FC7;&#x7A0B;&#x5B9E;&#x9645;&#x4E0A;&#x8FD8;&#x662F;&#x5F88;&#x96BE;&#x505A;&#x5230;&#x7684;&#x3002;&#x5BF9;&#x4E8E;TCP&#x6216;&#x8005;&#x5185;&#x6838;&#x4E4B;&#x7C7B;&#x7684;&#x6587;&#x7AE0;&#x5F88;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x89C2;&#x5BDF;&#x4E86;&#x4E00;&#x4E0B;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x7684;&#x95EE;&#x9898;&#x5E76;&#x4E0D;&#x662F;&#x770B;&#x7684;&#x6587;&#x7AE0;&#x4E0D;&#x591F;&#x591A;&#xFF0C;&#x800C;&#x662F;&#x770B;&#x7684;&#x4E0D;&#x591F;&#x4ED4;&#x7EC6;&#x3002;</p>
<p>&#x4E0E;&#x5176;&#x6BCF;&#x5929;&#x4E50;&#x6B64;&#x4E0D;&#x75B2;&#x7684;mark&#x4E00;&#x5806;&#x6280;&#x672F;&#x6587;&#x7AE0;&#x7136;&#x540E;&#x968F;&#x4FBF;&#x626B;&#x51E0;&#x773C;&#xFF0C;&#x8FD8;&#x4E0D;&#x5982;&#x5B89;&#x5FC3;&#x628A;&#x4E00;&#x7BC7;&#x6587;&#x7AE0;&#x5B8C;&#x6574;&#x7684;&#x8BFB;&#x900F;&#xFF0C;&#x751A;&#x81F3;&#x518D;&#x9000;&#x4E00;&#x6B65;&#xFF0C;&#x628A;&#x6587;&#x7AE0;&#x4ECE;&#x5934;&#x5230;&#x5C3E;&#x901A;&#x8BFB;&#x4E00;&#x904D;&#xFF0C;&#x90A3;&#x4E5F;&#x662F;&#x6781;&#x597D;&#x7684;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x8FD9;&#x6B21;&#x7FFB;&#x8BD1;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7684;&#x521D;&#x8877;&#xFF0C;&#x4E0E;&#x5404;&#x4F4D;&#x5171;&#x52C9;&#x3002;</p>
<p><code>&#x77E5;&#x8BC6;&#x5171;&#x4EAB;&#x8BB8;&#x53EF;&#x534F;&#x8BAE;</code></p>
<p><code>&#x672C;&#x4F5C;&#x54C1;&#x91C7;&#x7528;&#x77E5;&#x8BC6;&#x5171;&#x4EAB;&#x7F72;&#x540D;-&#x975E;&#x5546;&#x4E1A;&#x6027;&#x4F7F;&#x7528; 4.0 &#x56FD;&#x9645;&#x8BB8;&#x53EF;&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x8BB8;&#x53EF;&#xFF0C;&#x8F6C;&#x8F7D;&#x8BF7;&#x6CE8;&#x660E;&#x4F5C;&#x8005;&#x53CA;&#x539F;&#x7F51;&#x5740;&#x3002;</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x6765;&amp;#x81EA;: &amp;#x535A;&amp;#x5BA2; Axb&amp;#x7684;&amp;#x81EA;&amp;#x6211;&amp;#x4FEE;&amp;#x517B; http://blog.2baxb.me/archives/1190 2015/05/01&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x4E00;-&amp;#x6458;&amp;#x8981;&quot;&gt;&lt;a href=&quot;#&amp;#x4E00;-&amp;#x6458;&amp;#x8981;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E00; &amp;#x6458;&amp;#x8981;&quot;&gt;&lt;/a&gt;&amp;#x4E00; &amp;#x6458;&amp;#x8981;&lt;/h2&gt;&lt;p&gt;&amp;#x8FD9;&amp;#x662F;&amp;#x300A;&amp;#x7FFB;&amp;#x8BD1;&amp;#xFF1A;&amp;#x7406;&amp;#x89E3;TCP/IP&amp;#x7F51;&amp;#x7EDC;&amp;#x6808;&amp;amp;&amp;#x7F16;&amp;#x5199;&amp;#x7F51;&amp;#x7EDC;&amp;#x5E94;&amp;#x7528;&amp;#x300B;&amp;#x7684;&amp;#x4E0B;&amp;#x7BC7;&amp;#xFF0C;&amp;#x6587;&amp;#x7AE0;&amp;#x4E2D;&amp;#x4F1A;&amp;#x901A;&amp;#x8FC7;&amp;#x8BB2;&amp;#x89E3;TCP&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x5B9E;&amp;#x73B0;&amp;#x5E2E;&amp;#x52A9;&amp;#x5927;&amp;#x5BB6;&amp;#x7406;&amp;#x89E3;&amp;#x53D1;&amp;#x9001;&amp;#x3001;&amp;#x63A5;&amp;#x6536;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x6D41;&amp;#x7A0B;&amp;#xFF0C;&amp;#x4E5F;&amp;#x63CF;&amp;#x8FF0;&amp;#x4E86;&amp;#x4E00;&amp;#x4E9B;&amp;#x7F51;&amp;#x5361;&amp;#x3001;&amp;#x9A71;&amp;#x52A8;&amp;#x7B49;&amp;#x7F51;&amp;#x7EDC;&amp;#x6808;&amp;#x5E95;&amp;#x5C42;&amp;#x7684;&amp;#x539F;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;#x539F;&amp;#x6587;&amp;#x5730;&amp;#x5740;&amp;#xFF1A;&lt;a href=&quot;http://www.cubrid.org/blog/dev-platform/understanding-tcp-ip-network-stack/&quot;&gt;http://www.cubrid.org/blog/dev-platform/understanding-tcp-ip-network-stack/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x539F;&amp;#x4F5C;&amp;#x8005;&amp;#xFF1A;Hyeongyeop Kim&lt;/p&gt;
&lt;p&gt;&amp;#x7FFB;&amp;#x8BD1;&amp;#xFF1A;@&amp;#x86CB;&amp;#x75BC;&amp;#x7684;axb &lt;a href=&quot;http://2baxb.me&quot;&gt;http://2baxb.me&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;&amp;#x4E8C;-&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&quot;&gt;&lt;a href=&quot;#&amp;#x4E8C;-&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E8C; &amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&quot;&gt;&lt;/a&gt;&amp;#x4E8C; &amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&lt;/h2&gt;&lt;p&gt;&amp;#x4EE5;&amp;#x4E0B;&amp;#x662F;&amp;#x4E00;&amp;#x4E9B;&amp;#x5173;&amp;#x952E;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&amp;#x6211;&amp;#x4EEC;&amp;#x4E86;&amp;#x89E3;&amp;#x4E00;&amp;#x4E0B;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#x518D;&amp;#x5F00;&amp;#x59CB;&amp;#x67E5;&amp;#x770B;&amp;#x4EE3;&amp;#x7801;&amp;#x3002;&lt;/p&gt;
&lt;h4 id=&quot;1-sk-buff-structure&quot;&gt;&lt;a href=&quot;#1-sk-buff-structure&quot; class=&quot;headerlink&quot; title=&quot;1. sk_buff_structure&quot;&gt;&lt;/a&gt;1. sk_buff_structure&lt;/h4&gt;&lt;p&gt;&amp;#x9996;&amp;#x5148;&amp;#xFF0C;&lt;strong&gt;sk_buff&lt;/strong&gt; &amp;#x7ED3;&amp;#x6784;&amp;#x6216; &lt;strong&gt;skb&lt;/strong&gt; &amp;#x7ED3;&amp;#x6784;&amp;#x4EE3;&amp;#x8868;&amp;#x4E00;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x3002;&lt;strong&gt;&amp;#x56FE;6&lt;/strong&gt; &amp;#x5C55;&amp;#x73B0;&amp;#x4E86; &lt;strong&gt;sk_buff&lt;/strong&gt; &amp;#x4E2D;&amp;#x7684;&amp;#x4E00;&amp;#x4E9B;&amp;#x7ED3;&amp;#x6784;&amp;#x3002;&amp;#x968F;&amp;#x7740;&amp;#x529F;&amp;#x80FD;&amp;#x53D8;&amp;#x5F97;&amp;#x66F4;&amp;#x5F3A;&amp;#x5927;&amp;#xFF0C;&amp;#x5B83;&amp;#x4EEC;&amp;#x4E5F;&amp;#x53D8;&amp;#x5F97;&amp;#x66F4;&amp;#x590D;&amp;#x6742;&amp;#x4E86;&amp;#x3002;&amp;#x4F46;&amp;#x662F;&amp;#x8FD8;&amp;#x662F;&amp;#x6709;&amp;#x4E00;&amp;#x4E9B;&amp;#x4EFB;&amp;#x4F55;&amp;#x4EBA;&amp;#x90FD;&amp;#x80FD;&amp;#x60F3;&amp;#x5230;&amp;#x7684;&amp;#x57FA;&amp;#x672C;&amp;#x529F;&amp;#x80FD;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2016/Understand-TCP-IP-network-2/packet_structure_sk_buff.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;center&gt;&amp;#x56FE;6&amp;#xFF1A;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x7ED3;&amp;#x6784;&lt;/center&gt;

&lt;h6 id=&quot;2-&amp;#x5305;&amp;#x542B;&amp;#x6570;&amp;#x636E;&amp;#x548C;&amp;#x5143;&amp;#x6570;&amp;#x636E;&quot;&gt;&lt;a href=&quot;#2-&amp;#x5305;&amp;#x542B;&amp;#x6570;&amp;#x636E;&amp;#x548C;&amp;#x5143;&amp;#x6570;&amp;#x636E;&quot; class=&quot;headerlink&quot; title=&quot;2. &amp;#x5305;&amp;#x542B;&amp;#x6570;&amp;#x636E;&amp;#x548C;&amp;#x5143;&amp;#x6570;&amp;#x636E;&quot;&gt;&lt;/a&gt;2. &amp;#x5305;&amp;#x542B;&amp;#x6570;&amp;#x636E;&amp;#x548C;&amp;#x5143;&amp;#x6570;&amp;#x636E;&lt;/h6&gt;&lt;p&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x7ED3;&amp;#x6784;&amp;#x76F4;&amp;#x63A5;&amp;#x5305;&amp;#x542B;&amp;#x6216;&amp;#x8005;&amp;#x901A;&amp;#x8FC7;&amp;#x6307;&amp;#x9488;&amp;#x5F15;&amp;#x7528;&amp;#x4E86;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x3002;&amp;#x5728; &lt;strong&gt;&amp;#x56FE;6&lt;/strong&gt; &amp;#x4E2D;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#xFF08;&amp;#x4ECE;Ethernet&amp;#x5230;Buffer&amp;#x90E8;&amp;#x5206;&amp;#xFF09;&amp;#x4F7F;&amp;#x7528;&amp;#x4E86;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x4E00;&amp;#x4E9B;&amp;#x989D;&amp;#x5916;&amp;#x7684;&amp;#x6570;&amp;#x636E;(frags&amp;#xFF09;&amp;#x5F15;&amp;#x7528;&amp;#x4E86;&amp;#x5B9E;&amp;#x9645;&amp;#x7684;&amp;#x5185;&amp;#x5B58;&amp;#x9875;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x4E00;&amp;#x4E9B;&amp;#x5FC5;&amp;#x8981;&amp;#x7684;&amp;#x4FE1;&amp;#x606F;&amp;#x6BD4;&amp;#x5982;&amp;#x5934;&amp;#x548C;&amp;#x5185;&amp;#x5BB9;&amp;#x957F;&amp;#x5EA6;&amp;#x88AB;&amp;#x4FDD;&amp;#x5B58;&amp;#x5728;&amp;#x5143;&amp;#x6570;&amp;#x636E;&amp;#x533A;&amp;#x3002;&amp;#x4F8B;&amp;#x5982;&amp;#xFF0C;&amp;#x5728; &lt;strong&gt;&amp;#x56FE;6&lt;/strong&gt; &amp;#x4E2D;&amp;#xFF0C;mac_header&amp;#x3001;network_header&amp;#x548C;transport_header&amp;#x90FD;&amp;#x6709;&amp;#x76F8;&amp;#x5E94;&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x6307;&amp;#x5411;&amp;#x94FE;&amp;#x8DEF;&amp;#x5934;&amp;#x3001;IP&amp;#x5934;&amp;#x548C;TCP&amp;#x5934;&amp;#x7684;&amp;#x8D77;&amp;#x59CB;&amp;#x5730;&amp;#x5740;&amp;#x3002;&amp;#x8FD9;&amp;#x79CD;&amp;#x65B9;&amp;#x5F0F;&amp;#x8BA9;TCP&amp;#x534F;&amp;#x8BAE;&amp;#x5904;&amp;#x7406;&amp;#x8FC7;&amp;#x7A0B;&amp;#x53D8;&amp;#x5F97;&amp;#x7B80;&amp;#x5355;&amp;#x3002;&lt;/p&gt;
&lt;h6 id=&quot;3-&amp;#x5982;&amp;#x4F55;&amp;#x589E;&amp;#x52A0;&amp;#x6216;&amp;#x5220;&amp;#x9664;&amp;#x5934;&quot;&gt;&lt;a href=&quot;#3-&amp;#x5982;&amp;#x4F55;&amp;#x589E;&amp;#x52A0;&amp;#x6216;&amp;#x5220;&amp;#x9664;&amp;#x5934;&quot; class=&quot;headerlink&quot; title=&quot;3. &amp;#x5982;&amp;#x4F55;&amp;#x589E;&amp;#x52A0;&amp;#x6216;&amp;#x5220;&amp;#x9664;&amp;#x5934;&quot;&gt;&lt;/a&gt;3. &amp;#x5982;&amp;#x4F55;&amp;#x589E;&amp;#x52A0;&amp;#x6216;&amp;#x5220;&amp;#x9664;&amp;#x5934;&lt;/h6&gt;&lt;p&gt;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x5728;&amp;#x7F51;&amp;#x7EDC;&amp;#x6808;&amp;#x7684;&amp;#x5404;&amp;#x5C42;&amp;#x4E2D;&amp;#x4E0A;&amp;#x5347;&amp;#x6216;&amp;#x4E0B;&amp;#x964D;&amp;#x65F6;&amp;#x4F1A;&amp;#x589E;&amp;#x52A0;&amp;#x6216;&amp;#x5220;&amp;#x9664;&amp;#x6570;&amp;#x636E;&amp;#x5934;&amp;#x3002;&amp;#x4E3A;&amp;#x4E86;&amp;#x66F4;&amp;#x6709;&amp;#x6548;&amp;#x7387;&amp;#x7684;&amp;#x5904;&amp;#x7406;&amp;#x800C;&amp;#x4F7F;&amp;#x7528;&amp;#x4E86;&amp;#x6307;&amp;#x9488;&amp;#x3002;&amp;#x4F8B;&amp;#x5982;&amp;#xFF0C;&amp;#x8981;&amp;#x5220;&amp;#x9664;&amp;#x94FE;&amp;#x8DEF;&amp;#x5934;&amp;#x53EA;&amp;#x9700;&amp;#x8981;&amp;#x4FEE;&amp;#x6539;head pointer&amp;#x7684;&amp;#x503C;&amp;#x3002;&lt;/p&gt;
&lt;h6 id=&quot;4-&amp;#x5982;&amp;#x4F55;&amp;#x5408;&amp;#x5E76;&amp;#x6216;&amp;#x5207;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#x5305;&quot;&gt;&lt;a href=&quot;#4-&amp;#x5982;&amp;#x4F55;&amp;#x5408;&amp;#x5E76;&amp;#x6216;&amp;#x5207;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#x5305;&quot; class=&quot;headerlink&quot; title=&quot;4. &amp;#x5982;&amp;#x4F55;&amp;#x5408;&amp;#x5E76;&amp;#x6216;&amp;#x5207;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#x5305;&quot;&gt;&lt;/a&gt;4. &amp;#x5982;&amp;#x4F55;&amp;#x5408;&amp;#x5E76;&amp;#x6216;&amp;#x5207;&amp;#x5206;&amp;#x6570;&amp;#x636E;&amp;#x5305;&lt;/h6&gt;&lt;p&gt;&amp;#x4E3A;&amp;#x4E86;&amp;#x66F4;&amp;#x6709;&amp;#x6548;&amp;#x7387;&amp;#x7684;&amp;#x6267;&amp;#x884C;&amp;#x628A;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x589E;&amp;#x5230;&amp;#x6216;&amp;#x4ECE;socket&amp;#x7F13;&amp;#x51B2;&amp;#x533A;&amp;#x4E2D;&amp;#x5220;&amp;#x9664;&amp;#x8FD9;&amp;#x7C7B;&amp;#x64CD;&amp;#x4F5C;&amp;#x800C;&amp;#x4F7F;&amp;#x7528;&amp;#x4E86;&amp;#x94FE;&amp;#x8868;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x53EB;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x94FE;&amp;#x3002;next&amp;#x548C;prev&amp;#x6307;&amp;#x9488;&amp;#x7528;&amp;#x4E8E;&amp;#x8FD9;&amp;#x4E2A;&amp;#x573A;&amp;#x666F;&amp;#x3002;&lt;/p&gt;
&lt;h6 id=&quot;5-&amp;#x5FEB;&amp;#x901F;&amp;#x5206;&amp;#x914D;&amp;#x548C;&amp;#x91CA;&amp;#x653E;&quot;&gt;&lt;a href=&quot;#5-&amp;#x5FEB;&amp;#x901F;&amp;#x5206;&amp;#x914D;&amp;#x548C;&amp;#x91CA;&amp;#x653E;&quot; class=&quot;headerlink&quot; title=&quot;5. &amp;#x5FEB;&amp;#x901F;&amp;#x5206;&amp;#x914D;&amp;#x548C;&amp;#x91CA;&amp;#x653E;&quot;&gt;&lt;/a&gt;5. &amp;#x5FEB;&amp;#x901F;&amp;#x5206;&amp;#x914D;&amp;#x548C;&amp;#x91CA;&amp;#x653E;&lt;/h6&gt;&lt;p&gt;&amp;#x65E0;&amp;#x8BBA;&amp;#x4F55;&amp;#x65F6;&amp;#x521B;&amp;#x5EFA;&amp;#x6570;&amp;#x636E;&amp;#x5305;&amp;#x90FD;&amp;#x4F1A;&amp;#x5206;&amp;#x914D;&amp;#x4E00;&amp;#x4E2A;&amp;#x6570;&amp;#x636E;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x6B64;&amp;#x65F6;&amp;#x4F1A;&amp;#x7528;&amp;#x5230;&amp;#x5FEB;&amp;#x901F;&amp;#x5206;&amp;#x914D;&amp;#x5668;&amp;#x3002;&amp;#x6BD4;&amp;#x5982;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x6570;&amp;#x636E;&amp;#x901A;&amp;#x8FC7;10Gb&amp;#x7684;&amp;#x4EE5;&amp;#x592A;&amp;#x7F51;&amp;#x4F20;&amp;#x8F93;&amp;#xFF0C;&amp;#x6BCF;&amp;#x79D2;&amp;#x4F1A;&amp;#x6709;&amp;#x8D85;&amp;#x8FC7;&amp;#x4E00;&amp;#x767E;&amp;#x4E07;&amp;#x4E2A;&amp;#x5BF9;&amp;#x8C61;&amp;#x88AB;&amp;#x521B;&amp;#x5EFA;&amp;#x548C;&amp;#x9500;&amp;#x6BC1;&amp;#x3002;&lt;/p&gt;
    
    </summary>
    
      <category term="Network" scheme="http://snowyying.github.io/categories/Network/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="TCP/IP" scheme="http://snowyying.github.io/tags/TCP-IP/"/>
    
  </entry>
  
  <entry>
    <title>理解TCP/IP网络栈&amp;编写网络应用 (上)</title>
    <link href="http://snowyying.github.io/2016/Understand-TCP-IP-network-1/"/>
    <id>http://snowyying.github.io/2016/Understand-TCP-IP-network-1/</id>
    <published>2016-08-16T12:40:39.000Z</published>
    <updated>2016-08-25T04:03:25.940Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x6765;&#x81EA;: &#x535A;&#x5BA2; Axb&#x7684;&#x81EA;&#x6211;&#x4FEE;&#x517B; http://blog.2baxb.me/archives/1174 2015/04/30</code></p>
<h2 id="&#x4E00;-&#x6458;&#x8981;"><a href="#&#x4E00;-&#x6458;&#x8981;" class="headerlink" title="&#x4E00; &#x6458;&#x8981;"></a>&#x4E00; &#x6458;&#x8981;</h2><p>&#x4E4B;&#x524D;&#x5728;&#x7F51;&#x4E0A;&#x770B;&#x5230;&#x4E86;&#x8FD9;&#x7BC7;&#x63CF;&#x8FF0;tcp&#x7F51;&#x7EDC;&#x6808;&#x539F;&#x7406;&#x7684;&#x6587;&#x7AE0;&#xFF0C;&#x611F;&#x89C9;&#x4E0D;&#x9519;&#xFF0C;&#x51B3;&#x5B9A;&#x62BD;&#x7A7A;&#x628A;&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x7FFB;&#x8BD1;&#x4E00;&#x4E0B;&#x3002;&#x4E00;&#x6765;&#x91CD;&#x65B0;&#x6E29;&#x4E60;&#x4E00;&#x4E0B;TCP&#x76F8;&#x5173;&#x77E5;&#x8BC6;&#xFF0C;&#x4E8C;&#x6765;&#x7EC3;&#x7EC3;&#x82F1;&#x6587;&#x3002;&#x7531;&#x4E8E;&#x539F;&#x6587;&#x592A;&#x957F;&#xFF0C;&#x8FD9;&#x91CC;&#x628A;&#x6587;&#x7AE0;&#x5206;&#x6210;&#x4E0A;&#x4E0B;&#x4E24;&#x90E8;&#x5206;&#xFF0C;&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x4E86;&#x539F;&#x7406;&#x548C;&#x4EE3;&#x7801;&#x3002; &#x5F88;&#x4E45;&#x6CA1;&#x7FFB;&#x8BD1;&#x6587;&#x7AE0;&#x4E86;&#x96BE;&#x514D;&#x6709;&#x8BEF;&#xFF0C;&#x5EFA;&#x8BAE;&#x6709;&#x80FD;&#x529B;&#x7684;&#x540C;&#x5B66;&#x8FD8;&#x662F;&#x770B;&#x4E00;&#x4E0B;&#x539F;&#x6587;&#x3002;</p>
<blockquote>
<p>&#x539F;&#x6587;&#x5730;&#x5740;&#xFF1A;<a href="http://www.cubrid.org/blog/dev-platform/understanding-tcp-ip-network-stack/" target="_blank" rel="external">http://www.cubrid.org/blog/dev-platform/understanding-tcp-ip-network-stack/</a></p>
<p>&#x539F;&#x4F5C;&#x8005;&#xFF1A;Hyeongyeop Kim</p>
<p>&#x7FFB;&#x8BD1;&#xFF1A;@&#x86CB;&#x75BC;&#x7684;axb <a href="http://2baxb.me" target="_blank" rel="external">http://2baxb.me</a></p>
</blockquote>
<h2 id="&#x4E8C;-&#x6982;&#x8FF0;"><a href="#&#x4E8C;-&#x6982;&#x8FF0;" class="headerlink" title="&#x4E8C; &#x6982;&#x8FF0;"></a>&#x4E8C; &#x6982;&#x8FF0;</h2><p>&#x6211;&#x4EEC;&#x96BE;&#x4EE5;&#x60F3;&#x8C61;&#x6CA1;&#x6709;&#x4E86;TCP/IP&#x4E4B;&#x540E;&#x7684;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x3002;&#x6240;&#x6709;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x5E76;&#x5728;NHN&#xFF08;&#x539F;&#x6587;&#x53D1;&#x5E03;&#x7684;&#x7F51;&#x7AD9;&#xFF09;&#x4F7F;&#x7528;&#x7684;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x90FD;&#x57FA;&#x4E8E;TCP/IP&#x8FD9;&#x4E2A;&#x575A;&#x5B9E;&#x7684;&#x57FA;&#x7840;&#x3002;&#x7406;&#x89E3;&#x6570;&#x636E;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x7F51;&#x7EDC;&#x4F20;&#x8F93;&#x53EF;&#x4EE5;&#x5E2E;&#x52A9;&#x4F60;&#x901A;&#x8FC7;&#x8C03;&#x4F18;&#x3001;&#x6392;&#x67E5;&#x6216;&#x5F15;&#x8FDB;&#x65B0;&#x6280;&#x672F;&#x4E4B;&#x7C7B;&#x7684;&#x624B;&#x6BB5;&#x63D0;&#x5347;&#x6027;&#x80FD;&#x3002;</p>
<p>&#x672C;&#x6587;&#x5C06;&#x57FA;&#x4E8E;Linux OS&#x548C;&#x786C;&#x4EF6;&#x5C42;&#x7684;&#x6570;&#x636E;&#x6D41;&#x548C;&#x63A7;&#x5236;&#x6D41;&#x6765;&#x63CF;&#x8FF0;&#x7F51;&#x7EDC;&#x6808;&#x7684;&#x6574;&#x4F53;&#x8FD0;&#x884C;&#x65B9;&#x5F0F;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x4E09;-TCP-IP&#x7684;&#x5173;&#x952E;&#x7279;&#x6027;"><a href="#&#x4E09;-TCP-IP&#x7684;&#x5173;&#x952E;&#x7279;&#x6027;" class="headerlink" title="&#x4E09; TCP/IP&#x7684;&#x5173;&#x952E;&#x7279;&#x6027;"></a>&#x4E09; TCP/IP&#x7684;&#x5173;&#x952E;&#x7279;&#x6027;</h2><p><strong>&#x6211;&#x5982;&#x4F55;&#x8BBE;&#x8BA1;&#x4E00;&#x4E2A;&#x80FD;&#x5728;&#x5FEB;&#x901F;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x7684;&#x540C;&#x65F6;&#x4FDD;&#x8BC1;&#x6570;&#x636E;&#x987A;&#x5E8F;&#x5E76;&#x4E14;&#x4E0D;&#x4E22;&#x5931;&#x6570;&#x636E;&#x7684;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#xFF1F;</strong> TCP/IP&#x5728;&#x8BBE;&#x8BA1;&#x65F6;&#x5C31;&#x57FA;&#x4E8E;&#x8FD9;&#x4E2A;&#x8003;&#x8651;&#x3002;&#x4EE5;&#x4E0B;&#x662F;&#x5728;&#x4E86;&#x89E3;&#x6574;&#x4F53;&#x7F51;&#x7EDC;&#x6808;&#x524D;&#x9700;&#x8981;&#x77E5;&#x9053;&#x7684;TCP/IP&#x7684;&#x4E3B;&#x8981;&#x7279;&#x6027;&#xFF1A;</p>
<blockquote>
<p>TCP&#x548C;IP</p>
<p>&#x4ECE;&#x6280;&#x672F;&#x4E0A;&#x8BB2;&#xFF0C;TCP&#x548C;IP&#x5904;&#x4E8E;&#x4E0D;&#x540C;&#x7684;&#x5C42;&#xFF0C;&#x5E94;&#x8BE5;&#x5206;&#x522B;&#x89E3;&#x91CA;&#x5B83;&#x4EEC;&#x3002;&#x4F46;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x628A;&#x4ED6;&#x4EEC;&#x770B;&#x505A;&#x4E00;&#x4E2A;&#x6574;&#x4F53;&#x3002;</p>
</blockquote>
<h4 id="1-&#x9762;&#x5411;&#x8FDE;&#x63A5;"><a href="#1-&#x9762;&#x5411;&#x8FDE;&#x63A5;" class="headerlink" title="1. &#x9762;&#x5411;&#x8FDE;&#x63A5;"></a>1. &#x9762;&#x5411;&#x8FDE;&#x63A5;</h4><p>&#x9996;&#x5148;&#xFF0C;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x524D;&#x9700;&#x8981;&#x5728;&#x4E24;&#x4E2A;&#x7EC8;&#x7AEF;&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x8FDE;&#x63A5;&#xFF08;&#x672C;&#x5730;&#x548C;&#x8FDC;&#x7A0B;&#xFF09;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x201C;TCP&#x8FDE;&#x63A5;&#x6807;&#x8BC6;&#x7B26;(TCP connection identifier)&#x201D;&#x662F;&#x4E24;&#x4E2A;&#x7EC8;&#x7AEF;&#x5730;&#x5740;&#x7684;&#x7EC4;&#x5408;&#xFF0C;&#x7C7B;&#x4F3C;<code>&lt;&#x672C;&#x5730;ip&#x5730;&#x5740;&#xFF0C;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x53F7;&#xFF0C;&#x8FDC;&#x7A0B;ip&#x5730;&#x5740;&#xFF0C;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x53F7;&gt;</code>&#x7684;&#x5F62;&#x5F0F;&#x3002;</p>
<h4 id="2-&#x53CC;&#x5411;&#x5B57;&#x8282;&#x6D41;"><a href="#2-&#x53CC;&#x5411;&#x5B57;&#x8282;&#x6D41;" class="headerlink" title="2. &#x53CC;&#x5411;&#x5B57;&#x8282;&#x6D41;"></a>2. &#x53CC;&#x5411;&#x5B57;&#x8282;&#x6D41;</h4><p>&#x901A;&#x8FC7;&#x5B57;&#x8282;&#x6D41;&#x5B9E;&#x73B0;&#x53CC;&#x5411;&#x6570;&#x636E;&#x901A;&#x4FE1;&#x3002;</p>
<h4 id="3-&#x987A;&#x5E8F;&#x6295;&#x9012;"><a href="#3-&#x987A;&#x5E8F;&#x6295;&#x9012;" class="headerlink" title="3. &#x987A;&#x5E8F;&#x6295;&#x9012;"></a>3. &#x987A;&#x5E8F;&#x6295;&#x9012;</h4><p>&#x63A5;&#x6536;&#x8005;&#x5728;&#x63A5;&#x6536;&#x6570;&#x636E;&#x65F6;&#x4E0E;&#x53D1;&#x9001;&#x8005;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x987A;&#x5E8F;&#x76F8;&#x540C;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6570;&#x636E;&#x9700;&#x8981;&#x662F;&#x6709;&#x5E8F;&#x7684;&#xFF0C;&#x4E3A;&#x4E86;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x987A;&#x5E8F;&#xFF0C;TCP/IP&#x4F7F;&#x7528;&#x4E86;32&#x4F4D;&#x7684;int&#x6570;&#x636E;&#x7C7B;&#x578B;&#x3002;</p>
<h4 id="4-&#x901A;&#x8FC7;ACK&#x5B9E;&#x73B0;&#x53EF;&#x9760;&#x6027;"><a href="#4-&#x901A;&#x8FC7;ACK&#x5B9E;&#x73B0;&#x53EF;&#x9760;&#x6027;" class="headerlink" title="4. &#x901A;&#x8FC7;ACK&#x5B9E;&#x73B0;&#x53EF;&#x9760;&#x6027;"></a>4. &#x901A;&#x8FC7;ACK&#x5B9E;&#x73B0;&#x53EF;&#x9760;&#x6027;</h4><p>&#x5F53;&#x53D1;&#x9001;&#x8005;&#x5411;&#x63A5;&#x6536;&#x8005;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x6CA1;&#x6709;&#x6536;&#x5230;&#x6765;&#x81EA;&#x63A5;&#x6536;&#x65B9;&#x7684;ACK&#xFF08;acknowledgement&#xFF0C;&#x5E94;&#x7B54;&#xFF09;&#x65F6;&#xFF0C;&#x53D1;&#x9001;&#x8005;&#x7684;TCP&#x5C42;&#x5C06;&#x91CD;&#x53D1;&#x6570;&#x636E;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x53D1;&#x9001;&#x8005;&#x7684;TCP&#x5C42;&#x4F1A;&#x628A;&#x63A5;&#x6536;&#x8005;&#x8FD8;&#x6CA1;&#x6709;&#x5E94;&#x7B54;&#x7684;&#x6570;&#x636E;&#x6682;&#x5B58;&#x8D77;&#x6765;&#x3002;</p>
<h4 id="5-&#x6D41;&#x91CF;&#x63A7;&#x5236;"><a href="#5-&#x6D41;&#x91CF;&#x63A7;&#x5236;" class="headerlink" title="5. &#x6D41;&#x91CF;&#x63A7;&#x5236;"></a>5. &#x6D41;&#x91CF;&#x63A7;&#x5236;</h4><p>&#x53D1;&#x9001;&#x8005;&#x7684;&#x53D1;&#x9001;&#x901F;&#x5EA6;&#x4E0E;&#x63A5;&#x6536;&#x8005;&#x7684;&#x63A5;&#x6536;&#x80FD;&#x529B;&#x76F8;&#x5173;&#x3002;&#x63A5;&#x6536;&#x8005;&#x4F1A;&#x628A;&#x5B83;&#x80FD;&#x63A5;&#x6536;&#x7684;&#x6700;&#x5927;&#x5B57;&#x8282;&#x6570;&#xFF08;&#x672A;&#x4F7F;&#x7528;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#xFF0C;&#x53C8;&#x53EB;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#xFF0C;receive window&#xFF09;&#x544A;&#x77E5;&#x53D1;&#x9001;&#x8005;&#x3002;&#x53D1;&#x9001;&#x8005;&#x53D1;&#x9001;&#x7684;&#x6700;&#x5927;&#x5B57;&#x8282;&#x6570;&#x4E0E;&#x63A5;&#x6536;&#x8005;&#x7684;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#x5927;&#x5C0F;&#x4E00;&#x81F4;&#x3002;</p>
<h4 id="6-&#x963B;&#x585E;&#x63A7;&#x5236;"><a href="#6-&#x963B;&#x585E;&#x63A7;&#x5236;" class="headerlink" title="6. &#x963B;&#x585E;&#x63A7;&#x5236;"></a>6. &#x963B;&#x585E;&#x63A7;&#x5236;</h4><p>&#x963B;&#x585E;&#x7A97;&#x53E3;&#x662F;&#x4E0D;&#x540C;&#x4E8E;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#x7684;&#x53E6;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x5B83;&#x901A;&#x8FC7;&#x9650;&#x5236;&#x7F51;&#x7EDC;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x6D41;&#x7684;&#x4F53;&#x79EF;&#x6765;&#x9632;&#x6B62;&#x7F51;&#x7EDC;&#x963B;&#x585E;&#x3002;&#x7C7B;&#x4F3C;&#x4E8E;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#xFF0C;&#x53D1;&#x9001;&#x8005;&#x901A;&#x8FC7;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x7B97;&#x6CD5;&#xFF08;&#x4F8B;&#x5982;TCP Vegas&#xFF0C;Westwood&#xFF0C;BIC&#xFF0C;CUBIC&#xFF09;&#x6765;&#x8BA1;&#x7B97;&#x53D1;&#x9001;&#x5BF9;&#x5E94;&#x7684;&#x63A5;&#x6536;&#x8005;&#x7684;&#x963B;&#x585E;&#x7A97;&#x53E3;&#x80FD;&#x5BB9;&#x7EB3;&#x7684;&#x6700;&#x591A;&#x7684;&#x6570;&#x636E;&#x3002;&#x548C;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x4E0D;&#x540C;&#xFF0C;&#x963B;&#x585E;&#x63A7;&#x5236;&#x53EA;&#x5728;&#x53D1;&#x9001;&#x65B9;&#x5B9E;&#x73B0;&#x3002;&#xFF08;&#x8BD1;&#x6CE8;&#xFF1A;&#x53D1;&#x9001;&#x8005;&#x7C7B;&#x4F3C;&#x4E8E;&#x901A;&#x8FC7;ack&#x65F6;&#x95F4;&#x4E4B;&#x7C7B;&#x7684;&#x7B97;&#x6CD5;&#x5224;&#x65AD;&#x5F53;&#x524D;&#x7F51;&#x7EDC;&#x662F;&#x5426;&#x963B;&#x585E;&#xFF0C;&#x4ECE;&#x800C;&#x8C03;&#x8282;&#x53D1;&#x9001;&#x901F;&#x5EA6;&#xFF09;</p>
<h2 id="&#x56DB;-&#x6570;&#x636E;&#x4F20;&#x8F93;"><a href="#&#x56DB;-&#x6570;&#x636E;&#x4F20;&#x8F93;" class="headerlink" title="&#x56DB; &#x6570;&#x636E;&#x4F20;&#x8F93;"></a>&#x56DB; &#x6570;&#x636E;&#x4F20;&#x8F93;</h2><p>&#x7F51;&#x7EDC;&#x6808;&#x6709;&#x5F88;&#x591A;&#x5C42;&#x3002;<strong>&#x56FE;1</strong> &#x8868;&#x793A;&#x4E86;&#x8FD9;&#x4E9B;&#x5C42;&#x7684;&#x7C7B;&#x578B;&#xFF1A;</p>
<p><img src="/2016/Understand-TCP-IP-network-1/operation_process_by_each_layer_of_tcp_ip.png" alt="img"></p>
<center>&#x56FE;1&#xFF1A;&#x53D1;&#x9001;&#x6570;&#x636E;&#x65F6;&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x5404;&#x5C42;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;</center>

<p>&#x8FD9;&#x4E9B;&#x5C42;&#x53EF;&#x4EE5;&#x88AB;&#x5927;&#x81F4;&#x5F52;&#x7C7B;&#x5230;&#x4E09;&#x4E2A;&#x533A;&#x57DF;&#x4E2D;&#xFF1A;</p>
<ol>
<li>&#x7528;&#x6237;&#x533A;</li>
<li>&#x5185;&#x6838;&#x533A;</li>
<li>&#x8BBE;&#x5907;&#x533A;</li>
</ol>
<p>&#x7528;&#x6237;&#x533A;&#x548C;&#x5185;&#x6838;&#x533A;&#x7684;&#x4EFB;&#x52A1;&#x7531;CPU&#x6267;&#x884C;&#x3002;&#x7528;&#x6237;&#x533A;&#x548C;&#x5185;&#x6838;&#x533A;&#x88AB;&#x53EB;&#x505A;&#x201C;&#x4E3B;&#x673A;&#xFF08;<strong>host</strong>&#xFF09;&#x201D;&#x4EE5;&#x533A;&#x522B;&#x4E8E;&#x8BBE;&#x5907;&#x533A;&#x3002;&#x5728;&#x8FD9;&#x91CC;&#xFF0C;&#x8BBE;&#x5907;&#x662F;&#x53D1;&#x9001;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x7F51;&#x7EDC;&#x63A5;&#x53E3;&#x5361;&#xFF08;Network Interface Card,NIC&#xFF09;&#x3002;&#x5B83;&#x6709;&#x4E00;&#x4E2A;&#x66F4;&#x5E38;&#x7528;&#x7684;&#x672F;&#x8BED;&#xFF1A;&#x7F51;&#x5361;&#x3002;</p>
<p>&#x6211;&#x4EEC;&#x6765;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x7528;&#x6237;&#x533A;&#x3002;&#x9996;&#x5148;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x521B;&#x5EFA;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#xFF08;<strong>&#x56FE;1</strong> &#x4E2D;&#x7684;&#x201C;<strong>User Data</strong>&#x201D;&#xFF09;&#x5E76;&#x4E14;&#x8C03;&#x7528;write()&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6765;&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF08;&#x5728;&#x8FD9;&#x91CC;&#x5047;&#x8BBE;socket&#x5DF2;&#x7ECF;&#x88AB;&#x521B;&#x5EFA;&#x4E86;&#xFF0C;&#x5BF9;&#x5E94; <strong>&#x56FE;1</strong> &#x4E2D;&#x7684;&#x201C;<strong>fd</strong>&#x201D;&#xFF09;&#x3002;&#x5F53;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x88AB;&#x8C03;&#x7528;&#x4E4B;&#x540E;&#x4E0A;&#x4E0B;&#x6587;&#x5207;&#x6362;&#x5230;&#x5185;&#x6838;&#x533A;&#x3002;</p>
<p>&#x50CF;Linux&#x6216;&#x8005;Unix&#x8FD9;&#x7C7B;POSIX&#x7CFB;&#x5217;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#xFF08;file descriptor&#xFF09;&#x628A;socket&#x66B4;&#x9732;&#x7ED9;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x5728;&#x8FD9;&#x7C7B;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;socket&#x662F;&#x6587;&#x4EF6;&#x7684;&#x4E00;&#x79CD;&#x3002;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6267;&#x884C;&#x7B80;&#x5355;&#x7684;&#x68C0;&#x67E5;&#x5E76;&#x8C03;&#x7528;socket&#x7ED3;&#x6784;&#x4E2D;&#x6307;&#x5411;&#x7684;socket&#x51FD;&#x6570;&#x3002;</p>
<p>&#x5185;&#x6838;&#x4E2D;&#x7684;socket&#x5305;&#x542B;&#x4E24;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#x3002;</p>
<ol>
<li>&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x7F13;&#x51B2;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;</li>
<li>&#x4E00;&#x4E2A;&#x7528;&#x4E8E;&#x7F13;&#x51B2;&#x8981;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;</li>
</ol>
<p>&#x5F53;write()&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x88AB;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x7528;&#x6237;&#x533A;&#x7684;&#x6570;&#x636E;&#x88AB;&#x62F7;&#x8D1D;&#x5230;&#x5185;&#x6838;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x5E76;&#x63D2;&#x5165;&#x5230;socket&#x7684;&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x533A;&#x672B;&#x5C3E;&#x3002;&#x8FD9;&#x6837;&#x6765;&#x4FDD;&#x8BC1;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x6709;&#x5E8F;&#x3002;&#x5728; <strong>&#x56FE;1</strong> &#x4E2D;&#xFF0C;&#x6D45;&#x7070;&#x8272;&#x6846;&#x8868;&#x793A;&#x5728;socket&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002;&#x4E4B;&#x540E;&#xFF0C;TCP&#x88AB;&#x8C03;&#x7528;&#x4E86;&#x3002;</p>
<p>socket&#x4F1A;&#x5173;&#x8054;&#x4E00;&#x4E2A;&#x53EB;&#x505A;TCP&#x63A7;&#x5236;&#x5757;&#xFF08;TCP Control Block&#xFF09;&#x7684;&#x7ED3;&#x6784;&#xFF0C;TCB&#x5305;&#x542B;&#x4E86;&#x5904;&#x7406;TCP&#x8FDE;&#x63A5;&#x6240;&#x9700;&#x7684;&#x6570;&#x636E;&#x3002;&#x5305;&#x62EC;&#x8FDE;&#x63A5;&#x72B6;&#x6001;&#xFF08;<code>LISTEN</code>&#xFF0C;<code>ESTABLISHED</code>&#xFF0C;<code>TIME_WAIT</code>&#xFF09;&#xFF0C;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#xFF0C;&#x963B;&#x585E;&#x7A97;&#x53E3;&#xFF0C;&#x987A;&#x5E8F;&#x53F7;&#xFF0C;&#x91CD;&#x53D1;&#x8BA1;&#x65F6;&#x5668;&#xFF0C;&#x7B49;&#x7B49;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5F53;&#x524D;&#x7684;TCP&#x72B6;&#x6001;&#x5141;&#x8BB8;&#x6570;&#x636E;&#x4F20;&#x8F93;&#xFF0C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;TCP&#x5206;&#x6BB5;&#xFF08;TCP segment,&#x6216;&#x8005;&#x53EB;&#x6570;&#x636E;&#x5305;,packet&#xFF09;&#x5C06;&#x88AB;&#x521B;&#x5EFA;&#x3002;&#x5982;&#x679C;&#x7531;&#x4E8E;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x6216;&#x8005;&#x5176;&#x5B83;&#x539F;&#x56E0;&#x4E0D;&#x80FD;&#x4F20;&#x8F93;&#x6570;&#x636E;&#xFF0C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4F1A;&#x5728;&#x8FD9;&#x91CC;&#x7ED3;&#x675F;&#xFF0C;&#x4E4B;&#x540E;&#x4F1A;&#x8FD4;&#x56DE;&#x5230;&#x7528;&#x6237;&#x6001;&#x3002;&#xFF08;&#x6362;&#x53E5;&#x8BDD;&#x8BF4;&#xFF0C;&#x63A7;&#x5236;&#x6743;&#x4F1A;&#x4EA4;&#x56DE;&#x5230;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4EE3;&#x7801;&#xFF09;</p>
<p>TCP&#x5206;&#x6BB5;&#x6709;&#x4E24;&#x90E8;&#x5206;, &#x5982; <strong>&#x56FE;2</strong> &#x6240;&#x793A;:</p>
<ol>
<li>TCP&#x5934;</li>
<li>&#x643A;&#x5E26;&#x7684;&#x6570;&#x636E;</li>
</ol>
<p><img src="/2016/Understand-TCP-IP-network-1/tcp_frame_structure.png" alt="img"></p>
<center>&#x56FE;2&#xFF1A;TCP&#x5E27;&#x7684;&#x7ED3;&#x6784;</center>

<p>TCP&#x6570;&#x636E;&#x5305;&#x7684;payload&#x90E8;&#x5206;&#x4F1A;&#x5305;&#x542B;&#x5728;socket&#x53D1;&#x9001;&#x7F13;&#x51B2;&#x533A;&#x91CC;&#x7684;&#x6CA1;&#x6709;&#x5E94;&#x7B54;&#x7684;&#x6570;&#x636E;&#x3002;&#x643A;&#x5E26;&#x6570;&#x636E;&#x7684;&#x6700;&#x5927;&#x957F;&#x5EA6;&#x662F;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#x3001;&#x963B;&#x585E;&#x7A97;&#x53E3;&#x548C;&#x6700;&#x5927;&#x5206;&#x6BB5;&#x957F;&#x5EA6;&#xFF08;maximum segment size,MSS&#xFF09;&#x4E2D;&#x7684;&#x6700;&#x5927;&#x503C;&#x3002;</p>
<p>&#x4E4B;&#x540E;&#x4F1A;&#x8BA1;&#x7B97;TCP&#x6821;&#x9A8C;&#x503C;&#x3002;&#x5728;&#x8BA1;&#x7B97;&#x65F6;&#xFF0C;&#x5934;&#x4FE1;&#x606F;&#xFF08;ip&#x5730;&#x5740;&#x3001;&#x5206;&#x6BB5;&#x957F;&#x5EA6;&#x548C;&#x7AEF;&#x53E3;&#x53F7;&#xFF09;&#x4F1A;&#x5305;&#x542B;&#x5728;&#x5185;&#x3002;&#x6839;&#x636E;TCP&#x72B6;&#x6001;&#x53EF;&#x53D1;&#x9001;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x3002;</p>
<p>&#x4E8B;&#x5B9E;&#x4E0A;&#xFF0C;&#x5F53;&#x524D;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#x4F7F;&#x7528;&#x4E86;&#x6821;&#x9A8C;&#x5378;&#x8F7D;&#xFF08;checksum offload&#xFF09;&#xFF0C;TCP&#x6821;&#x9A8C;&#x548C;&#x4F1A;&#x7531;NIC&#x8BA1;&#x7B97;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5185;&#x6838;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x4E3A;&#x4E86;&#x89E3;&#x91CA;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x8FD8;&#x662F;&#x5047;&#x8BBE;&#x5185;&#x6838;&#x8BA1;&#x7B97;&#x6821;&#x9A8C;&#x548C;&#x3002;<br>&#x88AB;&#x521B;&#x5EFA;&#x7684;TCP&#x5206;&#x6BB5;&#x7EE7;&#x7EED;&#x8D70;&#x5230;&#x4E0B;&#x9762;&#x7684;IP&#x5C42;&#x3002;IP&#x5C42;&#x5411;TCP&#x5206;&#x6BB5;&#x4E2D;&#x589E;&#x52A0;&#x4E86;IP&#x5934;&#x5E76;&#x4E14;&#x6267;&#x884C;&#x4E86;IP&#x8DEF;&#x7531;&#xFF08;<strong>IP routing</strong>&#xFF09;&#x3002;IP&#x8DEF;&#x7531;&#x662F;&#x5BFB;&#x627E;&#x5230;&#x8FBE;&#x76EE;&#x7684;IP&#x7684;&#x4E0B;&#x4E00;&#x8DF3;IP&#x5730;&#x5740;&#x7684;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x5728;IP&#x5C42;&#x8BA1;&#x7B97;&#x5E76;&#x589E;&#x52A0;&#x4E86;IP&#x5934;&#x6821;&#x9A8C;&#x548C;&#x4E4B;&#x540E;&#xFF0C;&#x5B83;&#x628A;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5230;&#x94FE;&#x8DEF;&#x5C42;&#x3002;&#x94FE;&#x8DEF;&#x5C42;&#x901A;&#x8FC7;&#x5730;&#x5740;&#x89E3;&#x6790;&#x534F;&#x8BAE;&#xFF08;Address Resolution Protocol&#xFF0C;ARP&#xFF09;&#x641C;&#x7D22;&#x4E0B;&#x4E00;&#x8DF3;IP&#x5730;&#x5740;&#x5BF9;&#x5E94;&#x7684;MAC&#x5730;&#x5740;&#x3002;&#x4E4B;&#x540E;&#x5B83;&#x4F1A;&#x5411;&#x6570;&#x636E;&#x5305;&#x4E2D;&#x589E;&#x52A0;&#x94FE;&#x8DEF;&#x5934;&#xFF0C;&#x5728;&#x589E;&#x52A0;&#x94FE;&#x8DEF;&#x5934;&#x4E4B;&#x540E;&#x4E3B;&#x673A;&#x8981;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x5305;&#x5C31;&#x662F;&#x5B8C;&#x6574;&#x7684;&#x4E86;&#x3002;</p>
<p>&#x5728;&#x6267;&#x884C;IP&#x8DEF;&#x7531;&#x65F6;&#xFF0C;&#x4F1A;&#x9009;&#x62E9;&#x4E00;&#x4E2A;&#x4F20;&#x8F93;&#x63A5;&#x53E3;&#xFF08;NIC&#xFF09;&#x3002;&#x63A5;&#x53E3;&#x88AB;&#x7528;&#x4E8E;&#x628A;&#x6570;&#x636E;&#x5305;&#x4F20;&#x9001;&#x81F3;&#x4E0B;&#x4E00;&#x8DF3;IP&#x3002;&#x4E8E;&#x662F;&#xFF0C;&#x7528;&#x4E8E;&#x53D1;&#x9001;&#x7684;NIC&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x88AB;&#x8C03;&#x7528;&#x4E86;&#x3002;</p>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x6B63;&#x5728;&#x6267;&#x884C;&#x6570;&#x636E;&#x5305;&#x6355;&#x83B7;&#x7A0B;&#x5E8F;&#xFF08;&#x4F8B;&#x5982;tcpdump&#x6216;wireshark&#xFF09;&#x7684;&#x8BDD;&#xFF0C;&#x5185;&#x6838;&#x5C06;&#x628A;&#x6570;&#x636E;&#x5305;&#x62F7;&#x8D1D;&#x5230;&#x8FD9;&#x4E9B;&#x7A0B;&#x5E8F;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x3002;&#x7528;&#x76F8;&#x540C;&#x7684;&#x65B9;&#x5F0F;&#xFF0C;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#x5305;&#x76F4;&#x63A5;&#x5728;&#x9A71;&#x52A8;&#x88AB;&#x6355;&#x83B7;&#x3002;&#x901A;&#x5E38;&#x6765;&#x8BF4;&#xFF0C;traffic shaper&#xFF08;&#x6CA1;&#x61C2;&#xFF09;&#x51FD;&#x6570;&#x88AB;&#x5B9E;&#x73B0;&#x4EE5;&#x5728;&#x8FD9;&#x4E2A;&#x5C42;&#x4E0A;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#xFF08;&#x4E0E;&#x5185;&#x6838;&#xFF09;&#x901A;&#x8FC7;&#x8BF7;&#x6C42;NIC&#x5236;&#x9020;&#x5546;&#x5B9A;&#x4E49;&#x7684;&#x901A;&#x8BAF;&#x534F;&#x8BAE;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x3002;</p>
<p>&#x5728;&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x5305;&#x4F20;&#x8F93;&#x8BF7;&#x6C42;&#x4E4B;&#x540E;&#xFF0C;NIC&#x628A;&#x6570;&#x636E;&#x5305;&#x4ECE;&#x7CFB;&#x7EDF;&#x5185;&#x5B58;&#x4E2D;&#x62F7;&#x8D1D;&#x5230;&#x5B83;&#x81EA;&#x5DF1;&#x7684;&#x5185;&#x5B58;&#x4E2D;&#xFF0C;&#x4E4B;&#x540E;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x5230;&#x7F51;&#x7EDC;&#x4E0A;&#x3002;&#x5728;&#x6B64;&#x65F6;&#xFF0C;&#x7531;&#x4E8E;&#x8981;&#x9075;&#x5B88;&#x4EE5;&#x592A;&#x7F51;&#x6807;&#x51C6;&#xFF08;Ethernet standard&#xFF09;&#xFF0C;NIC&#x4F1A;&#x5411;&#x6570;&#x636E;&#x5305;&#x4E2D;&#x589E;&#x52A0;&#x5E27;&#x95F4;&#x9699;&#xFF08;Inter-Frame Gap&#xFF0C;IFG&#xFF09;&#xFF0C;&#x540C;&#x6B65;&#x7801;&#xFF08;preamble&#xFF09;&#x548C;crc&#x6821;&#x9A8C;&#x548C;&#x3002;&#x5E27;&#x95F4;&#x9699;&#x548C;&#x540C;&#x6B65;&#x7801;&#x7528;&#x4E8E;&#x533A;&#x5206;&#x6570;&#x636E;&#x5305;&#x7684;&#x5F00;&#x59CB;&#xFF08;&#x7F51;&#x7EDC;&#x672F;&#x8BED;&#x53EB;&#x505A;&#x5E27;&#xFF0C;framing&#xFF09;&#xFF0C;crc&#x7528;&#x4E8E;&#x4FDD;&#x62A4;&#x6570;&#x636E;&#xFF08;&#x4E0E;TCP&#x6216;&#x8005;IP&#x6821;&#x9A8C;&#x548C;&#x7684;&#x76EE;&#x7684;&#x76F8;&#x540C;&#xFF09;&#x3002;NIC&#x4F1A;&#x57FA;&#x4E8E;&#x4EE5;&#x592A;&#x7F51;&#x7684;&#x7269;&#x7406;&#x901F;&#x5EA6;&#x548C;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x51B3;&#x5B9A;&#x6570;&#x636E;&#x5305;&#x5F00;&#x59CB;&#x4F20;&#x8F93;&#x7684;&#x65F6;&#x95F4;&#x3002;It is like getting the floor and speaking in a conference room.&#xFF08;&#x6CA1;&#x770B;&#x61C2;&#xFF09;</p>
<p>&#x5F53;NIC&#x53D1;&#x9001;&#x4E86;&#x6570;&#x636E;&#x5305;&#xFF0C;NIC&#x4F1A;&#x5728;&#x4E3B;&#x673A;&#x7684;CPU&#x4E0A;&#x4EA7;&#x751F;&#x4E2D;&#x65AD;&#x3002;&#x6240;&#x6709;&#x7684;&#x4E2D;&#x65AD;&#x4F1A;&#x6709;&#x81EA;&#x5DF1;&#x7684;&#x4E2D;&#x65AD;&#x53F7;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4F1A;&#x7528;&#x8FD9;&#x4E2A;&#x4E2D;&#x65AD;&#x53F7;&#x67E5;&#x627E;&#x5408;&#x9002;&#x7684;&#x7A0B;&#x5E8F;&#x53BB;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x3002;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5728;&#x542F;&#x52A8;&#x65F6;&#x4F1A;&#x6CE8;&#x518C;&#x4E00;&#x4E2A;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x7684;&#x51FD;&#x6570;&#x3002;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E4B;&#x540E;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4F1A;&#x628A;&#x5DF2;&#x53D1;&#x9001;&#x7684;&#x6570;&#x636E;&#x5305;&#x8FD4;&#x56DE;&#x7ED9;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x3002;</p>
<p>&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#x6211;&#x4EEC;&#x8BA8;&#x8BBA;&#x4E86;&#x5F53;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6267;&#x884C;&#x4E86;write&#x4E4B;&#x540E;&#xFF0C;&#x6570;&#x636E;&#x6D41;&#x7ECF;&#x5185;&#x6838;&#x548C;&#x8BBE;&#x5907;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x9664;&#x4E86;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x76F4;&#x63A5;&#x8C03;&#x7528;write&#x4E4B;&#x5916;&#xFF0C;&#x5185;&#x6838;&#x4E5F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8C03;&#x7528;TCP&#x4F20;&#x8F93;&#x6570;&#x636E;&#x5305;&#x3002;&#x6BD4;&#x5982;&#x5F53;&#x63A5;&#x6536;&#x5230;ACK&#x5E76;&#x4E14;&#x5F97;&#x77E5;&#x63A5;&#x6536;&#x65B9;&#x7684;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#x589E;&#x5927;&#x4E4B;&#x540E;&#xFF0C;&#x5185;&#x6838;&#x4F1A;&#x521B;&#x5EFA;&#x5305;&#x542B;socket&#x7F13;&#x51B2;&#x533A;&#x5269;&#x4F59;&#x6570;&#x636E;&#x7684;TCP&#x7247;&#x6BB5;&#x5E76;&#x4E14;&#x628A;&#x6570;&#x636E;&#x53D1;&#x9001;&#x7ED9;&#x63A5;&#x6536;&#x8005;&#x3002;</p>
<h2 id="&#x4E94;-&#x6570;&#x636E;&#x63A5;&#x6536;"><a href="#&#x4E94;-&#x6570;&#x636E;&#x63A5;&#x6536;" class="headerlink" title="&#x4E94; &#x6570;&#x636E;&#x63A5;&#x6536;"></a>&#x4E94; &#x6570;&#x636E;&#x63A5;&#x6536;</h2><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x6570;&#x636E;&#x662F;&#x5982;&#x4F55;&#x88AB;&#x63A5;&#x6536;&#x7684;&#x3002;&#x6570;&#x636E;&#x63A5;&#x6536;&#x662F;&#x7F51;&#x7EDC;&#x6808;&#x5982;&#x4F55;&#x5904;&#x7406;&#x6D41;&#x5165;&#x6570;&#x636E;&#x5305;&#x7684;&#x8FC7;&#x7A0B;&#x3002; <strong>&#x56FE;3</strong> &#x5C55;&#x73B0;&#x4E86;&#x7F51;&#x7EDC;&#x6808;&#x5982;&#x4F55;&#x5904;&#x7406;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-1/operation_process_by_each_layer_of_tcp_ip_for_data_received.png" alt="img"></p>
<center>&#x56FE;3&#xFF1A;&#x63A5;&#x6536;&#x6570;&#x636E;&#x65F6;&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x5404;&#x5C42;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x64CD;&#x4F5C;</center>

<p>&#x9996;&#x5148;&#xFF0C;NIC&#x628A;&#x6570;&#x636E;&#x5305;&#x5199;&#x5165;&#x5B83;&#x81EA;&#x8EAB;&#x7684;&#x5185;&#x5B58;&#x3002;&#x901A;&#x8FC7;CRC&#x6821;&#x9A8C;&#x68C0;&#x67E5;&#x6570;&#x636E;&#x5305;&#x662F;&#x5426;&#x6709;&#x6548;&#xFF0C;&#x4E4B;&#x540E;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x5230;&#x4E3B;&#x673A;&#x7684;&#x5185;&#x5B58;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x8FD9;&#x91CC;&#x8BF4;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x662F;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x63D0;&#x524D;&#x5411;&#x5185;&#x6838;&#x7533;&#x8BF7;&#x597D;&#x7684;&#x4E00;&#x5757;&#x5185;&#x5B58;&#x533A;&#x57DF;&#xFF0C;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;&#x5728;&#x7F13;&#x51B2;&#x533A;&#x88AB;&#x7CFB;&#x7EDF;&#x5206;&#x914D;&#x4E4B;&#x540E;&#xFF0C;&#x9A71;&#x52A8;&#x4F1A;&#x628A;&#x8FD9;&#x90E8;&#x5206;&#x5185;&#x5B58;&#x7684;&#x5730;&#x5740;&#x548C;&#x5927;&#x5C0F;&#x544A;&#x77E5;NIC&#x3002;&#x5982;&#x679C;&#x4E3B;&#x673A;&#x6CA1;&#x6709;&#x4E3A;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5206;&#x914D;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x90A3;&#x4E48;&#x5F53;NIC&#x63A5;&#x6536;&#x5230;&#x6570;&#x636E;&#x5305;&#x65F6;&#x6709;&#x53EF;&#x80FD;&#x4F1A;&#x76F4;&#x63A5;&#x4E22;&#x5F03;&#x5B83;&#x3002;</p>
<p>&#x5728;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x5230;&#x4E3B;&#x673A;&#x7F13;&#x51B2;&#x533A;&#x4E4B;&#x540E;&#xFF0C;NIC&#x4F1A;&#x5411;&#x4E3B;&#x673A;&#x53D1;&#x51FA;&#x4E2D;&#x65AD;&#x3002;</p>
<p>&#x4E4B;&#x540E;&#xFF0C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4F1A;&#x5224;&#x65AD;&#x5B83;&#x662F;&#x5426;&#x80FD;&#x5904;&#x7406;&#x65B0;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;&#x5230;&#x76EE;&#x524D;&#x4E3A;&#x6B62;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x7531;&#x5236;&#x9020;&#x5546;&#x5B9A;&#x4E49;&#x7684;&#x7F51;&#x5361;&#x9A71;&#x52A8;&#x7684;&#x901A;&#x8BAF;&#x534F;&#x8BAE;&#x3002;</p>
<p>&#x5F53;&#x9A71;&#x52A8;&#x5E94;&#x8BE5;&#x5411;&#x4E0A;&#x5C42;&#x53D1;&#x9001;&#x6570;&#x636E;&#x5305;&#x65F6;&#xFF0C;&#x6570;&#x636E;&#x5305;&#x5FC5;&#x987B;&#x88AB;&#x653E;&#x8FDB;&#x4E00;&#x4E2A;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x80FD;&#x591F;&#x7406;&#x89E3;&#x548C;&#x4F7F;&#x7528;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x3002;&#x4F8B;&#x5982;Linux&#x7684; <strong>sk_buff</strong> &#xFF0C;&#x6216;&#x8005;BSD&#x7CFB;&#x5217;&#x5185;&#x6838;&#x7684; <strong>mbuf</strong> &#xFF0C;&#x6216;&#x8005;windows&#x7684; <strong>NET_BUFFER_LIST</strong> &#x3002;&#x9A71;&#x52A8;&#x4F1A;&#x628A;&#x6570;&#x636E;&#x5305;&#x5305;&#x88C5;&#x6210;&#x6307;&#x5B9A;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x53D1;&#x9001;&#x5230;&#x4E0A;&#x4E00;&#x5C42;&#x3002;</p>
<p>&#x94FE;&#x8DEF;&#x5C42;&#x4F1A;&#x68C0;&#x67E5;&#x6570;&#x636E;&#x5305;&#x662F;&#x5426;&#x6709;&#x6548;&#x5E76;&#x4E14;&#x89E3;&#x6790;&#x51FA;&#x4E0A;&#x5C42;&#x7684;&#x534F;&#x8BAE;&#xFF08;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#xFF09;&#x3002;&#x6B64;&#x65F6;&#x5B83;&#x4F1A;&#x5224;&#x65AD;&#x94FE;&#x8DEF;&#x5934;&#x4E2D;&#x7684;&#x4EE5;&#x592A;&#x7F51;&#x7C7B;&#x578B;&#x3002;&#xFF08;IPv4&#x7684;&#x4EE5;&#x592A;&#x7F51;&#x7C7B;&#x578B;&#x662F;0x0800&#xFF09;&#x3002;&#x5B83;&#x4F1A;&#x628A;&#x94FE;&#x8DEF;&#x5934;&#x5220;&#x6389;&#x5E76;&#x4E14;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x5230;IP&#x5C42;&#x3002;</p>
<p>IP&#x5C42;&#x540C;&#x6837;&#x4F1A;&#x68C0;&#x67E5;&#x6570;&#x636E;&#x5305;&#x662F;&#x5426;&#x6709;&#x6548;&#x3002;&#x6216;&#x8005;&#x8BF4;&#xFF0C;&#x4F1A;&#x68C0;&#x67E5;IP&#x5934;&#x6821;&#x9A8C;&#x548C;&#x3002;&#x5B83;&#x4F1A;&#x6267;&#x884C;IP&#x8DEF;&#x7531;&#x5224;&#x65AD;&#xFF0C;&#x5224;&#x65AD;&#x662F;&#x7531;&#x672C;&#x673A;&#x5904;&#x7406;&#x6570;&#x636E;&#x5305;&#x8FD8;&#x662F;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x5230;&#x5176;&#x5B83;&#x7CFB;&#x7EDF;&#x3002;&#x5982;&#x679C;&#x6570;&#x636E;&#x5305;&#x5FC5;&#x987B;&#x7531;&#x672C;&#x5730;&#x7CFB;&#x7EDF;&#x5904;&#x7406;&#xFF0C;IP&#x5C42;&#x4F1A;&#x901A;&#x8FC7;IP header&#x4E2D;&#x5F15;&#x7528;&#x7684;&#x539F;&#x578B;&#x503C;&#xFF08;proto value&#xFF09;&#x89E3;&#x6790;&#x4E0A;&#x5C42;&#x534F;&#x8BAE;&#xFF08;&#x4F20;&#x8F93;&#x534F;&#x8BAE;&#xFF09;&#x3002;TCP&#x539F;&#x578B;&#x503C;&#x4E3A;6&#x3002;&#x7CFB;&#x7EDF;&#x4F1A;&#x5220;&#x9664;IP&#x5934;&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x5230;TCP&#x5C42;&#x3002;</p>
<p>&#x5C31;&#x50CF;&#x4E4B;&#x524D;&#x7684;&#x51E0;&#x5C42;&#xFF0C;TCP&#x5C42;&#x68C0;&#x67E5;&#x6570;&#x636E;&#x5305;&#x662F;&#x5426;&#x6709;&#x6548;&#xFF0C;&#x540C;&#x65F6;&#x4F1A;&#x68C0;&#x67E5;TCP&#x6821;&#x9A8C;&#x548C;&#x3002;&#x5C31;&#x50CF;&#x4E4B;&#x524D;&#x63D0;&#x5230;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x5F53;&#x524D;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#x4F7F;&#x7528;&#x4E86;&#x6821;&#x9A8C;&#x5378;&#x8F7D;&#xFF0C;&#x90A3;&#x4E48;TCP&#x6821;&#x9A8C;&#x548C;&#x4F1A;&#x7531;NIC&#x8BA1;&#x7B97;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5185;&#x6838;&#x3002;</p>
<p>&#x4E4B;&#x540E;&#x5B83;&#x4F1A;&#x67E5;&#x627E;&#x6570;&#x636E;&#x5305;&#x5BF9;&#x5E94;&#x7684;TCP&#x63A7;&#x5236;&#x5757;&#xFF08;TCB&#xFF09;&#xFF0C;&#x8FD9;&#x65F6;&#x4F1A;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x5305;&#x4E2D;&#x7684; <code>&lt;&#x6E90;ip&#xFF0C;&#x6E90;&#x7AEF;&#x53E3;&#xFF0C;&#x76EE;&#x7684;IP&#xFF0C;&#x76EE;&#x7684;&#x7AEF;&#x53E3;&gt;</code> &#x505A;&#x6807;&#x8BC6;&#x3002;&#x5728;&#x67E5;&#x8BE2;&#x5230;&#x5BF9;&#x5E94;&#x7684;&#x8FDE;&#x63A5;&#x4E4B;&#x540E;&#xFF0C;&#x4F1A;&#x6267;&#x884C;&#x534F;&#x8BAE;&#x4E2D;&#x5B9A;&#x4E49;&#x7684;&#x64CD;&#x4F5C;&#x53BB;&#x5904;&#x7406;&#x6570;&#x636E;&#x5305;&#x3002;&#x5982;&#x679C;&#x63A5;&#x6536;&#x5230;&#x7684;&#x662F;&#x65B0;&#x6570;&#x636E;&#xFF0C;&#x6570;&#x636E;&#x4F1A;&#x88AB;&#x589E;&#x52A0;&#x5230;socket&#x7684;&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x6839;&#x636E;tcp&#x8FDE;&#x63A5;&#x7684;&#x72B6;&#x6001;&#xFF0C;&#x6B64;&#x65F6;&#x4E5F;&#x53EF;&#x4EE5;&#x53D1;&#x9001;&#x65B0;&#x7684;TCP&#x5305;&#xFF08;&#x6BD4;&#x5982;&#x53D1;&#x9001;ACK&#x5305;&#xFF09;&#x3002;&#x6B64;&#x65F6;&#xFF0C;TCP/IP&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x7684;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x3002;</p>
<p>socket&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5927;&#x5C0F;&#x5C31;&#x662F;TCP&#x63A5;&#x6536;&#x7A97;&#x53E3;&#x3002;TCP&#x541E;&#x5410;&#x91CF;&#x4F1A;&#x968F;&#x7740;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#x53D8;&#x5927;&#x800C;&#x589E;&#x52A0;&#x3002;&#x8FC7;&#x53BB;socket&#x7F13;&#x51B2;&#x533A;&#x5927;&#x5C0F;&#x662F;&#x5E94;&#x7528;&#x6216;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;&#x914D;&#x7F6E;&#x7684;&#x5B9A;&#x503C;&#x3002;&#x6700;&#x65B0;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#x53BB;&#x81EA;&#x52A8;&#x51B3;&#x5B9A;&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5927;&#x5C0F;&#x3002;</p>
<p>&#x5F53;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;read&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x65F6;&#xFF0C;&#x7A0B;&#x5E8F;&#x4F1A;&#x5207;&#x6362;&#x5230;&#x5185;&#x6838;&#x533A;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x628A;socket&#x63A5;&#x6536;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&#x7528;&#x6237;&#x533A;&#x3002;&#x62F7;&#x8D1D;&#x540E;&#x7684;&#x6570;&#x636E;&#x4F1A;&#x4ECE;socket&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x79FB;&#x9664;&#x3002;&#x4E4B;&#x540E;TCP&#x4F1A;&#x88AB;&#x8C03;&#x7528;&#xFF0C;TCP&#x4F1A;&#x589E;&#x52A0;&#x63A5;&#x6536;&#x7A97;&#x53E3;&#x7684;&#x5927;&#x5C0F;&#xFF08;&#x56E0;&#x4E3A;&#x7F13;&#x51B2;&#x533A;&#x6709;&#x4E86;&#x65B0;&#x7A7A;&#x95F4;&#xFF09;&#x3002;&#x5E76;&#x4E14;&#x4F1A;&#x6839;&#x636E;&#x534F;&#x8BAE;&#x72B6;&#x6001;&#x53D1;&#x9001;&#x6570;&#x636E;&#x5305;&#x3002;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x5305;&#x4F20;&#x9001;&#xFF0C;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7ED3;&#x675F;&#x3002;</p>
<h2 id="&#x516D;-&#x7F51;&#x7EDC;&#x6808;&#x5F00;&#x53D1;&#x65B9;&#x5411;"><a href="#&#x516D;-&#x7F51;&#x7EDC;&#x6808;&#x5F00;&#x53D1;&#x65B9;&#x5411;" class="headerlink" title="&#x516D; &#x7F51;&#x7EDC;&#x6808;&#x5F00;&#x53D1;&#x65B9;&#x5411;"></a>&#x516D; &#x7F51;&#x7EDC;&#x6808;&#x5F00;&#x53D1;&#x65B9;&#x5411;</h2><p>&#x5230;&#x6B64;&#x4E3A;&#x6B62;&#x63CF;&#x8FF0;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x51FD;&#x6570;&#x90FD;&#x662F;&#x6700;&#x57FA;&#x7840;&#x7684;&#x51FD;&#x6570;&#x3002;&#x5728;1990&#x5E74;&#x4EE3;&#x65E9;&#x671F;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#x51FD;&#x6570;&#x53EA;&#x6BD4;&#x4E0A;&#x9762;&#x63CF;&#x8FF0;&#x7684;&#x591A;&#x4E00;&#x4E9B;&#x3002;&#x4F46;&#x662F;&#x6700;&#x8FD1;&#x7684;&#x968F;&#x7740;&#x7F51;&#x7EDC;&#x6808;&#x7684;&#x5B9E;&#x73B0;&#x5C42;&#x6B21;&#x53D8;&#x9AD8;&#xFF0C;&#x7F51;&#x7EDC;&#x6808;&#x589E;&#x52A0;&#x4E86;&#x5F88;&#x591A;&#x51FD;&#x6570;&#x548C;&#x590D;&#x6742;&#x5EA6;&#x3002;</p>
<p>&#x6700;&#x65B0;&#x7684;&#x7F51;&#x7EDC;&#x6808;&#x53EF;&#x4EE5;&#x6309;&#x4EE5;&#x4E0B;&#x9700;&#x6C42;&#x5206;&#x7C7B;&#xFF1A;</p>
<h4 id="6-1-&#x64CD;&#x4F5C;&#x62A5;&#x6587;&#x5904;&#x7406;&#x8FC7;&#x7A0B;"><a href="#6-1-&#x64CD;&#x4F5C;&#x62A5;&#x6587;&#x5904;&#x7406;&#x8FC7;&#x7A0B;" class="headerlink" title="6.1.&#x64CD;&#x4F5C;&#x62A5;&#x6587;&#x5904;&#x7406;&#x8FC7;&#x7A0B;"></a>6.1.&#x64CD;&#x4F5C;&#x62A5;&#x6587;&#x5904;&#x7406;&#x8FC7;&#x7A0B;</h4><p>&#x5B83;&#x5305;&#x62EC;&#x7C7B;&#x4F3C;Netfilter&#xFF08;firewall,NAT&#xFF09;&#x7684;&#x529F;&#x80FD;&#x548C;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x3002;&#x901A;&#x8FC7;&#x5728;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x4E2D;&#x589E;&#x52A0;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x53EF;&#x4EE5;&#x7531;&#x7528;&#x6237;&#x63A7;&#x5236;&#x5B9E;&#x73B0;&#x4E0D;&#x540C;&#x7684;&#x529F;&#x80FD;&#x3002;</p>
<h4 id="6-2-&#x534F;&#x8BAE;&#x6027;&#x80FD;"><a href="#6-2-&#x534F;&#x8BAE;&#x6027;&#x80FD;" class="headerlink" title="6.2.&#x534F;&#x8BAE;&#x6027;&#x80FD;"></a>6.2.&#x534F;&#x8BAE;&#x6027;&#x80FD;</h4><p>&#x7528;&#x4E8E;&#x6539;&#x8FDB;&#x7279;&#x5B9A;&#x7F51;&#x7EDC;&#x73AF;&#x5883;&#x4E0B;&#x7684;&#x541E;&#x5410;&#x91CF;&#x3001;&#x5EF6;&#x8FDF;&#x548C;&#x53EF;&#x9760;&#x6027;&#x3002;&#x5178;&#x578B;&#x4F8B;&#x5B50;&#x662F;&#x589E;&#x52A0;&#x7684;&#x6D41;&#x91CF;&#x63A7;&#x5236;&#x7B97;&#x6CD5;&#x548C;&#x989D;&#x5916;&#x7684;&#x7C7B;&#x4F3C;SACK&#x7684;TCP&#x529F;&#x80FD;&#x3002;&#x7531;&#x4E8E;&#x5DF2;&#x7ECF;&#x8D85;&#x51FA;&#x4E86;&#x8303;&#x56F4;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x6DF1;&#x5165;&#x8BA8;&#x8BBA;&#x534F;&#x8BAE;&#x6539;&#x8FDB;&#x4E86;&#x3002;</p>
<h4 id="6-3-&#x9AD8;&#x6548;&#x7684;&#x62A5;&#x6587;&#x5904;&#x7406;"><a href="#6-3-&#x9AD8;&#x6548;&#x7684;&#x62A5;&#x6587;&#x5904;&#x7406;" class="headerlink" title="6.3.&#x9AD8;&#x6548;&#x7684;&#x62A5;&#x6587;&#x5904;&#x7406;"></a>6.3.&#x9AD8;&#x6548;&#x7684;&#x62A5;&#x6587;&#x5904;&#x7406;</h4><p>&#x9AD8;&#x6548;&#x7684;&#x62A5;&#x6587;&#x5904;&#x7406;&#x6307;&#x7684;&#x662F;&#x901A;&#x8FC7;&#x964D;&#x4F4E;&#x5904;&#x7406;&#x62A5;&#x6587;&#x7684;CPU&#x5468;&#x671F;&#x3001;&#x5185;&#x5B58;&#x7528;&#x91CF;&#x548C;&#x5904;&#x7406;&#x62A5;&#x6587;&#x9700;&#x8981;&#x8BBF;&#x95EE;&#x5185;&#x5B58;&#x7684;&#x6B21;&#x6570;&#x8FD9;&#x4E9B;&#x624B;&#x6BB5;&#xFF0C;&#x6765;&#x63D0;&#x5347;&#x6BCF;&#x79D2;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x7684;&#x62A5;&#x6587;&#x6570;&#x91CF;&#x3002;&#x6709;&#x5F88;&#x591A;&#x964D;&#x4F4E;&#x7CFB;&#x7EDF;&#x5EF6;&#x8FDF;&#x7684;&#x5C1D;&#x8BD5;&#xFF0C;&#x6BD4;&#x5982;&#x534F;&#x8BAE;&#x6808;&#x5E76;&#x884C;&#x5904;&#x7406;&#xFF08;stack parallel processing&#xFF09;&#x3001;&#x62A5;&#x5934;&#x9884;&#x5904;&#x7406;&#xFF08;header prediction&#xFF09;&#x3001;&#x96F6;&#x62F7;&#x8D1D;&#xFF08;zero-copy&#xFF09;&#x3001;&#x5355;&#x6B21;&#x62F7;&#x8D1D;&#xFF08;single-copy&#xFF09;&#x3001;&#x6821;&#x9A8C;&#x5378;&#x8F7D;&#xFF08;checksum offload&#xFF09;&#x3001;TSO&#xFF08;TCP Segment Offload&#xFF09;&#x3001;LRO&#xFF08;Large Receive Offload&#xFF09;&#x3001;RSS&#xFF08;Receive Side Scaling&#xFF09;&#x7B49;&#x3002;</p>
<h2 id="&#x4E03;-&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x6D41;&#x7A0B;&#x63A7;&#x5236;"><a href="#&#x4E03;-&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x6D41;&#x7A0B;&#x63A7;&#x5236;" class="headerlink" title="&#x4E03; &#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x6D41;&#x7A0B;&#x63A7;&#x5236;"></a>&#x4E03; &#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x6D41;&#x7A0B;&#x63A7;&#x5236;</h2><p>&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;Linux&#x7F51;&#x7EDC;&#x6808;&#x5185;&#x90E8;&#x6D41;&#x7A0B;&#x7684;&#x7EC6;&#x8282;&#x3002;&#x7F51;&#x7EDC;&#x6808;&#x57FA;&#x4E8E;&#x4E8B;&#x4EF6;&#x9A71;&#x52A8;&#x7684;&#x65B9;&#x5F0F;&#x8FD0;&#x884C;&#xFF0C;&#x5728;&#x4E8B;&#x4EF6;&#x4EA7;&#x751F;&#x65F6;&#x505A;&#x51FA;&#x76F8;&#x5E94;&#x7684;&#x53CD;&#x5E94;&#x3002;&#x56E0;&#x6B64;&#xFF0C;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x7EBF;&#x7A0B;&#x53BB;&#x8FD0;&#x884C;&#x7F51;&#x7EDC;&#x6808;&#x3002; <strong>&#x56FE;1</strong> &#x548C; <strong>&#x56FE;3</strong> &#x5C55;&#x793A;&#x4E86;&#x6700;&#x7B80;&#x5355;&#x7684;&#x63A7;&#x5236;&#x6D41;&#x7A0B;&#x56FE;&#x3002; <strong>&#x56FE;4</strong> &#x8BF4;&#x660E;&#x4E86;&#x66F4;&#x52A0;&#x51C6;&#x786E;&#x7684;&#x63A7;&#x5236;&#x6D41;&#x7A0B;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-1/control_flow_in_stack.png" alt="img"></p>
<center>&#x56FE;4&#xFF1A;&#x7F51;&#x7EDC;&#x6808;&#x4E2D;&#x7684;&#x6D41;&#x7A0B;&#x63A7;&#x5236;</center>

<p>&#x5728;&#x56FE;4&#x4E2D;&#x7684;Flow(1)&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x901A;&#x8FC7;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53BB;&#x6267;&#x884C;&#xFF08;&#x4F7F;&#x7528;&#xFF09;TCP&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x8C03;&#x7528;read&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x6216;&#x8005;wirte&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x5E76;&#x6267;&#x884C;TCP&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x4E00;&#x6B65;&#x91CC;&#x6CA1;&#x6709;&#x6570;&#x636E;&#x5305;&#x4F20;&#x8F93;&#x3002;</p>
<p>Flow(2)&#x8DDF;Flow(1)&#x7C7B;&#x4F3C;&#xFF0C;&#x5728;&#x6267;&#x884C;TCP&#x540E;&#x9700;&#x8981;&#x4F20;&#x8F93;&#x62A5;&#x6587;&#x3002;&#x5B83;&#x4F1A;&#x521B;&#x5EFA;&#x6570;&#x636E;&#x5305;&#x5E76;&#x4E14;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x7ED9;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4E0A;&#x5C42;&#x6709;&#x4E00;&#x4E2A;&#x961F;&#x5217;&#x3002;&#x6570;&#x636E;&#x5305;&#x9996;&#x5148;&#x88AB;&#x653E;&#x5165;&#x961F;&#x5217;&#xFF0C;&#x4E4B;&#x540E;&#x961F;&#x5217;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x51B3;&#x5B9A;&#x4F55;&#x65F6;&#x628A;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x7ED9;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;&#x8FD9;&#x4E2A;&#x662F;Linux&#x7684;&#x961F;&#x5217;&#x89C4;&#x5219;&#xFF08;queue discipline,qdisc&#xFF09;&#x3002;Linux&#x7684;&#x4F20;&#x8F93;&#x7BA1;&#x7406;&#x51FD;&#x6570;&#x7528;&#x6765;&#x7BA1;&#x7406;&#x961F;&#x5217;&#x89C4;&#x5219;&#x3002;&#x9ED8;&#x8BA4;&#x7684;&#x961F;&#x5217;&#x89C4;&#x5219;&#x662F;&#x7B80;&#x5355;&#x7684;&#x5148;&#x5165;&#x5148;&#x51FA;&#x961F;&#x5217;&#x3002;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x5176;&#x5B83;&#x7684;&#x961F;&#x5217;&#x7BA1;&#x7406;&#x89C4;&#x5219;&#xFF0C;&#x53EF;&#x4EE5;&#x6267;&#x884C;&#x591A;&#x79CD;&#x64CD;&#x4F5C;&#xFF0C;&#x4F8B;&#x5982;&#x4EBA;&#x9020;&#x6570;&#x636E;&#x4E22;&#x5305;&#x3001;&#x6570;&#x636E;&#x5305;&#x5EF6;&#x8FDF;&#x3001;&#x901A;&#x4FE1;&#x6BD4;&#x7387;&#x9650;&#x5236;&#xFF0C;&#x7B49;&#x7B49;&#x3002;&#x5728;Flow(1)&#x548C;Flow(2)&#x4E2D;&#xFF0C;&#x9A71;&#x52A8;&#x548C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x5904;&#x4E8E;&#x76F8;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x3002;</p>
<p>Flow(3)&#x5C55;&#x793A;&#x4E86;TCP&#x4F7F;&#x7528;&#x7684;&#x5B9A;&#x65F6;&#x5668;&#x8D85;&#x65F6;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5F53; <strong>TIME_WAIT</strong> &#x5B9A;&#x65F6;&#x5668;&#x8D85;&#x65F6;&#x540E;&#xFF0C;TCP&#x88AB;&#x8C03;&#x7528;&#x5E76;&#x5220;&#x9664;&#x8FDE;&#x63A5;&#x3002;</p>
<p>&#x7C7B;&#x4F3C;Flow(3)&#xFF0C;Flow&#xFF08;4&#xFF09;&#x662F;TCP&#x7684;&#x5B9A;&#x65F6;&#x5668;&#x8D85;&#x65F6;&#x5E76;&#x4E14;&#x9700;&#x8981;&#x53D1;&#x9001;TCP&#x6267;&#x884C;&#x7ED3;&#x679C;&#x6570;&#x636E;&#x5305;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x6BD4;&#x5982;&#xFF0C;&#x5F53;&#x91CD;&#x4F20;&#x8BA1;&#x65F6;&#x5668;&#x8D85;&#x65F6;&#x540E;&#xFF0C;&#x4F1A;&#x53D1;&#x9001;&#x201C;&#x6CA1;&#x6709;&#x6536;&#x5230;ACK&#x201D;&#x6570;&#x636E;&#x5305;&#x3002;</p>
<p>Flow&#xFF08;3&#xFF09;&#x548C;Flow&#xFF08;4&#xFF09;&#x5C55;&#x793A;&#x4E86;&#x5B9A;&#x65F6;&#x5668;&#x8F6F;&#x4E2D;&#x65AD;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x3002;</p>
<p>&#x5F53;NIC&#x9A71;&#x52A8;&#x6536;&#x5230;&#x4E2D;&#x65AD;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x91CA;&#x653E;&#x5DF2;&#x7ECF;&#x4F20;&#x8F93;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;&#x5728;&#x5927;&#x591A;&#x6570;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x9A71;&#x52A8;&#x7684;&#x6267;&#x884C;&#x8FC7;&#x7A0B;&#x5230;&#x8FD9;&#x91CC;&#x5C31;&#x7ED3;&#x675F;&#x4E86;&#x3002;Flow&#xFF08;5&#xFF09;&#x662F;&#x6570;&#x636E;&#x5305;&#x79EF;&#x7D2F;&#x5728;&#x4F20;&#x8F93;&#x961F;&#x5217;&#x91CC;&#x7684;&#x60C5;&#x51B5;&#x3002;&#x9A71;&#x52A8;&#x8BF7;&#x6C42;&#x8F6F;&#x4E2D;&#x65AD;&#xFF0C;&#x4E4B;&#x540E;&#x8F6F;&#x4E2D;&#x65AD;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x628A;&#x4F20;&#x8F93;&#x961F;&#x5217;&#x91CC;&#x5806;&#x79EF;&#x7684;&#x6570;&#x636E;&#x5305;&#x53D1;&#x9001;&#x7ED9;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x5F53;NIC&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x63A5;&#x6536;&#x5230;&#x4E2D;&#x65AD;&#x5E76;&#x4E14;&#x53D1;&#x73B0;&#x6709;&#x65B0;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#x5305;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x8BF7;&#x6C42;&#x8F6F;&#x4E2D;&#x65AD;&#x3002;&#x8F6F;&#x4E2D;&#x65AD;&#x4F1A;&#x8C03;&#x7528;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5904;&#x7406;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x5E76;&#x4E14;&#x628A;&#x4ED6;&#x4EEC;&#x4F20;&#x9001;&#x5230;&#x4E0A;&#x4E00;&#x5C42;&#x3002;&#x5728;Linux&#x4E2D;&#xFF0C;&#x4E0A;&#x9762;&#x63CF;&#x8FF0;&#x7684;&#x5904;&#x7406;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x8FC7;&#x7A0B;&#x53EB;&#x505A;New API&#xFF08;NAPI&#xFF09;&#x3002;&#x5B83;&#x548C;&#x8F6E;&#x8BE2;&#x7C7B;&#x4F3C;&#xFF0C;&#x56E0;&#x4E3A;&#x9A71;&#x52A8;&#x5E76;&#x4E0D;&#x76F4;&#x63A5;&#x628A;&#x6570;&#x636E;&#x5305;&#x4F20;&#x9001;&#x5230;&#x4E0A;&#x4E00;&#x5C42;&#xFF0C;&#x800C;&#x662F;&#x4E0A;&#x5C42;&#x76F4;&#x63A5;&#x6765;&#x53D6;&#x6570;&#x636E;&#x3002;&#x5B9E;&#x9645;&#x4EE3;&#x7801;&#x4E2D;&#x53EB;&#x505A;NAPI poll &#x6216; poll&#x3002;</p>
<p>Flow&#xFF08;6&#xFF09;&#x5C55;&#x793A;&#x4E86;TCP&#x6267;&#x884C;&#x5B8C;&#x6210;&#xFF0C;Flow&#xFF08;7&#xFF09;&#x5C55;&#x793A;&#x4E86;&#x9700;&#x8981;&#x66F4;&#x591A;&#x6570;&#x636E;&#x5305;&#x4F20;&#x8F93;&#x7684;&#x60C5;&#x51B5;&#x3002;Flow&#xFF08;5&#x3001;6&#x3001;7&#xFF09;&#x7684;NIC&#x4E2D;&#x65AD;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x8F6F;&#x4E2D;&#x65AD;&#x6267;&#x884C;&#x7684;&#x3002;</p>
<h2 id="&#x516B;-&#x5982;&#x4F55;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;"><a href="#&#x516B;-&#x5982;&#x4F55;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;" class="headerlink" title="&#x516B; &#x5982;&#x4F55;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;"></a>&#x516B; &#x5982;&#x4F55;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;</h2><p>&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x662F;&#x590D;&#x6742;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x4F60;&#x9700;&#x8981;&#x4E86;&#x89E3;&#x6570;&#x636E;&#x5305;&#x63A5;&#x6536;&#x548C;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x4E2D;&#x7684;&#x548C;&#x6027;&#x80FD;&#x76F8;&#x5173;&#x7684;&#x95EE;&#x9898;&#x3002;&#x56FE;5&#x5C55;&#x793A;&#x4E86;&#x4E00;&#x6B21;&#x4E2D;&#x65AD;&#x7684;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x3002;</p>
<p><img src="/2016/Understand-TCP-IP-network-1/processing_interrupt_softirq_and_received_packet.png" alt="img"></p>
<center>&#x56FE;5&#xFF1A;&#x5904;&#x7406;&#x4E2D;&#x65AD;&#x3001;&#x8F6F;&#x4E2D;&#x65AD;&#x548C;&#x63A5;&#x6536;&#x6570;&#x636E;</center>

<p>&#x5047;&#x8BBE;CPU0&#x6B63;&#x5728;&#x6267;&#x884C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x3002;&#x5728;&#x6B64;&#x65F6;&#xFF0C;NIC&#x63A5;&#x6536;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x5E76;&#x4E14;&#x5728;CPU0&#x4E0A;&#x4EA7;&#x751F;&#x4E86;&#x4E2D;&#x65AD;&#x3002;CPU0&#x6267;&#x884C;&#x4E86;&#x5185;&#x6838;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;(irq)&#x3002;&#x8FD9;&#x4E2A;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x5173;&#x8054;&#x4E86;&#x4E00;&#x4E2A;&#x4E2D;&#x65AD;&#x53F7;&#x5E76;&#x4E14;&#x5185;&#x6838;&#x4F1A;&#x8C03;&#x7528;&#x9A71;&#x52A8;&#x91CC;&#x5BF9;&#x5E94;&#x7684;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;&#x9A71;&#x52A8;&#x5728;&#x91CA;&#x653E;&#x5DF2;&#x7ECF;&#x4F20;&#x8F93;&#x7684;&#x6570;&#x636E;&#x5305;&#x4E4B;&#x540E;&#x8C03;&#x7528; <code>napi_schedule()</code> &#x51FD;&#x6570;&#x53BB;&#x5904;&#x7406;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#xFF0C;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;&#x8BF7;&#x6C42;&#x8F6F;&#x4E2D;&#x65AD;&#x3002;</p>
<p>&#x5728;&#x6267;&#x884C;&#x4E86;&#x9A71;&#x52A8;&#x7684;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x540E;&#xFF0C;&#x63A7;&#x5236;&#x6743;&#x88AB;&#x8F6C;&#x79FB;&#x5230;&#x5185;&#x6838;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;&#x5185;&#x6838;&#x4E2D;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x4F1A;&#x6267;&#x884C;&#x8F6F;&#x4E2D;&#x65AD;&#x7684;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x3002;</p>
<p>&#x5728;&#x4E2D;&#x65AD;&#x4E0A;&#x4E0B;&#x6587;&#x88AB;&#x6267;&#x884C;&#x4E4B;&#x540E;&#xFF0C;&#x8F6F;&#x4E2D;&#x65AD;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4F1A;&#x88AB;&#x6267;&#x884C;&#x3002;&#x4E2D;&#x65AD;&#x4E0A;&#x4E0B;&#x6587;&#x548C;&#x8F6F;&#x4E2D;&#x65AD;&#x4E0A;&#x4E0B;&#x6587;&#x4F1A;&#x901A;&#x8FC7;&#x76F8;&#x540C;&#x7684;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x4F1A;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684;&#x6808;&#x3002;&#x5E76;&#x4E14;&#x4E2D;&#x65AD;&#x4E0A;&#x4E0B;&#x6587;&#x4F1A;&#x5C4F;&#x853D;&#x786C;&#x4EF6;&#x4E2D;&#x65AD;&#xFF1B;&#x800C;&#x8F6F;&#x4E2D;&#x65AD;&#x4E0A;&#x4E0B;&#x6587;&#x4E0D;&#x4F1A;&#x5C4F;&#x853D;&#x786C;&#x4EF6;&#x4E2D;&#x65AD;&#x3002;</p>
<p>&#x5904;&#x7406;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x7684;&#x8F6F;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x662F; <code>net_rx_action()</code> &#x51FD;&#x6570;&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x4F1A;&#x8C03;&#x7528;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x7684; <code>poll()</code> &#x51FD;&#x6570;&#x3002;&#x800C; <code>poll()</code> &#x51FD;&#x6570;&#x4F1A;&#x8C03;&#x7528; <code>netif_receive_skb()</code> &#x51FD;&#x6570;&#xFF0C;&#x5E76;&#x628A;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5305;&#x4E00;&#x4E2A;&#x63A5;&#x4E00;&#x4E2A;&#x7684;&#x53D1;&#x9001;&#x5230;&#x4E0A;&#x5C42;&#x3002;&#x5728;&#x8F6F;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x7ED3;&#x675F;&#x540E;&#xFF0C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4F1A;&#x4ECE;&#x505C;&#x6B62;&#x7684;&#x4F4D;&#x7F6E;&#x91CD;&#x65B0;&#x5F00;&#x59CB;&#x6267;&#x884C;&#x3002;&#xFF08;After processing the softirq, the application restarts execution from the stopped point in order to request a system call.&#x6CA1;&#x592A;&#x660E;&#x767D;&#x8FD9;&#x4E00;&#x53E5;&#x7684;system call&#x662F;&#x5565;&#x610F;&#x601D;&#xFF09;</p>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x63A5;&#x6536;&#x4E2D;&#x65AD;&#x8BF7;&#x6C42;&#x7684;CPU&#x4F1A;&#x8D1F;&#x8D23;&#x5904;&#x7406;&#x63A5;&#x6536;&#x6570;&#x636E;&#x5305;&#x4ECE;&#x59CB;&#x81F3;&#x7EC8;&#x7684;&#x6574;&#x4E2A;&#x8FC7;&#x7A0B;&#x3002;&#x5728;Linux&#x3001;BSD&#x548C;Windows&#x4E2D;&#xFF0C;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x57FA;&#x672C;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#x3002;</p>
<p>&#x5F53;&#x4F60;&#x68C0;&#x67E5;&#x670D;&#x52A1;&#x5668;CPU&#x5229;&#x7528;&#x7387;&#x65F6;&#xFF0C;&#x6709;&#x65F6;&#x4F60;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;&#x670D;&#x52A1;&#x5668;&#x7684;&#x5F88;&#x591A;CPU&#x4E2D;&#x662F;&#x5426;&#x53EA;&#x6709;&#x4E00;&#x4E2A;CPU&#x5728;&#x8270;&#x96BE;&#x6267;&#x884C;&#x8F6F;&#x4E2D;&#x65AD;&#x3002;&#x8FD9;&#x4E2A;&#x73B0;&#x8C61;&#x4EA7;&#x751F;&#x7684;&#x539F;&#x56E0;&#x5C31;&#x662F;&#x4E0A;&#x6587;&#x6240;&#x89E3;&#x91CA;&#x7684;&#x6570;&#x636E;&#x5305;&#x63A5;&#x6536;&#x7684;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x3002;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x5F00;&#x53D1;&#x51FA;&#x4E86;&#x591A;&#x961F;&#x5217;NIC(multi-queue NIC)&#x3001;RSS&#x548C;RPS&#x3002;</p>
<p><code>&#x77E5;&#x8BC6;&#x5171;&#x4EAB;&#x8BB8;&#x53EF;&#x534F;&#x8BAE;</code></p>
<p><code>&#x672C;&#x4F5C;&#x54C1;&#x91C7;&#x7528;&#x77E5;&#x8BC6;&#x5171;&#x4EAB;&#x7F72;&#x540D;-&#x975E;&#x5546;&#x4E1A;&#x6027;&#x4F7F;&#x7528; 4.0 &#x56FD;&#x9645;&#x8BB8;&#x53EF;&#x534F;&#x8BAE;&#x8FDB;&#x884C;&#x8BB8;&#x53EF;&#xFF0C;&#x8F6C;&#x8F7D;&#x8BF7;&#x6CE8;&#x660E;&#x4F5C;&#x8005;&#x53CA;&#x539F;&#x7F51;&#x5740;&#x3002;</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x6765;&amp;#x81EA;: &amp;#x535A;&amp;#x5BA2; Axb&amp;#x7684;&amp;#x81EA;&amp;#x6211;&amp;#x4FEE;&amp;#x517B; http://blog.2baxb.me/archives/1174 2015/04/30&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x4E00;-&amp;#x6458;&amp;#x8981;&quot;&gt;&lt;a href=&quot;#&amp;#x4E00;-&amp;#x6458;&amp;#x8981;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E00; &amp;#x6458;&amp;#x8981;&quot;&gt;&lt;/a&gt;&amp;#x4E00; &amp;#x6458;&amp;#x8981;&lt;/h2&gt;&lt;p&gt;&amp;#x4E4B;&amp;#x524D;&amp;#x5728;&amp;#x7F51;&amp;#x4E0A;&amp;#x770B;&amp;#x5230;&amp;#x4E86;&amp;#x8FD9;&amp;#x7BC7;&amp;#x63CF;&amp;#x8FF0;tcp&amp;#x7F51;&amp;#x7EDC;&amp;#x6808;&amp;#x539F;&amp;#x7406;&amp;#x7684;&amp;#x6587;&amp;#x7AE0;&amp;#xFF0C;&amp;#x611F;&amp;#x89C9;&amp;#x4E0D;&amp;#x9519;&amp;#xFF0C;&amp;#x51B3;&amp;#x5B9A;&amp;#x62BD;&amp;#x7A7A;&amp;#x628A;&amp;#x8FD9;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x7FFB;&amp;#x8BD1;&amp;#x4E00;&amp;#x4E0B;&amp;#x3002;&amp;#x4E00;&amp;#x6765;&amp;#x91CD;&amp;#x65B0;&amp;#x6E29;&amp;#x4E60;&amp;#x4E00;&amp;#x4E0B;TCP&amp;#x76F8;&amp;#x5173;&amp;#x77E5;&amp;#x8BC6;&amp;#xFF0C;&amp;#x4E8C;&amp;#x6765;&amp;#x7EC3;&amp;#x7EC3;&amp;#x82F1;&amp;#x6587;&amp;#x3002;&amp;#x7531;&amp;#x4E8E;&amp;#x539F;&amp;#x6587;&amp;#x592A;&amp;#x957F;&amp;#xFF0C;&amp;#x8FD9;&amp;#x91CC;&amp;#x628A;&amp;#x6587;&amp;#x7AE0;&amp;#x5206;&amp;#x6210;&amp;#x4E0A;&amp;#x4E0B;&amp;#x4E24;&amp;#x90E8;&amp;#x5206;&amp;#xFF0C;&amp;#x5206;&amp;#x522B;&amp;#x5BF9;&amp;#x5E94;&amp;#x4E86;&amp;#x539F;&amp;#x7406;&amp;#x548C;&amp;#x4EE3;&amp;#x7801;&amp;#x3002; &amp;#x5F88;&amp;#x4E45;&amp;#x6CA1;&amp;#x7FFB;&amp;#x8BD1;&amp;#x6587;&amp;#x7AE0;&amp;#x4E86;&amp;#x96BE;&amp;#x514D;&amp;#x6709;&amp;#x8BEF;&amp;#xFF0C;&amp;#x5EFA;&amp;#x8BAE;&amp;#x6709;&amp;#x80FD;&amp;#x529B;&amp;#x7684;&amp;#x540C;&amp;#x5B66;&amp;#x8FD8;&amp;#x662F;&amp;#x770B;&amp;#x4E00;&amp;#x4E0B;&amp;#x539F;&amp;#x6587;&amp;#x3002;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;#x539F;&amp;#x6587;&amp;#x5730;&amp;#x5740;&amp;#xFF1A;&lt;a href=&quot;http://www.cubrid.org/blog/dev-platform/understanding-tcp-ip-network-stack/&quot;&gt;http://www.cubrid.org/blog/dev-platform/understanding-tcp-ip-network-stack/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x539F;&amp;#x4F5C;&amp;#x8005;&amp;#xFF1A;Hyeongyeop Kim&lt;/p&gt;
&lt;p&gt;&amp;#x7FFB;&amp;#x8BD1;&amp;#xFF1A;@&amp;#x86CB;&amp;#x75BC;&amp;#x7684;axb &lt;a href=&quot;http://2baxb.me&quot;&gt;http://2baxb.me&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;&amp;#x4E8C;-&amp;#x6982;&amp;#x8FF0;&quot;&gt;&lt;a href=&quot;#&amp;#x4E8C;-&amp;#x6982;&amp;#x8FF0;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x4E8C; &amp;#x6982;&amp;#x8FF0;&quot;&gt;&lt;/a&gt;&amp;#x4E8C; &amp;#x6982;&amp;#x8FF0;&lt;/h2&gt;&lt;p&gt;&amp;#x6211;&amp;#x4EEC;&amp;#x96BE;&amp;#x4EE5;&amp;#x60F3;&amp;#x8C61;&amp;#x6CA1;&amp;#x6709;&amp;#x4E86;TCP/IP&amp;#x4E4B;&amp;#x540E;&amp;#x7684;&amp;#x7F51;&amp;#x7EDC;&amp;#x670D;&amp;#x52A1;&amp;#x3002;&amp;#x6240;&amp;#x6709;&amp;#x6211;&amp;#x4EEC;&amp;#x5F00;&amp;#x53D1;&amp;#x5E76;&amp;#x5728;NHN&amp;#xFF08;&amp;#x539F;&amp;#x6587;&amp;#x53D1;&amp;#x5E03;&amp;#x7684;&amp;#x7F51;&amp;#x7AD9;&amp;#xFF09;&amp;#x4F7F;&amp;#x7528;&amp;#x7684;&amp;#x7F51;&amp;#x7EDC;&amp;#x670D;&amp;#x52A1;&amp;#x90FD;&amp;#x57FA;&amp;#x4E8E;TCP/IP&amp;#x8FD9;&amp;#x4E2A;&amp;#x575A;&amp;#x5B9E;&amp;#x7684;&amp;#x57FA;&amp;#x7840;&amp;#x3002;&amp;#x7406;&amp;#x89E3;&amp;#x6570;&amp;#x636E;&amp;#x5982;&amp;#x4F55;&amp;#x901A;&amp;#x8FC7;&amp;#x7F51;&amp;#x7EDC;&amp;#x4F20;&amp;#x8F93;&amp;#x53EF;&amp;#x4EE5;&amp;#x5E2E;&amp;#x52A9;&amp;#x4F60;&amp;#x901A;&amp;#x8FC7;&amp;#x8C03;&amp;#x4F18;&amp;#x3001;&amp;#x6392;&amp;#x67E5;&amp;#x6216;&amp;#x5F15;&amp;#x8FDB;&amp;#x65B0;&amp;#x6280;&amp;#x672F;&amp;#x4E4B;&amp;#x7C7B;&amp;#x7684;&amp;#x624B;&amp;#x6BB5;&amp;#x63D0;&amp;#x5347;&amp;#x6027;&amp;#x80FD;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x672C;&amp;#x6587;&amp;#x5C06;&amp;#x57FA;&amp;#x4E8E;Linux OS&amp;#x548C;&amp;#x786C;&amp;#x4EF6;&amp;#x5C42;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x6D41;&amp;#x548C;&amp;#x63A7;&amp;#x5236;&amp;#x6D41;&amp;#x6765;&amp;#x63CF;&amp;#x8FF0;&amp;#x7F51;&amp;#x7EDC;&amp;#x6808;&amp;#x7684;&amp;#x6574;&amp;#x4F53;&amp;#x8FD0;&amp;#x884C;&amp;#x65B9;&amp;#x5F0F;&amp;#x3002;&lt;/p&gt;
    
    </summary>
    
      <category term="Network" scheme="http://snowyying.github.io/categories/Network/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="TCP/IP" scheme="http://snowyying.github.io/tags/TCP-IP/"/>
    
  </entry>
  
  <entry>
    <title>linux 异步 I/O 的实现</title>
    <link href="http://snowyying.github.io/2016/linux-asynchronous-io/"/>
    <id>http://snowyying.github.io/2016/linux-asynchronous-io/</id>
    <published>2016-08-07T07:29:30.000Z</published>
    <updated>2016-08-25T04:03:25.986Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x6765;&#x81EA;: CSDN http://blog.csdn.net/zhang_shuai_2011/article/details/7678990 2012-06-20</code></p>
<p>&#x77E5;&#x9053;&#x5F02;&#x6B65;IO&#x5DF2;&#x7ECF;&#x5F88;&#x4E45;&#x4E86;&#xFF0C;&#x4F46;&#x662F;&#x76F4;&#x5230;&#x6700;&#x8FD1;&#xFF0C;&#x624D;&#x771F;&#x6B63;&#x7528;&#x5B83;&#x6765;&#x89E3;&#x51B3;&#x4E00;&#x4E0B;&#x5B9E;&#x9645;&#x95EE;&#x9898;&#xFF08;&#x5728;&#x4E00;&#x4E2A;CPU&#x5BC6;&#x96C6;&#x578B;&#x7684;&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x6709;&#x4E00;&#x4E9B;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#x53EF;&#x80FD;&#x653E;&#x5728;&#x78C1;&#x76D8;&#x4E0A;&#x3002;&#x9884;&#x5148;&#x77E5;&#x9053;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x6240;&#x4EE5;&#x9884;&#x5148;&#x53D1;&#x8D77;&#x5F02;&#x6B65;IO&#x8BFB;&#x8BF7;&#x6C42;&#x3002;&#x7B49;&#x5230;&#x771F;&#x6B63;&#x9700;&#x8981;&#x7528;&#x5230;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x518D;&#x7B49;&#x5F85;&#x5F02;&#x6B65;IO&#x5B8C;&#x6210;&#x3002;&#x4F7F;&#x7528;&#x4E86;&#x5F02;&#x6B65;IO&#xFF0C;&#x5728;&#x53D1;&#x8D77;IO&#x8BF7;&#x6C42;&#x5230;&#x5B9E;&#x9645;&#x4F7F;&#x7528;&#x6570;&#x636E;&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#xFF0C;&#x7A0B;&#x5E8F;&#x8FD8;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x505A;&#x5176;&#x4ED6;&#x4E8B;&#x60C5;&#xFF09;&#x3002;<br>&#x5047;&#x6B64;&#x673A;&#x4F1A;&#xFF0C;&#x4E5F;&#x987A;&#x4FBF;&#x7814;&#x7A76;&#x4E86;&#x4E00;&#x4E0B;linux&#x4E0B;&#x7684;&#x5F02;&#x6B65;IO&#x7684;&#x5B9E;&#x73B0;&#x3002;</p>
<p>linux&#x4E0B;&#x4E3B;&#x8981;&#x6709;&#x4E24;&#x5957;&#x5F02;&#x6B65;IO&#xFF0C;&#x4E00;&#x5957;&#x662F;&#x7531;glibc&#x5B9E;&#x73B0;&#x7684;&#xFF08;&#x4EE5;&#x4E0B;&#x79F0;&#x4E4B;&#x4E3A;glibc&#x7248;&#x672C;&#xFF09;&#x3001;&#x4E00;&#x5957;&#x662F;&#x7531;linux&#x5185;&#x6838;&#x5B9E;&#x73B0;&#xFF0C;&#x5E76;&#x7531;libaio&#x6765;&#x5C01;&#x88C5;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#xFF08;&#x4EE5;&#x4E0B;&#x79F0;&#x4E4B;&#x4E3A;linux&#x7248;&#x672C;&#xFF09;&#x3002;</p>
<a id="more"></a> 
<h2 id="glibc&#x7248;&#x672C;"><a href="#glibc&#x7248;&#x672C;" class="headerlink" title="glibc&#x7248;&#x672C;"></a>glibc&#x7248;&#x672C;</h2><p><strong> &#x63A5;&#x53E3; </strong></p>
<p>glibc&#x7248;&#x672C;&#x4E3B;&#x8981;&#x5305;&#x542B;&#x5982;&#x4E0B;&#x63A5;&#x53E3;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* &#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8BFB; */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_read</span><span class="params">(<span class="keyword">struct</span> aiocb *aiocbp)</span></span>;</div><div class="line"><span class="comment">/* &#x63D0;&#x4EA4;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x5199; */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_write</span><span class="params">(<span class="keyword">struct</span> aiocb *aiocbp)</span></span>;</div><div class="line"><span class="comment">/* &#x53D6;&#x6D88;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#xFF08;&#x6216;&#x57FA;&#x4E8E;&#x4E00;&#x4E2A;fd&#x7684;&#x6240;&#x6709;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#xFF0C;aiocbp==NULL&#xFF09; */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_cancel</span><span class="params">(<span class="keyword">int</span> fildes, <span class="keyword">struct</span> aiocb *aiocbp)</span></span>;</div><div class="line"><span class="comment">/* &#x67E5;&#x770B;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x72B6;&#x6001;&#xFF08;&#x8FDB;&#x884C;&#x4E2D;EINPROGRESS&#xFF1F;&#x8FD8;&#x662F;&#x5DF2;&#x7ECF;&#x7ED3;&#x675F;&#x6216;&#x51FA;&#x9519;&#xFF1F;&#xFF09; */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_error</span><span class="params">(<span class="keyword">const</span> <span class="keyword">struct</span> aiocb *aiocbp)</span></span>;</div><div class="line"><span class="comment">/* &#x67E5;&#x770B;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF08;&#x8DDF;&#x540C;&#x6B65;&#x8BFB;&#x5199;&#x5B9A;&#x4E49;&#x7684;&#x4E00;&#x6837;&#xFF09; */</span></div><div class="line"><span class="keyword">ssize_t</span> aio_return(<span class="keyword">struct</span> aiocb *aiocbp);</div><div class="line"><span class="comment">/* &#x963B;&#x585E;&#x7B49;&#x5F85;&#x8BF7;&#x6C42;&#x5B8C;&#x6210; */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">aio_suspend</span><span class="params">(<span class="keyword">const</span> <span class="keyword">struct</span> aiocb * <span class="keyword">const</span> <span class="built_in">list</span>[], <span class="keyword">int</span> nent, <span class="keyword">const</span> <span class="keyword">struct</span> timespec *timeout)</span></span>;</div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#xFF0C;struct aiocb&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5B57;&#x6BB5;&#xFF1A;<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>               aio_fildes;        <span class="comment">/* &#x8981;&#x88AB;&#x8BFB;&#x5199;&#x7684;fd */</span></div><div class="line"><span class="keyword">void</span> *            aio_buf;           <span class="comment">/* &#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x5BF9;&#x5E94;&#x7684;&#x5185;&#x5B58;buffer */</span></div><div class="line"><span class="keyword">__off64_t</span>         aio_offset;        <span class="comment">/* &#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x504F;&#x79FB; */</span></div><div class="line"><span class="keyword">size_t</span>            aio_nbytes;        <span class="comment">/* &#x9700;&#x8981;&#x8BFB;&#x5199;&#x7684;&#x5B57;&#x8282;&#x957F;&#x5EA6; */</span></div><div class="line"><span class="keyword">int</span>               aio_reqprio;       <span class="comment">/* &#x8BF7;&#x6C42;&#x7684;&#x4F18;&#x5148;&#x7EA7; */</span></div><div class="line"><span class="keyword">struct</span> sigevent   aio_sigevent;      <span class="comment">/* &#x5F02;&#x6B65;&#x4E8B;&#x4EF6;&#xFF0C;&#x5B9A;&#x4E49;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x65F6;&#x7684;&#x901A;&#x77E5;&#x4FE1;&#x53F7;&#x6216;&#x56DE;&#x8C03;&#x51FD;&#x6570; */</span></div></pre></td></tr></table></figure></p>
<p><strong> &#x5B9E;&#x73B0; </strong></p>
<p>glibc&#x7684;aio&#x5B9E;&#x73B0;&#x662F;&#x6BD4;&#x8F83;&#x901A;&#x4FD7;&#x6613;&#x61C2;&#x7684;&#xFF1A;</p>
<ol>
<li>&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x88AB;&#x63D0;&#x4EA4;&#x5230;request_queue&#x4E2D;&#xFF1B;</li>
<li>request_queue&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x8868;&#x7ED3;&#x6784;&#xFF0C;&#x201D;&#x884C;&#x201D;&#x662F;fd&#x3001;&#x201D;&#x5217;&#x201D;&#x662F;&#x5177;&#x4F53;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;fd&#x7684;&#x8BF7;&#x6C42;&#x4F1A;&#x88AB;&#x7EC4;&#x7EC7;&#x5728;&#x4E00;&#x8D77;&#xFF1B;</li>
<li>&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x6709;&#x4F18;&#x5148;&#x7EA7;&#x6982;&#x5FF5;&#xFF0C;&#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x4E2A;fd&#x7684;&#x8BF7;&#x6C42;&#x4F1A;&#x6309;&#x4F18;&#x5148;&#x7EA7;&#x6392;&#x5E8F;&#xFF0C;&#x5E76;&#x4E14;&#x6700;&#x7EC8;&#x88AB;&#x6309;&#x4F18;&#x5148;&#x7EA7;&#x987A;&#x5E8F;&#x5904;&#x7406;&#xFF1B;</li>
<li>&#x968F;&#x7740;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x63D0;&#x4EA4;&#xFF0C;&#x4E00;&#x4E9B;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x88AB;&#x52A8;&#x6001;&#x521B;&#x5EFA;&#x3002;&#x8FD9;&#x4E9B;&#x7EBF;&#x7A0B;&#x8981;&#x505A;&#x7684;&#x4E8B;&#x60C5;&#x5C31;&#x662F;&#x4ECE;request_queue&#x4E2D;&#x53D6;&#x51FA;&#x8BF7;&#x6C42;&#xFF0C;&#x7136;&#x540E;&#x5904;&#x7406;&#x4E4B;&#xFF1B;</li>
<li>&#x4E3A;&#x907F;&#x514D;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x7684;&#x7ADE;&#x4E89;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;fd&#x6240;&#x5BF9;&#x5E94;&#x7684;&#x8BF7;&#x6C42;&#x53EA;&#x7531;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6765;&#x5904;&#x7406;&#xFF1B;</li>
<li>&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x540C;&#x6B65;&#x5730;&#x5904;&#x7406;&#x6BCF;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x540E;&#x5728;&#x5BF9;&#x5E94;&#x7684;aiocb&#x4E2D;&#x586B;&#x5145;&#x7ED3;&#x679C;&#xFF0C;&#x7136;&#x540E;&#x89E6;&#x53D1;&#x53EF;&#x80FD;&#x7684;&#x4FE1;&#x53F7;&#x901A;&#x77E5;&#x6216;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF08;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x662F;&#x9700;&#x8981;&#x521B;&#x5EFA;&#x65B0;&#x7EBF;&#x7A0B;&#x6765;&#x8C03;&#x7528;&#x7684;&#xFF09;&#xFF1B;</li>
<li>&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x5728;&#x5B8C;&#x6210;&#x67D0;&#x4E2A;fd&#x7684;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x540E;&#xFF0C;&#x8FDB;&#x5165;&#x95F2;&#x7F6E;&#x72B6;&#x6001;&#xFF1B;</li>
<li>&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x5728;&#x95F2;&#x7F6E;&#x72B6;&#x6001;&#x65F6;&#xFF0C;&#x5982;&#x679C;request_queue&#x4E2D;&#x6709;&#x65B0;&#x7684;fd&#x52A0;&#x5165;&#xFF0C;&#x5219;&#x91CD;&#x65B0;&#x6295;&#x5165;&#x5DE5;&#x4F5C;&#xFF0C;&#x53BB;&#x5904;&#x7406;&#x8FD9;&#x4E2A;&#x65B0;fd&#x7684;&#x8BF7;&#x6C42;&#xFF08;&#x65B0;fd&#x548C;&#x5B83;&#x4E0A;&#x4E00;&#x6B21;&#x5904;&#x7406;&#x7684;fd&#x53EF;&#x4EE5;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#xFF09;&#xFF1B;</li>
<li>&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x5904;&#x4E8E;&#x95F2;&#x7F6E;&#x72B6;&#x6001;&#x4E00;&#x6BB5;&#x65F6;&#x95F4;&#x540E;&#xFF08;&#x6CA1;&#x6709;&#x65B0;&#x7684;&#x8BF7;&#x6C42;&#xFF09;&#xFF0C;&#x5219;&#x4F1A;&#x81EA;&#x52A8;&#x9000;&#x51FA;&#x3002;&#x7B49;&#x5230;&#x518D;&#x6709;&#x65B0;&#x7684;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x518D;&#x53BB;&#x52A8;&#x6001;&#x521B;&#x5EFA;&#xFF1B;<br>&#x770B;&#x8D77;&#x6765;&#xFF0C;&#x6362;&#x4F5C;&#x662F;&#x6211;&#x4EEC;&#xFF0C;&#x8981;&#x5728;&#x7528;&#x6237;&#x6001;&#x5B9E;&#x73B0;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;IO&#xFF0C;&#x4F3C;&#x4E4E;&#x5927;&#x6982;&#x4E5F;&#x4F1A;&#x8BBE;&#x8BA1;&#x6210;&#x7C7B;&#x4F3C;&#x7684;&#x6837;&#x5B50;&#x2026;&#x2026;</li>
</ol>
<h2 id="linux&#x7248;&#x672C;"><a href="#linux&#x7248;&#x672C;" class="headerlink" title="linux&#x7248;&#x672C;"></a>linux&#x7248;&#x672C;</h2><p><strong> &#x63A5;&#x53E3; </strong></p>
<p>&#x4E0B;&#x9762;&#x518D;&#x6765;&#x770B;&#x770B;linux&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x3002;&#x5B83;&#x4E3B;&#x8981;&#x5305;&#x542B;&#x5982;&#x4E0B;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;IO&#x4E0A;&#x4E0B;&#x6587;&#xFF08;io_context_t&#x662F;&#x4E00;&#x4E2A;&#x53E5;&#x67C4;&#xFF09; */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">io_setup</span><span class="params">(<span class="keyword">int</span> maxevents, <span class="keyword">io_context_t</span> *ctxp)</span></span>;</div><div class="line"><span class="comment">/* &#x9500;&#x6BC1;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;IO&#x4E0A;&#x4E0B;&#x6587;&#xFF08;&#x5982;&#x679C;&#x6709;&#x6B63;&#x5728;&#x8FDB;&#x884C;&#x7684;&#x5F02;&#x6B65;IO&#xFF0C;&#x53D6;&#x6D88;&#x5E76;&#x7B49;&#x5F85;&#x5B83;&#x4EEC;&#x5B8C;&#x6210;&#xFF09; */</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">io_destroy</span><span class="params">(<span class="keyword">io_context_t</span> ctx)</span></span>;</div><div class="line"><span class="comment">/* &#x63D0;&#x4EA4;&#x5F02;&#x6B65;IO&#x8BF7;&#x6C42; */</span></div><div class="line"><span class="function"><span class="keyword">long</span> <span class="title">io_submit</span><span class="params">(<span class="keyword">aio_context_t</span> ctx_id, <span class="keyword">long</span> nr, <span class="keyword">struct</span> iocb **iocbpp)</span></span>;</div><div class="line"><span class="comment">/* &#x53D6;&#x6D88;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;IO&#x8BF7;&#x6C42; */</span></div><div class="line"><span class="function"><span class="keyword">long</span> <span class="title">io_cancel</span><span class="params">(<span class="keyword">aio_context_t</span> ctx_id, <span class="keyword">struct</span> iocb *iocb, <span class="keyword">struct</span> io_event *result)</span></span>;</div><div class="line"><span class="comment">/* &#x7B49;&#x5F85;&#x5E76;&#x83B7;&#x53D6;&#x5F02;&#x6B65;IO&#x8BF7;&#x6C42;&#x7684;&#x4E8B;&#x4EF6;&#xFF08;&#x4E5F;&#x5C31;&#x662F;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x7684;&#x5904;&#x7406;&#x7ED3;&#x679C;&#xFF09; */</span></div><div class="line"><span class="function"><span class="keyword">long</span> <span class="title">io_getevents</span><span class="params">(<span class="keyword">aio_context_t</span> ctx_id, <span class="keyword">long</span> min_nr, <span class="keyword">long</span> nr, <span class="keyword">struct</span> io_event *events, <span class="keyword">struct</span> timespec *timeout)</span></span>;</div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#xFF0C;struct iocb&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5B57;&#x6BB5;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="number">__u</span>16     aio_lio_opcode;     <span class="comment">/* &#x8BF7;&#x6C42;&#x7C7B;&#x578B;&#xFF08;&#x5982;&#xFF1A;IOCB_CMD_PREAD=&#x8BFB;&#x3001;IOCB_CMD_PWRITE=&#x5199;&#x3001;&#x7B49;&#xFF09; */</span></div><div class="line"><span class="number">__u</span>32     aio_fildes;         <span class="comment">/* &#x8981;&#x88AB;&#x64CD;&#x4F5C;&#x7684;fd */</span></div><div class="line"><span class="number">__u</span>64     aio_buf;            <span class="comment">/* &#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x5BF9;&#x5E94;&#x7684;&#x5185;&#x5B58;buffer */</span></div><div class="line"><span class="number">__u</span>64     aio_nbytes;         <span class="comment">/* &#x9700;&#x8981;&#x8BFB;&#x5199;&#x7684;&#x5B57;&#x8282;&#x957F;&#x5EA6; */</span></div><div class="line"><span class="number">__</span>s64     aio_offset;         <span class="comment">/* &#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x504F;&#x79FB; */</span></div><div class="line"><span class="number">__u</span>64     aio_data;           <span class="comment">/* &#x8BF7;&#x6C42;&#x53EF;&#x643A;&#x5E26;&#x7684;&#x79C1;&#x6709;&#x6570;&#x636E;&#xFF08;&#x5728;io_getevents&#x65F6;&#x80FD;&#x591F;&#x4ECE;io_event&#x7ED3;&#x679C;&#x4E2D;&#x53D6;&#x5F97;&#xFF09; */</span></div><div class="line"><span class="number">__u</span>32     aio_flags;          <span class="comment">/* &#x53EF;&#x9009;IOCB_FLAG_RESFD&#x6807;&#x8BB0;&#xFF0C;&#x8868;&#x793A;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x65F6;&#x4F7F;&#x7528;eventfd&#x8FDB;&#x884C;&#x901A;&#x77E5;&#xFF08;&#x767E;&#x5EA6;&#x4E00;&#x4E0B;&#xFF09; */</span></div><div class="line"><span class="number">__u</span>32     aio_resfd;          <span class="comment">/* &#x6709;IOCB_FLAG_RESFD&#x6807;&#x8BB0;&#x65F6;&#xFF0C;&#x63A5;&#x6536;&#x901A;&#x77E5;&#x7684;eventfd */</span></div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#xFF0C;struct io_event&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5B57;&#x6BB5;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">__u</span>64     data;               <span class="comment">/* &#x5BF9;&#x5E94;iocb&#x7684;aio_data&#x7684;&#x503C; */</span></div><div class="line"><span class="number">__u</span>64     obj;                <span class="comment">/* &#x6307;&#x5411;&#x5BF9;&#x5E94;iocb&#x7684;&#x6307;&#x9488; */</span></div><div class="line"><span class="number">__</span>s64     res;                <span class="comment">/* &#x5BF9;&#x5E94;IO&#x8BF7;&#x6C42;&#x7684;&#x7ED3;&#x679C;&#xFF08;&gt;=0: &#x76F8;&#x5F53;&#x4E8E;&#x5BF9;&#x5E94;&#x7684;&#x540C;&#x6B65;&#x8C03;&#x7528;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#xFF1B;&lt;0: -errno&#xFF09; */</span></div></pre></td></tr></table></figure>
<p><strong> &#x5B9E;&#x73B0; </strong></p>
<p>io_context_t&#x53E5;&#x67C4;&#x5728;&#x5185;&#x6838;&#x4E2D;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;struct kioctx&#x7ED3;&#x6784;&#xFF0C;&#x7528;&#x6765;&#x7ED9;&#x4E00;&#x7EC4;&#x5F02;&#x6B65;IO&#x8BF7;&#x6C42;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x3002;&#x5176;&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5B57;&#x6BB5;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> mm_struct*     mm;             <span class="comment">/* &#x8C03;&#x7528;&#x8005;&#x8FDB;&#x7A0B;&#x5BF9;&#x5E94;&#x7684;&#x5185;&#x5B58;&#x7BA1;&#x7406;&#x7ED3;&#x6784;&#xFF08;&#x4EE3;&#x8868;&#x4E86;&#x8C03;&#x7528;&#x8005;&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF09; */</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span>         user_id;        <span class="comment">/* &#x4E0A;&#x4E0B;&#x6587;ID&#xFF0C;&#x4E5F;&#x5C31;&#x662F;io_context_t&#x53E5;&#x67C4;&#x7684;&#x503C;&#xFF08;&#x7B49;&#x4E8E;ring_info.mmap_base&#xFF09; */</span></div><div class="line"><span class="keyword">struct</span> hlist_node     <span class="built_in">list</span>;           <span class="comment">/* &#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x7684;&#x6240;&#x6709;kioctx&#x7ED3;&#x6784;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;list&#x4E32;&#x8FDE;&#x8D77;&#x6765;&#xFF0C;&#x94FE;&#x8868;&#x5934;&#x662F;mm-&gt;ioctx_list */</span></div><div class="line"><span class="keyword">wait_queue_head_t</span>     wait;           <span class="comment">/* &#x7B49;&#x5F85;&#x961F;&#x5217;&#xFF08;io_getevents&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x53EF;&#x80FD;&#x9700;&#x8981;&#x7B49;&#x5F85;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x5C31;&#x5728;&#x8BE5;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x4E0A;&#x7761;&#x7720;&#xFF09; */</span></div><div class="line"><span class="keyword">int</span>                   reqs_active;    <span class="comment">/* &#x8FDB;&#x884C;&#x4E2D;&#x7684;&#x8BF7;&#x6C42;&#x6570;&#x76EE; */</span></div><div class="line"><span class="keyword">struct</span> list_head      active_reqs;    <span class="comment">/* &#x8FDB;&#x884C;&#x4E2D;&#x7684;&#x8BF7;&#x6C42;&#x961F;&#x5217; */</span></div><div class="line"><span class="keyword">unsigned</span>              max_reqs;       <span class="comment">/* &#x6700;&#x5927;&#x8BF7;&#x6C42;&#x6570;&#xFF08;&#x5BF9;&#x5E94;io_setup&#x8C03;&#x7528;&#x7684;int maxevents&#x53C2;&#x6570;&#xFF09; */</span></div><div class="line"><span class="keyword">struct</span> list_head      run_list;       <span class="comment">/* &#x9700;&#x8981;aio&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;&#x5217;&#x8868;&#xFF08;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;IO&#x8BF7;&#x6C42;&#x53EF;&#x80FD;&#x4EA4;&#x7ED9;aio&#x7EBF;&#x7A0B;&#x6765;&#x63D0;&#x4EA4;&#xFF09; */</span></div><div class="line"><span class="keyword">struct</span> delayed_work   wq;             <span class="comment">/* &#x5EF6;&#x8FDF;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#xFF08;&#x5F53;&#x9700;&#x8981;aio&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5C06;wq&#x6302;&#x5165;aio&#x7EBF;&#x7A0B;&#x5BF9;&#x5E94;&#x7684;&#x8BF7;&#x6C42;&#x961F;&#x5217;&#xFF09; */</span></div><div class="line"><span class="keyword">struct</span> aio_ring_info  ring_info;      <span class="comment">/* &#x5B58;&#x653E;&#x8BF7;&#x6C42;&#x7ED3;&#x679C;io_event&#x7ED3;&#x6784;&#x7684;ring buffer */</span></div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;aio_ring_info&#x7ED3;&#x6784;&#x6BD4;&#x8F83;&#x503C;&#x5F97;&#x4E00;&#x63D0;&#xFF0C;&#x5B83;&#x662F;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x8BF7;&#x6C42;&#x7ED3;&#x679C;io_event&#x7ED3;&#x6784;&#x7684;ring buffer&#x3002;&#x5B83;&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4E86;&#x5982;&#x4E0B;&#x5B57;&#x6BB5;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span>   mmap_base;       <span class="comment">/* ring buffer&#x7684;&#x5730;&#x59CB;&#x5730;&#x5740; */</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span>   mmap_size;       <span class="comment">/* ring buffer&#x5206;&#x914D;&#x7A7A;&#x95F4;&#x7684;&#x5927;&#x5C0F; */</span></div><div class="line"><span class="keyword">struct</span> page**   ring_pages;      <span class="comment">/* ring buffer&#x5BF9;&#x5E94;&#x7684;page&#x6570;&#x7EC4; */</span></div><div class="line"><span class="keyword">long</span>            nr_pages;        <span class="comment">/* &#x5206;&#x914D;&#x7A7A;&#x95F4;&#x5BF9;&#x5E94;&#x7684;&#x9875;&#x9762;&#x6570;&#x76EE;&#xFF08;nr_pages * PAGE_SIZE = mmap_size&#xFF09; */</span></div><div class="line"><span class="keyword">unsigned</span>        nr, tail;        <span class="comment">/* &#x5305;&#x542B;io_event&#x7684;&#x6570;&#x76EE;&#x53CA;&#x5B58;&#x53D6;&#x6E38;&#x6807; */</span></div></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x770B;&#x8D77;&#x6765;&#x6709;&#x4E9B;&#x5947;&#x602A;&#xFF0C;&#x76F4;&#x63A5;&#x5F04;&#x4E00;&#x4E2A;io_event&#x6570;&#x7EC4;&#x4E0D;&#x5C31;&#x5B8C;&#x4E8B;&#x4E86;&#x4E48;&#xFF1F;&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x7EF4;&#x62A4;mmap_base&#x3001;mmap_size&#x3001;ring_pages&#x3001;nr_pages&#x8FD9;&#x4E48;&#x590D;&#x6742;&#x7684;&#x4E00;&#x7EC4;&#x4FE1;&#x606F;&#xFF0C;&#x800C;&#x53C8;&#x628A;io_event&#x7ED3;&#x6784;&#x9690;&#x85CF;&#x8D77;&#x6765;&#x5462;&#xFF1F;</p>
<p>&#x8FD9;&#x91CC;&#x7684;&#x5947;&#x5999;&#x4E4B;&#x5904;&#x5C31;&#x5728;&#x4E8E;&#xFF0C;io_event&#x7ED3;&#x6784;&#x7684;buffer&#x662F;&#x5728;&#x7528;&#x6237;&#x6001;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4E0A;&#x5206;&#x914D;&#x7684;&#x3002;&#x6CE8;&#x610F;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x5185;&#x6838;&#x91CC;&#x9762;&#x770B;&#x5230;&#x4E86;&#x8BF8;&#x591A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x90FD;&#x662F;&#x5728;&#x5185;&#x6838;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4E0A;&#x5206;&#x914D;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x7ED3;&#x6784;&#x90FD;&#x662F;&#x5185;&#x6838;&#x4E13;&#x6709;&#x7684;&#xFF0C;&#x6CA1;&#x5FC5;&#x8981;&#x7ED9;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x770B;&#x5230;&#xFF0C;&#x66F4;&#x4E0D;&#x80FD;&#x8BA9;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x53BB;&#x4FEE;&#x6539;&#x3002;&#x800C;&#x8FD9;&#x91CC;&#x7684;io_event&#x5374;&#x662F;&#x6709;&#x610F;&#x8BA9;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x770B;&#x5230;&#xFF0C;&#x800C;&#x4E14;&#x7528;&#x6237;&#x5C31;&#x7B97;&#x4FEE;&#x6539;&#x4E86;&#x4E5F;&#x4E0D;&#x4F1A;&#x5BF9;&#x5185;&#x6838;&#x7684;&#x6B63;&#x786E;&#x6027;&#x9020;&#x6210;&#x5F71;&#x54CD;&#x3002;&#x4E8E;&#x662F;&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x4E86;&#x8FD9;&#x6837;&#x4E00;&#x4E2A;&#x6709;&#x4E9B;&#x53D6;&#x5DE7;&#x7684;&#x529E;&#x6CD5;&#xFF0C;&#x7531;&#x5185;&#x6838;&#x5728;&#x7528;&#x6237;&#x6001;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4E0A;&#x5206;&#x914D;buffer&#x3002;&#xFF08;&#x5982;&#x679C;&#x6362;&#x4E00;&#x4E2A;&#x4FDD;&#x5B88;&#x70B9;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x5185;&#x6838;&#x6001;&#x53EF;&#x4EE5;&#x7EF4;&#x62A4;io_event&#x7684;buffer&#xFF0C;&#x7136;&#x540E;io_getevents&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C06;&#x5BF9;&#x5E94;&#x7684;io_event&#x590D;&#x5236;&#x4E00;&#x4EFD;&#x5230;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x3002;&#xFF09;</p>
<p>&#x6309;&#x7167;&#x8FD9;&#x6837;&#x7684;&#x601D;&#x8DEF;&#xFF0C;io_setup&#x65F6;&#xFF0C;&#x5185;&#x6838;&#x4F1A;&#x901A;&#x8FC7;mmap&#x5728;&#x5BF9;&#x5E94;&#x7684;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x5206;&#x914D;&#x4E00;&#x6BB5;&#x5185;&#x5B58;&#xFF0C;mmap_base&#x3001;mmap_size&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x5BF9;&#x5E94;&#x7684;&#x4F4D;&#x7F6E;&#x548C;&#x5927;&#x5C0F;&#x3002;&#x7136;&#x540E;&#xFF0C;&#x5149;&#x6709;&#x6620;&#x5C04;&#x8FD8;&#x4E0D;&#x884C;&#xFF0C;&#x8FD8;&#x5FC5;&#x987B;&#x7ACB;&#x9A6C;&#x5206;&#x914D;&#x7269;&#x7406;&#x5185;&#x5B58;&#xFF0C;ring_pages&#x3001;nr_pages&#x5C31;&#x662F;&#x5206;&#x914D;&#x597D;&#x7684;&#x7269;&#x7406;&#x9875;&#x9762;&#x3002;&#xFF08;&#x56E0;&#x4E3A;&#x8FD9;&#x4E9B;&#x5185;&#x5B58;&#x662F;&#x8981;&#x88AB;&#x5185;&#x6838;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x7684;&#xFF0C;&#x5185;&#x6838;&#x4F1A;&#x5C06;&#x5F02;&#x6B65;IO&#x7684;&#x7ED3;&#x679C;&#x5199;&#x5165;&#x5176;&#x4E2D;&#x3002;&#x5982;&#x679C;&#x7269;&#x7406;&#x9875;&#x9762;&#x5EF6;&#x8FDF;&#x5206;&#x914D;&#xFF0C;&#x90A3;&#x4E48;&#x5185;&#x6838;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x5185;&#x5B58;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x53D1;&#x751F;&#x7F3A;&#x9875;&#x5F02;&#x5E38;&#x3002;&#x800C;&#x5904;&#x7406;&#x5185;&#x6838;&#x6001;&#x7684;&#x7F3A;&#x9875;&#x5F02;&#x5E38;&#x53C8;&#x5F88;&#x9EBB;&#x70E6;&#xFF0C;&#x6240;&#x4EE5;&#x8FD8;&#x4E0D;&#x5982;&#x76F4;&#x63A5;&#x5206;&#x914D;&#x7269;&#x7406;&#x5185;&#x5B58;&#x7684;&#x597D;&#x3002;&#x5176;&#x4E8C;&#xFF0C;&#x5185;&#x6838;&#x5728;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;buffer&#x91CC;&#x7684;&#x4FE1;&#x606F;&#x65F6;&#xFF0C;&#x4E5F;&#x5E76;&#x4E0D;&#x662F;&#x901A;&#x8FC7;mmap_base&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x5730;&#x5740;&#x53BB;&#x76F4;&#x63A5;&#x8BBF;&#x95EE;&#x7684;&#x3002;&#x65E2;&#x7136;&#x662F;&#x5F02;&#x6B65;&#xFF0C;&#x90A3;&#x4E48;&#x7ED3;&#x679C;&#x5199;&#x56DE;&#x7684;&#x65F6;&#x5019;&#x53EF;&#x80FD;&#x662F;&#x5728;&#x53E6;&#x4E00;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x4E0A;&#x9762;&#xFF0C;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x90FD;&#x4E0D;&#x540C;&#x3002;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FDB;&#x884C;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x7684;&#x5207;&#x6362;&#xFF0C;&#x5185;&#x6838;&#x5E72;&#x8106;&#x76F4;&#x63A5;&#x901A;&#x8FC7;kmap&#x5C06;ring_pages&#x6620;&#x5C04;&#x5230;&#x9AD8;&#x7AEF;&#x5185;&#x5B58;&#x4E0A;&#x53BB;&#x8BBF;&#x95EE;&#x597D;&#x4E86;&#x3002;&#xFF09;</p>
<p>&#x7136;&#x540E;&#xFF0C;&#x5728;mmap_base&#x6307;&#x5411;&#x7684;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#x5730;&#x5740;&#x4E0A;&#xFF0C;&#x4F1A;&#x5B58;&#x653E;&#x7740;&#x4E00;&#x4E2A;struct aio_ring&#x7ED3;&#x6784;&#xFF0C;&#x7528;&#x6765;&#x7BA1;&#x7406;&#x8FD9;&#x4E2A;ring buffer&#x3002;&#x5176;&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4E86;&#x5982;&#x4E0B;&#x5B57;&#x6BB5;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span>         id;                <span class="comment">/* &#x7B49;&#x4E8E;aio_ring_info&#x4E2D;&#x7684;user_id */</span></div><div class="line"><span class="keyword">unsigned</span>         nr;                <span class="comment">/* &#x7B49;&#x4E8E;aio_ring_info&#x4E2D;&#x7684;nr */</span></div><div class="line"><span class="keyword">unsigned</span>         head,tail;         <span class="comment">/* io_events&#x6570;&#x7EC4;&#x7684;&#x6E38;&#x6807; */</span></div><div class="line"><span class="keyword">unsigned</span>         magic,compat_features,incompat_features;</div><div class="line"><span class="keyword">unsigned</span>         header_length;     <span class="comment">/* aio_ring&#x7ED3;&#x6784;&#x7684;&#x5927;&#x5C0F; */</span></div><div class="line"><span class="keyword">struct</span> io_event  io_events[<span class="number">0</span>];      <span class="comment">/* io_event&#x7684;buffer */</span></div></pre></td></tr></table></figure>
<p>&#x7EC8;&#x4E8E;&#xFF0C;&#x6211;&#x4EEC;&#x671F;&#x5F85;&#x7684;io_event&#x6570;&#x7EC4;&#x51FA;&#x73B0;&#x4E86;&#x3002;</p>
<p>&#x770B;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x5982;&#x679C;&#x524D;&#x9762;&#x7684;&#x5185;&#x5BB9;&#x4F60;&#x5DF2;&#x7ECF;&#x7406;&#x89E3;&#x6E05;&#x695A;&#x4E86;&#xFF0C;&#x4F60;&#x4E00;&#x5B9A;&#x4F1A;&#x6709;&#x4E2A;&#x7591;&#x95EE;&#xFF1A;&#x65E2;&#x7136;&#x6574;&#x4E2A;aio_ring&#x7ED3;&#x6784;&#x53CA;&#x5176;&#x4E2D;&#x7684;io_event&#x7F13;&#x51B2;&#x90FD;&#x662F;&#x653E;&#x5728;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x7684;&#xFF0C;&#x5185;&#x6838;&#x8FD8;&#x63D0;&#x4F9B;io_getevents&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x5E72;&#x4EC0;&#x4E48;&#xFF1F;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x4E0D;&#x662F;&#x76F4;&#x63A5;&#x5C31;&#x53EF;&#x4EE5;&#x53D6;&#x7528;io_event&#xFF0C;&#x5E76;&#x4E14;&#x4FEE;&#x6539;&#x6E38;&#x6807;&#x4E86;&#x4E48;&#xFF08;&#x5185;&#x6838;&#x4F5C;&#x4E3A;&#x751F;&#x4EA7;&#x8005;&#xFF0C;&#x4FEE;&#x6539;aio_ring-&gt;tail&#xFF1B;&#x7528;&#x6237;&#x4F5C;&#x4E3A;&#x6D88;&#x8D39;&#x8005;&#xFF0C;&#x4FEE;&#x6539;aio_ring-&gt;head&#xFF09;&#xFF1F;&#x6211;&#x60F3;&#xFF0C;aio_ring&#x4E4B;&#x6240;&#x4EE5;&#x8981;&#x653E;&#x5728;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#xFF0C;&#x5176;&#x539F;&#x672C;&#x7528;&#x610F;&#x5E94;&#x8BE5;&#x5C31;&#x662F;&#x8FD9;&#x6837;&#x7684;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x5982;&#x4F55;&#x77E5;&#x9053;aio_ring&#x7ED3;&#x6784;&#x7684;&#x5730;&#x5740;&#xFF08;aio_ring_info-&gt;mmap_base&#xFF09;&#x5462;&#xFF1F;&#x5176;&#x5B9E;kioctx&#x7ED3;&#x6784;&#x4E2D;&#x7684;user_id&#xFF0C;&#x4E5F;&#x5C31;&#x662F;io_setup&#x8FD4;&#x56DE;&#x7ED9;&#x7528;&#x6237;&#x7684;io_context_t&#xFF0C;&#x5C31;&#x7B49;&#x4E8E;aio_ring_info-&gt;mmap_base&#x3002;</p>
<p>&#x7136;&#x540E;&#xFF0C;aio_ring&#x7ED3;&#x6784;&#x4E2D;&#x8FD8;&#x6709;&#x8BF8;&#x5982;magic&#x3001;compat_features&#x3001;incompat_features&#x8FD9;&#x6837;&#x7684;&#x5B57;&#x6BB5;&#xFF0C;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x53EF;&#x4EE5;&#x8BFB;&#x8FD9;&#x4E9B;magic&#xFF0C;&#x4EE5;&#x786E;&#x5B9A;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x6CA1;&#x6709;&#x88AB;&#x5F02;&#x5E38;&#x7BE1;&#x6539;&#x3002;&#x5982;&#x679C;&#x4E00;&#x5207;&#x53EF;&#x63A7;&#xFF0C;&#x90A3;&#x4E48;&#x5C31;&#x81EA;&#x5DF1;&#x52A8;&#x624B;&#x3001;&#x4E30;&#x8863;&#x8DB3;&#x98DF;&#xFF1B;&#x5426;&#x5219;&#x5C31;&#x8FD8;&#x662F;&#x8D70;io_getevents&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;&#x800C;io_getevents&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x901A;&#x8FC7;aio_ring_info-&gt;ring_pages&#x5F97;&#x5230;aio_ring&#x7ED3;&#x6784;&#xFF0C;&#x518D;&#x5C06;&#x76F8;&#x5E94;&#x7684;io_event&#x62F7;&#x8D1D;&#x5230;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x8D34;&#x4E00;&#x6BB5;libaio&#x4E2D;&#x7684;io_getevents&#x7684;&#x4EE3;&#x7801;&#xFF08;&#x524D;&#x9762;&#x63D0;&#x5230;&#x8FC7;&#xFF0C;linux&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x662F;&#x7531;&#x7528;&#x6237;&#x6001;&#x7684;libaio&#x6765;&#x5C01;&#x88C5;&#x7684;&#xFF09;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">io_getevents_0_4</span><span class="params">(<span class="keyword">io_context_t</span> ctx, <span class="keyword">long</span> min_nr, <span class="keyword">long</span> nr, <span class="keyword">struct</span> io_event * events, <span class="keyword">struct</span> timespec * timeout)</span></span>{</div><div class="line">    <span class="keyword">struct</span> aio_ring *ring;</div><div class="line">    ring = (<span class="keyword">struct</span> aio_ring*)ctx;</div><div class="line">    <span class="keyword">if</span> (ring==<span class="literal">NULL</span> || ring-&gt;magic != AIO_RING_MAGIC)</div><div class="line">        <span class="keyword">goto</span> do_syscall;</div><div class="line">    <span class="keyword">if</span> (timeout!=<span class="literal">NULL</span> &amp;&amp; timeout-&gt;tv_sec == <span class="number">0</span> &amp;&amp; timeout-&gt;tv_nsec == <span class="number">0</span>) {</div><div class="line">        <span class="keyword">if</span> (ring-&gt;head == ring-&gt;tail)</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    }</div><div class="line">do_syscall:</div><div class="line">    <span class="keyword">return</span> <span class="number">__</span>io_getevents_0_4(ctx, min_nr, nr, events, timeout);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x5176;&#x4E2D;&#x786E;&#x5B9E;&#x7528;&#x5230;&#x4E86;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x4E0A;&#x7684;aio_ring&#x7ED3;&#x6784;&#x7684;&#x4FE1;&#x606F;&#xFF0C;&#x4E0D;&#x8FC7;&#x5C3A;&#x5EA6;&#x8FD8;&#x662F;&#x4E0D;&#x591F;&#x5927;&#x3002;</p>
<p>&#x4EE5;&#x4E0A;&#x5C31;&#x662F;&#x5F02;&#x6B65;IO&#x7684;context&#x7684;&#x7ED3;&#x6784;&#x3002;&#x90A3;&#x4E48;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;linux&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x9700;&#x8981;&#x201C;&#x4E0A;&#x4E0B;&#x6587;&#x201D;&#x8FD9;&#x4E48;&#x4E2A;&#x6982;&#x5FF5;&#xFF0C;&#x800C;glibc&#x7248;&#x672C;&#x5219;&#x4E0D;&#x9700;&#x8981;&#x5462;&#xFF1F;</p>
<p>&#x5728;glibc&#x7248;&#x672C;&#x4E2D;&#xFF0C;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x662F;glibc&#x5728;&#x8C03;&#x7528;&#x8005;&#x8FDB;&#x7A0B;&#x4E2D;&#x52A8;&#x6001;&#x521B;&#x5EFA;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x5B83;&#x548C;&#x8C03;&#x7528;&#x8005;&#x5FC5;&#x5B9A;&#x662F;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4E2D;&#x7684;&#x3002;&#x8FD9;&#x91CC;&#x5DF2;&#x7ECF;&#x9690;&#x542B;&#x4E86;&#x201C;&#x540C;&#x4E00;&#x4E0A;&#x4E0B;&#x6587;&#x201D;&#x8FD9;&#x4E48;&#x4E2A;&#x5173;&#x7CFB;&#x3002;</p>
<p>&#x800C;&#x5BF9;&#x4E8E;&#x5185;&#x6838;&#x6765;&#x8BF4;&#xFF0C;&#x8981;&#x9762;&#x5BF9;&#x7684;&#x662F;&#x4EFB;&#x610F;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x4EFB;&#x610F;&#x7684;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x3002;&#x5F53;&#x5904;&#x7406;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5185;&#x6838;&#x9700;&#x8981;&#x5728;&#x8C03;&#x7528;&#x8005;&#x5BF9;&#x5E94;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x4E2D;&#x5B58;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x5FC5;&#x987B;&#x77E5;&#x9053;&#x8FD9;&#x4E2A;&#x865A;&#x62DF;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x662F;&#x4EC0;&#x4E48;&#x3002;&#x4E0D;&#x8FC7;&#x5F53;&#x7136;&#xFF0C;&#x5982;&#x679C;&#x8BBE;&#x8BA1;&#x4E0A;&#x8981;&#x60F3;&#x628A;&#x201C;&#x4E0A;&#x4E0B;&#x6587;&#x201D;&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x9690;&#x85CF;&#x4E86;&#x4E5F;&#x662F;&#x80AF;&#x5B9A;&#x53EF;&#x4EE5;&#x7684;&#xFF08;&#x6BD4;&#x5982;&#x8BA9;&#x6BCF;&#x4E2A;mm&#x9690;&#x542B;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;IO&#x4E0A;&#x4E0B;&#x6587;&#xFF09;&#x3002;&#x5177;&#x4F53;&#x5982;&#x4F55;&#x9009;&#x62E9;&#xFF0C;&#x53EA;&#x662F;&#x8BBE;&#x8BA1;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>struct iocb&#x5728;&#x5185;&#x6838;&#x4E2D;&#x53C8;&#x5BF9;&#x5E94;&#x5230;struct kiocb&#x7ED3;&#x6784;&#xFF0C;&#x4E3B;&#x8981;&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x5B57;&#x6BB5;&#xFF1A;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> kioctx*       ki_ctx;           <span class="comment">/* &#x8BF7;&#x6C42;&#x5BF9;&#x5E94;&#x7684;kioctx&#xFF08;&#x4E0A;&#x4E0B;&#x6587;&#x7ED3;&#x6784;&#xFF09; */</span></div><div class="line"><span class="keyword">struct</span> list_head     ki_run_list;      <span class="comment">/* &#x9700;&#x8981;aio&#x7EBF;&#x7A0B;&#x5904;&#x7406;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x901A;&#x8FC7;&#x8BE5;&#x5B57;&#x6BB5;&#x94FE;&#x5165;ki_ctx-&gt;run_list */</span></div><div class="line"><span class="keyword">struct</span> list_head     ki_list;          <span class="comment">/* &#x94FE;&#x5165;ki_ctx-&gt;active_reqs */</span></div><div class="line"><span class="keyword">struct</span> file*         ki_filp;          <span class="comment">/* &#x5BF9;&#x5E94;&#x7684;&#x6587;&#x4EF6;&#x6307;&#x9488; */</span></div><div class="line"><span class="keyword">void</span> <span class="number">__u</span>ser*         ki_obj.user;      <span class="comment">/* &#x6307;&#x5411;&#x7528;&#x6237;&#x6001;&#x7684;iocb&#x7ED3;&#x6784; */</span></div><div class="line"><span class="number">__u</span>64                ki_user_data;     <span class="comment">/* &#x7B49;&#x4E8E;iocb-&gt;aio_data */</span></div><div class="line"><span class="keyword">loff_t</span>               ki_pos;           <span class="comment">/* &#x7B49;&#x4E8E;iocb-&gt;aio_offset */</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span>       ki_opcode;        <span class="comment">/* &#x7B49;&#x4E8E;iocb-&gt;aio_lio_opcode */</span></div><div class="line"><span class="keyword">size_t</span>               ki_nbytes;        <span class="comment">/* &#x7B49;&#x4E8E;iocb-&gt;aio_nbytes */</span></div><div class="line"><span class="keyword">char</span> <span class="number">__u</span>ser *        ki_buf;           <span class="comment">/* &#x7B49;&#x4E8E;iocb-&gt;aio_buf */</span></div><div class="line"><span class="keyword">size_t</span>               ki_left;          <span class="comment">/* &#x8BE5;&#x8BF7;&#x6C42;&#x5269;&#x4F59;&#x5B57;&#x8282;&#x6570;&#xFF08;&#x521D;&#x503C;&#x7B49;&#x4E8E;iocb-&gt;aio_nbytes&#xFF09; */</span></div><div class="line"><span class="keyword">struct</span> eventfd_ctx*  ki_eventfd;       <span class="comment">/* &#x7531;iocb-&gt;aio_resfd&#x5BF9;&#x5E94;&#x7684;eventfd&#x5BF9;&#x8C61; */</span></div><div class="line"><span class="keyword">ssize_t</span> (*ki_retry)(<span class="keyword">struct</span> kiocb *);   <span class="comment">/*&#x7531;ki_opcode&#x9009;&#x62E9;&#x7684;&#x8BF7;&#x6C42;&#x63D0;&#x4EA4;&#x51FD;&#x6570;*/</span></div></pre></td></tr></table></figure>
<p>&#x8C03;&#x7528;io_submit&#x540E;&#xFF0C;&#x5BF9;&#x5E94;&#x4E8E;&#x7528;&#x6237;&#x4F20;&#x9012;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;iocb&#x7ED3;&#x6784;&#xFF0C;&#x4F1A;&#x5728;&#x5185;&#x6838;&#x6001;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x4E0E;&#x4E4B;&#x5BF9;&#x5E94;&#x7684;kiocb&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x5BF9;&#x5E94;kioctx&#x7ED3;&#x6784;&#x7684;ring_info&#x4E2D;&#x9884;&#x7559;&#x4E00;&#x4E2A;io_events&#x7684;&#x7A7A;&#x95F4;&#x3002;&#x4E4B;&#x540E;&#xFF0C;&#x8BF7;&#x6C42;&#x7684;&#x5904;&#x7406;&#x7ED3;&#x679C;&#x5C31;&#x88AB;&#x5199;&#x5230;&#x8FD9;&#x4E2A;io_event&#x4E2D;&#x3002;</p>
<p>&#x7136;&#x540E;&#xFF0C;&#x5BF9;&#x5E94;&#x7684;&#x5F02;&#x6B65;&#x8BFB;&#x5199;&#xFF08;&#x6216;&#x5176;&#x4ED6;&#xFF09;&#x8BF7;&#x6C42;&#x5C31;&#x88AB;&#x63D0;&#x4EA4;&#x5230;&#x4E86;&#x865A;&#x62DF;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#xFF0C;&#x5B9E;&#x9645;&#x4E0A;&#x5C31;&#x662F;&#x8C03;&#x7528;&#x4E86;file-&gt;f_op-&gt;aio_read&#x6216;file-&gt;f_op-&gt;aio_write&#xFF08;&#x6216;&#x5176;&#x4ED6;&#xFF09;&#x3002;&#x4E5F;&#x5C31;&#x662F;&#xFF0C;&#x5728;&#x7ECF;&#x5386;&#x78C1;&#x76D8;&#x9AD8;&#x901F;&#x7F13;&#x5B58;&#x5C42;&#x3001;&#x901A;&#x7528;&#x5757;&#x5C42;&#x4E4B;&#x540E;&#xFF0C;&#x8BF7;&#x6C42;&#x88AB;&#x63D0;&#x4EA4;&#x5230;IO&#x8C03;&#x5EA6;&#x5C42;&#xFF0C;&#x7B49;&#x5F85;&#x88AB;&#x5904;&#x7406;&#x3002;&#x8FD9;&#x4E2A;&#x8DDF;&#x666E;&#x901A;&#x7684;&#x6587;&#x4EF6;&#x8BFB;&#x5199;&#x8BF7;&#x6C42;&#x662F;&#x7C7B;&#x4F3C;&#x7684;&#x3002;</p>
<p>&#x5728;&#x300A;linux&#x6587;&#x4EF6;&#x8BFB;&#x5199;&#x6D45;&#x6790;&#x300B;&#x4E2D;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5BF9;&#x4E8E;&#x975E;direct-io&#x7684;&#x8BFB;&#x8BF7;&#x6C42;&#x6765;&#x8BF4;&#xFF0C;&#x5982;&#x679C;page cache&#x4E0D;&#x547D;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;IO&#x8BF7;&#x6C42;&#x4F1A;&#x88AB;&#x63D0;&#x4EA4;&#x5230;&#x5E95;&#x5C42;&#x3002;&#x4E4B;&#x540E;&#xFF0C;do_generic_file_read&#x4F1A;&#x901A;&#x8FC7;lock_page&#x64CD;&#x4F5C;&#xFF0C;&#x7B49;&#x5F85;&#x6570;&#x636E;&#x6700;&#x7EC8;&#x8BFB;&#x5B8C;&#x3002;&#x8FD9;&#x4E00;&#x70B9;&#x8DDF;&#x5F02;&#x6B65;IO&#x662F;&#x80CC;&#x9053;&#x800C;&#x9A70;&#x7684;&#xFF0C;&#x56E0;&#x4E3A;&#x5F02;&#x6B65;&#x5C31;&#x610F;&#x5473;&#x7740;&#x8BF7;&#x6C42;&#x63D0;&#x4EA4;&#x540E;&#x4E0D;&#x80FD;&#x7B49;&#x5F85;&#xFF0C;&#x5FC5;&#x987B;&#x9A6C;&#x4E0A;&#x8FD4;&#x56DE;&#x3002;&#x800C;&#x5BF9;&#x4E8E;&#x975E;direct-io&#x7684;&#x5199;&#x8BF7;&#x6C42;&#xFF0C;&#x5199;&#x64CD;&#x4F5C;&#x4E00;&#x822C;&#x4EC5;&#x4EC5;&#x662F;&#x5C06;&#x6570;&#x636E;&#x66F4;&#x65B0;&#x4F5C;&#x7528;&#x5230;page cache&#x4E0A;&#xFF0C;&#x5E76;&#x4E0D;&#x9700;&#x8981;&#x771F;&#x6B63;&#x7684;&#x5199;&#x78C1;&#x76D8;&#x3002;page cache&#x5199;&#x56DE;&#x78C1;&#x76D8;&#x672C;&#x8EAB;&#x662F;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x7684;&#x8FC7;&#x7A0B;&#x3002;&#x53EF;&#x89C1;&#xFF0C;&#x5BF9;&#x4E8E;&#x975E;direct-io&#x7684;&#x6587;&#x4EF6;&#x8BFB;&#x5199;&#xFF0C;&#x4F7F;&#x7528;linux&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x63A5;&#x53E3;&#x5B8C;&#x5168;&#x6CA1;&#x6709;&#x610F;&#x4E49;&#xFF08;&#x5C31;&#x8DDF;&#x4F7F;&#x7528;&#x540C;&#x6B65;&#x63A5;&#x53E3;&#x6548;&#x679C;&#x4E00;&#x6837;&#xFF09;&#x3002;</p>
<p>&#x4E3A;&#x4EC0;&#x4E48;&#x4F1A;&#x6709;&#x8FD9;&#x6837;&#x7684;&#x8BBE;&#x8BA1;&#x5462;&#xFF1F;&#x56E0;&#x4E3A;&#x975E;direct-io&#x7684;&#x6587;&#x4EF6;&#x8BFB;&#x5199;&#x662F;&#x53EA;&#x8DDF;page cache&#x6253;&#x4EA4;&#x9053;&#x7684;&#x3002;&#x800C;page cache&#x662F;&#x5185;&#x5B58;&#xFF0C;&#x8DDF;&#x5185;&#x5B58;&#x6253;&#x4EA4;&#x9053;&#x53C8;&#x4E0D;&#x4F1A;&#x5B58;&#x5728;&#x963B;&#x585E;&#xFF0C;&#x90A3;&#x4E48;&#x4E5F;&#x5C31;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5F02;&#x6B65;&#x7684;&#x6982;&#x5FF5;&#x4E86;&#x3002;&#x81F3;&#x4E8E;&#x8BFB;&#x5199;&#x78C1;&#x76D8;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x963B;&#x585E;&#xFF0C;&#x90A3;&#x662F;page cache&#x8DDF;&#x78C1;&#x76D8;&#x6253;&#x4EA4;&#x9053;&#x65F6;&#x53D1;&#x751F;&#x7684;&#x4E8B;&#x60C5;&#xFF0C;&#x8DDF;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53C8;&#x6CA1;&#x6709;&#x76F4;&#x63A5;&#x5173;&#x7CFB;&#x3002;</p>
<p>&#x7136;&#x800C;&#xFF0C;&#x5BF9;&#x4E8E;direct-io&#x6765;&#x8BF4;&#xFF0C;&#x5F02;&#x6B65;&#x5219;&#x662F;&#x6709;&#x610F;&#x4E49;&#x7684;&#x3002;&#x56E0;&#x4E3A;direct-io&#x662F;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x7684;buffer&#x8DDF;&#x78C1;&#x76D8;&#x7684;&#x76F4;&#x63A5;&#x4EA4;&#x4E92;&#xFF08;&#x4E0D;&#x4F7F;&#x7528;page cache&#xFF09;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#xFF0C;&#x5728;&#x4F7F;&#x7528;direct-io&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;file-&gt;f<em>op-&gt;aio</em>{read,write}&#x63D0;&#x4EA4;&#x5B8C;IO&#x8BF7;&#x6C42;&#x5C31;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x4E86;&#xFF0C;&#x7136;&#x540E;io_submit&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x8FD4;&#x56DE;&#x3002;&#xFF08;&#x89C1;&#x540E;&#x9762;&#x7684;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x3002;&#xFF09;</p>
<p>&#x901A;&#x8FC7;linux&#x5185;&#x6838;&#x5F02;&#x6B65;&#x89E6;&#x53D1;&#x7684;IO&#x8C03;&#x5EA6;&#xFF08;&#x5982;&#xFF1A;&#x88AB;&#x65F6;&#x949F;&#x4E2D;&#x65AD;&#x89E6;&#x53D1;&#x3001;&#x88AB;&#x5176;&#x4ED6;&#x7684;IO&#x8BF7;&#x6C42;&#x89E6;&#x53D1;&#x3001;&#x7B49;&#xFF09;&#xFF0C;&#x5DF2;&#x7ECF;&#x63D0;&#x4EA4;&#x7684;IO&#x8BF7;&#x6C42;&#x88AB;&#x8C03;&#x5EA6;&#xFF0C;&#x7531;&#x5BF9;&#x5E94;&#x7684;&#x8BBE;&#x5907;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x63D0;&#x4EA4;&#x7ED9;&#x5177;&#x4F53;&#x7684;&#x8BBE;&#x5907;&#x3002;&#x5BF9;&#x4E8E;&#x78C1;&#x76D8;&#xFF0C;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x4F1A;&#x53D1;&#x8D77;&#x4E00;&#x6B21;DMA&#x3002;&#x7136;&#x540E;&#x53C8;&#x7ECF;&#x8FC7;&#x82E5;&#x5E72;&#x65F6;&#x95F4;&#xFF0C;&#x8BFB;&#x5199;&#x8BF7;&#x6C42;&#x88AB;&#x78C1;&#x76D8;&#x5904;&#x7406;&#x5B8C;&#x6210;&#xFF0C;CPU&#x5C06;&#x6536;&#x5230;&#x8868;&#x793A;DMA&#x5B8C;&#x6210;&#x7684;&#x4E2D;&#x65AD;&#x4FE1;&#x53F7;&#xFF0C;&#x8BBE;&#x5907;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x6CE8;&#x518C;&#x7684;&#x5904;&#x7406;&#x51FD;&#x6570;&#x5C06;&#x5728;&#x4E2D;&#x65AD;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x88AB;&#x8C03;&#x7528;&#x3002;&#x8FD9;&#x4E2A;&#x5904;&#x7406;&#x51FD;&#x6570;&#x4F1A;&#x8C03;&#x7528;end_request&#x51FD;&#x6570;&#x6765;&#x7ED3;&#x675F;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x3002;&#x8FD9;&#x4E2A;&#x6D41;&#x7A0B;&#x8DDF;&#x300A;linux&#x6587;&#x4EF6;&#x8BFB;&#x5199;&#x6D45;&#x6790;&#x300B;&#x4E2D;&#x6240;&#x8BF4;&#x7684;&#x975E;direct-io&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x60C5;&#x51B5;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<p>&#x4E0D;&#x540C;&#x7684;&#x662F;&#xFF0C;&#x5BF9;&#x4E8E;&#x540C;&#x6B65;&#x975E;direct-io&#xFF0C;end_request&#x5C06;&#x901A;&#x8FC7;&#x6E05;&#x9664;page&#x7ED3;&#x6784;&#x7684;PG_locked&#x6807;&#x8BB0;&#x6765;&#x5524;&#x9192;&#x88AB;&#x963B;&#x585E;&#x7684;&#x8BFB;&#x64CD;&#x4F5C;&#x6D41;&#x7A0B;&#xFF0C;&#x5F02;&#x6B65;IO&#x548C;&#x540C;&#x6B65;IO&#x6548;&#x679C;&#x4E00;&#x6837;&#x3002;&#x800C;&#x5BF9;&#x4E8E;direct-io&#xFF0C;&#x9664;&#x4E86;&#x5524;&#x9192;&#x88AB;&#x963B;&#x585E;&#x7684;&#x8BFB;&#x64CD;&#x4F5C;&#x6D41;&#x7A0B;&#xFF08;&#x540C;&#x6B65;IO&#xFF09;&#x6216;io_getevents&#x6D41;&#x7A0B;&#xFF08;&#x5F02;&#x6B65;IO&#xFF09;&#x4E4B;&#x5916;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5C06;IO&#x8BF7;&#x6C42;&#x7684;&#x5904;&#x7406;&#x7ED3;&#x679C;&#x586B;&#x56DE;&#x5BF9;&#x5E94;&#x7684;io_event&#x4E2D;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;&#x7B49;&#x5230;&#x8C03;&#x7528;&#x8005;&#x8C03;&#x7528;io_getevents&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C31;&#x80FD;&#x83B7;&#x53D6;&#x5230;&#x8BF7;&#x6C42;&#x5BF9;&#x5E94;&#x7684;&#x7ED3;&#x679C;&#xFF08;io_event&#xFF09;&#x3002;&#x800C;&#x5982;&#x679C;&#x8C03;&#x7528;io_getevents&#x7684;&#x65F6;&#x5019;&#x7ED3;&#x679C;&#x8FD8;&#x6CA1;&#x51FA;&#x6765;&#xFF0C;&#x6D41;&#x7A0B;&#x4E5F;&#x4F1A;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x5E76;&#x4E14;&#x4F1A;&#x5728;direct-io&#x7684;end_request&#x8FC7;&#x7A0B;&#x4E2D;&#x5F97;&#x5230;&#x5524;&#x9192;&#x3002;</p>
<p>linux&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x4E5F;&#x6709;aio&#x7EBF;&#x7A0B;&#xFF08;&#x6BCF;CPU&#x4E00;&#x4E2A;&#xFF09;&#xFF0C;&#x4F46;&#x662F;&#x8DDF;glibc&#x7248;&#x672C;&#x4E2D;&#x7684;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x4E0D;&#x540C;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;aio&#x7EBF;&#x7A0B;&#x662F;&#x7528;&#x6765;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x91CD;&#x8BD5;&#x7684;&#x3002;&#x67D0;&#x4E9B;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;file-&gt;f<em>op-&gt;aio</em>{read,write}&#x53EF;&#x80FD;&#x4F1A;&#x8FD4;&#x56DE;-EIOCBRETRY&#xFF0C;&#x8868;&#x793A;&#x9700;&#x8981;&#x91CD;&#x8BD5;&#xFF08;&#x53EA;&#x6709;&#x4E00;&#x4E9B;&#x7279;&#x6B8A;&#x7684;IO&#x8BBE;&#x5907;&#x4F1A;&#x8FD9;&#x6837;&#xFF09;&#x3002;&#x800C;&#x8C03;&#x7528;&#x8005;&#x65E2;&#x7136;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x5F02;&#x6B65;IO&#x63A5;&#x53E3;&#xFF0C;&#x80AF;&#x5B9A;&#x4E0D;&#x5E0C;&#x671B;&#x91CC;&#x9762;&#x4F1A;&#x6709;&#x7B49;&#x5F85;/&#x91CD;&#x8BD5;&#x7684;&#x903B;&#x8F91;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5982;&#x679C;&#x9047;&#x5230;-EIOCBRETRY&#xFF0C;&#x5185;&#x6838;&#x5C31;&#x5728;&#x5F53;&#x524D;CPU&#x5BF9;&#x5E94;&#x7684;aio&#x7EBF;&#x7A0B;&#x6DFB;&#x52A0;&#x4E00;&#x4E2A;&#x4EFB;&#x52A1;&#xFF0C;&#x8BA9;aio&#x7EBF;&#x7A0B;&#x6765;&#x5B8C;&#x6210;&#x8BF7;&#x6C42;&#x7684;&#x91CD;&#x65B0;&#x63D0;&#x4EA4;&#x3002;&#x800C;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x963B;&#x585E;&#x3002;</p>
<p>&#x8BF7;&#x6C42;&#x5728;aio&#x7EBF;&#x7A0B;&#x4E2D;&#x63D0;&#x4EA4;&#x548C;&#x5728;&#x8C03;&#x7528;&#x8005;&#x8FDB;&#x7A0B;&#x4E2D;&#x63D0;&#x4EA4;&#x76F8;&#x6BD4;&#xFF0C;&#x6709;&#x4E00;&#x4E2A;&#x6700;&#x5927;&#x7684;&#x4E0D;&#x540C;&#xFF0C;&#x5C31;&#x662F;aio&#x7EBF;&#x7A0B;&#x4F7F;&#x7528;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#x53EF;&#x80FD;&#x8DDF;&#x8C03;&#x7528;&#x8005;&#x7EBF;&#x7A0B;&#x4E0D;&#x4E00;&#x6837;&#x3002;&#x9700;&#x8981;&#x5229;&#x7528;kioctx-&gt;mm&#x5207;&#x6362;&#x5230;&#x6B63;&#x786E;&#x7684;&#x5730;&#x5740;&#x7A7A;&#x95F4;&#xFF0C;&#x7136;&#x540E;&#x624D;&#x80FD;&#x53D1;&#x8BF7;&#x6C42;&#x3002;&#xFF08;&#x53C2;&#x89C1;&#x300A;&#x6D45;&#x5C1D;&#x5F02;&#x6B65;IO&#x300B;&#x4E2D;&#x7684;&#x8BA8;&#x8BBA;&#x3002;&#xFF09;</p>
<p><strong> &#x5185;&#x6838;&#x5904;&#x7406;&#x6D41;&#x7A0B; </strong></p>
<p>&#x6700;&#x540E;&#xFF0C;&#x6574;&#x7406;&#x4E00;&#x4E0B;direct-io&#x5F02;&#x6B65;&#x8BFB;&#x64CD;&#x4F5C;&#x7684;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#xFF1A;</p>
<ul>
<li>io_submit&#x3002;&#x5BF9;&#x4E8E;&#x63D0;&#x4EA4;&#x7684;iocbpp&#x6570;&#x7EC4;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;iocb&#xFF08;&#x5F02;&#x6B65;&#x8BF7;&#x6C42;&#xFF09;&#xFF0C;&#x8C03;&#x7528;io_submit_one&#x6765;&#x63D0;&#x4EA4;&#x5B83;&#x4EEC;&#xFF1B;</li>
<li>io_submit_one&#x3002;&#x4E3A;&#x8BF7;&#x6C42;&#x5206;&#x914D;&#x4E00;&#x4E2A;kiocb&#x7ED3;&#x6784;&#xFF0C;&#x5E76;&#x4E14;&#x5728;&#x5BF9;&#x5E94;&#x7684;kioctx&#x7684;ring_info&#x4E2D;&#x4E3A;&#x5B83;&#x9884;&#x7559;&#x4E00;&#x4E2A;&#x5BF9;&#x5E94;&#x7684;io_event&#x3002;&#x7136;&#x540E;&#x8C03;&#x7528;aio_rw_vect_retry&#x6765;&#x63D0;&#x4EA4;&#x8FD9;&#x4E2A;&#x8BFB;&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>aio_rw_vect_retry&#x3002;&#x8C03;&#x7528;file-&gt;f_op-&gt;aio_read&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x901A;&#x5E38;&#x662F;&#x7531;generic_file_aio_read&#x6216;&#x8005;&#x5176;&#x5C01;&#x88C5;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF1B;</li>
<li>generic_file_aio_read&#x3002;&#x5BF9;&#x4E8E;&#x975E;direct-io&#xFF0C;&#x4F1A;&#x8C03;&#x7528;do_generic_file_read&#x6765;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF08;&#x89C1;&#x300A;linux&#x6587;&#x4EF6;&#x8BFB;&#x5199;&#x6D45;&#x6790;&#x300B;&#xFF09;&#x3002;&#x800C;&#x5BF9;&#x4E8E;direct-io&#xFF0C;&#x5219;&#x662F;&#x8C03;&#x7528;mapping-&gt;a_ops-&gt;direct_IO&#x3002;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#x901A;&#x5E38;&#x5C31;&#x662F;blkdev_direct_IO&#xFF1B;</li>
<li>blkdev_direct_IO&#x3002;&#x8C03;&#x7528;filemap_write_and_wait_range&#x5C06;&#x76F8;&#x5E94;&#x4F4D;&#x7F6E;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7684;page cache&#x5E9F;&#x5F03;&#x6389;&#x6216;&#x5237;&#x56DE;&#x78C1;&#x76D8;&#xFF08;&#x907F;&#x514D;&#x4EA7;&#x751F;&#x4E0D;&#x4E00;&#x81F4;&#xFF09;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;direct_io_worker&#x6765;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF1B;</li>
<li>direct_io_worker&#x3002;&#x4E00;&#x6B21;&#x8BFB;&#x53EF;&#x80FD;&#x5305;&#x542B;&#x591A;&#x4E2A;&#x8BFB;&#x64CD;&#x4F5C;&#xFF08;&#x5BF9;&#x5E94;&#x4E8E;&#x7C7B;readv&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF09;&#xFF0C;&#x5BF9;&#x4E8E;&#x5176;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#xFF0C;&#x8C03;&#x7528;do_direct_IO&#xFF1B;</li>
<li>do_direct_IO&#x3002;&#x8C03;&#x7528;submit_page_section&#xFF1B;</li>
<li>submit_page_section&#x3002;&#x8C03;&#x7528;dio_new_bio&#x5206;&#x914D;&#x5BF9;&#x5E94;&#x7684;bio&#x7ED3;&#x6784;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x7528;dio_bio_submit&#x6765;&#x63D0;&#x4EA4;bio&#xFF1B;</li>
<li>dio_bio_submit&#x3002;&#x8C03;&#x7528;submit_bio&#x63D0;&#x4EA4;&#x8BF7;&#x6C42;&#x3002;&#x540E;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x5C31;&#x8DDF;&#x975E;direct-io&#x662F;&#x4E00;&#x6837;&#x7684;&#x4E86;&#xFF0C;&#x7136;&#x540E;&#x7B49;&#x5230;&#x8BF7;&#x6C42;&#x5B8C;&#x6210;&#xFF0C;&#x9A71;&#x52A8;&#x7A0B;&#x5E8F;&#x5C06;&#x8C03;&#x7528; bio-&gt;bi_end_io&#x6765;&#x7ED3;&#x675F;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x3002;&#x5BF9;&#x4E8E;direct-io&#x4E0B;&#x7684;&#x5F02;&#x6B65;IO&#xFF0C;bio-&gt;bi_end_io&#x7B49;&#x4E8E;dio_bio_end_aio&#xFF1B;</li>
<li>dio_bio_end_aio&#x3002;&#x8C03;&#x7528;wake_up_process&#x5524;&#x9192;&#x88AB;&#x963B;&#x585E;&#x7684;&#x8FDB;&#x7A0B;&#xFF08;&#x5F02;&#x6B65;IO&#x4E0B;&#xFF0C;&#x4E3B;&#x8981;&#x662F;io_getevents&#x7684;&#x8C03;&#x7528;&#x8005;&#xFF09;&#x3002;&#x7136;&#x540E;&#x8C03;&#x7528;aio_complete&#xFF1B;</li>
<li>aio_complete&#x3002;&#x5C06;&#x5904;&#x7406;&#x7ED3;&#x679C;&#x5199;&#x56DE;&#x5230;&#x5BF9;&#x5E94;&#x7684;io_event&#x4E2D;&#xFF1B;</li>
</ul>
<p><strong> &#x6BD4;&#x8F83; </strong></p>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;linux&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x5B9E;&#x9645;&#x4E0A;&#x53EA;&#x662F;&#x5229;&#x7528;&#x4E86;CPU&#x548C;IO&#x8BBE;&#x5907;&#x53EF;&#x4EE5;&#x5F02;&#x6B65;&#x5DE5;&#x4F5C;&#x7684;&#x7279;&#x6027;&#xFF08;IO&#x8BF7;&#x6C42;&#x63D0;&#x4EA4;&#x7684;&#x8FC7;&#x7A0B;&#x4E3B;&#x8981;&#x8FD8;&#x662F;&#x5728;&#x8C03;&#x7528;&#x8005;&#x7EBF;&#x7A0B;&#x4E0A;&#x540C;&#x6B65;&#x5B8C;&#x6210;&#x7684;&#xFF0C;&#x8BF7;&#x6C42;&#x63D0;&#x4EA4;&#x540E;&#x7531;&#x4E8E;CPU&#x4E0E;IO&#x8BBE;&#x5907;&#x53EF;&#x4EE5;&#x5E76;&#x884C;&#x5DE5;&#x4F5C;&#xFF0C;&#x6240;&#x4EE5;&#x8C03;&#x7528;&#x6D41;&#x7A0B;&#x53EF;&#x4EE5;&#x8FD4;&#x56DE;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x505A;&#x5176;&#x4ED6;&#x4E8B;&#x60C5;&#xFF09;&#x3002;&#x76F8;&#x6BD4;&#x540C;&#x6B65;IO&#xFF0C;&#x5E76;&#x4E0D;&#x4F1A;&#x5360;&#x7528;&#x989D;&#x5916;&#x7684;CPU&#x8D44;&#x6E90;&#x3002;</p>
<p>&#x800C;glibc&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x5219;&#x662F;&#x5229;&#x7528;&#x4E86;&#x7EBF;&#x7A0B;&#x4E0E;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x53EF;&#x4EE5;&#x5F02;&#x6B65;&#x5DE5;&#x4F5C;&#x7684;&#x7279;&#x6027;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x6765;&#x5B8C;&#x6210;IO&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x79CD;&#x505A;&#x6CD5;&#x4F1A;&#x989D;&#x5916;&#x5360;&#x7528;CPU&#x8D44;&#x6E90;&#xFF08;&#x5BF9;&#x7EBF;&#x7A0B;&#x7684;&#x521B;&#x5EFA;&#x3001;&#x9500;&#x6BC1;&#x3001;&#x8C03;&#x5EA6;&#x90FD;&#x5B58;&#x5728;CPU&#x5F00;&#x9500;&#xFF0C;&#x5E76;&#x4E14;&#x8C03;&#x7528;&#x8005;&#x7EBF;&#x7A0B;&#x548C;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x4E4B;&#x95F4;&#x8FD8;&#x5B58;&#x5728;&#x7EBF;&#x7A0B;&#x95F4;&#x901A;&#x4FE1;&#x7684;&#x5F00;&#x9500;&#xFF09;&#x3002;&#x4E0D;&#x8FC7;&#xFF0C;IO&#x8BF7;&#x6C42;&#x63D0;&#x4EA4;&#x7684;&#x8FC7;&#x7A0B;&#x90FD;&#x7531;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x6765;&#x5B8C;&#x6210;&#x4E86;&#xFF08;&#x800C;linux&#x7248;&#x672C;&#x662F;&#x8C03;&#x7528;&#x8005;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x8BF7;&#x6C42;&#x63D0;&#x4EA4;&#xFF09;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x7EBF;&#x7A0B;&#x53EF;&#x4EE5;&#x66F4;&#x5FEB;&#x5730;&#x54CD;&#x5E94;&#x5176;&#x4ED6;&#x4E8B;&#x60C5;&#x3002;&#x5982;&#x679C;CPU&#x8D44;&#x6E90;&#x5F88;&#x5BCC;&#x8DB3;&#xFF0C;&#x8FD9;&#x79CD;&#x5B9E;&#x73B0;&#x5012;&#x4E5F;&#x8FD8;&#x4E0D;&#x9519;&#x3002;</p>
<p>&#x8FD8;&#x6709;&#x4E00;&#x70B9;&#xFF0C;&#x5F53;&#x8C03;&#x7528;&#x8005;&#x8FDE;&#x7EED;&#x8C03;&#x7528;&#x5F02;&#x6B65;IO&#x63A5;&#x53E3;&#xFF0C;&#x63D0;&#x4EA4;&#x591A;&#x4E2A;&#x5F02;&#x6B65;IO&#x8BF7;&#x6C42;&#x65F6;&#x3002;&#x5728;glibc&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x4E2D;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;fd&#x7684;&#x8BFB;&#x5199;&#x8BF7;&#x6C42;&#x7531;&#x540C;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x6765;&#x5B8C;&#x6210;&#x3002;&#x800C;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x53C8;&#x662F;&#x540C;&#x6B65;&#x5730;&#x3001;&#x4E00;&#x4E2A;&#x4E00;&#x4E2A;&#x5730;&#x53BB;&#x5904;&#x7406;&#x8FD9;&#x4E9B;&#x8BF7;&#x6C42;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x5BF9;&#x4E8E;&#x5E95;&#x5C42;&#x7684;IO&#x8C03;&#x5EA6;&#x5668;&#x6765;&#x8BF4;&#xFF0C;&#x5B83;&#x4E00;&#x6B21;&#x53EA;&#x80FD;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x3002;&#x5904;&#x7406;&#x5B8C;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x5F02;&#x6B65;&#x5904;&#x7406;&#x7EBF;&#x7A0B;&#x624D;&#x4F1A;&#x63D0;&#x4EA4;&#x4E0B;&#x4E00;&#x4E2A;&#x3002;&#x800C;&#x5185;&#x6838;&#x5B9E;&#x73B0;&#x7684;&#x5F02;&#x6B65;IO&#xFF0C;&#x5219;&#x662F;&#x76F4;&#x63A5;&#x5C06;&#x6240;&#x6709;&#x8BF7;&#x6C42;&#x90FD;&#x63D0;&#x4EA4;&#x7ED9;&#x4E86;IO&#x8C03;&#x5EA6;&#x5668;&#xFF0C;IO&#x8C03;&#x5EA6;&#x5668;&#x80FD;&#x770B;&#x5230;&#x6240;&#x6709;&#x7684;&#x8BF7;&#x6C42;&#x3002;&#x8BF7;&#x6C42;&#x591A;&#x4E86;&#xFF0C;IO&#x8C03;&#x5EA6;&#x5668;&#x4F7F;&#x7528;&#x7684;&#x7C7B;&#x7535;&#x68AF;&#x7B97;&#x6CD5;&#x5C31;&#x80FD;&#x53D1;&#x6325;&#x66F4;&#x5927;&#x7684;&#x529F;&#x6548;&#x3002;&#x8BF7;&#x6C42;&#x5C11;&#x4E86;&#xFF0C;&#x6781;&#x7AEF;&#x60C5;&#x51B5;&#x4E0B;&#xFF08;&#x6BD4;&#x5982;&#x7CFB;&#x7EDF;&#x4E2D;&#x7684;IO&#x8BF7;&#x6C42;&#x90FD;&#x96C6;&#x4E2D;&#x5728;&#x540C;&#x4E00;&#x4E2A;fd&#x4E0A;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x4F7F;&#x7528;&#x9884;&#x8BFB;&#xFF09;&#xFF0C;IO&#x8C03;&#x5EA6;&#x5668;&#x603B;&#x662F;&#x53EA;&#x80FD;&#x770B;&#x5230;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x90A3;&#x4E48;&#x7535;&#x68AF;&#x7B97;&#x6CD5;&#x5C06;&#x9000;&#x5316;&#x6210;&#x5148;&#x6765;&#x5148;&#x670D;&#x52A1;&#x7B97;&#x6CD5;&#xFF0C;&#x53EF;&#x80FD;&#x4F1A;&#x6781;&#x5927;&#x7684;&#x589E;&#x52A0;&#x78B0;&#x5934;&#x79FB;&#x52A8;&#x7684;&#x5F00;&#x9500;&#x3002;</p>
<p>&#x6700;&#x540E;&#xFF0C;glibc&#x7248;&#x672C;&#x7684;&#x5F02;&#x6B65;IO&#x652F;&#x6301;&#x975E;direct-io&#xFF0C;&#x53EF;&#x4EE5;&#x5229;&#x7528;&#x5185;&#x6838;&#x63D0;&#x4F9B;&#x7684;page cache&#x6765;&#x63D0;&#x9AD8;&#x6548;&#x7387;&#x3002;&#x800C;linux&#x7248;&#x672C;&#x53EA;&#x652F;&#x6301;direct-io&#xFF0C;cache&#x7684;&#x5DE5;&#x4F5C;&#x5C31;&#x53EA;&#x80FD;&#x9760;&#x7528;&#x6237;&#x7A0B;&#x5E8F;&#x6765;&#x5B9E;&#x73B0;&#x4E86;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x6765;&amp;#x81EA;: CSDN http://blog.csdn.net/zhang_shuai_2011/article/details/7678990 2012-06-20&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x77E5;&amp;#x9053;&amp;#x5F02;&amp;#x6B65;IO&amp;#x5DF2;&amp;#x7ECF;&amp;#x5F88;&amp;#x4E45;&amp;#x4E86;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;&amp;#x76F4;&amp;#x5230;&amp;#x6700;&amp;#x8FD1;&amp;#xFF0C;&amp;#x624D;&amp;#x771F;&amp;#x6B63;&amp;#x7528;&amp;#x5B83;&amp;#x6765;&amp;#x89E3;&amp;#x51B3;&amp;#x4E00;&amp;#x4E0B;&amp;#x5B9E;&amp;#x9645;&amp;#x95EE;&amp;#x9898;&amp;#xFF08;&amp;#x5728;&amp;#x4E00;&amp;#x4E2A;CPU&amp;#x5BC6;&amp;#x96C6;&amp;#x578B;&amp;#x7684;&amp;#x5E94;&amp;#x7528;&amp;#x4E2D;&amp;#xFF0C;&amp;#x6709;&amp;#x4E00;&amp;#x4E9B;&amp;#x9700;&amp;#x8981;&amp;#x5904;&amp;#x7406;&amp;#x7684;&amp;#x6570;&amp;#x636E;&amp;#x53EF;&amp;#x80FD;&amp;#x653E;&amp;#x5728;&amp;#x78C1;&amp;#x76D8;&amp;#x4E0A;&amp;#x3002;&amp;#x9884;&amp;#x5148;&amp;#x77E5;&amp;#x9053;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x4F4D;&amp;#x7F6E;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x9884;&amp;#x5148;&amp;#x53D1;&amp;#x8D77;&amp;#x5F02;&amp;#x6B65;IO&amp;#x8BFB;&amp;#x8BF7;&amp;#x6C42;&amp;#x3002;&amp;#x7B49;&amp;#x5230;&amp;#x771F;&amp;#x6B63;&amp;#x9700;&amp;#x8981;&amp;#x7528;&amp;#x5230;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6570;&amp;#x636E;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#xFF0C;&amp;#x518D;&amp;#x7B49;&amp;#x5F85;&amp;#x5F02;&amp;#x6B65;IO&amp;#x5B8C;&amp;#x6210;&amp;#x3002;&amp;#x4F7F;&amp;#x7528;&amp;#x4E86;&amp;#x5F02;&amp;#x6B65;IO&amp;#xFF0C;&amp;#x5728;&amp;#x53D1;&amp;#x8D77;IO&amp;#x8BF7;&amp;#x6C42;&amp;#x5230;&amp;#x5B9E;&amp;#x9645;&amp;#x4F7F;&amp;#x7528;&amp;#x6570;&amp;#x636E;&amp;#x8FD9;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x5185;&amp;#xFF0C;&amp;#x7A0B;&amp;#x5E8F;&amp;#x8FD8;&amp;#x53EF;&amp;#x4EE5;&amp;#x7EE7;&amp;#x7EED;&amp;#x505A;&amp;#x5176;&amp;#x4ED6;&amp;#x4E8B;&amp;#x60C5;&amp;#xFF09;&amp;#x3002;&lt;br&gt;&amp;#x5047;&amp;#x6B64;&amp;#x673A;&amp;#x4F1A;&amp;#xFF0C;&amp;#x4E5F;&amp;#x987A;&amp;#x4FBF;&amp;#x7814;&amp;#x7A76;&amp;#x4E86;&amp;#x4E00;&amp;#x4E0B;linux&amp;#x4E0B;&amp;#x7684;&amp;#x5F02;&amp;#x6B65;IO&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;linux&amp;#x4E0B;&amp;#x4E3B;&amp;#x8981;&amp;#x6709;&amp;#x4E24;&amp;#x5957;&amp;#x5F02;&amp;#x6B65;IO&amp;#xFF0C;&amp;#x4E00;&amp;#x5957;&amp;#x662F;&amp;#x7531;glibc&amp;#x5B9E;&amp;#x73B0;&amp;#x7684;&amp;#xFF08;&amp;#x4EE5;&amp;#x4E0B;&amp;#x79F0;&amp;#x4E4B;&amp;#x4E3A;glibc&amp;#x7248;&amp;#x672C;&amp;#xFF09;&amp;#x3001;&amp;#x4E00;&amp;#x5957;&amp;#x662F;&amp;#x7531;linux&amp;#x5185;&amp;#x6838;&amp;#x5B9E;&amp;#x73B0;&amp;#xFF0C;&amp;#x5E76;&amp;#x7531;libaio&amp;#x6765;&amp;#x5C01;&amp;#x88C5;&amp;#x8C03;&amp;#x7528;&amp;#x63A5;&amp;#x53E3;&amp;#xFF08;&amp;#x4EE5;&amp;#x4E0B;&amp;#x79F0;&amp;#x4E4B;&amp;#x4E3A;linux&amp;#x7248;&amp;#x672C;&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
    
    </summary>
    
      <category term="I/O" scheme="http://snowyying.github.io/categories/I-O/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="I/O" scheme="http://snowyying.github.io/tags/I-O/"/>
    
      <category term="性能" scheme="http://snowyying.github.io/tags/%E6%80%A7%E8%83%BD/"/>
    
      <category term="linux" scheme="http://snowyying.github.io/tags/linux/"/>
    
      <category term="异步" scheme="http://snowyying.github.io/tags/%E5%BC%82%E6%AD%A5/"/>
    
  </entry>
  
  <entry>
    <title>两种高性能 I/O 设计模式 (Reactor/Proactor) 的比较</title>
    <link href="http://snowyying.github.io/2016/io-reactor-and-proactor/"/>
    <id>http://snowyying.github.io/2016/io-reactor-and-proactor/</id>
    <published>2016-08-07T06:46:47.000Z</published>
    <updated>2016-09-10T08:28:22.329Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x6765;&#x81EA;: &#x4F2F;&#x4E50;&#x5728;&#x7EBF; IT&#x6280;&#x672F; &#x8BBE;&#x8BA1;&#x6A21;&#x5F0F; http://blog.jobbole.com/59676/ 2014/02/17</code></p>
<h2 id="&#x7EFC;&#x8FF0;"><a href="#&#x7EFC;&#x8FF0;" class="headerlink" title="&#x7EFC;&#x8FF0;"></a>&#x7EFC;&#x8FF0;</h2><p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x63A2;&#x8BA8;&#x5E76;&#x6BD4;&#x8F83;&#x4E24;&#x79CD;&#x7528;&#x4E8E;TCP&#x670D;&#x52A1;&#x5668;&#x7684;&#x9AD8;&#x6027;&#x80FD;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x3002; &#x9664;&#x4E86;&#x4ECB;&#x7ECD;&#x73B0;&#x6709;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF0C;&#x8FD8;&#x63D0;&#x51FA;&#x4E86;&#x4E00;&#x79CD;&#x66F4;&#x5177;&#x4F38;&#x7F29;&#x6027;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x7EF4;&#x62A4;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#x5E76;&#x4E14;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;(&#x542B;&#x4EE3;&#x7801;&#x793A;&#x4F8B;)&#xFF0C;&#x4EE5;&#x53CA;&#x5176;&#x5728;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x4E0A;&#x7684;&#x5FAE;&#x8C03;&#x3002; &#x6B64;&#x6587;&#x8FD8;&#x6BD4;&#x8F83;&#x4E86;java&#x3001;c#&#x3001;c++&#x5BF9;&#x5404;&#x81EA;&#x73B0;&#x6709;&#x4EE5;&#x53CA;&#x63D0;&#x5230;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x7684;&#x5B9E;&#x73B0;&#x6027;&#x80FD;&#x3002;</p>
<p>&#x7CFB;&#x7EDF;I/O &#x53EF;&#x5206;&#x4E3A;&#x963B;&#x585E;&#x578B;&#xFF0C; &#x975E;&#x963B;&#x585E;&#x540C;&#x6B65;&#x578B;&#x4EE5;&#x53CA;&#x975E;&#x963B;&#x585E;&#x5F02;&#x6B65;&#x578B;[1&#x3001;2]&#x3002; &#x963B;&#x585E;&#x578B;I/O&#x610F;&#x5473;&#x7740;&#x63A7;&#x5236;&#x6743;&#x53EA;&#x5230;&#x8C03;&#x7528;&#x64CD;&#x4F5C;&#x7ED3;&#x675F;&#x4E86;&#x624D;&#x4F1A;&#x56DE;&#x5230;&#x8C03;&#x7528;&#x8005;&#x624B;&#x91CC;&#x3002; &#x7ED3;&#x679C;&#x8C03;&#x7528;&#x8005;&#x88AB;&#x963B;&#x585E;&#x4E86;&#xFF0C; &#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x4E86;&#x505A;&#x4E0D;&#x4E86;&#x4EFB;&#x4F55;&#x5176;&#x5B83;&#x4E8B;&#x60C5;&#x3002; &#x66F4;&#x90C1;&#x95F7;&#x7684;&#x662F;&#xFF0C;&#x5728;&#x7B49;&#x5F85;IO&#x7ED3;&#x679C;&#x7684;&#x65F6;&#x95F4;&#x91CC;&#xFF0C;&#x8C03;&#x7528;&#x8005;&#x6240;&#x5728;&#x7EBF;&#x7A0B;&#x6B64;&#x65F6;&#x65E0;&#x6CD5;&#x817E;&#x51FA;&#x624B;&#x6765;&#x53BB;&#x54CD;&#x5E94;&#x5176;&#x5B83;&#x7684;&#x8BF7;&#x6C42;&#xFF0C;&#x8FD9;&#x771F;&#x662F;&#x592A;&#x6D6A;&#x8D39;&#x8D44;&#x6E90;&#x4E86;&#x3002;&#x62FF;read()&#x64CD;&#x4F5C;&#x6765;&#x8BF4;&#x5427;&#xFF0C; &#x8C03;&#x7528;&#x6B64;&#x51FD;&#x6570;&#x7684;&#x4EE3;&#x7801;&#x4F1A;&#x4E00;&#x76F4;&#x50F5;&#x5728;&#x6B64;&#x5904;&#x76F4;&#x81F3;&#x5B83;&#x6240;&#x8BFB;&#x7684;socket&#x7F13;&#x5B58;&#x4E2D;&#x6709;&#x6570;&#x636E;&#x5230;&#x6765;&#x3002;</p>
<p>&#x76F8;&#x6BD4;&#x4E4B;&#x4E0B;&#xFF0C;&#x975E;&#x963B;&#x585E;&#x540C;&#x6B65;&#x662F;&#x4F1A;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x63A7;&#x5236;&#x6743;&#x7ED9;&#x8C03;&#x7528;&#x8005;&#x7684;&#x3002;&#x8C03;&#x7528;&#x8005;&#x4E0D;&#x9700;&#x8981;&#x7B49;&#x7B49;&#xFF0C;&#x5B83;&#x4ECE;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x83B7;&#x53D6;&#x4E24;&#x79CD;&#x7ED3;&#x679C;&#xFF1A;&#x8981;&#x4E48;&#x6B64;&#x6B21;&#x8C03;&#x7528;&#x6210;&#x529F;&#x8FDB;&#x884C;&#x4E86;;&#x8981;&#x4E48;&#x7CFB;&#x7EDF;&#x8FD4;&#x56DE;&#x9519;&#x8BEF;&#x6807;&#x8BC6;&#x544A;&#x8BC9;&#x8C03;&#x7528;&#x8005;&#x5F53;&#x524D;&#x8D44;&#x6E90;&#x4E0D;&#x53EF;&#x7528;&#xFF0C;&#x4F60;&#x518D;&#x7B49;&#x7B49;&#x6216;&#x8005;&#x518D;&#x8BD5;&#x5EA6;&#x770B;&#x5427;&#x3002;&#x6BD4;&#x5982;read()&#x64CD;&#x4F5C;&#xFF0C; &#x5982;&#x679C;&#x5F53;&#x524D;socket&#x65E0;&#x6570;&#x636E;&#x53EF;&#x8BFB;&#xFF0C;&#x5219;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;EWOULBLOCK/EAGAIN&#xFF0C;&#x544A;&#x8BC9;&#x8C03;&#x7528;read()&#x8005;&#x201D;&#x6570;&#x636E;&#x8FD8;&#x6CA1;&#x51C6;&#x5907;&#x597D;&#xFF0C;&#x4F60;&#x7A0D;&#x540E;&#x518D;&#x8BD5;&#x201D;&#x3002;</p>
<p>&#x5728;&#x975E;&#x963B;&#x585E;&#x5F02;&#x6B65;&#x8C03;&#x7528;&#x4E2D;&#xFF0C;&#x7A0D;&#x6709;&#x4E0D;&#x540C;&#x3002;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x5728;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x65F6;&#xFF0C;&#x8FD8;&#x544A;&#x8BC9;&#x8C03;&#x7528;&#x8005;&#xFF0C;&#x8FD9;&#x6B21;&#x8BF7;&#x6C42;&#x5DF2;&#x7ECF;&#x5F00;&#x59CB;&#x4E86;&#x3002;&#x7CFB;&#x7EDF;&#x4F1A;&#x4F7F;&#x7528;&#x53E6;&#x5916;&#x7684;&#x8D44;&#x6E90;&#x6216;&#x8005;&#x7EBF;&#x7A0B;&#x6765;&#x5B8C;&#x6210;&#x8FD9;&#x6B21;&#x8C03;&#x7528;&#x64CD;&#x4F5C;&#xFF0C;&#x5E76;&#x5728;&#x5B8C;&#x6210;&#x7684;&#x65F6;&#x5019;&#x77E5;&#x4F1A;&#x8C03;&#x7528;&#x8005;&#xFF08;&#x6BD4;&#x5982;&#x901A;&#x8FC7;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF09;&#x3002;&#x62FF;Windows&#x7684;ReadFile()&#x6216;&#x8005;POSIX&#x7684;aio_read()&#x6765;&#x8BF4;&#xFF0C;&#x8C03;&#x7528;&#x5B83;&#x4E4B;&#x540E;&#xFF0C;&#x51FD;&#x6570;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5728;&#x540E;&#x53F0;&#x540C;&#x65F6;&#x5F00;&#x59CB;&#x8BFB;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x5728;&#x4EE5;&#x4E0A;&#x4E09;&#x79CD;IO&#x5F62;&#x5F0F;&#x4E2D;&#xFF0C;&#x975E;&#x963B;&#x585E;&#x5F02;&#x6B65;&#x662F;&#x6027;&#x80FD;&#x6700;&#x9AD8;&#x3001;&#x4F38;&#x7F29;&#x6027;&#x6700;&#x597D;&#x7684;&#x3002;</p>
<p>&#x8FD9;&#x7BC7;&#x6587;&#x7AE0;&#x63A2;&#x8BA8;&#x4E0D;&#x540C;&#x7684;I/O&#x5229;&#x7528;&#x673A;&#x5236;&#x5E76;&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;(&#x89E3;&#x51B3;&#x65B9;&#x6848;)&#x3002; &#x5E0C;&#x671B;&#x6B64;&#x6587;&#x53EF;&#x4EE5;&#x7ED9;&#x4E8E;TCP&#x9AD8;&#x6027;&#x80FD;&#x670D;&#x52A1;&#x5668;&#x5F00;&#x53D1;&#x8005;&#x4E00;&#x4E9B;&#x5E2E;&#x52A9;&#xFF0C;&#x9009;&#x62E9;&#x6700;&#x4F73;&#x7684;&#x8BBE;&#x8BA1;&#x65B9;&#x6848;&#x3002;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x4F1A;&#x6BD4;&#x8F83; Java&#x3001;C#&#x3001; C++&#x5404;&#x81EA;&#x5BF9;&#x63A2;&#x8BA8;&#x65B9;&#x6848;&#x7684;&#x5B9E;&#x73B0;&#x4EE5;&#x53CA;&#x6027;&#x80FD;&#x3002; &#x6211;&#x4EEC;&#x5728;&#x6587;&#x7AE0;&#x7684;&#x540E;&#x9762;&#x5C31;&#x4E0D;&#x518D;&#x63D0;&#x53CA;&#x963B;&#x585E;&#x5F0F;&#x7684;&#x65B9;&#x6848;&#x4E86;&#xFF0C;&#x56E0;&#x4E3A;&#x963B;&#x585E;&#x5F0F;I/O&#x5B9E;&#x5728;&#x662F;&#x7F3A;&#x5C11;&#x53EF;&#x4F38;&#x7F29;&#x6027;&#xFF0C;&#x6027;&#x80FD;&#x4E5F;&#x8FBE;&#x4E0D;&#x5230;&#x9AD8;&#x6027;&#x80FD;&#x670D;&#x52A1;&#x5668;&#x7684;&#x8981;&#x6C42;&#x3002;</p>
<a id="more"></a>
<h2 id="&#x4E24;&#x79CD;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x65B9;&#x6848;-Reactor-and-Proactor"><a href="#&#x4E24;&#x79CD;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x65B9;&#x6848;-Reactor-and-Proactor" class="headerlink" title="&#x4E24;&#x79CD;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x65B9;&#x6848;: Reactor and Proactor"></a>&#x4E24;&#x79CD;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x65B9;&#x6848;: Reactor and Proactor</h2><p>&#x4E00;&#x822C;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;I/O &#x590D;&#x7528;&#x673A;&#x5236;&#x9700;&#x8981;&#x4E8B;&#x4EF6;&#x5206;&#x4EAB;&#x5668;(event demultiplexor [1&#x3001;3])&#x3002; &#x4E8B;&#x4EF6;&#x5206;&#x4EAB;&#x5668;&#x7684;&#x4F5C;&#x7528;&#xFF0C;&#x5373;&#x5C06;&#x90A3;&#x4E9B;&#x8BFB;&#x5199;&#x4E8B;&#x4EF6;&#x6E90;&#x5206;&#x53D1;&#x7ED9;&#x5404;&#x8BFB;&#x5199;&#x4E8B;&#x4EF6;&#x7684;&#x5904;&#x7406;&#x8005;&#xFF0C;&#x5C31;&#x50CF;&#x9001;&#x5FEB;&#x9012;&#x7684;&#x5728;&#x697C;&#x4E0B;&#x558A;: &#x8C01;&#x7684;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#x9001;&#x4E86;&#xFF0C; &#x5FEB;&#x6765;&#x62FF;&#x5427;&#x3002;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x5728;&#x5F00;&#x59CB;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x5728;&#x5206;&#x4EAB;&#x5668;&#x90A3;&#x91CC;&#x6CE8;&#x518C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x8005;(event handlers)&#xFF0C;&#x6216;&#x8005;&#x662F;&#x56DE;&#x8C03;&#x51FD;&#x6570;; &#x4E8B;&#x4EF6;&#x5206;&#x4EAB;&#x5668;&#x5728;&#x9002;&#x5F53;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5C06;&#x8BF7;&#x6C42;&#x7684;&#x4E8B;&#x4EF6;&#x5206;&#x53D1;&#x7ED9;&#x8FD9;&#x4E9B;handler&#x6216;&#x8005;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x3002;</p>
<p>&#x6D89;&#x53CA;&#x5230;&#x4E8B;&#x4EF6;&#x5206;&#x4EAB;&#x5668;&#x7684;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x79F0;&#x4E3A;&#xFF1A;Reactor and Proactor [1]&#x3002; Reactor&#x6A21;&#x5F0F;&#x662F;&#x57FA;&#x4E8E;&#x540C;&#x6B65;I/O&#x7684;&#xFF0C;&#x800C;Proactor&#x6A21;&#x5F0F;&#x662F;&#x548C;&#x5F02;&#x6B65;I/O&#x76F8;&#x5173;&#x7684;&#x3002; &#x5728;Reactor&#x6A21;&#x5F0F;&#x4E2D;&#xFF0C;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#x7B49;&#x5F85;&#x67D0;&#x4E2A;&#x4E8B;&#x4EF6;&#x6216;&#x8005;&#x53EF;&#x5E94;&#x7528;&#x6216;&#x4E2A;&#x64CD;&#x4F5C;&#x7684;&#x72B6;&#x6001;&#x53D1;&#x751F;&#xFF08;&#x6BD4;&#x5982;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x53EF;&#x8BFB;&#x5199;&#xFF0C;&#x6216;&#x8005;&#x662F;socket&#x53EF;&#x8BFB;&#x5199;&#xFF09;&#xFF0C;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#x5C31;&#x628A;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x4F20;&#x7ED9;&#x4E8B;&#x5148;&#x6CE8;&#x518C;&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x51FD;&#x6570;&#x6216;&#x8005;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x7531;&#x540E;&#x8005;&#x6765;&#x505A;&#x5B9E;&#x9645;&#x7684;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x3002;</p>
<p>&#x800C;&#x5728;Proactor&#x6A21;&#x5F0F;&#x4E2D;&#xFF0C;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;(&#x6216;&#x8005;&#x4EE3;&#x7531;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#x53D1;&#x8D77;)&#x76F4;&#x63A5;&#x53D1;&#x8D77;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;(&#x76F8;&#x5F53;&#x4E8E;&#x8BF7;&#x6C42;)&#xFF0C;&#x800C;&#x5B9E;&#x9645;&#x7684;&#x5DE5;&#x4F5C;&#x662F;&#x7531;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x6765;&#x5B8C;&#x6210;&#x7684;&#x3002;&#x53D1;&#x8D77;&#x65F6;&#xFF0C;&#x9700;&#x8981;&#x63D0;&#x4F9B;&#x7684;&#x53C2;&#x6570;&#x5305;&#x62EC;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x8BFB;&#x5230;&#x6570;&#x636E;&#x7684;&#x7F13;&#x5B58;&#x533A;&#xFF0C;&#x8BFB;&#x7684;&#x6570;&#x636E;&#x5927;&#x5C0F;&#xFF0C;&#x6216;&#x8005;&#x7528;&#x4E8E;&#x5B58;&#x653E;&#x5916;&#x53D1;&#x6570;&#x636E;&#x7684;&#x7F13;&#x5B58;&#x533A;&#xFF0C;&#x4EE5;&#x53CA;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x5B8C;&#x540E;&#x7684;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#x7B49;&#x4FE1;&#x606F;&#x3002;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#x5F97;&#x77E5;&#x4E86;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x5B83;&#x9ED8;&#x9ED8;&#x7B49;&#x5F85;&#x8FD9;&#x4E2A;&#x8BF7;&#x6C42;&#x7684;&#x5B8C;&#x6210;&#xFF0C;&#x7136;&#x540E;&#x8F6C;&#x53D1;&#x5B8C;&#x6210;&#x4E8B;&#x4EF6;&#x7ED9;&#x76F8;&#x5E94;&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x6216;&#x8005;&#x56DE;&#x8C03;&#x3002;&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF0C;&#x5728;Windows&#x4E0A;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x6295;&#x9012;&#x4E86;&#x4E00;&#x4E2A;&#x5F02;&#x6B65;IO&#x64CD;&#x4F5C;(&#x79F0;&#x6709;overlapped&#x7684;&#x6280;&#x672F;)&#xFF0C;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#x7B49;IOCompletion&#x4E8B;&#x4EF6;&#x5B8C;&#x6210;[1]&#x3002; &#x8FD9;&#x79CD;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x7684;&#x5178;&#x578B;&#x5B9E;&#x73B0;&#x662F;&#x57FA;&#x4E8E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5E95;&#x5C42;&#x5F02;&#x6B65;API&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x53EF;&#x79F0;&#x4E4B;&#x4E3A;&#x201C;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x201D;&#x7684;&#x6216;&#x8005;&#x201C;&#x771F;&#x6B63;&#x610F;&#x4E49;&#x4E0A;&#x201D;&#x7684;&#x5F02;&#x6B65;&#xFF0C;&#x56E0;&#x4E3A;&#x5177;&#x4F53;&#x7684;&#x8BFB;&#x5199;&#x662F;&#x7531;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4EE3;&#x52B3;&#x7684;&#x3002;</p>
<p>&#x4E3E;&#x53E6;&#x5916;&#x4E2A;&#x4F8B;&#x5B50;&#x6765;&#x66F4;&#x597D;&#x5730;&#x7406;&#x89E3;Reactor&#x4E0E;Proactor&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x7684;&#x533A;&#x522B;&#x3002;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x53EA;&#x5173;&#x6CE8;read&#x64CD;&#x4F5C;&#xFF0C;&#x56E0;&#x4E3A;write&#x64CD;&#x4F5C;&#x4E5F;&#x662F;&#x5DEE;&#x4E0D;&#x591A;&#x7684;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x662F;Reactor&#x7684;&#x505A;&#x6CD5;&#xFF1A;</p>
<ul>
<li>&#x67D0;&#x4E2A;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x5BA3;&#x79F0;&#x5B83;&#x5BF9;&#x67D0;&#x4E2A;socket&#x4E0A;&#x7684;&#x8BFB;&#x4E8B;&#x4EF6;&#x5F88;&#x611F;&#x5174;&#x8DA3;;</li>
<li>&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#x7B49;&#x7740;&#x8FD9;&#x4E2A;&#x4E8B;&#x4EF6;&#x7684;&#x53D1;&#x751F;;</li>
<li>&#x5F53;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x4E86;&#xFF0C;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x5668;&#x88AB;&#x5524;&#x9192;&#xFF0C;&#x8FD9;&#x8D1F;&#x8D23;&#x901A;&#x77E5;&#x5148;&#x524D;&#x90A3;&#x4E2A;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;;</li>
<li>&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x6536;&#x5230;&#x6D88;&#x606F;&#xFF0C;&#x4E8E;&#x662F;&#x53BB;&#x90A3;&#x4E2A;socket&#x4E0A;&#x8BFB;&#x6570;&#x636E;&#x4E86;&#x3002; &#x5982;&#x679C;&#x9700;&#x8981;&#xFF0C;&#x5B83;&#x518D;&#x6B21;&#x5BA3;&#x79F0;&#x5BF9;&#x8FD9;&#x4E2A;socket&#x4E0A;&#x7684;&#x8BFB;&#x4E8B;&#x4EF6;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x4E00;&#x76F4;&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x6B65;&#x9AA4;;</li>
</ul>
<p>&#x4E0B;&#x9762;&#x518D;&#x6765;&#x770B;&#x770B;&#x771F;&#x6B63;&#x610F;&#x4E49;&#x7684;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;Proactor&#x662F;&#x5982;&#x4F55;&#x505A;&#x7684;&#xFF1A;</p>
<ul>
<li>&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x76F4;&#x63A5;&#x6295;&#x9012;&#x53D1;&#x4E00;&#x4E2A;&#x5199;&#x64CD;&#x4F5C;(&#x5F53;&#x7136;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5FC5;&#x987B;&#x652F;&#x6301;&#x8FD9;&#x4E2A;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;)&#x3002; &#x8FD9;&#x4E2A;&#x65F6;&#x5019;&#xFF0C;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x6839;&#x672C;&#x4E0D;&#x5173;&#x5FC3;&#x8BFB;&#x4E8B;&#x4EF6;&#xFF0C;&#x5B83;&#x53EA;&#x7BA1;&#x53D1;&#x8FD9;&#x4E48;&#x4E2A;&#x8BF7;&#x6C42;&#xFF0C;&#x5B83;&#x9B42;&#x7275;&#x68A6;&#x8426;&#x7684;&#x662F;&#x8FD9;&#x4E2A;&#x5199;&#x64CD;&#x4F5C;&#x7684;&#x5B8C;&#x6210;&#x4E8B;&#x4EF6;&#x3002;&#x8FD9;&#x4E2A;&#x5904;&#x7406;&#x8005;&#x5F88;&#x62FD;&#xFF0C;&#x53D1;&#x4E2A;&#x547D;&#x4EE4;&#x5C31;&#x4E0D;&#x7BA1;&#x5177;&#x4F53;&#x7684;&#x4E8B;&#x60C5;&#x4E86;&#xFF0C;&#x53EA;&#x7B49;&#x7740;&#x522B;&#x4EBA;&#xFF08;&#x7CFB;&#x7EDF;&#xFF09;&#x5E2E;&#x4ED6;&#x641E;&#x5B9A;&#x7684;&#x65F6;&#x5019;&#x7ED9;&#x4ED6;&#x56DE;&#x4E2A;&#x8BDD;&#x3002;</li>
<li>&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#x7B49;&#x7740;&#x8FD9;&#x4E2A;&#x8BFB;&#x4E8B;&#x4EF6;&#x7684;&#x5B8C;&#x6210;(&#x6BD4;&#x8F83;&#x4E0B;&#x4E0E;Reactor&#x7684;&#x4E0D;&#x540C;);</li>
<li>&#x5F53;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#x9ED8;&#x9ED8;&#x7B49;&#x5F85;&#x5B8C;&#x6210;&#x4E8B;&#x60C5;&#x5230;&#x6765;&#x7684;&#x540C;&#x65F6;&#xFF0C;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5DF2;&#x7ECF;&#x5728;&#x4E00;&#x8FB9;&#x5F00;&#x59CB;&#x5E72;&#x6D3B;&#x4E86;&#xFF0C;&#x5B83;&#x4ECE;&#x76EE;&#x6807;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x653E;&#x5165;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x7684;&#x7F13;&#x5B58;&#x533A;&#x4E2D;&#xFF0C;&#x6700;&#x540E;&#x901A;&#x77E5;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x8005;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E8B;&#x60C5;&#x6211;&#x641E;&#x5B8C;&#x4E86;;</li>
<li>&#x4E8B;&#x4EF6;&#x5206;&#x4EAB;&#x8005;&#x901A;&#x77E5;&#x4E4B;&#x524D;&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;: &#x4F60;&#x5429;&#x5490;&#x7684;&#x4E8B;&#x60C5;&#x641E;&#x5B9A;&#x4E86;;</li>
<li>&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x8FD9;&#x65F6;&#x4F1A;&#x53D1;&#x73B0;&#x60F3;&#x8981;&#x8BFB;&#x7684;&#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x4E56;&#x4E56;&#x5730;&#x653E;&#x5728;&#x4ED6;&#x63D0;&#x4F9B;&#x7684;&#x7F13;&#x5B58;&#x533A;&#x4E2D;&#xFF0C;&#x60F3;&#x600E;&#x4E48;&#x5904;&#x7406;&#x90FD;&#x884C;&#x4E86;&#x3002;&#x5982;&#x679C;&#x6709;&#x9700;&#x8981;&#xFF0C;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x8FD8;&#x50CF;&#x4E4B;&#x524D;&#x4E00;&#x6837;&#x53D1;&#x8D77;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x548C;&#x4E0A;&#x9762;&#x7684;&#x51E0;&#x4E2A;&#x6B65;&#x9AA4;&#x4E00;&#x6837;&#x3002;</li>
</ul>
<h2 id="&#x73B0;&#x884C;&#x505A;&#x6CD5;"><a href="#&#x73B0;&#x884C;&#x505A;&#x6CD5;" class="headerlink" title="&#x73B0;&#x884C;&#x505A;&#x6CD5;"></a>&#x73B0;&#x884C;&#x505A;&#x6CD5;</h2><p>&#x5F00;&#x6E90;C++&#x5F00;&#x53D1;&#x6846;&#x67B6; ACE[1&#x3001;3](Douglas Schmidt, et al.&#x5F00;&#x53D1;) &#x63D0;&#x4F9B;&#x4E86;&#x5927;&#x91CF;&#x5E73;&#x53F0;&#x72EC;&#x7ACB;&#x7684;&#x5E95;&#x5C42;&#x5E76;&#x53D1;&#x652F;&#x6301;&#x7C7B;(&#x7EBF;&#x7A0B;&#x3001;&#x4E92;&#x65A5;&#x91CF;&#x7B49;)&#x3002; &#x540C;&#x65F6;&#x5728;&#x66F4;&#x9AD8;&#x4E00;&#x5C42;&#x5B83;&#x4E5F;&#x63D0;&#x4F9B;&#x4E86;&#x72EC;&#x7ACB;&#x7684;&#x51E0;&#x7EC4;C++&#x7C7B;&#xFF0C;&#x7528;&#x4E8E;&#x5B9E;&#x73B0;Reactor&#x53CA;Proactor&#x6A21;&#x5F0F;&#x3002; &#x5C3D;&#x7BA1;&#x5B83;&#x4EEC;&#x90FD;&#x662F;&#x5E73;&#x53F0;&#x72EC;&#x7ACB;&#x7684;&#x5355;&#x5143;&#xFF0C;&#x4F46;&#x4ED6;&#x4EEC;&#x90FD;&#x63D0;&#x4F9B;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x63A5;&#x53E3;&#x3002;</p>
<p>ACE Proactor&#x5728;MS-Windows&#x4E0A;&#x65E0;&#x8BBA;&#x662F;&#x6027;&#x80FD;&#x8FD8;&#x5728;&#x5065;&#x58EE;&#x6027;&#x90FD;&#x66F4;&#x80DC;&#x4E00;&#x7B79;&#xFF0C;&#x8FD9;&#x4E3B;&#x8981;&#x662F;&#x7531;&#x4E8E;Windows&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x7CFB;&#x5217;&#x9AD8;&#x6548;&#x7684;&#x5E95;&#x5C42;&#x5F02;&#x6B65;API&#x3002; [4&#x3001;5]&#x3002;</p>
<p>(&#x8FD9;&#x6BB5;&#x53EF;&#x80FD;&#x8FC7;&#x65F6;&#x4E86;&#x70B9;&#x5427;) &#x4E0D;&#x5E78;&#x7684;&#x662F;&#xFF0C;&#x5E76;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x90FD;&#x4E3A;&#x5E95;&#x5C42;&#x5F02;&#x6B65;&#x63D0;&#x4F9B;&#x5065;&#x58EE;&#x7684;&#x652F;&#x6301;&#x3002;&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF0C; &#x8BB8;&#x591A;Unix&#x7CFB;&#x7EDF;&#x5C31;&#x6709;&#x9EBB;&#x70E6;&#x3002;&#x56E0;&#x6B64;&#xFF0C; ACE Reactor&#x53EF;&#x80FD;&#x662F;Unix&#x7CFB;&#x7EDF;&#x4E0A;&#x66F4;&#x5408;&#x9002;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002; &#x6B63;&#x56E0;&#x4E3A;&#x7CFB;&#x7EDF;&#x5E95;&#x5C42;&#x7684;&#x652F;&#x6301;&#x529B;&#x5EA6;&#x4E0D;&#x4E00;&#xFF0C;&#x4E3A;&#x4E86;&#x5728;&#x5404;&#x7CFB;&#x7EDF;&#x4E0A;&#x6709;&#x66F4;&#x597D;&#x7684;&#x6027;&#x80FD;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x4E0D;&#x5F97;&#x4E0D;&#x7EF4;&#x62A4;&#x72EC;&#x7ACB;&#x7684;&#x597D;&#x51E0;&#x4EFD;&#x4EE3;&#x7801;: &#x4E3A;Windows&#x51C6;&#x5907;&#x7684;ACE Proactor&#x4EE5;&#x53CA;&#x4E3A;Unix&#x7CFB;&#x5217;&#x63D0;&#x4F9B;&#x7684;ACE Reactor&#x3002;</p>
<p>&#x5C31;&#x50CF;&#x6211;&#x4EEC;&#x63D0;&#x5230;&#x8FC7;&#x7684;&#xFF0C;&#x771F;&#x6B63;&#x7684;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x9700;&#x8981;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x7684;&#x652F;&#x6301;&#x3002;&#x7531;&#x4E8E;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x53CA;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4EA4;&#x4E92;&#x7684;&#x5DEE;&#x5F02;&#xFF0C;&#x4E3A;Reactor&#x548C;Proactor&#x8BBE;&#x8BA1;&#x4E00;&#x79CD;&#x901A;&#x7528;&#x7EDF;&#x4E00;&#x7684;&#x5916;&#x90E8;&#x63A5;&#x53E3;&#x662F;&#x975E;&#x5E38;&#x56F0;&#x96BE;&#x7684;&#x3002;&#x8FD9;&#x4E5F;&#x662F;&#x8BBE;&#x8BA1;&#x901A;&#x884C;&#x5F00;&#x53D1;&#x6846;&#x67B6;&#x7684;&#x96BE;&#x70B9;&#x6240;&#x5728;&#x3002;</p>
<h2 id="&#x66F4;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;"><a href="#&#x66F4;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;" class="headerlink" title="&#x66F4;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;"></a>&#x66F4;&#x597D;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;</h2><p>&#x5728;&#x6587;&#x7AE0;&#x8FD9;&#x4E00;&#x6BB5;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;&#x5C1D;&#x8BD5;&#x63D0;&#x4F9B;&#x4E00;&#x79CD;&#x878D;&#x5408;&#x4E86;Proactor&#x548C;Reactor&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x3002; &#x4E3A;&#x4E86;&#x6F14;&#x793A;&#x8FD9;&#x4E2A;&#x65B9;&#x6848;&#xFF0C;&#x6211;&#x4EEC;&#x5C06;Reactor&#x7A0D;&#x505A;&#x8C03;&#x6574;&#xFF0C;&#x6A21;&#x62DF;&#x6210;&#x5F02;&#x6B65;&#x7684;Proactor&#x6A21;&#x578B;(&#x4E3B;&#x8981;&#x662F;&#x5728;&#x4E8B;&#x4EF6;&#x5206;&#x79BB;&#x5668;&#x91CC;&#x5B8C;&#x6210;&#x672C;&#x8BE5;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x505A;&#x7684;&#x5B9E;&#x9645;&#x8BFB;&#x5199;&#x5DE5;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x79F0;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x4E3A;&#x201D;&#x6A21;&#x62DF;&#x5F02;&#x6B65;&#x201C;)&#x3002; &#x4E0B;&#x9762;&#x7684;&#x793A;&#x4F8B;&#x53EF;&#x4EE5;&#x770B;&#x770B;read&#x64CD;&#x4F5C;&#x662F;&#x5982;&#x4F55;&#x5B8C;&#x6210;&#x7684;:</p>
<ul>
<li>&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x5BA3;&#x79F0;&#x5BF9;&#x8BFB;&#x4E8B;&#x4EF6;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x5E76;&#x63D0;&#x4F9B;&#x4E86;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x7ED3;&#x679C;&#x7684;&#x7F13;&#x5B58;&#x533A;&#x3001;&#x8BFB;&#x6570;&#x636E;&#x957F;&#x5EA6;&#x7B49;&#x53C2;&#x6570;;</li>
<li>&#x8C03;&#x8BD5;&#x8005;&#x7B49;&#x5F85;(&#x6BD4;&#x5982;&#x901A;&#x8FC7;select());</li>
<li>&#x5F53;&#x6709;&#x4E8B;&#x4EF6;&#x5230;&#x6765;(&#x5373;&#x53EF;&#x8BFB;)&#xFF0C;&#x8C03;&#x8BD5;&#x8005;&#x88AB;&#x5524;&#x9192;&#xFF0C; &#x8C03;&#x8BD5;&#x8005;&#x53BB;&#x6267;&#x884C;&#x975E;&#x963B;&#x585E;&#x7684;&#x8BFB;&#x64CD;&#x4F5C;(&#x524D;&#x9762;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x5DF2;&#x7ECF;&#x7ED9;&#x4E86;&#x8DB3;&#x591F;&#x7684;&#x4FE1;&#x606F;&#x4E86;)&#x3002;&#x8BFB;&#x5B8C;&#x540E;&#xFF0C;&#x5B83;&#x53BB;&#x901A;&#x77E5;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x3002;</li>
<li>&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x8FD9;&#x65F6;&#x88AB;&#x77E5;&#x4F1A;&#x8BFB;&#x64CD;&#x4F5C;&#x5DF2;&#x5B8C;&#x6210;&#xFF0C;&#x5B83;&#x62E5;&#x6709;&#x5B8C;&#x6574;&#x7684;&#x539F;&#x5148;&#x60F3;&#x8981;&#x83B7;&#x53D6;&#x7684;&#x6570;&#x636E;&#x4E86;&#x3002;</li>
</ul>
<p>&#x6211;&#x4EEC;&#x770B;&#x5230;&#xFF0C;&#x901A;&#x8FC7;&#x4E3A;&#x5206;&#x79BB;&#x8005;(&#x4E5F;&#x5C31;&#x4E0A;&#x9762;&#x7684;&#x8C03;&#x8BD5;&#x8005;)&#x6DFB;&#x52A0;&#x4E00;&#x4E9B;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x8BA9;Reactor&#x6A21;&#x5F0F;&#x8F6C;&#x6362;&#x4E3A;Proactor&#x6A21;&#x5F0F;&#x3002;&#x6240;&#x6709;&#x8FD9;&#x4E9B;&#x88AB;&#x6267;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#xFF0C;&#x5176;&#x5B9E;&#x662F;&#x548C;Reactor&#x6A21;&#x578B;&#x5E94;&#x7528;&#x65F6;&#x5B8C;&#x5168;&#x4E00;&#x81F4;&#x7684;&#x3002;&#x6211;&#x4EEC;&#x53EA;&#x662F;&#x628A;&#x5DE5;&#x4F5C;&#x6253;&#x6563;&#x5206;&#x914D;&#x7ED9;&#x4E0D;&#x540C;&#x7684;&#x89D2;&#x8272;&#x53BB;&#x5B8C;&#x6210;&#x800C;&#x5DF2;&#x3002;&#x8FD9;&#x6837;&#x5E76;&#x4E0D;&#x4F1A;&#x6709;&#x989D;&#x5916;&#x7684;&#x5F00;&#x9500;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x6709;&#x6027;&#x80FD;&#x4E0A;&#x7684;&#x7684;&#x635F;&#x5931;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x518D;&#x4ED4;&#x7EC6;&#x770B;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4E24;&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;&#x4ED6;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x5B8C;&#x6210;&#x4E86;&#x4E00;&#x6837;&#x7684;&#x4E8B;&#x60C5;&#xFF1A;</p>
<p>&#x6807;&#x51C6;&#x7684;&#x7ECF;&#x5178;&#x7684; Reactor&#x6A21;&#x5F0F;:</p>
<ul>
<li>&#x6B65;&#x9AA4; 1) &#x7B49;&#x5F85;&#x4E8B;&#x4EF6; (Reactor &#x7684;&#x5DE5;&#x4F5C;)</li>
<li>&#x6B65;&#x9AA4; 2) &#x53D1;&#x201D;&#x5DF2;&#x7ECF;&#x53EF;&#x8BFB;&#x201D;&#x4E8B;&#x4EF6;&#x53D1;&#x7ED9;&#x4E8B;&#x5148;&#x6CE8;&#x518C;&#x7684;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x6216;&#x8005;&#x56DE;&#x8C03; (Reactor &#x8981;&#x505A;&#x7684;)</li>
<li>&#x6B65;&#x9AA4; 3) &#x8BFB;&#x6570;&#x636E; (&#x7528;&#x6237;&#x4EE3;&#x7801;&#x8981;&#x505A;&#x7684;)</li>
<li>&#x6B65;&#x9AA4; 4) &#x5904;&#x7406;&#x6570;&#x636E; (&#x7528;&#x6237;&#x4EE3;&#x7801;&#x8981;&#x505A;&#x7684;)</li>
</ul>
<p>&#x6A21;&#x62DF;&#x7684;Proactor&#x6A21;&#x5F0F;:</p>
<ul>
<li>&#x6B65;&#x9AA4; 1) &#x7B49;&#x5F85;&#x4E8B;&#x4EF6; (Proactor &#x7684;&#x5DE5;&#x4F5C;)</li>
<li>&#x6B65;&#x9AA4; 2) &#x8BFB;&#x6570;&#x636E; (&#x770B;&#xFF0C;&#x8FD9;&#x91CC;&#x53D8;&#x6210;&#x6210;&#x4E86;&#x8BA9; Proactor &#x505A;&#x8FD9;&#x4E2A;&#x4E8B;&#x60C5;)</li>
<li>&#x6B65;&#x9AA4; 3) &#x628A;&#x6570;&#x636E;&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x597D;&#x7684;&#x6D88;&#x606F;&#x7ED9;&#x7528;&#x6237;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x5373;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005; (Proactor &#x8981;&#x505A;&#x7684;)</li>
<li>&#x6B65;&#x9AA4; 4) &#x5904;&#x7406;&#x6570;&#x636E; (&#x7528;&#x6237;&#x4EE3;&#x7801;&#x8981;&#x505A;&#x7684;)</li>
</ul>
<p>&#x5728;&#x6CA1;&#x6709;&#x5E95;&#x5C42;&#x5F02;&#x6B65;I/O API&#x652F;&#x6301;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x5E2E;&#x6211;&#x4EEC;&#x9690;&#x85CF;&#x6389;socket&#x63A5;&#x53E3;&#x7684;&#x5DEE;&#x5F02;(&#x65E0;&#x8BBA;&#x662F;&#x6027;&#x80FD;&#x8FD8;&#x662F;&#x5176;&#x5B83;)&#xFF0C; &#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x5B8C;&#x5168;&#x53EF;&#x7528;&#x7684;&#x7EDF;&#x4E00;&#x201C;&#x5F02;&#x6B65;&#x63A5;&#x53E3;&#x201D;&#x3002;&#x8FD9;&#x6837;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x53D1;&#x771F;&#x6B63;&#x5E73;&#x53F0;&#x72EC;&#x7ACB;&#x7684;&#x901A;&#x7528;&#x63A5;&#x53E3;&#x4E86;&#x3002;</p>
<h2 id="TProactor"><a href="#TProactor" class="headerlink" title="TProactor"></a>TProactor</h2><p>&#x6211;&#x4EEC;&#x63D0;&#x51FA;&#x7684;TProactor&#x65B9;&#x6848;&#x5DF2;&#x7ECF;&#x7531;TerabitP/L [6]&#x516C;&#x53F8;&#x5B9E;&#x73B0;&#x4E86;&#x3002; &#x5B83;&#x6709;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;: C++&#x7684;&#x548C;Java&#x7684;&#x3002;C++&#x7248;&#x672C;&#x4F7F;&#x7528;&#x4E86;ACE&#x5E73;&#x53F0;&#x72EC;&#x7ACB;&#x7684;&#x5E95;&#x5C42;&#x5143;&#x4EF6;&#xFF0C;&#x6700;&#x7EC8;&#x5728;&#x6240;&#x6709;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E0A;&#x63D0;&#x4F9B;&#x4E86;&#x7EDF;&#x4E00;&#x7684;&#x5F02;&#x6B65;&#x63A5;&#x53E3;&#x3002;</p>
<p>TProactor&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x7EC4;&#x4EF6;&#x8981;&#x6570;Engine&#x548C;WaitStrategy&#x4E86;&#x3002; Engine&#x7528;&#x4E8E;&#x7EF4;&#x62A4;&#x5F02;&#x6B65;&#x64CD;&#x4F5C;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF1B;&#x800C;WaitStrategy&#x7528;&#x4E8E;&#x7BA1;&#x7406;&#x5E76;&#x53D1;&#x7B56;&#x7565;&#x3002; WaitStrategy&#x548C;Engine&#x4E00;&#x822C;&#x662F;&#x6210;&#x5BF9;&#x51FA;&#x73B0;&#x7684;&#xFF0C; &#x4E24;&#x8005;&#x95F4;&#x63D0;&#x4F9B;&#x4E86;&#x826F;&#x597D;&#x7684;&#x5339;&#x914D;&#x63A5;&#x53E3;&#x3002;</p>
<p>Engines&#x548C;&#x7B49;&#x5F85;&#x7B56;&#x7565;&#x88AB;&#x8BBE;&#x8BA1;&#x6210;&#x9AD8;&#x5EA6;&#x53EF;&#x7EC4;&#x5408;&#x7684;(&#x5B8C;&#x6574;&#x7684;&#x5B9E;&#x73B0;&#x5217;&#x8868;&#x8BF7;&#x53C2;&#x7167;&#x9644;&#x5F55;1)&#x3002;TProactor&#x662F;&#x9AD8;&#x5EA6;&#x53EF;&#x914D;&#x7F6E;&#x7684;&#x65B9;&#x6848;&#xFF0C;&#x901A;&#x8FC7;&#x4F7F;&#x7528;&#x5F02;&#x6B65;&#x5185;&#x6838;API&#x548C;&#x540C;&#x6B65;Unix API(select(), poll(), /dev/poll (Solaris 5.8+), port_get (Solaris 5.10),RealTime (RT) signals (Linux 2.4+), epoll (Linux 2.6), k-queue (FreeBSD) )&#xFF0C;&#x5B83;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x4E86;&#x4E09;&#x79CD;&#x5F15;&#x64CE;(POSIX AIO, SUN AIO and Emulated AIO)&#x5E76;&#x9690;&#x85CF;&#x4E86;&#x516D;&#x7C7B;&#x7B49;&#x5F85;&#x7B56;&#x7565;&#x3002;TProactor&#x5B9E;&#x73B0;&#x4E86;&#x548C;&#x6807;&#x51C6;&#x7684; ACE Proactor&#x4E00;&#x6837;&#x7684;&#x63A5;&#x53E3;&#x3002;&#x8FD9;&#x6837;&#x4E00;&#x6765;&#xFF0C;&#x4E3A;&#x4E0D;&#x540C;&#x5E73;&#x53F0;&#x63D0;&#x4F9B;&#x901A;&#x7528;&#x7EDF;&#x4E00;&#x7684;&#x53EA;&#x6709;&#x4E00;&#x4EFD;&#x4EE3;&#x7801;&#x7684;&#x8DE8;&#x5E73;&#x53F0;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x6210;&#x4E3A;&#x53EF;&#x80FD;&#x3002;</p>
<p>Engines&#x548C;WaitStrategies&#x53EF;&#x4EE5;&#x50CF;&#x4E50;&#x9AD8;&#x79EF;&#x6728;&#x4E00;&#x6837;&#x81EA;&#x7531;&#x5730;&#x7EC4;&#x5408;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EF;&#x4EE5;&#x5728;&#x8FD0;&#x884C;&#x65F6;&#x901A;&#x8FC7;&#x914D;&#x7F6E;&#x53C2;&#x6570;&#x6765;&#x9009;&#x62E9;&#x5408;&#x9002;&#x7684;&#x5185;&#x90E8;&#x673A;&#x5236;&#xFF08;&#x5F15;&#x64CE;&#x548C;&#x7B49;&#x5F85;&#x7B56;&#x7565;&#xFF09;&#x3002;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x6C42;&#x8BBE;&#x5B9A;&#x914D;&#x7F6E;&#xFF0C;&#x6BD4;&#x5982;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;&#x7CFB;&#x7EDF;&#x4F38;&#x7F29;&#x6027;&#xFF0C;&#x4EE5;&#x53CA;&#x8FD0;&#x884C;&#x7684;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7B49;&#x3002;&#x5982;&#x679C;&#x7CFB;&#x7EDF;&#x652F;&#x6301;&#x76F8;&#x5E94;&#x7684;&#x5F02;&#x6B65;&#x5E95;&#x5C42;API&#xFF0C;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x771F;&#x6B63;&#x7684;&#x5F02;&#x6B65;&#x7B56;&#x7565;&#xFF0C;&#x5426;&#x5219;&#x7528;&#x6237;&#x4E5F;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x4F7F;&#x7528;&#x6A21;&#x62DF;&#x51FA;&#x6765;&#x7684;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x3002;&#x6240;&#x6709;&#x8FD9;&#x4E00;&#x5207;&#x7B56;&#x7565;&#x4E0A;&#x7684;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x90FD;&#x4E0D;&#x592A;&#x9700;&#x8981;&#x5173;&#x6CE8;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x5230;&#x7684;&#x662F;&#x4E00;&#x4E2A;&#x53EF;&#x7528;&#x7684;&#x5F02;&#x6B65;&#x6A21;&#x578B;&#x3002;</p>
<p>&#x4E3E;&#x4F8B;&#x6765;&#x8BF4;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD0;&#x884C;&#x5728;Sun Solaris&#x4E0A;&#x7684;HTTP&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x5982;&#x679C;&#x9700;&#x8981;&#x652F;&#x6301;&#x5927;&#x91CF;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#xFF0C;/dev/poll&#x6216;&#x8005;port_get()&#x4E4B;&#x7C7B;&#x7684;&#x5F15;&#x64CE;&#x662F;&#x6BD4;&#x8F83;&#x5408;&#x9002;&#x7684;&#x9009;&#x62E9;&#xFF1B;&#x5982;&#x679C;&#x9700;&#x8981;&#x9AD8;&#x541E;&#x5410;&#x91CF;&#xFF0C;&#x90A3;&#x4F7F;&#x7528;&#x57FA;&#x672C;select()&#x7684;&#x5F15;&#x64CE;&#x4F1A;&#x66F4;&#x597D;&#x3002;&#x7531;&#x4E8E;&#x4E0D;&#x540C;&#x9009;&#x62E9;&#x7B56;&#x7565;&#x5185;&#x5728;&#x7B97;&#x6CD5;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x50CF;&#x8FD9;&#x6837;&#x7684;&#x5F39;&#x6027;&#x9009;&#x62E9;&#x662F;&#x6807;&#x51C6;ACE Reactor/Proactor&#x6A21;&#x5F0F;&#x6240;&#x65E0;&#x6CD5;&#x63D0;&#x4F9B;&#x7684;&#xFF08;&#x89C1;&#x9644;&#x5F55;2&#xFF09;&#x3002;</p>
<p>&#x5728;&#x6027;&#x80FD;&#x65B9;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x7684;&#x6D4B;&#x8BD5;&#x663E;&#x793A;&#xFF0C;&#x6A21;&#x62DF;&#x5F02;&#x6B65;&#x6A21;&#x5F0F;&#x5E76;&#x672A;&#x9020;&#x6210;&#x4EFB;&#x4F55;&#x5F00;&#x9500;&#xFF0C;&#x6CA1;&#x6709;&#x53D8;&#x6162;&#xFF0C;&#x53CD;&#x5012;&#x662F;&#x6027;&#x80FD;&#x6709;&#x6240;&#x63D0;&#x5347;&#x3002;&#x6839;&#x636E;&#x6211;&#x4EEC;&#x7684;&#x6D4B;&#x8BD5;&#x7ED3;&#x679C;&#xFF0C;TProactor&#x76F8;&#x8F83;&#x6807;&#x7B7E;&#x7684;ACE Reactor&#x5728;Unix/Linux&#x7CFB;&#x7EDF;&#x4E0A;&#x6709;&#x5927;&#x7EA6;10-35%&#x6027;&#x80FD;&#x63D0;&#x5347;&#xFF0C;&#x800C;&#x5728;Windows&#x4E0A;&#x5DEE;&#x4E0D;&#x591A;(&#x6D4B;&#x8BD5;&#x4E86;&#x541E;&#x5410;&#x91CF;&#x53CA;&#x54CD;&#x5E94;&#x65F6;&#x95F4;)&#x3002;</p>
<h2 id="&#x6027;&#x80FD;&#x6BD4;&#x8F83;-JAVA-C-C"><a href="#&#x6027;&#x80FD;&#x6BD4;&#x8F83;-JAVA-C-C" class="headerlink" title="&#x6027;&#x80FD;&#x6BD4;&#x8F83; (JAVA / C++ / C#)"></a>&#x6027;&#x80FD;&#x6BD4;&#x8F83; (JAVA / C++ / C#)</h2><p>&#x9664;&#x4E86;C++&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x5728;Java&#x4E2D;&#x5B9E;&#x73B0;&#x4E86;TProactor&#x3002; JDK1.4&#x4E2D;&#xFF0C; Java&#x4EC5;&#x63D0;&#x4F9B;&#x4E86;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C; &#x50CF;C&#x4E2D;&#x7684;select() [7&#x3001;8]&#x3002; Java TProactor&#x57FA;&#x4E8E;Java&#x7684;&#x975E;&#x963B;&#x585E;&#x529F;&#x80FD;(java.nio&#x5305;),&#x7C7B;&#x4F3C;&#x4E8E;C++&#x7684;TProactor&#x4F7F;&#x7528;&#x4E86;select()&#x5F15;&#x64CE;&#x3002;</p>
<p>&#x56FE;1&#x3001;2&#x663E;&#x793A;&#x4E86;&#x4EE5; bits/sec&#x4E3A;&#x5355;&#x4F4D;&#x7684;&#x4F20;&#x8F93;&#x901F;&#x5EA6;&#x4EE5;&#x53CA;&#x76F8;&#x5E94;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x3002;&#x8FD9;&#x4E9B;&#x56FE;&#x6BD4;&#x8F83;&#x4E86;&#x4EE5;&#x4E0B;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x5B9E;&#x73B0;&#x7684;echo&#x670D;&#x52A1;&#x5668;&#xFF1A;&#x6807;&#x51C6;ACE Reactor&#x5B9E;&#x73B0;(&#x57FA;&#x4E8E;RedHat Linux9.0)&#x3001;TProactor C++/Java&#x5B9E;&#x73B0;(Microsoft Windows&#x5E73;&#x53F0;&#x53CA;RedHat v9.0)&#xFF0C; &#x4EE5;&#x53CA;C#&#x5B9E;&#x73B0;&#x3002;&#x6D4B;&#x8BD5;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x4E09;&#x79CD;&#x670D;&#x52A1;&#x5668;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x75AF;&#x72C2;&#x5730;&#x8FDE;&#x63A5;&#xFF0C;&#x4E0D;&#x95F4;&#x65AD;&#x5730;&#x53D1;&#x9001;&#x56FA;&#x5B9A;&#x5927;&#x5C0F;&#x7684;&#x6570;&#x636E;&#x5305;&#x3002;</p>
<p>&#x8FD9;&#x51E0;&#x7EC4;&#x6D4B;&#x8BD5;&#x662F;&#x5728;&#x76F8;&#x540C;&#x7684;&#x786C;&#x4EF6;&#x4E0A;&#x505A;&#x7684;&#xFF0C;&#x5728;&#x4E0D;&#x540C;&#x786C;&#x4EF6;&#x4E0A;&#x505A;&#x7684;&#x76F8;&#x5BF9;&#x7ED3;&#x679C;&#x5BF9;&#x6BD4;&#x4E5F;&#x662F;&#x7C7B;&#x4F3C;&#x3002;</p>
<p><img src="/2016/io-reactor-and-proactor/io_dp_fig_1.gif" alt="io_dp_fig_1"></p>
<p>&#x56FE; 1. Windows XP/P4 2.6GHz HyperThreading/512 MB RAM.</p>
<p><img src="/2016/io-reactor-and-proactor/io_dp_fig_2.gif" alt="io_dp_fig_2"></p>
<p>&#x56FE; 2. Linux RedHat 2.4.20-smp/P4 2.6GHz HyperThreading/512 MB RAM.</p>
<h2 id="&#x7528;&#x6237;&#x4EE3;&#x7801;&#x793A;&#x4F8B;"><a href="#&#x7528;&#x6237;&#x4EE3;&#x7801;&#x793A;&#x4F8B;" class="headerlink" title="&#x7528;&#x6237;&#x4EE3;&#x7801;&#x793A;&#x4F8B;"></a>&#x7528;&#x6237;&#x4EE3;&#x7801;&#x793A;&#x4F8B;</h2><p>&#x4E0B;&#x9762;&#x662F;TProactor Java&#x5B9E;&#x73B0;&#x7684;echo&#x670D;&#x52A1;&#x5668;&#x4EE3;&#x7801;&#x6846;&#x67B6;&#x3002;&#x603B;&#x7684;&#x6765;&#x8BF4;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x53EA;&#x9700;&#x8981;&#x5B9E;&#x73B0;&#x4E24;&#x4E2A;&#x63A5;&#x53E3;&#xFF1A;&#x4E00;&#x662F;OpRead&#xFF0C;&#x63D0;&#x4F9B;&#x5B58;&#x653E;&#x8BFB;&#x7ED3;&#x679C;&#x7684;&#x7F13;&#x5B58;&#xFF1B;&#x4E8C;&#x662F;OpWrite&#xFF0C;&#x63D0;&#x4F9B;&#x5B58;&#x50A8;&#x5F85;&#x5199;&#x6570;&#x636E;&#x7684;&#x7F13;&#x5B58;&#x533A;&#x3002;&#x540C;&#x65F6;&#xFF0C;&#x5F00;&#x53D1;&#x8005;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x56DE;&#x8C03;onReadComplated()&#x548C;onWriteCompleted()&#x5B9E;&#x73B0;&#x534F;&#x8BAE;&#x76F8;&#x5173;&#x7684;&#x4E1A;&#x52A1;&#x4EE3;&#x7801;&#x3002;&#x8FD9;&#x4E9B;&#x56DE;&#x8C03;&#x4F1A;&#x5728;&#x5408;&#x9002;&#x7684;&#x65F6;&#x5019;&#x88AB;&#x8C03;&#x7528;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EchoServerProtocol</span> <span class="keyword">implements</span> <span class="title">AsynchHandler</span></span></div><div class="line">{</div><div class="line"></div><div class="line">  AsynchChannel achannel = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">  EchoServerProtocol( Demultiplexor m,  SelectableChannel channel )</div><div class="line">  <span class="keyword">throws</span> Exception</div><div class="line">  {</div><div class="line">    <span class="keyword">this</span>.achannel = <span class="keyword">new</span> AsynchChannel( m, <span class="keyword">this</span>, channel );</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></div><div class="line">  {</div><div class="line">    <span class="comment">// called after construction</span></div><div class="line">    System.out.println( Thread.currentThread().getName() +</div><div class="line">	<span class="string">&quot;: EchoServer protocol started&quot;</span> );</div><div class="line">    achannel.read( buffer);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReadCompleted</span><span class="params">( OpRead opRead )</span> <span class="keyword">throws</span> Exception</span></div><div class="line">  {</div><div class="line">    <span class="keyword">if</span> ( opRead.getError() != <span class="keyword">null</span> )</div><div class="line">    {</div><div class="line">      <span class="comment">// handle error, do clean-up if needed</span></div><div class="line">      System.out.println( <span class="string">&quot;EchoServer::readCompleted: &quot;</span> +</div><div class="line">      opRead.getError().toString());</div><div class="line">      achannel.close();</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">if</span> ( opRead.getBytesCompleted () &lt;= <span class="number">0</span>)</div><div class="line">    {</div><div class="line">      System.out.println(<span class="string">&quot;EchoServer::readCompleted: Peer closed &quot;</span></div><div class="line">	   + opRead.getBytesCompleted();</div><div class="line">      achannel.close();</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    ByteBuffer buffer = opRead.getBuffer();</div><div class="line"></div><div class="line">    achannel.write(buffer);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onWriteCompleted</span><span class="params">(OpWrite opWrite)</span></span></div><div class="line">  <span class="keyword">throws</span> Exception</div><div class="line">  {</div><div class="line">    <span class="comment">// logically similar to onReadCompleted</span></div><div class="line">    ...</div><div class="line">  }</div><div class="line">}</div></pre></td></tr></table></figure>
<h2 id="&#x7ED3;&#x675F;&#x8BED;"><a href="#&#x7ED3;&#x675F;&#x8BED;" class="headerlink" title="&#x7ED3;&#x675F;&#x8BED;"></a>&#x7ED3;&#x675F;&#x8BED;</h2><p>TProactor&#x4E3A;&#x591A;&#x4E2A;&#x5E73;&#x53F0;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x901A;&#x7528;&#x3001;&#x5F39;&#x6027;&#x3001;&#x53EF;&#x914D;&#x7F6E;&#x7684;&#x9AD8;&#x6027;&#x80FD;&#x901A;&#x8BAF;&#x7EC4;&#x4EF6;&#xFF0C;&#x6240;&#x6709;&#x90A3;&#x4E9B;&#x5728;&#x9644;&#x5F55;2&#x4E2D;&#x63D0;&#x5230;&#x7684;&#x95EE;&#x9898;&#x90FD;&#x88AB;&#x5F88;&#x597D;&#x5730;&#x9690;&#x85CF;&#x5728;&#x5185;&#x90E8;&#x5B9E;&#x73B0;&#x4E2D;&#x4E86;&#x3002;</p>
<p>&#x4ECE;&#x4E0A;&#x9762;&#x7684;&#x56FE;&#x4E2D;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x51FA;C++&#x4ECD;&#x65E7;&#x662F;&#x7F16;&#x5199;&#x9AD8;&#x6027;&#x80FD;&#x670D;&#x52A1;&#x5668;&#x6700;&#x4F73;&#x9009;&#x62E9;&#xFF0C;&#x867D;&#x7136;Java&#x5DF2;&#x7D27;&#x968F;&#x5176;&#x540E;&#x3002;&#x7136;&#x800C;&#x56E0;&#x4E3A;Java&#x672C;&#x8EAB;&#x5B9E;&#x73B0;&#x4E0A;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5176;&#x5728;Windows&#x4E0A;&#x8868;&#x73B0;&#x4E0D;&#x4F73;(&#x8FD9;&#x5DF2;&#x7ECF;&#x5E94;&#x8BE5;&#x6210;&#x4E3A;&#x5386;&#x53F2;&#x4E86;&#x5427;)&#x3002;</p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x4EE5;&#x4E0A;&#x9488;&#x5BF9;Java&#x7684;&#x6D4B;&#x8BD5;&#xFF0C;&#x90FD;&#x662F;&#x4EE5;&#x88F8;&#x6570;&#x636E;&#x7684;&#x5F62;&#x5F0F;&#x6D4B;&#x8BD5;&#x7684;&#xFF0C;&#x672A;&#x6D89;&#x53CA;&#x5230;&#x6570;&#x636E;&#x7684;&#x5904;&#x7406;(&#x5F71;&#x54CD;&#x6027;&#x80FD;)&#x3002;</p>
<p>&#x7EB5;&#x89C2;AIO&#x5728;Linux&#x4E0A;&#x7684;&#x5FEB;&#x901F;&#x53D1;&#x5C55;[9]&#xFF0C; &#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9884;&#x8BA1;Linux&#x5185;&#x6838;API&#x5C06;&#x4F1A;&#x63D0;&#x4F9B;&#x5927;&#x91CF;&#x66F4;&#x52A0;&#x5F3A;&#x5065;&#x7684;&#x5F02;&#x6B65;API&#xFF0C; &#x5982;&#x6B64;&#x4E00;&#x6765;&#x4EE5;&#x540E;&#x57FA;&#x4E8E;&#x6B64;&#x800C;&#x5B9E;&#x73B0;&#x7684;&#x65B0;&#x7684;Engine/&#x7B49;&#x5F85;&#x7B56;&#x7565;&#x5C06;&#x80FD;&#x8F7B;&#x677E;&#x5730;&#x89E3;&#x51B3;&#x80FD;&#x7528;&#x6027;&#x65B9;&#x9762;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5E76;&#x4E14;&#x8FD9;&#x4E5F;&#x80FD;&#x8BA9;&#x6807;&#x51C6;ACE Proactor&#x63A5;&#x53E3;&#x53D7;&#x76CA;&#x3002;</p>
<p><strong> &#x9644;&#x5F55; I </strong></p>
<p>TProactor&#x4E2D;&#x5B9E;&#x73B0;&#x7684;Engines &#x548C; &#x7B49;&#x5F85;&#x7B56;&#x7565;</p>
<table>
<thead>
<tr>
<th style="text-align:left">&#x5F15;&#x64CE;&#x7C7B;&#x578B;</th>
<th style="text-align:left">&#x7B49;&#x5F85;&#x7B56;&#x7565;</th>
<th style="text-align:left">&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">POSIX_AIO (true async) <br> aio_read()/aio_write()</td>
<td style="text-align:left">aio_suspend() <br> Waiting for RT signal <br> Callback function</td>
<td style="text-align:left">POSIX complained UNIX (not robust) <br> POSIX (not robust) <br> SGI IRIX, LINUX (not robust)</td>
</tr>
<tr>
<td style="text-align:left">SUN_AIO (true async) <br> aio_read()/aio_write()</td>
<td style="text-align:left">aio_wait()</td>
<td style="text-align:left">SUN (not robust)</td>
</tr>
<tr>
<td style="text-align:left">Emulated Async <br> Non-blocking read()/write()</td>
<td style="text-align:left">select() <br> poll() <br> /dev/poll <br> Linux RT signals <br> Kqueue</td>
<td style="text-align:left">generic POSIX <br> Mostly all POSIX implementations <br> SUN <br> Linux <br> FreeBSD</td>
</tr>
</tbody>
</table>
<p><strong> &#x9644;&#x5F55; II </strong></p>
<p>&#x6240;&#x6709;&#x540C;&#x6B65;&#x7B49;&#x5F85;&#x7B56;&#x7565;&#x53EF;&#x5212;&#x5206;&#x4E3A;&#x4E24;&#x7EC4;:</p>
<p>edge-triggered (e.g. Linux&#x5B9E;&#x65F6;&#x4FE1;&#x53F7;) &#x2013; signal readiness only when socket became ready (changes state);<br>level-triggered (e.g. select(), poll(), /dev/poll) &#x2013; readiness at any time.<br>&#x8BA9;&#x6211;&#x4EEC;&#x770B;&#x770B;&#x8FD9;&#x4E24;&#x7EC4;&#x7684;&#x4E00;&#x4E9B;&#x666E;&#x904D;&#x7684;&#x903B;&#x8F91;&#x95EE;&#x9898;:</p>
<p>edge-triggered group: after executing I/O operation, the demultiplexing loop can lose the state of socket readiness. Example: the &#x201C;read&#x201D; handler did not read whole chunk of data, so the socket remains still ready for read. But the demultiplexor loop will not receive next notification.<br>level-triggered group: when demultiplexor loop detects readiness, it starts the write/read user defined handler. But before the start, it should remove socket descriptior from theset of monitored descriptors. Otherwise, the same event can be dispatched twice.<br>Obviously, solving these problems adds extra complexities to development. All these problems were resolved internally within TProactor and the developer should not worry about those details, while in the synch approach one needs to apply extra effort to resolve them.</p>
<p><strong> &#x8D44;&#x6E90; </strong></p>
<p>[1] Douglas C. Schmidt, Stephen D. Huston &#x201C;C++ Network Programming.&#x201D; 2002, Addison-Wesley ISBN 0-201-60464-7</p>
<p>[2] W. Richard Stevens &#x201C;UNIX Network Programming&#x201D; vol. 1 and 2, 1999, Prentice Hill, ISBN 0-13- 490012-X</p>
<p>[3] Douglas C. Schmidt, Michael Stal, Hans Rohnert, Frank Buschmann &#x201C;Pattern-Oriented Software Architecture: Patterns for Concurrent and Networked Objects, Volume 2&#x201D; Wiley &amp; Sons, NY 2000</p>
<p>[4] INFO: Socket Overlapped I/O Versus Blocking/Non-blocking Mode. Q181611. Microsoft Knowledge Base Articles.</p>
<p>[5] Microsoft MSDN. I/O Completion Ports.<br><a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-" target="_blank" rel="external">http://msdn.microsoft.com/library/default.asp?url=/library/en-</a> us/fileio/fs/i_o_completion_ports.asp</p>
<p>[6] TProactor (ACE compatible Proactor).<br>www.terabit.com.au</p>
<p>[7] JavaDoc java.nio.channels<br><a href="http://java.sun.com/j2se/1.4.2/docs/api/java/nio/channels/package-summary.html" target="_blank" rel="external">http://java.sun.com/j2se/1.4.2/docs/api/java/nio/channels/package-summary.html</a></p>
<p>[8] JavaDoc Java.nio.channels.spi Class SelectorProvider<br><a href="http://java.sun.com/j2se/1.4.2/docs/api/java/nio/channels/spi/SelectorProvider.html" target="_blank" rel="external">http://java.sun.com/j2se/1.4.2/docs/api/java/nio/channels/spi/SelectorProvider.html</a></p>
<p>[9] Linux AIO development<br><a href="http://lse.sourceforge.net/io/aio.html" target="_blank" rel="external">http://lse.sourceforge.net/io/aio.html</a>, and<br><a href="http://archive.linuxsymposium.org/ols2003/Proceedings/All-Reprints/Reprint-Pulavarty-OLS2003.pdf" target="_blank" rel="external">http://archive.linuxsymposium.org/ols2003/Proceedings/All-Reprints/Reprint-Pulavarty-OLS2003.pdf</a></p>
<p><strong> &#x66F4;&#x591A; </strong></p>
<p>Ian Barile &#x201C;I/O Multiplexing &amp; Scalable Socket Servers&#x201D;, 2004 February, DDJ</p>
<p>Further reading on event handling<br>&#x2013; <a href="http://www.cs.wustl.edu/~schmidt/ACE-papers.html" target="_blank" rel="external">http://www.cs.wustl.edu/~schmidt/ACE-papers.html</a></p>
<p>The Adaptive Communication Environment<br><a href="http://www.cs.wustl.edu/~schmidt/ACE.html" target="_blank" rel="external">http://www.cs.wustl.edu/~schmidt/ACE.html</a></p>
<p>Terabit Solutions<br><a href="http://terabit.com.au/solutions.php" target="_blank" rel="external">http://terabit.com.au/solutions.php</a></p>
<p><strong> &#x5173;&#x4E8E;&#x4F5C;&#x8005; </strong></p>
<p>Alex Libman has been programming for 15 years. During the past 5 years his main area of interest is pattern-oriented multiplatform networked programming using C++ and Java. He is big fan and contributor of ACE.</p>
<p>Vlad Gilbourd works as a computer consultant, but wishes to spend more time listening jazz :) As a hobby,he started and runs www.corporatenews.com.au website.</p>
<p><code>&#x539F;&#x6587;&#x51FA;&#x5904;&#xFF1A; [Alex Libman](http://www.artima.com/articles/io_design_patterns.html)</code></p>
<p><code>&#x8BD1;&#x6587;&#x51FA;&#x5904;&#xFF1A;[&#x6F58;&#x5B59;&#x53CB;](http://www.cppblog.com/pansunyou/archive/2013/11/19/139343.html)</code></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x6765;&amp;#x81EA;: &amp;#x4F2F;&amp;#x4E50;&amp;#x5728;&amp;#x7EBF; IT&amp;#x6280;&amp;#x672F; &amp;#x8BBE;&amp;#x8BA1;&amp;#x6A21;&amp;#x5F0F; http://blog.jobbole.com/59676/ 2014/02/17&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;&amp;#x7EFC;&amp;#x8FF0;&quot;&gt;&lt;a href=&quot;#&amp;#x7EFC;&amp;#x8FF0;&quot; class=&quot;headerlink&quot; title=&quot;&amp;#x7EFC;&amp;#x8FF0;&quot;&gt;&lt;/a&gt;&amp;#x7EFC;&amp;#x8FF0;&lt;/h2&gt;&lt;p&gt;&amp;#x8FD9;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x63A2;&amp;#x8BA8;&amp;#x5E76;&amp;#x6BD4;&amp;#x8F83;&amp;#x4E24;&amp;#x79CD;&amp;#x7528;&amp;#x4E8E;TCP&amp;#x670D;&amp;#x52A1;&amp;#x5668;&amp;#x7684;&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x8BBE;&amp;#x8BA1;&amp;#x6A21;&amp;#x5F0F;&amp;#x3002; &amp;#x9664;&amp;#x4E86;&amp;#x4ECB;&amp;#x7ECD;&amp;#x73B0;&amp;#x6709;&amp;#x7684;&amp;#x89E3;&amp;#x51B3;&amp;#x65B9;&amp;#x6848;&amp;#xFF0C;&amp;#x8FD8;&amp;#x63D0;&amp;#x51FA;&amp;#x4E86;&amp;#x4E00;&amp;#x79CD;&amp;#x66F4;&amp;#x5177;&amp;#x4F38;&amp;#x7F29;&amp;#x6027;&amp;#xFF0C;&amp;#x53EA;&amp;#x9700;&amp;#x8981;&amp;#x7EF4;&amp;#x62A4;&amp;#x4E00;&amp;#x4EFD;&amp;#x4EE3;&amp;#x7801;&amp;#x5E76;&amp;#x4E14;&amp;#x8DE8;&amp;#x5E73;&amp;#x53F0;&amp;#x7684;&amp;#x89E3;&amp;#x51B3;&amp;#x65B9;&amp;#x6848;(&amp;#x542B;&amp;#x4EE3;&amp;#x7801;&amp;#x793A;&amp;#x4F8B;)&amp;#xFF0C;&amp;#x4EE5;&amp;#x53CA;&amp;#x5176;&amp;#x5728;&amp;#x4E0D;&amp;#x540C;&amp;#x5E73;&amp;#x53F0;&amp;#x4E0A;&amp;#x7684;&amp;#x5FAE;&amp;#x8C03;&amp;#x3002; &amp;#x6B64;&amp;#x6587;&amp;#x8FD8;&amp;#x6BD4;&amp;#x8F83;&amp;#x4E86;java&amp;#x3001;c#&amp;#x3001;c++&amp;#x5BF9;&amp;#x5404;&amp;#x81EA;&amp;#x73B0;&amp;#x6709;&amp;#x4EE5;&amp;#x53CA;&amp;#x63D0;&amp;#x5230;&amp;#x7684;&amp;#x89E3;&amp;#x51B3;&amp;#x65B9;&amp;#x6848;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x6027;&amp;#x80FD;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x7CFB;&amp;#x7EDF;I/O &amp;#x53EF;&amp;#x5206;&amp;#x4E3A;&amp;#x963B;&amp;#x585E;&amp;#x578B;&amp;#xFF0C; &amp;#x975E;&amp;#x963B;&amp;#x585E;&amp;#x540C;&amp;#x6B65;&amp;#x578B;&amp;#x4EE5;&amp;#x53CA;&amp;#x975E;&amp;#x963B;&amp;#x585E;&amp;#x5F02;&amp;#x6B65;&amp;#x578B;[1&amp;#x3001;2]&amp;#x3002; &amp;#x963B;&amp;#x585E;&amp;#x578B;I/O&amp;#x610F;&amp;#x5473;&amp;#x7740;&amp;#x63A7;&amp;#x5236;&amp;#x6743;&amp;#x53EA;&amp;#x5230;&amp;#x8C03;&amp;#x7528;&amp;#x64CD;&amp;#x4F5C;&amp;#x7ED3;&amp;#x675F;&amp;#x4E86;&amp;#x624D;&amp;#x4F1A;&amp;#x56DE;&amp;#x5230;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#x624B;&amp;#x91CC;&amp;#x3002; &amp;#x7ED3;&amp;#x679C;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#x88AB;&amp;#x963B;&amp;#x585E;&amp;#x4E86;&amp;#xFF0C; &amp;#x8FD9;&amp;#x6BB5;&amp;#x65F6;&amp;#x95F4;&amp;#x4E86;&amp;#x505A;&amp;#x4E0D;&amp;#x4E86;&amp;#x4EFB;&amp;#x4F55;&amp;#x5176;&amp;#x5B83;&amp;#x4E8B;&amp;#x60C5;&amp;#x3002; &amp;#x66F4;&amp;#x90C1;&amp;#x95F7;&amp;#x7684;&amp;#x662F;&amp;#xFF0C;&amp;#x5728;&amp;#x7B49;&amp;#x5F85;IO&amp;#x7ED3;&amp;#x679C;&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#x91CC;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#x6240;&amp;#x5728;&amp;#x7EBF;&amp;#x7A0B;&amp;#x6B64;&amp;#x65F6;&amp;#x65E0;&amp;#x6CD5;&amp;#x817E;&amp;#x51FA;&amp;#x624B;&amp;#x6765;&amp;#x53BB;&amp;#x54CD;&amp;#x5E94;&amp;#x5176;&amp;#x5B83;&amp;#x7684;&amp;#x8BF7;&amp;#x6C42;&amp;#xFF0C;&amp;#x8FD9;&amp;#x771F;&amp;#x662F;&amp;#x592A;&amp;#x6D6A;&amp;#x8D39;&amp;#x8D44;&amp;#x6E90;&amp;#x4E86;&amp;#x3002;&amp;#x62FF;read()&amp;#x64CD;&amp;#x4F5C;&amp;#x6765;&amp;#x8BF4;&amp;#x5427;&amp;#xFF0C; &amp;#x8C03;&amp;#x7528;&amp;#x6B64;&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x4EE3;&amp;#x7801;&amp;#x4F1A;&amp;#x4E00;&amp;#x76F4;&amp;#x50F5;&amp;#x5728;&amp;#x6B64;&amp;#x5904;&amp;#x76F4;&amp;#x81F3;&amp;#x5B83;&amp;#x6240;&amp;#x8BFB;&amp;#x7684;socket&amp;#x7F13;&amp;#x5B58;&amp;#x4E2D;&amp;#x6709;&amp;#x6570;&amp;#x636E;&amp;#x5230;&amp;#x6765;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x76F8;&amp;#x6BD4;&amp;#x4E4B;&amp;#x4E0B;&amp;#xFF0C;&amp;#x975E;&amp;#x963B;&amp;#x585E;&amp;#x540C;&amp;#x6B65;&amp;#x662F;&amp;#x4F1A;&amp;#x7ACB;&amp;#x5373;&amp;#x8FD4;&amp;#x56DE;&amp;#x63A7;&amp;#x5236;&amp;#x6743;&amp;#x7ED9;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#x7684;&amp;#x3002;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#x4E0D;&amp;#x9700;&amp;#x8981;&amp;#x7B49;&amp;#x7B49;&amp;#xFF0C;&amp;#x5B83;&amp;#x4ECE;&amp;#x8C03;&amp;#x7528;&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#x83B7;&amp;#x53D6;&amp;#x4E24;&amp;#x79CD;&amp;#x7ED3;&amp;#x679C;&amp;#xFF1A;&amp;#x8981;&amp;#x4E48;&amp;#x6B64;&amp;#x6B21;&amp;#x8C03;&amp;#x7528;&amp;#x6210;&amp;#x529F;&amp;#x8FDB;&amp;#x884C;&amp;#x4E86;;&amp;#x8981;&amp;#x4E48;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8FD4;&amp;#x56DE;&amp;#x9519;&amp;#x8BEF;&amp;#x6807;&amp;#x8BC6;&amp;#x544A;&amp;#x8BC9;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#x5F53;&amp;#x524D;&amp;#x8D44;&amp;#x6E90;&amp;#x4E0D;&amp;#x53EF;&amp;#x7528;&amp;#xFF0C;&amp;#x4F60;&amp;#x518D;&amp;#x7B49;&amp;#x7B49;&amp;#x6216;&amp;#x8005;&amp;#x518D;&amp;#x8BD5;&amp;#x5EA6;&amp;#x770B;&amp;#x5427;&amp;#x3002;&amp;#x6BD4;&amp;#x5982;read()&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C; &amp;#x5982;&amp;#x679C;&amp;#x5F53;&amp;#x524D;socket&amp;#x65E0;&amp;#x6570;&amp;#x636E;&amp;#x53EF;&amp;#x8BFB;&amp;#xFF0C;&amp;#x5219;&amp;#x7ACB;&amp;#x5373;&amp;#x8FD4;&amp;#x56DE;EWOULBLOCK/EAGAIN&amp;#xFF0C;&amp;#x544A;&amp;#x8BC9;&amp;#x8C03;&amp;#x7528;read()&amp;#x8005;&amp;#x201D;&amp;#x6570;&amp;#x636E;&amp;#x8FD8;&amp;#x6CA1;&amp;#x51C6;&amp;#x5907;&amp;#x597D;&amp;#xFF0C;&amp;#x4F60;&amp;#x7A0D;&amp;#x540E;&amp;#x518D;&amp;#x8BD5;&amp;#x201D;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;&amp;#x975E;&amp;#x963B;&amp;#x585E;&amp;#x5F02;&amp;#x6B65;&amp;#x8C03;&amp;#x7528;&amp;#x4E2D;&amp;#xFF0C;&amp;#x7A0D;&amp;#x6709;&amp;#x4E0D;&amp;#x540C;&amp;#x3002;&amp;#x8C03;&amp;#x7528;&amp;#x51FD;&amp;#x6570;&amp;#x5728;&amp;#x7ACB;&amp;#x5373;&amp;#x8FD4;&amp;#x56DE;&amp;#x65F6;&amp;#xFF0C;&amp;#x8FD8;&amp;#x544A;&amp;#x8BC9;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#xFF0C;&amp;#x8FD9;&amp;#x6B21;&amp;#x8BF7;&amp;#x6C42;&amp;#x5DF2;&amp;#x7ECF;&amp;#x5F00;&amp;#x59CB;&amp;#x4E86;&amp;#x3002;&amp;#x7CFB;&amp;#x7EDF;&amp;#x4F1A;&amp;#x4F7F;&amp;#x7528;&amp;#x53E6;&amp;#x5916;&amp;#x7684;&amp;#x8D44;&amp;#x6E90;&amp;#x6216;&amp;#x8005;&amp;#x7EBF;&amp;#x7A0B;&amp;#x6765;&amp;#x5B8C;&amp;#x6210;&amp;#x8FD9;&amp;#x6B21;&amp;#x8C03;&amp;#x7528;&amp;#x64CD;&amp;#x4F5C;&amp;#xFF0C;&amp;#x5E76;&amp;#x5728;&amp;#x5B8C;&amp;#x6210;&amp;#x7684;&amp;#x65F6;&amp;#x5019;&amp;#x77E5;&amp;#x4F1A;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#xFF08;&amp;#x6BD4;&amp;#x5982;&amp;#x901A;&amp;#x8FC7;&amp;#x56DE;&amp;#x8C03;&amp;#x51FD;&amp;#x6570;&amp;#xFF09;&amp;#x3002;&amp;#x62FF;Windows&amp;#x7684;ReadFile()&amp;#x6216;&amp;#x8005;POSIX&amp;#x7684;aio_read()&amp;#x6765;&amp;#x8BF4;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;&amp;#x5B83;&amp;#x4E4B;&amp;#x540E;&amp;#xFF0C;&amp;#x51FD;&amp;#x6570;&amp;#x7ACB;&amp;#x5373;&amp;#x8FD4;&amp;#x56DE;&amp;#xFF0C;&amp;#x64CD;&amp;#x4F5C;&amp;#x7CFB;&amp;#x7EDF;&amp;#x5728;&amp;#x540E;&amp;#x53F0;&amp;#x540C;&amp;#x65F6;&amp;#x5F00;&amp;#x59CB;&amp;#x8BFB;&amp;#x64CD;&amp;#x4F5C;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5728;&amp;#x4EE5;&amp;#x4E0A;&amp;#x4E09;&amp;#x79CD;IO&amp;#x5F62;&amp;#x5F0F;&amp;#x4E2D;&amp;#xFF0C;&amp;#x975E;&amp;#x963B;&amp;#x585E;&amp;#x5F02;&amp;#x6B65;&amp;#x662F;&amp;#x6027;&amp;#x80FD;&amp;#x6700;&amp;#x9AD8;&amp;#x3001;&amp;#x4F38;&amp;#x7F29;&amp;#x6027;&amp;#x6700;&amp;#x597D;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x8FD9;&amp;#x7BC7;&amp;#x6587;&amp;#x7AE0;&amp;#x63A2;&amp;#x8BA8;&amp;#x4E0D;&amp;#x540C;&amp;#x7684;I/O&amp;#x5229;&amp;#x7528;&amp;#x673A;&amp;#x5236;&amp;#x5E76;&amp;#x63D0;&amp;#x4F9B;&amp;#x4E00;&amp;#x79CD;&amp;#x8DE8;&amp;#x5E73;&amp;#x53F0;&amp;#x7684;&amp;#x8BBE;&amp;#x8BA1;&amp;#x6A21;&amp;#x5F0F;(&amp;#x89E3;&amp;#x51B3;&amp;#x65B9;&amp;#x6848;)&amp;#x3002; &amp;#x5E0C;&amp;#x671B;&amp;#x6B64;&amp;#x6587;&amp;#x53EF;&amp;#x4EE5;&amp;#x7ED9;&amp;#x4E8E;TCP&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x670D;&amp;#x52A1;&amp;#x5668;&amp;#x5F00;&amp;#x53D1;&amp;#x8005;&amp;#x4E00;&amp;#x4E9B;&amp;#x5E2E;&amp;#x52A9;&amp;#xFF0C;&amp;#x9009;&amp;#x62E9;&amp;#x6700;&amp;#x4F73;&amp;#x7684;&amp;#x8BBE;&amp;#x8BA1;&amp;#x65B9;&amp;#x6848;&amp;#x3002;&amp;#x4E0B;&amp;#x9762;&amp;#x6211;&amp;#x4EEC;&amp;#x4F1A;&amp;#x6BD4;&amp;#x8F83; Java&amp;#x3001;C#&amp;#x3001; C++&amp;#x5404;&amp;#x81EA;&amp;#x5BF9;&amp;#x63A2;&amp;#x8BA8;&amp;#x65B9;&amp;#x6848;&amp;#x7684;&amp;#x5B9E;&amp;#x73B0;&amp;#x4EE5;&amp;#x53CA;&amp;#x6027;&amp;#x80FD;&amp;#x3002; &amp;#x6211;&amp;#x4EEC;&amp;#x5728;&amp;#x6587;&amp;#x7AE0;&amp;#x7684;&amp;#x540E;&amp;#x9762;&amp;#x5C31;&amp;#x4E0D;&amp;#x518D;&amp;#x63D0;&amp;#x53CA;&amp;#x963B;&amp;#x585E;&amp;#x5F0F;&amp;#x7684;&amp;#x65B9;&amp;#x6848;&amp;#x4E86;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x963B;&amp;#x585E;&amp;#x5F0F;I/O&amp;#x5B9E;&amp;#x5728;&amp;#x662F;&amp;#x7F3A;&amp;#x5C11;&amp;#x53EF;&amp;#x4F38;&amp;#x7F29;&amp;#x6027;&amp;#xFF0C;&amp;#x6027;&amp;#x80FD;&amp;#x4E5F;&amp;#x8FBE;&amp;#x4E0D;&amp;#x5230;&amp;#x9AD8;&amp;#x6027;&amp;#x80FD;&amp;#x670D;&amp;#x52A1;&amp;#x5668;&amp;#x7684;&amp;#x8981;&amp;#x6C42;&amp;#x3002;&lt;/p&gt;
    
    </summary>
    
      <category term="I/O" scheme="http://snowyying.github.io/categories/I-O/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="I/O" scheme="http://snowyying.github.io/tags/I-O/"/>
    
      <category term="性能" scheme="http://snowyying.github.io/tags/%E6%80%A7%E8%83%BD/"/>
    
      <category term="设计模式" scheme="http://snowyying.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
      <category term="Reactor" scheme="http://snowyying.github.io/tags/Reactor/"/>
    
      <category term="Proactor" scheme="http://snowyying.github.io/tags/Proactor/"/>
    
  </entry>
  
  <entry>
    <title>socket选项之SO_REUSEADDR的意义</title>
    <link href="http://snowyying.github.io/2016/socket-SO-REUSEADDR/"/>
    <id>http://snowyying.github.io/2016/socket-SO-REUSEADDR/</id>
    <published>2016-08-06T11:46:10.000Z</published>
    <updated>2016-08-17T02:00:36.136Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x8F6C;&#x81EA;: &#x535A;&#x5BA2;&#x56ED; http://www.cnblogs.com/qq78292959/archive/2013/01/18/2865926.html 2013-01-18</code></p>
<h6 id="1-&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x91CA;&#x653E;&#x540E;&#x4F1A;&#x7B49;&#x5F85;&#x4E24;&#x5206;&#x949F;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x518D;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;SO-REUSEADDR&#x662F;&#x8BA9;&#x7AEF;&#x53E3;&#x91CA;&#x653E;&#x540E;&#x7ACB;&#x5373;&#x5C31;&#x53EF;&#x4EE5;&#x88AB;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x3002;"><a href="#1-&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x91CA;&#x653E;&#x540E;&#x4F1A;&#x7B49;&#x5F85;&#x4E24;&#x5206;&#x949F;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x518D;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;SO-REUSEADDR&#x662F;&#x8BA9;&#x7AEF;&#x53E3;&#x91CA;&#x653E;&#x540E;&#x7ACB;&#x5373;&#x5C31;&#x53EF;&#x4EE5;&#x88AB;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x3002;" class="headerlink" title="1. &#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x91CA;&#x653E;&#x540E;&#x4F1A;&#x7B49;&#x5F85;&#x4E24;&#x5206;&#x949F;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x518D;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;SO_REUSEADDR&#x662F;&#x8BA9;&#x7AEF;&#x53E3;&#x91CA;&#x653E;&#x540E;&#x7ACB;&#x5373;&#x5C31;&#x53EF;&#x4EE5;&#x88AB;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x3002;"></a>1. &#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x4E00;&#x4E2A;&#x7AEF;&#x53E3;&#x91CA;&#x653E;&#x540E;&#x4F1A;&#x7B49;&#x5F85;&#x4E24;&#x5206;&#x949F;&#x4E4B;&#x540E;&#x624D;&#x80FD;&#x518D;&#x88AB;&#x4F7F;&#x7528;&#xFF0C;SO_REUSEADDR&#x662F;&#x8BA9;&#x7AEF;&#x53E3;&#x91CA;&#x653E;&#x540E;&#x7ACB;&#x5373;&#x5C31;&#x53EF;&#x4EE5;&#x88AB;&#x518D;&#x6B21;&#x4F7F;&#x7528;&#x3002;</h6><p>SO_REUSEADDR&#x7528;&#x4E8E;&#x5BF9;TCP&#x5957;&#x63A5;&#x5B57;&#x5904;&#x4E8E;TIME_WAIT&#x72B6;&#x6001;&#x4E0B;&#x7684;socket&#xFF0C;&#x624D;&#x53EF;&#x4EE5;&#x91CD;&#x590D;&#x7ED1;&#x5B9A;&#x4F7F;&#x7528;&#x3002;server&#x7A0B;&#x5E8F;&#x603B;&#x662F;&#x5E94;&#x8BE5;&#x5728;&#x8C03;&#x7528;bind()&#x4E4B;&#x524D;&#x8BBE;&#x7F6E;SO_REUSEADDR&#x5957;&#x63A5;&#x5B57;&#x9009;&#x9879;&#x3002;TCP&#xFF0C;&#x5148;&#x8C03;&#x7528;close()&#x7684;&#x4E00;&#x65B9;&#x4F1A;&#x8FDB;&#x5165;TIME_WAIT&#x72B6;&#x6001;</p>
<h6 id="2-SO-REUSEADDR&#x548C;SO-REUSEPORT"><a href="#2-SO-REUSEADDR&#x548C;SO-REUSEPORT" class="headerlink" title="2. SO_REUSEADDR&#x548C;SO_REUSEPORT"></a>2. SO_REUSEADDR&#x548C;SO_REUSEPORT</h6><p>SO_REUSEADDR&#x63D0;&#x4F9B;&#x5982;&#x4E0B;&#x56DB;&#x4E2A;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>SO_REUSEADDR&#x5141;&#x8BB8;&#x542F;&#x52A8;&#x4E00;&#x4E2A;&#x76D1;&#x542C;&#x670D;&#x52A1;&#x5668;&#x5E76;&#x6346;&#x7ED1;&#x5176;&#x4F17;&#x6240;&#x5468;&#x77E5;&#x7AEF;&#x53E3;&#xFF0C;&#x5373;&#x4F7F;&#x4EE5;&#x524D;&#x5EFA;&#x7ACB;&#x7684;&#x5C06;&#x6B64;&#x7AEF;&#x53E3;&#x7528;&#x505A;&#x4ED6;&#x4EEC;&#x7684;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x7684;&#x8FDE;&#x63A5;&#x4ECD;&#x5B58;&#x5728;&#x3002;&#x8FD9;&#x901A;&#x5E38;&#x662F;&#x91CD;&#x542F;&#x76D1;&#x542C;&#x670D;&#x52A1;&#x5668;&#x65F6;&#x51FA;&#x73B0;&#xFF0C;&#x82E5;&#x4E0D;&#x8BBE;&#x7F6E;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x5219;bind&#x65F6;&#x5C06;&#x51FA;&#x9519;&#x3002;</li>
<li>SO_REUSEADDR&#x5141;&#x8BB8;&#x5728;&#x540C;&#x4E00;&#x7AEF;&#x53E3;&#x4E0A;&#x542F;&#x52A8;&#x540C;&#x4E00;&#x670D;&#x52A1;&#x5668;&#x7684;&#x591A;&#x4E2A;&#x5B9E;&#x4F8B;&#xFF0C;&#x53EA;&#x8981;&#x6BCF;&#x4E2A;&#x5B9E;&#x4F8B;&#x6346;&#x7ED1;&#x4E00;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x672C;&#x5730;IP&#x5730;&#x5740;&#x5373;&#x53EF;&#x3002;&#x5BF9;&#x4E8E;TCP&#xFF0C;&#x6211;&#x4EEC;&#x6839;&#x672C;&#x4E0D;&#x53EF;&#x80FD;&#x542F;&#x52A8;&#x6346;&#x7ED1;&#x76F8;&#x540C;IP&#x5730;&#x5740;&#x548C;&#x76F8;&#x540C;&#x7AEF;&#x53E3;&#x53F7;&#x7684;&#x591A;&#x4E2A;&#x670D;&#x52A1;&#x5668;&#x3002;</li>
<li>SO_REUSEADDR&#x5141;&#x8BB8;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x6346;&#x7ED1;&#x540C;&#x4E00;&#x7AEF;&#x53E3;&#x5230;&#x591A;&#x4E2A;&#x5957;&#x63A5;&#x53E3;&#x4E0A;&#xFF0C;&#x53EA;&#x8981;&#x6BCF;&#x4E2A;&#x6346;&#x7ED1;&#x6307;&#x5B9A;&#x4E0D;&#x540C;&#x7684;&#x672C;&#x5730;IP&#x5730;&#x5740;&#x5373;&#x53EF;&#x3002;&#x8FD9;&#x4E00;&#x822C;&#x4E0D;&#x7528;&#x4E8E;TCP&#x670D;&#x52A1;&#x5668;&#x3002;</li>
<li>SO_REUSEADDR&#x5141;&#x8BB8;&#x5B8C;&#x5168;&#x91CD;&#x590D;&#x7684;&#x6346;&#x7ED1;&#xFF1A;&#x5F53;&#x4E00;&#x4E2A;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x7ED1;&#x5B9A;&#x5230;&#x67D0;&#x4E2A;&#x5957;&#x63A5;&#x53E3;&#x4E0A;&#x65F6;&#xFF0C;&#x8FD8;&#x5141;&#x8BB8;&#x6B64;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x6346;&#x7ED1;&#x5230;&#x53E6;&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x53E3;&#x4E0A;&#x3002;&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x4EC5;&#x5728;&#x652F;&#x6301;&#x591A;&#x64AD;&#x7684;&#x7CFB;&#x7EDF;&#x4E0A;&#x624D;&#x6709;&#xFF0C;&#x800C;&#x4E14;&#x53EA;&#x5BF9;UDP&#x5957;&#x63A5;&#x53E3;&#x800C;&#x8A00;&#xFF08;TCP&#x4E0D;&#x652F;&#x6301;&#x591A;&#x64AD;&#xFF09;&#x3002;</li>
</ul>
<p>SO_REUSEPORT&#x9009;&#x9879;&#x6709;&#x5982;&#x4E0B;&#x8BED;&#x4E49;&#xFF1A;</p>
<ul>
<li>&#x6B64;&#x9009;&#x9879;&#x5141;&#x8BB8;&#x5B8C;&#x5168;&#x91CD;&#x590D;&#x6346;&#x7ED1;&#xFF0C;&#x4F46;&#x4EC5;&#x5728;&#x60F3;&#x6346;&#x7ED1;&#x76F8;&#x540C;IP&#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x7684;&#x5957;&#x63A5;&#x53E3;&#x90FD;&#x6307;&#x5B9A;&#x4E86;&#x6B64;&#x5957;&#x63A5;&#x53E3;&#x9009;&#x9879;&#x624D;&#x884C;&#x3002;</li>
<li>&#x5982;&#x679C;&#x88AB;&#x6346;&#x7ED1;&#x7684;IP&#x5730;&#x5740;&#x662F;&#x4E00;&#x4E2A;&#x591A;&#x64AD;&#x5730;&#x5740;&#xFF0C;&#x5219;SO_REUSEADDR&#x548C;SO_REUSEPORT&#x7B49;&#x6548;&#x3002;</li>
</ul>
<h6 id="3-&#x4F7F;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x5957;&#x63A5;&#x53E3;&#x9009;&#x9879;&#x7684;&#x5EFA;&#x8BAE;"><a href="#3-&#x4F7F;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x5957;&#x63A5;&#x53E3;&#x9009;&#x9879;&#x7684;&#x5EFA;&#x8BAE;" class="headerlink" title="3. &#x4F7F;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x5957;&#x63A5;&#x53E3;&#x9009;&#x9879;&#x7684;&#x5EFA;&#x8BAE;"></a>3. &#x4F7F;&#x7528;&#x8FD9;&#x4E24;&#x4E2A;&#x5957;&#x63A5;&#x53E3;&#x9009;&#x9879;&#x7684;&#x5EFA;&#x8BAE;</h6><ul>
<li>&#x5728;&#x6240;&#x6709;TCP&#x670D;&#x52A1;&#x5668;&#x4E2D;&#xFF0C;&#x5728;&#x8C03;&#x7528;bind&#x4E4B;&#x524D;&#x8BBE;&#x7F6E;SO_REUSEADDR&#x5957;&#x63A5;&#x53E3;&#x9009;&#x9879;&#xFF1B;</li>
<li>&#x5F53;&#x7F16;&#x5199;&#x4E00;&#x4E2A;&#x540C;&#x4E00;&#x65F6;&#x523B;&#x5728;&#x540C;&#x4E00;&#x4E3B;&#x673A;&#x4E0A;&#x53EF;&#x8FD0;&#x884C;&#x591A;&#x6B21;&#x7684;&#x591A;&#x64AD;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x8BBE;&#x7F6E;SO_REUSEADDR&#x9009;&#x9879;&#xFF0C;&#x5E76;&#x5C06;&#x672C;&#x7EC4;&#x7684;&#x591A;&#x64AD;&#x5730;&#x5740;&#x4F5C;&#x4E3A;&#x672C;&#x5730;IP&#x5730;&#x5740;&#x6346;&#x7ED1;&#x3002;<code>if (setsockopt(fd, SOL_SOCKET, SO_REUSEADDR, (const void \*)&amp;nOptval , sizeof(int)) &lt; 0) ...</code></li>
</ul>
<h2 id="&#x9644;"><a href="#&#x9644;" class="headerlink" title="&#x9644;"></a>&#x9644;</h2><p><em>Q: &#x7F16;&#x5199; TCP/SOCK_STREAM &#x670D;&#x52A1;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;SO_REUSEADDR&#x5230;&#x5E95;&#x4EC0;&#x4E48;&#x610F;&#x601D;&#xFF1F;</em></p>
<p><em>A: &#x8FD9;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x9009;&#x9879;&#x901A;&#x77E5;&#x5185;&#x6838;&#xFF0C;&#x5982;&#x679C;&#x7AEF;&#x53E3;&#x5FD9;&#xFF0C;&#x4F46;TCP&#x72B6;&#x6001;&#x4F4D;&#x4E8E; TIME_WAIT &#xFF0C;&#x53EF;&#x4EE5;&#x91CD;&#x7528;&#x7AEF;&#x53E3;&#x3002;&#x5982;&#x679C;&#x7AEF;&#x53E3;&#x5FD9;&#xFF0C;&#x800C;TCP&#x72B6;&#x6001;&#x4F4D;&#x4E8E;&#x5176;&#x4ED6;&#x72B6;&#x6001;&#xFF0C;&#x91CD;&#x7528;&#x7AEF;&#x53E3;&#x65F6;&#x4F9D;&#x65E7;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x9519;&#x8BEF;&#x4FE1;&#x606F;&#xFF0C;&#x6307;&#x660E;&#x201D;&#x5730;&#x5740;&#x5DF2;&#x7ECF;&#x4F7F;&#x7528;&#x4E2D;&#x201D;&#x3002;&#x5982;&#x679C;&#x4F60;&#x7684;&#x670D;&#x52A1;&#x7A0B;&#x5E8F;&#x505C;&#x6B62;&#x540E;&#x60F3;&#x7ACB;&#x5373;&#x91CD;&#x542F;&#xFF0C;&#x800C;&#x65B0;&#x5957;&#x63A5;&#x5B57;&#x4F9D;&#x65E7;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x7AEF;&#x53E3;&#xFF0C;&#x6B64;&#x65F6;SO_REUSEADDR &#x9009;&#x9879;&#x975E;&#x5E38;&#x6709;&#x7528;&#x3002;&#x5FC5;&#x987B;&#x610F;&#x8BC6;&#x5230;&#xFF0C;&#x6B64;&#x65F6;&#x4EFB;&#x4F55;&#x975E;&#x671F;&#x671B;&#x6570;&#x636E;&#x5230;&#x8FBE;&#xFF0C;&#x90FD;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x670D;&#x52A1;&#x7A0B;&#x5E8F;&#x53CD;&#x5E94;&#x6DF7;&#x4E71;&#xFF0C;&#x4E0D;&#x8FC7;&#x8FD9;&#x53EA;&#x662F;&#x4E00;&#x79CD;&#x53EF;&#x80FD;&#xFF0C;&#x4E8B;&#x5B9E;&#x4E0A;&#x5F88;&#x4E0D;&#x53EF;&#x80FD;&#x3002;</em></p>
<p>&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x7531;&#x76F8;&#x5173;&#x4E94;&#x5143;&#x7EC4;&#x6784;&#x6210;&#xFF0C;&#x534F;&#x8BAE;&#x3001;&#x672C;&#x5730;&#x5730;&#x5740;&#x3001;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#x3001;&#x8FDC;&#x7A0B;&#x5730;&#x5740;&#x3001;&#x8FDC;&#x7A0B;&#x7AEF;&#x53E3;&#x3002;SO_REUSEADDR &#x4EC5;&#x4EC5;&#x8868;&#x793A;&#x53EF;&#x4EE5;&#x91CD;&#x7528;&#x672C;&#x5730;&#x5730;&#x5740;&#x3001;&#x672C;&#x5730;&#x7AEF;&#x53E3;&#xFF0C;&#x6574;&#x4E2A;&#x76F8;&#x5173;&#x4E94;&#x5143;&#x7EC4;&#x8FD8;&#x662F;&#x552F;&#x4E00;&#x786E;&#x5B9A;&#x7684;&#x3002;&#x6240;&#x4EE5;&#xFF0C;&#x91CD;&#x542F;&#x540E;&#x7684;&#x670D;&#x52A1;&#x7A0B;&#x5E8F;&#x6709;&#x53EF;&#x80FD;&#x6536;&#x5230;&#x975E;&#x671F;&#x671B;&#x6570;&#x636E;&#x3002;&#x5FC5;&#x987B;&#x614E;&#x91CD;&#x4F7F;&#x7528;SO_REUSEADDR &#x9009;&#x9879;&#x3002;&#x3010;2&#x3011;</p>
<p>&#x3010;1&#x3011;<a href="http://topic.csdn.net/u/20090103/16/a0414edb-b289-4c72-84da-39e155e8f4be.html" target="_blank" rel="external">http://topic.csdn.net/u/20090103/16/a0414edb-b289-4c72-84da-39e155e8f4be.html</a></p>
<p>&#x3010;2&#x3011;&#x4EE5;&#x4E0B;&#x535A;&#x5BA2;&#x5BF9;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x8FDB;&#x884C;&#x4E86;&#x5BF9;&#x7B54;&#x5F0F;&#x7684;&#x89E3;&#x7B54;&#xFF1A;<a href="http://blog.sina.com.cn/s/blog_53a2ecbf010095db.html" target="_blank" rel="external">http://blog.sina.com.cn/s/blog_53a2ecbf010095db.html</a></p>
<p>&#x3010;3&#x3011;<a href="http://www.sudu.cn/info/html/edu/20050101/296180.html" target="_blank" rel="external">http://www.sudu.cn/info/html/edu/20050101/296180.html</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x8F6C;&amp;#x81EA;: &amp;#x535A;&amp;#x5BA2;&amp;#x56ED; http://www.cnblogs.com/qq78292959/archive/2013/01/18/2865926.html 2013-01-18&lt;/code&gt;&lt;/p&gt;

    
    </summary>
    
      <category term="Network" scheme="http://snowyying.github.io/categories/Network/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="socket" scheme="http://snowyying.github.io/tags/socket/"/>
    
      <category term="setsockopt" scheme="http://snowyying.github.io/tags/setsockopt/"/>
    
      <category term="SO_REUSEADDR" scheme="http://snowyying.github.io/tags/SO-REUSEADDR/"/>
    
  </entry>
  
  <entry>
    <title>再谈select, iocp, epoll, kqueue及各种I/O复用机制</title>
    <link href="http://snowyying.github.io/2016/io-multiplexing-mechanism/"/>
    <id>http://snowyying.github.io/2016/io-multiplexing-mechanism/</id>
    <published>2016-08-06T02:26:54.000Z</published>
    <updated>2016-08-25T04:09:30.787Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x8F6C;&#x81EA;: http://www.cnblogs.com/huacw/p/3518461.html 2010-01-28</code></p>
<p>&#x9996;&#x5148;&#xFF0C;&#x4ECB;&#x7ECD;&#x51E0;&#x79CD;&#x5E38;&#x89C1;&#x7684;I/O&#x6A21;&#x578B;&#x53CA;&#x5176;&#x533A;&#x522B;&#xFF0C;&#x5982;&#x4E0B;&#xFF1A;</p>
<ul>
<li>blocking I/O</li>
<li>nonblocking I/O</li>
<li>I/O multiplexing (select and poll)</li>
<li>signal driven I/O (SIGIO)</li>
<li>asynchronous I/O (the POSIX aio_functions)</li>
</ul>
<h2 id="blocking-I-O"><a href="#blocking-I-O" class="headerlink" title="blocking I/O"></a>blocking I/O</h2><p>&#x8FD9;&#x4E2A;&#x4E0D;&#x7528;&#x591A;&#x89E3;&#x91CA;&#x5427;&#xFF0C;&#x963B;&#x585E;&#x5957;&#x63A5;&#x5B57;&#x3002;&#x4E0B;&#x56FE;&#x662F;&#x5B83;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x7684;&#x56FE;&#x793A;&#xFF1A;</p>
<p><img src="/2016/io-multiplexing-mechanism/io_module_01.jpg" alt="blocking I/O"></p>
<p>&#x91CD;&#x70B9;&#x89E3;&#x91CA;&#x4E0B;&#x4E0A;&#x56FE;&#xFF0C;&#x4E0B;&#x9762;&#x4F8B;&#x5B50;&#x90FD;&#x4F1A;&#x8BB2;&#x5230;&#x3002;&#x9996;&#x5148;application&#x8C03;&#x7528; recvfrom()&#x8F6C;&#x5165;kernel&#xFF0C;&#x6CE8;&#x610F;kernel&#x6709;2&#x4E2A;&#x8FC7;&#x7A0B;&#xFF0C;wait for data&#x548C;copy data from kernel to user&#x3002;&#x76F4;&#x5230;&#x6700;&#x540E;copy complete&#x540E;&#xFF0C;recvfrom()&#x624D;&#x8FD4;&#x56DE;&#x3002;&#x6B64;&#x8FC7;&#x7A0B;&#x4E00;&#x76F4;&#x662F;&#x963B;&#x585E;&#x7684;&#x3002;</p>
<h2 id="nonblocking-I-O"><a href="#nonblocking-I-O" class="headerlink" title="nonblocking I/O"></a>nonblocking I/O</h2><p>&#x4E0E;blocking I/O&#x5BF9;&#x7ACB;&#x7684;&#xFF0C;&#x975E;&#x963B;&#x585E;&#x5957;&#x63A5;&#x5B57;&#xFF0C;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x56FE;&#x5982;&#x4E0B;&#xFF1A;</p>
<p><img src="/2016/io-multiplexing-mechanism/io_module_02.jpg" alt="nonblocking I/O"></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x89C1;&#xFF0C;&#x5982;&#x679C;&#x76F4;&#x63A5;&#x64CD;&#x4F5C;&#x5B83;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x4E2A;&#x8F6E;&#x8BE2;&#x3002;&#x3002;&#x76F4;&#x5230;&#x5185;&#x6838;&#x7F13;&#x51B2;&#x533A;&#x6709;&#x6570;&#x636E;&#x3002;</p>
<h2 id="I-O-multiplexing-select-and-poll"><a href="#I-O-multiplexing-select-and-poll" class="headerlink" title="I/O multiplexing (select and poll)"></a>I/O multiplexing (select and poll)</h2><p>&#x6700;&#x5E38;&#x89C1;&#x7684;I/O&#x590D;&#x7528;&#x6A21;&#x578B;&#xFF0C;select&#x3002;</p>
<p><img src="/2016/io-multiplexing-mechanism/io_module_03.jpg" alt="I/O multiplexing"></p>
<p>select&#x5148;&#x963B;&#x585E;&#xFF0C;&#x6709;&#x6D3B;&#x52A8;&#x5957;&#x63A5;&#x5B57;&#x624D;&#x8FD4;&#x56DE;&#x3002;&#x4E0E;blocking I/O&#x76F8;&#x6BD4;&#xFF0C;select&#x4F1A;&#x6709;&#x4E24;&#x6B21;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x4F46;&#x662F;select&#x80FD;&#x5904;&#x7406;&#x591A;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x3002;</p>
<h2 id="signal-driven-I-O-SIGIO"><a href="#signal-driven-I-O-SIGIO" class="headerlink" title="signal driven I/O (SIGIO)"></a>signal driven I/O (SIGIO)</h2><p>&#x53EA;&#x6709;UNIX&#x7CFB;&#x7EDF;&#x652F;&#x6301;&#xFF0C;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x8BFE;&#x67E5;&#x9605;&#x76F8;&#x5173;&#x8D44;&#x6599;</p>
<p><img src="/2016/io-multiplexing-mechanism/io_module_04.jpg" alt="signal driven I/O"></p>
<p>&#x4E0E;I/O multiplexing (select and poll)&#x76F8;&#x6BD4;&#xFF0C;&#x5B83;&#x7684;&#x4F18;&#x52BF;&#x662F;&#xFF0C;&#x514D;&#x53BB;&#x4E86;select&#x7684;&#x963B;&#x585E;&#x4E0E;&#x8F6E;&#x8BE2;&#xFF0C;&#x5F53;&#x6709;&#x6D3B;&#x8DC3;&#x5957;&#x63A5;&#x5B57;&#x65F6;&#xFF0C;&#x7531;&#x6CE8;&#x518C;&#x7684;handler&#x5904;&#x7406;&#x3002;</p>
<h2 id="asynchronous-I-O-the-POSIX-aio-functions"><a href="#asynchronous-I-O-the-POSIX-aio-functions" class="headerlink" title="asynchronous I/O (the POSIX aio_functions)"></a>asynchronous I/O (the POSIX aio_functions)</h2><p>&#x5F88;&#x5C11;&#x6709;*nix&#x7CFB;&#x7EDF;&#x652F;&#x6301;&#xFF0C;windows&#x7684;IOCP&#x5219;&#x662F;&#x6B64;&#x6A21;&#x578B;</p>
<p><img src="/2016/io-multiplexing-mechanism/io_module_05.jpg" alt="asynchronous I/O"></p>
<p>&#x5B8C;&#x5168;&#x5F02;&#x6B65;&#x7684;I/O&#x590D;&#x7528;&#x673A;&#x5236;&#xFF0C;&#x56E0;&#x4E3A;&#x7EB5;&#x89C2;&#x4E0A;&#x9762;&#x5176;&#x5B83;&#x56DB;&#x79CD;&#x6A21;&#x578B;&#xFF0C;&#x81F3;&#x5C11;&#x90FD;&#x4F1A;&#x5728;&#x7531;kernel copy data to appliction&#x65F6;&#x963B;&#x585E;&#x3002;&#x800C;&#x8BE5;&#x6A21;&#x578B;&#x662F;&#x5F53;copy&#x5B8C;&#x6210;&#x540E;&#x624D;&#x901A;&#x77E5;application&#xFF0C;&#x53EF;&#x89C1;&#x662F;&#x7EAF;&#x5F02;&#x6B65;&#x7684;&#x3002;&#x597D;&#x50CF;&#x53EA;&#x6709;windows&#x7684;&#x5B8C;&#x6210;&#x7AEF;&#x53E3;&#x662F;&#x8FD9;&#x4E2A;&#x6A21;&#x578B;&#xFF0C;&#x6548;&#x7387;&#x4E5F;&#x5F88;&#x51FA;&#x8272;&#x3002;</p>
<a id="more"></a> 
<p>&#x4E0B;&#x9762;&#x662F;&#x4EE5;&#x4E0A;&#x4E94;&#x79CD;&#x6A21;&#x578B;&#x7684;&#x6BD4;&#x8F83;</p>
<p><img src="/2016/io-multiplexing-mechanism/io_module_cmp.jpg" alt="&#x4E94;&#x79CD;&#x6A21;&#x578B;&#x6BD4;&#x8F83;"></p>
<p>&#x53EF;&#x4EE5;&#x770B;&#x51FA;&#xFF0C;&#x8D8A;&#x5F80;&#x540E;&#xFF0C;&#x963B;&#x585E;&#x8D8A;&#x5C11;&#xFF0C;&#x7406;&#x8BBA;&#x4E0A;&#x6548;&#x7387;&#x4E5F;&#x662F;&#x6700;&#x4F18;&#x3002;</p>
<hr>
<p>5&#x79CD;&#x6A21;&#x578B;&#x7684;&#x6BD4;&#x8F83;&#x6BD4;&#x8F83;&#x6E05;&#x6670;&#x4E86;&#xFF0C;&#x5269;&#x4E0B;&#x7684;&#x5C31;&#x662F;&#x628A;select,epoll,iocp,kqueue&#x6309;&#x53F7;&#x5165;&#x5EA7;&#x90A3;&#x5C31;OK&#x4E86;&#x3002;</p>
<p>select&#x548C;iocp&#x5206;&#x522B;&#x5BF9;&#x5E94;&#x7B2C;3&#x79CD;&#x4E0E;&#x7B2C;5&#x79CD;&#x6A21;&#x578B;&#xFF0C;&#x90A3;&#x4E48;epoll&#x4E0E;kqueue&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x4E5F;&#x4E8E;select&#x5C5E;&#x4E8E;&#x540C;&#x4E00;&#x79CD;&#x6A21;&#x578B;&#xFF0C;&#x53EA;&#x662F;&#x66F4;&#x9AD8;&#x7EA7;&#x4E00;&#x4E9B;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x4F5C;&#x6709;&#x4E86;&#x7B2C;4&#x79CD;&#x6A21;&#x578B;&#x7684;&#x67D0;&#x4E9B;&#x7279;&#x6027;&#xFF0C;&#x5982;callback&#x673A;&#x5236;&#x3002;</p>
<p>&#x90A3;&#x4E48;&#xFF0C;&#x4E3A;&#x4EC0;&#x4E48;epoll,kqueue&#x6BD4;select&#x9AD8;&#x7EA7;&#xFF1F;     </p>
<p>&#x7B54;&#x6848;&#x662F;&#xFF0C;&#x4ED6;&#x4EEC;&#x65E0;&#x8F6E;&#x8BE2;&#x3002;&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x7528;callback&#x53D6;&#x4EE3;&#x4E86;&#x3002;&#x60F3;&#x60F3;&#x770B;&#xFF0C;&#x5F53;&#x5957;&#x63A5;&#x5B57;&#x6BD4;&#x8F83;&#x591A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6BCF;&#x6B21;select()&#x90FD;&#x8981;&#x901A;&#x8FC7;&#x904D;&#x5386;FD_SETSIZE&#x4E2A;Socket&#x6765;&#x5B8C;&#x6210;&#x8C03;&#x5EA6;,&#x4E0D;&#x7BA1;&#x54EA;&#x4E2A;Socket&#x662F;&#x6D3B;&#x8DC3;&#x7684;,&#x90FD;&#x904D;&#x5386;&#x4E00;&#x904D;&#x3002;&#x8FD9;&#x4F1A;&#x6D6A;&#x8D39;&#x5F88;&#x591A;CPU&#x65F6;&#x95F4;&#x3002;&#x5982;&#x679C;&#x80FD;&#x7ED9;&#x5957;&#x63A5;&#x5B57;&#x6CE8;&#x518C;&#x67D0;&#x4E2A;&#x56DE;&#x8C03;&#x51FD;&#x6570;&#xFF0C;&#x5F53;&#x4ED6;&#x4EEC;&#x6D3B;&#x8DC3;&#x65F6;&#xFF0C;&#x81EA;&#x52A8;&#x5B8C;&#x6210;&#x76F8;&#x5173;&#x64CD;&#x4F5C;&#xFF0C;&#x90A3;&#x5C31;&#x907F;&#x514D;&#x4E86;&#x8F6E;&#x8BE2;&#xFF0C;&#x8FD9;&#x6B63;&#x662F;epoll&#x4E0E;kqueue&#x505A;&#x7684;&#x3002;</p>
<p>windows or *nix &#xFF08;IOCP or kqueue/epoll&#xFF09;&#xFF1F;</p>
<p>&#x8BDA;&#x7136;&#xFF0C;Windows&#x7684;IOCP&#x975E;&#x5E38;&#x51FA;&#x8272;&#xFF0C;&#x76EE;&#x524D;&#x5F88;&#x5C11;&#x6709;&#x652F;&#x6301;asynchronous I/O&#x7684;&#x7CFB;&#x7EDF;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5176;&#x7CFB;&#x7EDF;&#x672C;&#x8EAB;&#x7684;&#x5C40;&#x9650;&#x6027;&#xFF0C;&#x5927;&#x578B;&#x670D;&#x52A1;&#x5668;&#x8FD8;&#x662F;&#x5728;UNIX&#x4E0B;&#x3002;&#x800C;&#x4E14;&#x6B63;&#x5982;&#x4E0A;&#x9762;&#x6240;&#x8FF0;&#xFF0C;kqueue/epoll &#x4E0E; IOCP&#x76F8;&#x6BD4;&#xFF0C;&#x5C31;&#x662F;&#x591A;&#x4E86;&#x4E00;&#x5C42;&#x4ECE;&#x5185;&#x6838;copy&#x6570;&#x636E;&#x5230;&#x5E94;&#x7528;&#x5C42;&#x7684;&#x963B;&#x585E;&#xFF0C;&#x4ECE;&#x800C;&#x4E0D;&#x80FD;&#x7B97;&#x4F5C;asynchronous I/O&#x7C7B;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x8FD9;&#x5C42;&#x5C0F;&#x5C0F;&#x7684;&#x963B;&#x585E;&#x65E0;&#x8DB3;&#x8F7B;&#x91CD;&#xFF0C;kqueue&#x4E0E;epoll&#x5DF2;&#x7ECF;&#x505A;&#x5F97;&#x5F88;&#x4F18;&#x79C0;&#x4E86;&#x3002;</p>
<p>&#x63D0;&#x4F9B;&#x4E00;&#x81F4;&#x7684;&#x63A5;&#x53E3;&#xFF0C;IO Design Patterns</p>
<p>&#x5B9E;&#x9645;&#x4E0A;&#xFF0C;&#x4E0D;&#x7BA1;&#x662F;&#x54EA;&#x79CD;&#x6A21;&#x578B;&#xFF0C;&#x90FD;&#x53EF;&#x4EE5;&#x62BD;&#x8C61;&#x4E00;&#x5C42;&#x51FA;&#x6765;&#xFF0C;&#x63D0;&#x4F9B;&#x4E00;&#x81F4;&#x7684;&#x63A5;&#x53E3;&#xFF0C;&#x5E7F;&#x4E3A;&#x4EBA;&#x77E5;&#x7684;&#x6709;ACE, Libevent&#x8FD9;&#x4E9B;&#xFF0C;&#x4ED6;&#x4EEC;&#x90FD;&#x662F;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x4ED6;&#x4EEC;&#x81EA;&#x52A8;&#x9009;&#x62E9;&#x6700;&#x4F18;&#x7684;I/O&#x590D;&#x7528;&#x673A;&#x5236;&#xFF0C;&#x7528;&#x6237;&#x53EA;&#x9700;&#x8C03;&#x7528;&#x63A5;&#x53E3;&#x5373;&#x53EF;&#x3002;&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#x53C8;&#x5F97;&#x8BF4;&#x8BF4;2&#x4E2A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#xFF0C;Reactor and Proactor&#x3002;&#x6709;&#x4E00;&#x7BC7;&#x7ECF;&#x5178;&#x6587;&#x7AE0;<a href="http://www.artima.com/articles/io_design_patterns.html&#x503C;&#x5F97;&#x9605;&#x8BFB;&#xFF0C;Libevent&#x662F;Reactor&#x6A21;&#x578B;&#xFF0C;ACE&#x63D0;&#x4F9B;Proactor&#x6A21;&#x578B;&#x3002;&#x5B9E;&#x9645;&#x90FD;&#x662F;&#x5BF9;&#x5404;&#x79CD;I/O&#x590D;&#x7528;&#x673A;&#x5236;&#x7684;&#x5C01;&#x88C5;&#x3002;" target="_blank" rel="external">http://www.artima.com/articles/io_design_patterns.html&#x503C;&#x5F97;&#x9605;&#x8BFB;&#xFF0C;Libevent&#x662F;Reactor&#x6A21;&#x578B;&#xFF0C;ACE&#x63D0;&#x4F9B;Proactor&#x6A21;&#x578B;&#x3002;&#x5B9E;&#x9645;&#x90FD;&#x662F;&#x5BF9;&#x5404;&#x79CD;I/O&#x590D;&#x7528;&#x673A;&#x5236;&#x7684;&#x5C01;&#x88C5;&#x3002;</a></p>
<p>Java nio&#x5305;&#x662F;&#x4EC0;&#x4E48;I/O&#x673A;&#x5236;&#xFF1F;</p>
<p>&#x6211;&#x66FE;&#x5929;&#x771F;&#x7684;&#x8BA4;&#x4E3A;java nio&#x5C01;&#x88C5;&#x7684;&#x662F;IOCP&#x3002;&#x3002;&#x73B0;&#x5728;&#x53EF;&#x4EE5;&#x786E;&#x5B9A;&#xFF0C;&#x76EE;&#x524D;&#x7684;java&#x672C;&#x8D28;&#x662F;select()&#x6A21;&#x578B;&#xFF0C;&#x53EF;&#x4EE5;&#x68C0;&#x67E5;/jre/bin/nio.dll&#x5F97;&#x77E5;&#x3002;&#x81F3;&#x4E8E;java&#x670D;&#x52A1;&#x5668;&#x4E3A;&#x4EC0;&#x4E48;&#x6548;&#x7387;&#x8FD8;&#x4E0D;&#x9519;&#x3002;&#x3002;&#x6211;&#x4E5F;&#x4E0D;&#x5F97;&#x800C;&#x77E5;&#xFF0C;&#x53EF;&#x80FD;&#x662F;&#x8BBE;&#x8BA1;&#x5F97;&#x6BD4;&#x8F83;&#x597D;&#x5427;&#x3002;&#x3002;-_-&#x3002;</p>
<hr>
<p><strong> &#x603B;&#x7ED3;&#x4E00;&#x4E9B;&#x91CD;&#x70B9;: </strong></p>
<ul>
<li>&#x53EA;&#x6709;IOCP&#x662F;asynchronous I/O&#xFF0C;&#x5176;&#x4ED6;&#x673A;&#x5236;&#x6216;&#x591A;&#x6216;&#x5C11;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x70B9;&#x963B;&#x585E;&#x3002;</li>
<li>select&#x4F4E;&#x6548;&#x662F;&#x56E0;&#x4E3A;&#x6BCF;&#x6B21;&#x5B83;&#x90FD;&#x9700;&#x8981;&#x8F6E;&#x8BE2;&#x3002;&#x4F46;&#x4F4E;&#x6548;&#x4E5F;&#x662F;&#x76F8;&#x5BF9;&#x7684;&#xFF0C;&#x89C6;&#x60C5;&#x51B5;&#x800C;&#x5B9A;&#xFF0C;&#x4E5F;&#x53EF;&#x901A;&#x8FC7;&#x826F;&#x597D;&#x7684;&#x8BBE;&#x8BA1;&#x6539;&#x5584;</li>
<li>epoll, kqueue&#x662F;Reacor&#x6A21;&#x5F0F;&#xFF0C;IOCP&#x662F;Proactor&#x6A21;&#x5F0F;&#x3002;</li>
<li>java nio&#x5305;&#x662F;select&#x6A21;&#x578B;&#x3002;&#x3002;</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x8F6C;&amp;#x81EA;: http://www.cnblogs.com/huacw/p/3518461.html 2010-01-28&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x9996;&amp;#x5148;&amp;#xFF0C;&amp;#x4ECB;&amp;#x7ECD;&amp;#x51E0;&amp;#x79CD;&amp;#x5E38;&amp;#x89C1;&amp;#x7684;I/O&amp;#x6A21;&amp;#x578B;&amp;#x53CA;&amp;#x5176;&amp;#x533A;&amp;#x522B;&amp;#xFF0C;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;blocking I/O&lt;/li&gt;
&lt;li&gt;nonblocking I/O&lt;/li&gt;
&lt;li&gt;I/O multiplexing (select and poll)&lt;/li&gt;
&lt;li&gt;signal driven I/O (SIGIO)&lt;/li&gt;
&lt;li&gt;asynchronous I/O (the POSIX aio_functions)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;blocking-I-O&quot;&gt;&lt;a href=&quot;#blocking-I-O&quot; class=&quot;headerlink&quot; title=&quot;blocking I/O&quot;&gt;&lt;/a&gt;blocking I/O&lt;/h2&gt;&lt;p&gt;&amp;#x8FD9;&amp;#x4E2A;&amp;#x4E0D;&amp;#x7528;&amp;#x591A;&amp;#x89E3;&amp;#x91CA;&amp;#x5427;&amp;#xFF0C;&amp;#x963B;&amp;#x585E;&amp;#x5957;&amp;#x63A5;&amp;#x5B57;&amp;#x3002;&amp;#x4E0B;&amp;#x56FE;&amp;#x662F;&amp;#x5B83;&amp;#x8C03;&amp;#x7528;&amp;#x8FC7;&amp;#x7A0B;&amp;#x7684;&amp;#x56FE;&amp;#x793A;&amp;#xFF1A;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2016/io-multiplexing-mechanism/io_module_01.jpg&quot; alt=&quot;blocking I/O&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x91CD;&amp;#x70B9;&amp;#x89E3;&amp;#x91CA;&amp;#x4E0B;&amp;#x4E0A;&amp;#x56FE;&amp;#xFF0C;&amp;#x4E0B;&amp;#x9762;&amp;#x4F8B;&amp;#x5B50;&amp;#x90FD;&amp;#x4F1A;&amp;#x8BB2;&amp;#x5230;&amp;#x3002;&amp;#x9996;&amp;#x5148;application&amp;#x8C03;&amp;#x7528; recvfrom()&amp;#x8F6C;&amp;#x5165;kernel&amp;#xFF0C;&amp;#x6CE8;&amp;#x610F;kernel&amp;#x6709;2&amp;#x4E2A;&amp;#x8FC7;&amp;#x7A0B;&amp;#xFF0C;wait for data&amp;#x548C;copy data from kernel to user&amp;#x3002;&amp;#x76F4;&amp;#x5230;&amp;#x6700;&amp;#x540E;copy complete&amp;#x540E;&amp;#xFF0C;recvfrom()&amp;#x624D;&amp;#x8FD4;&amp;#x56DE;&amp;#x3002;&amp;#x6B64;&amp;#x8FC7;&amp;#x7A0B;&amp;#x4E00;&amp;#x76F4;&amp;#x662F;&amp;#x963B;&amp;#x585E;&amp;#x7684;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;nonblocking-I-O&quot;&gt;&lt;a href=&quot;#nonblocking-I-O&quot; class=&quot;headerlink&quot; title=&quot;nonblocking I/O&quot;&gt;&lt;/a&gt;nonblocking I/O&lt;/h2&gt;&lt;p&gt;&amp;#x4E0E;blocking I/O&amp;#x5BF9;&amp;#x7ACB;&amp;#x7684;&amp;#xFF0C;&amp;#x975E;&amp;#x963B;&amp;#x585E;&amp;#x5957;&amp;#x63A5;&amp;#x5B57;&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;&amp;#x8FC7;&amp;#x7A0B;&amp;#x56FE;&amp;#x5982;&amp;#x4E0B;&amp;#xFF1A;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2016/io-multiplexing-mechanism/io_module_02.jpg&quot; alt=&quot;nonblocking I/O&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x53EF;&amp;#x4EE5;&amp;#x770B;&amp;#x89C1;&amp;#xFF0C;&amp;#x5982;&amp;#x679C;&amp;#x76F4;&amp;#x63A5;&amp;#x64CD;&amp;#x4F5C;&amp;#x5B83;&amp;#xFF0C;&amp;#x90A3;&amp;#x5C31;&amp;#x662F;&amp;#x4E2A;&amp;#x8F6E;&amp;#x8BE2;&amp;#x3002;&amp;#x3002;&amp;#x76F4;&amp;#x5230;&amp;#x5185;&amp;#x6838;&amp;#x7F13;&amp;#x51B2;&amp;#x533A;&amp;#x6709;&amp;#x6570;&amp;#x636E;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;I-O-multiplexing-select-and-poll&quot;&gt;&lt;a href=&quot;#I-O-multiplexing-select-and-poll&quot; class=&quot;headerlink&quot; title=&quot;I/O multiplexing (select and poll)&quot;&gt;&lt;/a&gt;I/O multiplexing (select and poll)&lt;/h2&gt;&lt;p&gt;&amp;#x6700;&amp;#x5E38;&amp;#x89C1;&amp;#x7684;I/O&amp;#x590D;&amp;#x7528;&amp;#x6A21;&amp;#x578B;&amp;#xFF0C;select&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2016/io-multiplexing-mechanism/io_module_03.jpg&quot; alt=&quot;I/O multiplexing&quot;&gt;&lt;/p&gt;
&lt;p&gt;select&amp;#x5148;&amp;#x963B;&amp;#x585E;&amp;#xFF0C;&amp;#x6709;&amp;#x6D3B;&amp;#x52A8;&amp;#x5957;&amp;#x63A5;&amp;#x5B57;&amp;#x624D;&amp;#x8FD4;&amp;#x56DE;&amp;#x3002;&amp;#x4E0E;blocking I/O&amp;#x76F8;&amp;#x6BD4;&amp;#xFF0C;select&amp;#x4F1A;&amp;#x6709;&amp;#x4E24;&amp;#x6B21;&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;select&amp;#x80FD;&amp;#x5904;&amp;#x7406;&amp;#x591A;&amp;#x4E2A;&amp;#x5957;&amp;#x63A5;&amp;#x5B57;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;signal-driven-I-O-SIGIO&quot;&gt;&lt;a href=&quot;#signal-driven-I-O-SIGIO&quot; class=&quot;headerlink&quot; title=&quot;signal driven I/O (SIGIO)&quot;&gt;&lt;/a&gt;signal driven I/O (SIGIO)&lt;/h2&gt;&lt;p&gt;&amp;#x53EA;&amp;#x6709;UNIX&amp;#x7CFB;&amp;#x7EDF;&amp;#x652F;&amp;#x6301;&amp;#xFF0C;&amp;#x611F;&amp;#x5174;&amp;#x8DA3;&amp;#x7684;&amp;#x8BFE;&amp;#x67E5;&amp;#x9605;&amp;#x76F8;&amp;#x5173;&amp;#x8D44;&amp;#x6599;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2016/io-multiplexing-mechanism/io_module_04.jpg&quot; alt=&quot;signal driven I/O&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x4E0E;I/O multiplexing (select and poll)&amp;#x76F8;&amp;#x6BD4;&amp;#xFF0C;&amp;#x5B83;&amp;#x7684;&amp;#x4F18;&amp;#x52BF;&amp;#x662F;&amp;#xFF0C;&amp;#x514D;&amp;#x53BB;&amp;#x4E86;select&amp;#x7684;&amp;#x963B;&amp;#x585E;&amp;#x4E0E;&amp;#x8F6E;&amp;#x8BE2;&amp;#xFF0C;&amp;#x5F53;&amp;#x6709;&amp;#x6D3B;&amp;#x8DC3;&amp;#x5957;&amp;#x63A5;&amp;#x5B57;&amp;#x65F6;&amp;#xFF0C;&amp;#x7531;&amp;#x6CE8;&amp;#x518C;&amp;#x7684;handler&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
&lt;h2 id=&quot;asynchronous-I-O-the-POSIX-aio-functions&quot;&gt;&lt;a href=&quot;#asynchronous-I-O-the-POSIX-aio-functions&quot; class=&quot;headerlink&quot; title=&quot;asynchronous I/O (the POSIX aio_functions)&quot;&gt;&lt;/a&gt;asynchronous I/O (the POSIX aio_functions)&lt;/h2&gt;&lt;p&gt;&amp;#x5F88;&amp;#x5C11;&amp;#x6709;*nix&amp;#x7CFB;&amp;#x7EDF;&amp;#x652F;&amp;#x6301;&amp;#xFF0C;windows&amp;#x7684;IOCP&amp;#x5219;&amp;#x662F;&amp;#x6B64;&amp;#x6A21;&amp;#x578B;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2016/io-multiplexing-mechanism/io_module_05.jpg&quot; alt=&quot;asynchronous I/O&quot;&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5B8C;&amp;#x5168;&amp;#x5F02;&amp;#x6B65;&amp;#x7684;I/O&amp;#x590D;&amp;#x7528;&amp;#x673A;&amp;#x5236;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x7EB5;&amp;#x89C2;&amp;#x4E0A;&amp;#x9762;&amp;#x5176;&amp;#x5B83;&amp;#x56DB;&amp;#x79CD;&amp;#x6A21;&amp;#x578B;&amp;#xFF0C;&amp;#x81F3;&amp;#x5C11;&amp;#x90FD;&amp;#x4F1A;&amp;#x5728;&amp;#x7531;kernel copy data to appliction&amp;#x65F6;&amp;#x963B;&amp;#x585E;&amp;#x3002;&amp;#x800C;&amp;#x8BE5;&amp;#x6A21;&amp;#x578B;&amp;#x662F;&amp;#x5F53;copy&amp;#x5B8C;&amp;#x6210;&amp;#x540E;&amp;#x624D;&amp;#x901A;&amp;#x77E5;application&amp;#xFF0C;&amp;#x53EF;&amp;#x89C1;&amp;#x662F;&amp;#x7EAF;&amp;#x5F02;&amp;#x6B65;&amp;#x7684;&amp;#x3002;&amp;#x597D;&amp;#x50CF;&amp;#x53EA;&amp;#x6709;windows&amp;#x7684;&amp;#x5B8C;&amp;#x6210;&amp;#x7AEF;&amp;#x53E3;&amp;#x662F;&amp;#x8FD9;&amp;#x4E2A;&amp;#x6A21;&amp;#x578B;&amp;#xFF0C;&amp;#x6548;&amp;#x7387;&amp;#x4E5F;&amp;#x5F88;&amp;#x51FA;&amp;#x8272;&amp;#x3002;&lt;/p&gt;
    
    </summary>
    
      <category term="I/O" scheme="http://snowyying.github.io/categories/I-O/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="I/O" scheme="http://snowyying.github.io/tags/I-O/"/>
    
      <category term="性能" scheme="http://snowyying.github.io/tags/%E6%80%A7%E8%83%BD/"/>
    
      <category term="复用" scheme="http://snowyying.github.io/tags/%E5%A4%8D%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>SELECT是如何实现的？</title>
    <link href="http://snowyying.github.io/2016/select-implement/"/>
    <id>http://snowyying.github.io/2016/select-implement/</id>
    <published>2016-08-05T04:21:47.000Z</published>
    <updated>2016-08-25T04:03:25.971Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x8F6C;&#x81EA;: QUORA http://www.quora.com/Network-Programming/How-is-select-implemented 2012-11-28</code></p>
<p>&#x6211;&#x4F1A;&#x4EE5;Linux&#x4E3A;&#x4F8B;&#xFF0C;&#x56E0;&#x4E3A;&#x90A3;&#x662F;&#x6211;&#x719F;&#x6089;&#x7684;&#x3002;&#x6211;&#x6CA1;&#x6709;BSD&#x6216;&#x5176;&#x4ED6;unix&#x7CFB;&#x7EDF;&#x7684;&#x7ECF;&#x9A8C;&#xFF0C;&#x4F46;&#x6211;&#x5047;&#x5B9A;&#x8FD9;&#x4E9B;&#x7CFB;&#x7EDF;&#x539F;&#x7406;&#x4E0A;&#x7C7B;&#x4F3C;&#x3002;</p>
<p>&#x6BCF;&#x4E00;&#x4E2A;Socket&#xFF08;&#x5B9E;&#x9645;&#x4E0A;&#x53EF;&#x4EE5;&#x662F;&#x80FD;&#x591F;&#x6CE8;&#x518C;&#x5230;select()&#x4E0A;&#x7684;&#x4EFB;&#x610F;fd - file descriptor&#xFF09;&#x90FD;&#x6709;&#x4E00;&#x4E2A;waiters&#x7684;&#x5217;&#x8868;&#xFF0C;&#x4ED6;&#x4EEC;&#xFF08;waiter&#xFF09;&#x5728;&#x7B49;&#x5F85;socket&#x4E0A;&#x7684;&#x6D3B;&#x52A8;&#xFF08;&#x5728;linux&#x4E0A;&#x662F; struct wait_queue_head_t&#xFF09;&#x3002;&#x8FD9;&#x4E2A;Socket&#x4E0A;&#x65E0;&#x8BBA;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x6709;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#xFF08;&#x5230;&#x8FBE;&#x65B0;&#x6570;&#x636E;&#xFF0C;&#x7F13;&#x51B2;&#x533A;&#x6709;&#x53EF;&#x5199;&#x7684;&#x7A7A;&#x95F2;&#x7A7A;&#x95F4;&#xFF0C;&#x6216;&#x8005;&#x67D0;&#x79CD;&#x9519;&#x8BEF;&#xFF09;&#xFF0C;&#x8FD9;&#x4E2A;Socket&#x4F1A;&#x904D;&#x5386;&#x5217;&#x8868;&#x901A;&#x77E5;&#x7B49;&#x5F85;&#x6D3B;&#x52A8;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x3002;</p>
<p>select()&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x904D;&#x5386;&#x7528;&#x6237;&#x4F20;&#x5165;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#x5217;&#x8868;&#x3002;&#x5BF9;&#x4E8E;&#x6BCF;&#x4E00;&#x4E2A;fd&#xFF0C;&#x8C03;&#x7528;fd&#x7684;poll()&#x65B9;&#x6CD5;&#xFF08;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x548C;&#x5E94;&#x7528;&#x5C42;&#x7684;poll()&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x662F;&#x4E24;&#x56DE;&#x4E8B;&#xFF09;&#xFF0C;&#x8FD9;&#x5C06;&#x4F1A;&#x6DFB;&#x52A0;&#x8C03;&#x7528;&#x8005;&#xFF08;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#xFF09;&#x5230;fd&#x7684;&#x7B49;&#x5F85;&#x961F;&#x5217;&#xFF0C;&#x8FD4;&#x56DE;&#x9002;&#x7528;&#x4E8E;&#x5F53;&#x524D;fd&#x7684;&#x4E8B;&#x4EF6;&#xFF08;&#x8BFB;&#xFF0C;&#x5199;&#xFF0C;&#x5F02;&#x5E38;&#xFF09;&#x3002;</p>
<p>&#x5982;&#x679C;&#x4EFB;&#x4F55;fd&#x5339;&#x914D;&#x7528;&#x6237;&#x4F20;&#x5165;&#x7684;&#x6761;&#x4EF6;&#xFF0C;select()&#x5728;&#x66F4;&#x65B0;&#x7528;&#x6237;&#x4F20;&#x5165;&#x7684;fd_sets&#x540E;&#xFF0C;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x3002;</p>
<p>&#x5982;&#x679C;&#x6CA1;&#x6709;&#x5339;&#x914D;&#x7684;fd&#xFF0C;select()&#x4F1A;&#x4E00;&#x76F4;&#x4F11;&#x7720;&#xFF0C;&#x4E00;&#x76F4;&#x5230;&#x7528;&#x6237;&#x6307;&#x5B9A;&#x7684;&#x6700;&#x5927;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x3002;</p>
<p>&#x5982;&#x679C;&#x5728;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x5185;&#xFF0C;&#x6CE8;&#x518C;&#x5230;select()&#x4E0A;&#x7684;&#x4EFB;&#x4E00;fd&#x6709;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#xFF0C;fd&#x4F1A;&#x901A;&#x77E5;&#x8FD9;&#x4E2A;fd&#x7684;&#x7B49;&#x5F85;&#x961F;&#x5217;&#x3002;&#x8FD9;&#x4F1A;&#x5524;&#x9192;&#x8C03;&#x7528;select()&#x65F6;&#x4F11;&#x7720;&#x7684;&#x7528;&#x6237;&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD9;&#x65F6;&#x5C31;&#x4F1A;&#x91CD;&#x590D;&#x4E0A;&#x9762;&#x7684;&#x5FAA;&#x73AF;&#xFF0C;&#x770B;&#x770B;&#x54EA;&#x4E00;&#x4E2A;fd&#x51C6;&#x5907;&#x597D;&#x8FD4;&#x56DE;&#x7ED9;&#x7528;&#x6237;&#x3002;</p>
<p>select()&#x4F1A;&#x8BB0;&#x5F55;&#x5B83;&#x6DFB;&#x52A0;&#x7684;&#x6240;&#x6709;&#x7684;&#x7B49;&#x5F85;&#x961F;&#x5217;&#xFF0C;&#x5728;&#x8FD4;&#x56DE;&#x4EE5;&#x524D;&#xFF0C;&#x786E;&#x4FDD;&#x4ECE;&#x6240;&#x6709;&#x7684;fd&#x79FB;&#x9664;&#x3002;</p>
<p>summary&#xFF1A;&#x6BCF;&#x4E00;&#x6B21;select()&#x8C03;&#x7528;&#x9700;&#x8981; 3 &#x6B21;&#x904D;&#x5386;&#xFF0C;&#x7B2C;&#x4E00;&#x6B21;&#x662F;&#x5BF9;&#x6BCF;&#x4E2A;fd&#x5206;&#x522B;&#x8C03;&#x7528;poll&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x662F;&#x904D;&#x5386;&#x751F;&#x6210;&#x8FD4;&#x56DE;&#x7ED9;&#x7528;&#x6237;&#x7684;fd_sets&#xFF0C;&#x7B2C;&#x4E09;&#x6B21;&#x662F;&#x5E94;&#x7528;&#x5C42;&#x9762;&#x904D;&#x5386;&#x8FDB;&#x884C;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x5904;&#x7406;&#x3002;</p>
<a id="more"></a> 
<p>&#x82F1;&#x6587;&#x539F;&#x6587;&#xFF1A;</p>
<blockquote>
<p>I&#x2019;ll answer for Linux, since that&#x2019;s what I know. I have no experience with any of the BSDs or other unixes, but I would assume they work broadly similarly.</p>
<p>Every socket (really, every file descriptor that can be select()ed on) has a list of waiters that are currently waiting for activity on that socket (struct wait_queue_head_t in Linux terminology). Whenever something interesting happens on that socket (new data is available, buffer space is free for writing, or some kind of error), that socket will walk its list and notify everyone waiting on it.</p>
<p>select() works by looping over the list of file descriptors that the user passed in. For every file descriptor, it calls that fd&#x2019;s poll() method, which will add the caller to that fd&#x2019;s wait queue, and return which events (readable, writeable, exception) currently apply to that fd.</p>
<p>If any file descriptor matches the condition that the user was looking for, select() will simply return immediately, after updating the appropriate fd_sets that the user passed.</p>
<p>If not, however, select() will go to sleep, for up to the maximum timeout the user specified.</p>
<p>If, during that interval, an interesting event happens to any file descriptor that select() is waiting on, that fd will notify its wait queue. That will cause the thread sleeping inside select() to wake up, at which point it will repeat the above loop and see which of the fd&#x2019;s are now ready to be returned to the user.</p>
<p>select() also keeps track of all of the wait queues it has been added to, and before returning (successfully or otherwise), must go through and ensure it&#x2019;s been removed from all of them.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x8F6C;&amp;#x81EA;: QUORA http://www.quora.com/Network-Programming/How-is-select-implemented 2012-11-28&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x6211;&amp;#x4F1A;&amp;#x4EE5;Linux&amp;#x4E3A;&amp;#x4F8B;&amp;#xFF0C;&amp;#x56E0;&amp;#x4E3A;&amp;#x90A3;&amp;#x662F;&amp;#x6211;&amp;#x719F;&amp;#x6089;&amp;#x7684;&amp;#x3002;&amp;#x6211;&amp;#x6CA1;&amp;#x6709;BSD&amp;#x6216;&amp;#x5176;&amp;#x4ED6;unix&amp;#x7CFB;&amp;#x7EDF;&amp;#x7684;&amp;#x7ECF;&amp;#x9A8C;&amp;#xFF0C;&amp;#x4F46;&amp;#x6211;&amp;#x5047;&amp;#x5B9A;&amp;#x8FD9;&amp;#x4E9B;&amp;#x7CFB;&amp;#x7EDF;&amp;#x539F;&amp;#x7406;&amp;#x4E0A;&amp;#x7C7B;&amp;#x4F3C;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;Socket&amp;#xFF08;&amp;#x5B9E;&amp;#x9645;&amp;#x4E0A;&amp;#x53EF;&amp;#x4EE5;&amp;#x662F;&amp;#x80FD;&amp;#x591F;&amp;#x6CE8;&amp;#x518C;&amp;#x5230;select()&amp;#x4E0A;&amp;#x7684;&amp;#x4EFB;&amp;#x610F;fd - file descriptor&amp;#xFF09;&amp;#x90FD;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;waiters&amp;#x7684;&amp;#x5217;&amp;#x8868;&amp;#xFF0C;&amp;#x4ED6;&amp;#x4EEC;&amp;#xFF08;waiter&amp;#xFF09;&amp;#x5728;&amp;#x7B49;&amp;#x5F85;socket&amp;#x4E0A;&amp;#x7684;&amp;#x6D3B;&amp;#x52A8;&amp;#xFF08;&amp;#x5728;linux&amp;#x4E0A;&amp;#x662F; struct wait_queue_head_t&amp;#xFF09;&amp;#x3002;&amp;#x8FD9;&amp;#x4E2A;Socket&amp;#x4E0A;&amp;#x65E0;&amp;#x8BBA;&amp;#x4EC0;&amp;#x4E48;&amp;#x65F6;&amp;#x5019;&amp;#x6709;&amp;#x611F;&amp;#x5174;&amp;#x8DA3;&amp;#x7684;&amp;#x4E8B;&amp;#x4EF6;&amp;#x53D1;&amp;#x751F;&amp;#xFF08;&amp;#x5230;&amp;#x8FBE;&amp;#x65B0;&amp;#x6570;&amp;#x636E;&amp;#xFF0C;&amp;#x7F13;&amp;#x51B2;&amp;#x533A;&amp;#x6709;&amp;#x53EF;&amp;#x5199;&amp;#x7684;&amp;#x7A7A;&amp;#x95F2;&amp;#x7A7A;&amp;#x95F4;&amp;#xFF0C;&amp;#x6216;&amp;#x8005;&amp;#x67D0;&amp;#x79CD;&amp;#x9519;&amp;#x8BEF;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;Socket&amp;#x4F1A;&amp;#x904D;&amp;#x5386;&amp;#x5217;&amp;#x8868;&amp;#x901A;&amp;#x77E5;&amp;#x7B49;&amp;#x5F85;&amp;#x6D3B;&amp;#x52A8;&amp;#x7684;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EBF;&amp;#x7A0B;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;select()&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x904D;&amp;#x5386;&amp;#x7528;&amp;#x6237;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x5217;&amp;#x8868;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x6BCF;&amp;#x4E00;&amp;#x4E2A;fd&amp;#xFF0C;&amp;#x8C03;&amp;#x7528;fd&amp;#x7684;poll()&amp;#x65B9;&amp;#x6CD5;&amp;#xFF08;&amp;#x8FD9;&amp;#x4E2A;&amp;#x65B9;&amp;#x6CD5;&amp;#x548C;&amp;#x5E94;&amp;#x7528;&amp;#x5C42;&amp;#x7684;poll()&amp;#x7CFB;&amp;#x7EDF;&amp;#x8C03;&amp;#x7528;&amp;#x662F;&amp;#x4E24;&amp;#x56DE;&amp;#x4E8B;&amp;#xFF09;&amp;#xFF0C;&amp;#x8FD9;&amp;#x5C06;&amp;#x4F1A;&amp;#x6DFB;&amp;#x52A0;&amp;#x8C03;&amp;#x7528;&amp;#x8005;&amp;#xFF08;&amp;#x5F53;&amp;#x524D;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF09;&amp;#x5230;fd&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x9002;&amp;#x7528;&amp;#x4E8E;&amp;#x5F53;&amp;#x524D;fd&amp;#x7684;&amp;#x4E8B;&amp;#x4EF6;&amp;#xFF08;&amp;#x8BFB;&amp;#xFF0C;&amp;#x5199;&amp;#xFF0C;&amp;#x5F02;&amp;#x5E38;&amp;#xFF09;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5982;&amp;#x679C;&amp;#x4EFB;&amp;#x4F55;fd&amp;#x5339;&amp;#x914D;&amp;#x7528;&amp;#x6237;&amp;#x4F20;&amp;#x5165;&amp;#x7684;&amp;#x6761;&amp;#x4EF6;&amp;#xFF0C;select()&amp;#x5728;&amp;#x66F4;&amp;#x65B0;&amp;#x7528;&amp;#x6237;&amp;#x4F20;&amp;#x5165;&amp;#x7684;fd_sets&amp;#x540E;&amp;#xFF0C;&amp;#x7ACB;&amp;#x5373;&amp;#x8FD4;&amp;#x56DE;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x5339;&amp;#x914D;&amp;#x7684;fd&amp;#xFF0C;select()&amp;#x4F1A;&amp;#x4E00;&amp;#x76F4;&amp;#x4F11;&amp;#x7720;&amp;#xFF0C;&amp;#x4E00;&amp;#x76F4;&amp;#x5230;&amp;#x7528;&amp;#x6237;&amp;#x6307;&amp;#x5B9A;&amp;#x7684;&amp;#x6700;&amp;#x5927;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;&amp;#x5982;&amp;#x679C;&amp;#x5728;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;&amp;#x95F4;&amp;#x9694;&amp;#x5185;&amp;#xFF0C;&amp;#x6CE8;&amp;#x518C;&amp;#x5230;select()&amp;#x4E0A;&amp;#x7684;&amp;#x4EFB;&amp;#x4E00;fd&amp;#x6709;&amp;#x611F;&amp;#x5174;&amp;#x8DA3;&amp;#x7684;&amp;#x4E8B;&amp;#x4EF6;&amp;#x53D1;&amp;#x751F;&amp;#xFF0C;fd&amp;#x4F1A;&amp;#x901A;&amp;#x77E5;&amp;#x8FD9;&amp;#x4E2A;fd&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x961F;&amp;#x5217;&amp;#x3002;&amp;#x8FD9;&amp;#x4F1A;&amp;#x5524;&amp;#x9192;&amp;#x8C03;&amp;#x7528;select()&amp;#x65F6;&amp;#x4F11;&amp;#x7720;&amp;#x7684;&amp;#x7528;&amp;#x6237;&amp;#x7EBF;&amp;#x7A0B;&amp;#xFF0C;&amp;#x8FD9;&amp;#x65F6;&amp;#x5C31;&amp;#x4F1A;&amp;#x91CD;&amp;#x590D;&amp;#x4E0A;&amp;#x9762;&amp;#x7684;&amp;#x5FAA;&amp;#x73AF;&amp;#xFF0C;&amp;#x770B;&amp;#x770B;&amp;#x54EA;&amp;#x4E00;&amp;#x4E2A;fd&amp;#x51C6;&amp;#x5907;&amp;#x597D;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x7528;&amp;#x6237;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;select()&amp;#x4F1A;&amp;#x8BB0;&amp;#x5F55;&amp;#x5B83;&amp;#x6DFB;&amp;#x52A0;&amp;#x7684;&amp;#x6240;&amp;#x6709;&amp;#x7684;&amp;#x7B49;&amp;#x5F85;&amp;#x961F;&amp;#x5217;&amp;#xFF0C;&amp;#x5728;&amp;#x8FD4;&amp;#x56DE;&amp;#x4EE5;&amp;#x524D;&amp;#xFF0C;&amp;#x786E;&amp;#x4FDD;&amp;#x4ECE;&amp;#x6240;&amp;#x6709;&amp;#x7684;fd&amp;#x79FB;&amp;#x9664;&amp;#x3002;&lt;/p&gt;
&lt;p&gt;summary&amp;#xFF1A;&amp;#x6BCF;&amp;#x4E00;&amp;#x6B21;select()&amp;#x8C03;&amp;#x7528;&amp;#x9700;&amp;#x8981; 3 &amp;#x6B21;&amp;#x904D;&amp;#x5386;&amp;#xFF0C;&amp;#x7B2C;&amp;#x4E00;&amp;#x6B21;&amp;#x662F;&amp;#x5BF9;&amp;#x6BCF;&amp;#x4E2A;fd&amp;#x5206;&amp;#x522B;&amp;#x8C03;&amp;#x7528;poll&amp;#xFF0C;&amp;#x7B2C;&amp;#x4E8C;&amp;#x6B21;&amp;#x662F;&amp;#x904D;&amp;#x5386;&amp;#x751F;&amp;#x6210;&amp;#x8FD4;&amp;#x56DE;&amp;#x7ED9;&amp;#x7528;&amp;#x6237;&amp;#x7684;fd_sets&amp;#xFF0C;&amp;#x7B2C;&amp;#x4E09;&amp;#x6B21;&amp;#x662F;&amp;#x5E94;&amp;#x7528;&amp;#x5C42;&amp;#x9762;&amp;#x904D;&amp;#x5386;&amp;#x8FDB;&amp;#x884C;&amp;#x4E1A;&amp;#x52A1;&amp;#x903B;&amp;#x8F91;&amp;#x5904;&amp;#x7406;&amp;#x3002;&lt;/p&gt;
    
    </summary>
    
      <category term="Network" scheme="http://snowyying.github.io/categories/Network/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="select" scheme="http://snowyying.github.io/tags/select/"/>
    
      <category term="epoll" scheme="http://snowyying.github.io/tags/epoll/"/>
    
  </entry>
  
  <entry>
    <title>socket编程之select函数</title>
    <link href="http://snowyying.github.io/2016/socket-select/"/>
    <id>http://snowyying.github.io/2016/socket-select/</id>
    <published>2016-08-05T02:26:48.000Z</published>
    <updated>2016-08-25T04:03:25.957Z</updated>
    
    <content type="html"><![CDATA[<p><code>&#x8F6C;&#x81EA;: &#x535A;&#x5BA2;&#x56ED; http://www.cnblogs.com/ggzss/archive/2011/08/25/2153746.html 2011-08-25</code></p>
<blockquote>
<p>Select&#x5728;Socket&#x7F16;&#x7A0B;&#x4E2D;&#x8FD8;&#x662F;&#x6BD4;&#x8F83;&#x91CD;&#x8981;&#x7684;&#xFF0C;&#x5B83;&#x80FD;&#x591F;&#x76D1;&#x89C6;&#x6211;&#x4EEC;&#x9700;&#x8981;&#x76D1;&#x89C6;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x53D8;&#x5316;&#x60C5;&#x51B5;&#x2014;&#x2014;&#x8BFB;&#x5199;&#x6216;&#x662F;&#x5F02;&#x5E38;&#x3002;</p>
</blockquote>
<p>Select&#x7684;&#x51FD;&#x6570;&#x683C;&#x5F0F;, Unix&#x7CFB;&#x7EDF;&#x4E0B;&#x7684;&#x4F2F;&#x514B;&#x5229;socket&#x7F16;&#x7A0B;&#xFF0C;&#x548C;windows&#x4E0B;&#x7684;&#x7565;&#x6709;&#x533A;&#x522B;&#xFF0C;&#x4F53;&#x73B0;&#x4E24;&#x4E2A;&#x65B9;&#x9762;&#xFF1A;</p>
<ol>
<li>select&#x51FD;&#x6570;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5728;windows&#x4E0B;&#x53EF;&#x4EE5;&#x5FFD;&#x7565;&#xFF0C;&#x4F46;&#x5728;linux&#x4E0B;&#x5FC5;&#x987B;&#x8BBE;&#x4E3A;&#x6700;&#x5927;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x52A0;1&#xFF1B;</li>
<li>&#x7ED3;&#x6784;fd_set&#x5728;&#x4E24;&#x4E2A;&#x7CFB;&#x7EDF;&#x91CC;&#x5B9A;&#x4E49;&#x4E0D;&#x4E00;&#x6837;</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span><span class="params">(<span class="keyword">int</span> maxfdp,</span></span></div><div class="line">  fd_set *readfds,</div><div class="line">  fd_set *writefds,</div><div class="line">  fd_set *errorfds,</div><div class="line">  <span class="keyword">struct</span> timeval *timeout);</div><div class="line"></div><div class="line"><span class="comment">/*&#x53C2;&#x6570;&#x5217;&#x8868;</span></div><div class="line">int maxfdp&#x662F;&#x4E00;&#x4E2A;&#x6574;&#x6570;&#x503C;&#xFF0C;&#x662F;&#x6307;&#x96C6;&#x5408;&#x4E2D;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x8303;&#x56F4;&#xFF0C;</div><div class="line">&#x5373;&#x6240;&#x6709;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x6700;&#x5927;&#x503C;&#x52A0;1&#xFF0C;&#x4E0D;&#x80FD;&#x9519;&#xFF01;</div><div class="line">&#x5728;Windows&#x4E2D;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x503C;&#x65E0;&#x6240;&#x8C13;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x4E0D;&#x6B63;&#x786E;&#x3002;</div><div class="line"></div><div class="line">fd_set *readfds&#x662F;&#x6307;&#x5411;fd_set&#x7ED3;&#x6784;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x5E94;&#x8BE5;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;</div><div class="line">&#x6211;&#x4EEC;&#x662F;&#x8981;&#x76D1;&#x89C6;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x8BFB;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x5373;&#x6211;&#x4EEC;&#x5173;&#x5FC3;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x4ECE;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x4E86;&#xFF0C;</div><div class="line">&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x53EF;&#x8BFB;&#xFF0C;select&#x5C31;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5927;&#x4E8E;0&#x7684;&#x503C;&#xFF0C;&#x8868;&#x793A;&#x6709;&#x6587;&#x4EF6;&#x53EF;&#x8BFB;&#xFF0C;</div><div class="line">&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53EF;&#x8BFB;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x6839;&#x636E;timeout&#x53C2;&#x6570;&#x518D;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8D85;&#x65F6;&#xFF0C;</div><div class="line">&#x82E5;&#x8D85;&#x51FA;timeout&#x7684;&#x65F6;&#x95F4;&#xFF0C;select&#x8FD4;&#x56DE;0&#xFF0C;&#x82E5;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x8FD4;&#x56DE;&#x8D1F;&#x503C;&#x3002;</div><div class="line">&#x53EF;&#x4EE5;&#x4F20;&#x5165;NULL&#x503C;&#xFF0C;&#x8868;&#x793A;&#x4E0D;&#x5173;&#x5FC3;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x7684;&#x8BFB;&#x53D8;&#x5316;&#x3002;</div><div class="line"></div><div class="line">fd_set *writefds&#x662F;&#x6307;&#x5411;fd_set&#x7ED3;&#x6784;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x5E94;&#x8BE5;&#x5305;&#x62EC;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;</div><div class="line">&#x6211;&#x4EEC;&#x662F;&#x8981;&#x76D1;&#x89C6;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x5199;&#x53D8;&#x5316;&#x7684;&#xFF0C;&#x5373;&#x6211;&#x4EEC;&#x5173;&#x5FC3;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x5411;&#x8FD9;&#x4E9B;&#x6587;&#x4EF6;&#x4E2D;&#x5199;&#x5165;&#x6570;&#x636E;&#x4E86;&#xFF0C;</div><div class="line">&#x5982;&#x679C;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x53EF;&#x5199;&#xFF0C;select&#x5C31;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5927;&#x4E8E;0&#x7684;&#x503C;&#xFF0C;&#x8868;&#x793A;&#x6709;&#x6587;&#x4EF6;&#x53EF;&#x5199;&#xFF0C;</div><div class="line">&#x5982;&#x679C;&#x6CA1;&#x6709;&#x53EF;&#x5199;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5219;&#x6839;&#x636E;timeout&#x53C2;&#x6570;&#x518D;&#x5224;&#x65AD;&#x662F;&#x5426;&#x8D85;&#x65F6;&#xFF0C;</div><div class="line">&#x82E5;&#x8D85;&#x51FA;timeout&#x7684;&#x65F6;&#x95F4;&#xFF0C;select&#x8FD4;&#x56DE;0&#xFF0C;&#x82E5;&#x53D1;&#x751F;&#x9519;&#x8BEF;&#x8FD4;&#x56DE;&#x8D1F;&#x503C;&#x3002;</div><div class="line">&#x53EF;&#x4EE5;&#x4F20;&#x5165;NULL&#x503C;&#xFF0C;&#x8868;&#x793A;&#x4E0D;&#x5173;&#x5FC3;&#x4EFB;&#x4F55;&#x6587;&#x4EF6;&#x7684;&#x5199;&#x53D8;&#x5316;&#x3002;</div><div class="line"></div><div class="line">fd_set *errorfds&#x540C;&#x4E0A;&#x9762;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#x7684;&#x610F;&#x56FE;&#xFF0C;&#x7528;&#x6765;&#x76D1;&#x89C6;&#x6587;&#x4EF6;&#x9519;&#x8BEF;&#x5F02;&#x5E38;&#x3002;</div><div class="line"></div><div class="line">struct timeval* timeout&#x662F;select&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x8FD9;&#x4E2A;&#x53C2;&#x6570;&#x81F3;&#x5173;&#x91CD;&#x8981;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x4F7F;select&#x5904;&#x4E8E;&#x4E09;&#x79CD;&#x72B6;&#x6001;&#xFF1A;</div><div class="line">1. &#x82E5;&#x5C06;NULL&#x4EE5;&#x5F62;&#x53C2;&#x4F20;&#x5165;&#xFF0C;&#x5373;&#x4E0D;&#x4F20;&#x5165;&#x65F6;&#x95F4;&#x7ED3;&#x6784;&#xFF0C;&#x5C31;&#x662F;&#x5C06;select&#x7F6E;&#x4E8E;&#x963B;&#x585E;&#x72B6;&#x6001;&#xFF0C;</div><div class="line">&#x4E00;&#x5B9A;&#x7B49;&#x5230;&#x76D1;&#x89C6;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x96C6;&#x5408;&#x4E2D;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x4E3A;&#x6B62;&#xFF1B;</div><div class="line">2. &#x82E5;&#x5C06;&#x65F6;&#x95F4;&#x503C;&#x8BBE;&#x4E3A;0&#x79D2;0&#x6BEB;&#x79D2;&#xFF0C;&#x5C31;&#x53D8;&#x6210;&#x4E00;&#x4E2A;&#x7EAF;&#x7CB9;&#x7684;&#x975E;&#x963B;&#x585E;&#x51FD;&#x6570;&#xFF0C;</div><div class="line">&#x4E0D;&#x7BA1;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x662F;&#x5426;&#x6709;&#x53D8;&#x5316;&#xFF0C;&#x90FD;&#x7ACB;&#x523B;&#x8FD4;&#x56DE;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#xFF0C;&#x6587;&#x4EF6;&#x65E0;&#x53D8;&#x5316;&#x8FD4;&#x56DE;0&#xFF0C;&#x6709;&#x53D8;&#x5316;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x6B63;&#x503C;&#xFF1B;</div><div class="line">3. timeout&#x7684;&#x503C;&#x5927;&#x4E8E;0&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x7B49;&#x5F85;&#x7684;&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#xFF0C;&#x5373; select&#x5728;timeout&#x65F6;&#x95F4;&#x5185;&#x963B;&#x585E;&#xFF0C;</div><div class="line">&#x8D85;&#x65F6;&#x65F6;&#x95F4;&#x4E4B;&#x5185;&#x6709;&#x4E8B;&#x4EF6;&#x5230;&#x6765;&#x5C31;&#x8FD4;&#x56DE;&#x4E86;&#xFF0C;&#x5426;&#x5219;&#x5728;&#x8D85;&#x65F6;&#x540E;&#x4E0D;&#x7BA1;&#x600E;&#x6837;&#x4E00;&#x5B9A;&#x8FD4;&#x56DE;&#xFF0C;&#x8FD4;&#x56DE;&#x503C;&#x540C;&#x4E0A;&#x8FF0;&#x3002;</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">&#x8FD4;&#x56DE;&#x503C;&#xFF1A;</div><div class="line">&#x8D1F;&#x503C;&#xFF1A;select&#x9519;&#x8BEF;</div><div class="line">&#x6B63;&#x503C;&#xFF1A;&#x67D0;&#x4E9B;&#x6587;&#x4EF6;&#x53EF;&#x8BFB;&#x5199;&#x6216;&#x51FA;&#x9519;</div><div class="line">0&#xFF1A;&#x7B49;&#x5F85;&#x8D85;&#x65F6;&#xFF0C;&#x6CA1;&#x6709;&#x53EF;&#x8BFB;&#x5199;&#x6216;&#x9519;&#x8BEF;&#x7684;&#x6587;&#x4EF6;</div><div class="line">*/</div></pre></td></tr></table></figure>
<a id="more"></a> 
<p><strong>&#x8BF4;&#x660E;&#x4E24;&#x4E2A;&#x7ED3;&#x6784;&#x4F53;&#xFF1A;</strong></p>
<ol>
<li>struct fd_set&#x53EF;&#x4EE5;&#x7406;&#x89E3;&#x4E3A;&#x4E00;&#x4E2A;&#x96C6;&#x5408;&#xFF0C;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4E2D;&#x5B58;&#x653E;&#x7684;&#x662F;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;(file descriptor)&#xFF0C;&#x5373;&#x6587;&#x4EF6;&#x53E5;&#x67C4;&#xFF0C;&#x8FD9;&#x53EF;&#x4EE5;&#x662F;&#x6211;&#x4EEC;&#x6240;&#x8BF4;&#x7684;&#x666E;&#x901A;&#x610F;&#x4E49;&#x7684;&#x6587;&#x4EF6;&#xFF0C;&#x5F53;&#x7136;Unix&#x4E0B;&#x4EFB;&#x4F55;&#x8BBE;&#x5907;&#x3001;&#x7BA1;&#x9053;&#x3001;FIFO&#x7B49;&#x90FD;&#x662F;&#x6587;&#x4EF6;&#x5F62;&#x5F0F;&#xFF0C;&#x5168;&#x90E8;&#x5305;&#x62EC;&#x5728;&#x5185;&#xFF0C;&#x6240;&#x4EE5;&#x6BEB;&#x65E0;&#x7591;&#x95EE;&#x4E00;&#x4E2A;socket&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;socket&#x53E5;&#x67C4;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x3002;<br>fd_set&#x96C6;&#x5408;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4E00;&#x4E9B;&#x5B8F;&#x7531;&#x4EBA;&#x4E3A;&#x6765;&#x64CD;&#x4F5C;&#xFF0C;&#x6BD4;&#x5982;&#x6E05;&#x7A7A;&#x96C6;&#x5408;<code>FD_ZERO(fd_set *)</code>&#xFF0C;&#x5C06;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x52A0;&#x5165;&#x96C6;&#x5408;&#x4E4B;&#x4E2D;<code>FD_SET(int, fd_set *)</code>&#xFF0C;&#x5C06;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x4ECE;&#x96C6;&#x5408;&#x4E2D;&#x5220;&#x9664;<code>FD_CLR(int, fd_set *)</code>&#xFF0C;&#x68C0;&#x67E5;&#x96C6;&#x5408;&#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x8BFB;&#x5199;<code>FD_ISSET(int, fd_set *)</code>&#x3002;</li>
<li>struct timeval&#x662F;&#x4E00;&#x4E2A;&#x5927;&#x5BB6;&#x5E38;&#x7528;&#x7684;&#x7ED3;&#x6784;&#xFF0C;&#x7528;&#x6765;&#x4EE3;&#x8868;&#x65F6;&#x95F4;&#x503C;&#xFF0C;&#x6709;&#x4E24;&#x4E2A;&#x6210;&#x5458;&#xFF0C;&#x4E00;&#x4E2A;&#x662F;&#x79D2;&#x6570;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x662F;&#x6BEB;&#x79D2;&#x6570;&#x3002;</li>
</ol>
<p>&#x5728;&#x6709;&#x4E86;select&#x540E;&#x53EF;&#x4EE5;&#x5199;&#x51FA;&#x50CF;&#x6837;&#x7684;&#x7F51;&#x7EDC;&#x7A0B;&#x5E8F;&#x6765;&#xFF01;&#x4E3E;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x4F8B;&#x5B50;&#xFF0C;&#x5C31;&#x662F;&#x4ECE;&#x7F51;&#x7EDC;&#x4E0A;&#x63A5;&#x53D7;&#x6570;&#x636E;&#x5199;&#x5165;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x4E2D;&#x3002;</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PORT 5150</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MSGSIZE 1024</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib, <span class="meta-string">&quot;ws2_32.lib&quot;</span>)</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> g_iTotalConn = <span class="number">0</span>;</div><div class="line">SOCKET g_CliSocketArr[FD_SETSIZE];</div><div class="line"></div><div class="line"><span class="function">DWORD WINAPI <span class="title">WorkerThread</span><span class="params">(LPVOID lpParameter)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">{</div><div class="line">    WSADATA wsaData;</div><div class="line">    SOCKET sListen, sClient;</div><div class="line">    SOCKADDR_IN local, client;</div><div class="line">    <span class="keyword">int</span> iaddrSize = <span class="keyword">sizeof</span>(SOCKADDR_IN);</div><div class="line">    DWORD dwThreadId;</div><div class="line">    <span class="comment">// Initialize Windows socket library</span></div><div class="line">    WSAStartup(<span class="number">0x0202</span>, &amp;wsaData);</div><div class="line">    <span class="comment">// Create listening socket</span></div><div class="line">    sListen = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</div><div class="line">    <span class="comment">// Bind</span></div><div class="line">    local.sin_addr.S_un.S_addr = htonl(INADDR_ANY);</div><div class="line">    local.sin_family = AF_INET;</div><div class="line">    local.sin_port = htons(PORT);</div><div class="line">    bind(sListen, (<span class="keyword">struct</span> sockaddr *)&amp;local, <span class="keyword">sizeof</span>(SOCKADDR_IN));</div><div class="line">    <span class="comment">// Listen</span></div><div class="line">    listen(sListen, <span class="number">3</span>);</div><div class="line">    <span class="comment">// Create worker thread</span></div><div class="line">    CreateThread(<span class="literal">NULL</span>, <span class="number">0</span>, WorkerThread, <span class="literal">NULL</span>, <span class="number">0</span>, &amp;dwThreadId);</div><div class="line">    <span class="keyword">while</span> (TRUE)</div><div class="line">    {</div><div class="line">        <span class="comment">// Accept a connection</span></div><div class="line">        sClient = accept(sListen, (<span class="keyword">struct</span> sockaddr *)&amp;client, &amp;iaddrSize);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Accepted client:%s:%d\n&quot;</span>, inet_ntoa(client.sin_addr), ntohs(client.sin_port));</div><div class="line">        <span class="comment">// Add socket to g_CliSocketArr</span></div><div class="line">        g_CliSocketArr[g_iTotalConn++] = sClient;</div><div class="line">    }</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="function">DWORD WINAPI <span class="title">WorkerThread</span><span class="params">(LPVOID lpParam)</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    fd_set fdread;</div><div class="line">    <span class="keyword">int</span> ret;</div><div class="line">    <span class="keyword">struct</span> timeval tv = {<span class="number">1</span>, <span class="number">0</span>};</div><div class="line">    <span class="keyword">char</span> szMessage[MSGSIZE];</div><div class="line">    <span class="keyword">while</span> (TRUE)</div><div class="line">    {</div><div class="line">        FD_ZERO(&amp;fdread);</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_iTotalConn; i++)</div><div class="line">        {</div><div class="line">            FD_SET(g_CliSocketArr, &amp;fdread);</div><div class="line">        } <span class="comment">// We only care read event</span></div><div class="line">        ret = select(<span class="number">0</span>, &amp;fdread, <span class="literal">NULL</span>, <span class="literal">NULL</span>, &amp;tv);</div><div class="line">        <span class="keyword">if</span> (ret == <span class="number">0</span>)</div><div class="line">        { <span class="comment">// Time expired</span></div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        }</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g_iTotalConn; i++)</div><div class="line">        {</div><div class="line">            <span class="keyword">if</span> (FD_ISSET(g_CliSocketArr, &amp;fdread))</div><div class="line">            { <span class="comment">// A read event happened on g_CliSocketArr</span></div><div class="line">                ret = recv(g_CliSocketArr, szMessage, MSGSIZE, <span class="number">0</span>);</div><div class="line">                <span class="keyword">if</span> (ret == <span class="number">0</span> || (ret == SOCKET_ERROR &amp;&amp; WSAGetLastError() == WSAECONNRESET))</div><div class="line">                {</div><div class="line">                    <span class="comment">// Client socket closed</span></div><div class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Client socket %d closed.\n&quot;</span>, g_CliSocketArr);</div><div class="line">                    closesocket(g_CliSocketArr);</div><div class="line">                    <span class="keyword">if</span> (i &lt; g_iTotalConn - <span class="number">1</span>)</div><div class="line">                    {</div><div class="line">                        g_CliSocketArr[i--] = g_CliSocketArr[--g_iTotalConn];</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keyword">else</span></div><div class="line">                {</div><div class="line">                    <span class="comment">// We received a message from client</span></div><div class="line">                    szMessage[ret] = <span class="string">&apos;\0&apos;</span>;</div><div class="line">                    send(g_CliSocketArr, szMessage, <span class="built_in">strlen</span>(szMessage), <span class="number">0</span>);</div><div class="line">                }</div><div class="line">            } <span class="comment">//if</span></div><div class="line">        }<span class="comment">//for</span></div><div class="line">    }<span class="comment">//while</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x670D;&#x52A1;&#x5668;&#x7684;&#x51E0;&#x4E2A;&#x4E3B;&#x8981;&#x52A8;&#x4F5C;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x521B;&#x5EFA;&#x76D1;&#x542C;&#x5957;&#x63A5;&#x5B57;&#xFF0C;&#x7ED1;&#x5B9A;&#xFF0C;&#x76D1;&#x542C;&#xFF1B;</li>
<li>&#x521B;&#x5EFA;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#xFF1B;</li>
<li>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x6570;&#x7EC4;&#xFF0C;&#x7528;&#x6765;&#x5B58;&#x653E;&#x5F53;&#x524D;&#x6240;&#x6709;&#x6D3B;&#x52A8;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5957;&#x63A5;&#x5B57;&#xFF0C;&#x6BCF;accept&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5C31;&#x66F4;&#x65B0;&#x4E00;&#x6B21;&#x6570;&#x7EC4;&#xFF1B;</li>
<li>&#x63A5;&#x53D7;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#x3002;</li>
</ol>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E00;&#x70B9;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#xFF0C;&#x5C31;&#x662F;&#x6211;&#x6CA1;&#x6709;&#x91CD;&#x65B0;&#x5B9A;&#x4E49;FD_SETSIZE&#x5B8F;&#xFF0C;&#x6240;&#x4EE5;&#x670D;&#x52A1;&#x5668;&#x6700;&#x591A;&#x652F;&#x6301;&#x7684;&#x5E76;&#x53D1;&#x8FDE;&#x63A5;&#x6570;&#x4E3A;64&#x3002;&#x800C;&#x4E14;&#xFF0C;&#x8FD9;&#x91CC;&#x51B3;&#x4E0D;&#x80FD;&#x65E0;&#x6761;&#x4EF6;&#x7684;accept,&#x670D;&#x52A1;&#x5668;&#x5E94;&#x8BE5;&#x6839;&#x636E;&#x5F53;&#x524D;&#x7684;&#x8FDE;&#x63A5;&#x6570;&#x6765;&#x51B3;&#x5B9A;&#x662F;&#x5426;&#x63A5;&#x53D7;&#x6765;&#x81EA;&#x67D0;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#x3002;&#x4E00;&#x79CD;&#x6BD4;&#x8F83;&#x597D;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x6848;&#x5C31;&#x662F;&#x91C7;&#x7528;WSAAccept&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x4E14;&#x8BA9;WSAAccept&#x56DE;&#x8C03;&#x81EA;&#x5DF1;&#x5B9E;&#x73B0;&#x7684;Condition Function&#x3002;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> CALLBACK <span class="title">ConditionFunc</span><span class="params">(LPWSABUF lpCallerId,</span></span></div><div class="line">    LPWSABUF lpCallerData,</div><div class="line">    LPQOS lpSQOS,</div><div class="line">    LPQOS lpGQOS,</div><div class="line">    LPWSABUF lpCalleeId,</div><div class="line">    LPWSABUF lpCalleeData,</div><div class="line">    GROUP FAR *g,</div><div class="line">    DWORD dwCallbackData)</div><div class="line">{</div><div class="line">&#x3000;&#x3000;<span class="keyword">if</span> (&#x5F53;&#x524D;&#x8FDE;&#x63A5;&#x6570; &lt; FD_SETSIZE)</div><div class="line">&#x3000;&#x3000;&#x3000;&#x3000;<span class="keyword">return</span> CF_ACCEPT;</div><div class="line">&#x3000;&#x3000;<span class="keyword">else</span>   </div><div class="line">&#x3000;&#x3000;&#x3000;&#x3000;<span class="keyword">return</span> CF_REJECT;</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#x91CC;&#x9762;&#x662F;&#x4E00;&#x4E2A;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;&#x4E00;&#x6B21;&#x5FAA;&#x73AF;&#x5B8C;&#x6210;&#x7684;&#x52A8;&#x4F5C;&#x662F;&#xFF1A;</p>
<ol>
<li>&#x5C06;&#x5F53;&#x524D;&#x6240;&#x6709;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x5957;&#x63A5;&#x5B57;&#x52A0;&#x5165;&#x5230;&#x8BFB;&#x96C6;fdread&#x4E2D;&#xFF1B;</li>
<li>&#x8C03;&#x7528;select&#x51FD;&#x6570;&#xFF1B;</li>
<li>&#x67E5;&#x770B;&#x67D0;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x662F;&#x5426;&#x4ECD;&#x7136;&#x5904;&#x4E8E;&#x8BFB;&#x96C6;&#x4E2D;&#xFF0C;&#x5982;&#x679C;&#x662F;&#xFF0C;&#x5219;&#x63A5;&#x6536;&#x6570;&#x636E;&#x3002;&#x5982;&#x679C;&#x63A5;&#x6536;&#x7684;&#x6570;&#x636E;&#x957F;&#x5EA6;&#x4E3A;0&#xFF0C;&#x6216;&#x8005;&#x53D1;&#x751F;WSAECONNRESET&#x9519;&#x8BEF;&#xFF0C;&#x5219;&#x8868;&#x793A;&#x5BA2;&#x6237;&#x7AEF;&#x5957;&#x63A5;&#x5B57;&#x4E3B;&#x52A8;&#x5173;&#x95ED;&#xFF0C;&#x8FD9;&#x65F6;&#x9700;&#x8981;&#x5C06;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#x5BF9;&#x5E94;&#x7684;&#x5957;&#x63A5;&#x5B57;&#x6240;&#x7ED1;&#x5B9A;&#x7684;&#x8D44;&#x6E90;&#x91CA;&#x653E;&#x6389;&#xFF0C;&#x7136;&#x540E;&#x8C03;&#x6574;&#x6211;&#x4EEC;&#x7684;&#x5957;&#x63A5;&#x5B57;&#x6570;&#x7EC4;&#xFF08;&#x5C06;&#x6570;&#x7EC4;&#x4E2D;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x632A;&#x5230;&#x5F53;&#x524D;&#x7684;&#x4F4D;&#x7F6E;&#x4E0A;&#xFF09;&#x3002;</li>
</ol>
<p>&#x9664;&#x4E86;&#x9700;&#x8981;&#x6709;&#x6761;&#x4EF6;&#x63A5;&#x53D7;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8FDE;&#x63A5;&#x5916;&#xFF0C;&#x8FD8;&#x9700;&#x8981;&#x5728;&#x8FDE;&#x63A5;&#x6570;&#x4E3A;0&#x7684;&#x60C5;&#x5F62;&#x4E0B;&#x505A;&#x7279;&#x6B8A;&#x5904;&#x7406;&#xFF0C;&#x56E0;&#x4E3A;&#x5982;&#x679C;&#x8BFB;&#x96C6;&#x4E2D;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x5957;&#x63A5;&#x5B57;&#xFF0C;select&#x51FD;&#x6570;&#x4F1A;&#x7ACB;&#x523B;&#x8FD4;&#x56DE;&#xFF0C;&#x8FD9;&#x5C06;&#x5BFC;&#x81F4;&#x5DE5;&#x4F5C;&#x8005;&#x7EBF;&#x7A0B;&#x6210;&#x4E3A;&#x4E00;&#x4E2A;&#x6BEB;&#x65E0;&#x505C;&#x987F;&#x7684;&#x6B7B;&#x5FAA;&#x73AF;&#xFF0C;CPU&#x7684;&#x5360;&#x7528;&#x7387;&#x9A6C;&#x4E0A;&#x8FBE;&#x5230;100%&#x3002;</p>
<p>&#x5173;&#x7CFB;&#x5230;&#x5957;&#x63A5;&#x5B57;&#x5217;&#x8868;&#x7684;&#x64CD;&#x4F5C;&#x90FD;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5FAA;&#x73AF;,&#x5728;&#x8F6E;&#x8BE2;&#x7684;&#x65F6;&#x5019;,&#x9700;&#x8981;&#x904D;&#x5386;&#x4E00;&#x6B21;,&#x518D;&#x65B0;&#x7684;&#x4E00;&#x8F6E;&#x5F00;&#x59CB;&#x65F6;,&#x5C06;&#x5217;&#x8868;&#x52A0;&#x5165;&#x961F;&#x5217;&#x53C8;&#x9700;&#x8981;&#x904D;&#x5386;&#x4E00;&#x6B21;.&#x4E5F;&#x5C31;&#x662F;&#x8BF4;,Select&#x5728;&#x5DE5;&#x4F5C;&#x4E00;&#x6B21;&#x65F6;,&#x9700;&#x8981;&#x81F3;&#x5C11;&#x904D;&#x5386;2&#x6B21;&#x5217;&#x8868;,&#x8FD9;&#x662F;&#x5B83;&#x6548;&#x7387;&#x8F83;&#x4F4E;&#x7684;&#x539F;&#x56E0;&#x4E4B;&#x4E00;.</p>
<p>&#x5728;&#x5927;&#x89C4;&#x6A21;&#x7684;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x65B9;&#x9762;,&#x8FD8;&#x662F;&#x63A8;&#x8350;&#x4F7F;&#x7528;IOCP&#x6216;EPOLL&#x6A21;&#x578B;.&#x4F46;&#x662F;Select&#x6A21;&#x578B;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x5728;&#x8BF8;&#x5982;&#x5BF9;&#x6218;&#x7C7B;&#x6E38;&#x620F;&#x4E0A;,&#x6BD4;&#x5982;&#x7C7B;&#x4F3C;&#x661F;&#x9645;&#x8FD9;&#x79CD;,&#x56E0;&#x4E3A;&#x5B83;&#x5C0F;&#x5DE7;&#x6613;&#x4E8E;&#x5B9E;&#x73B0;,&#x4E14;&#x5BF9;&#x6218;&#x7C7B;&#x6E38;&#x620F;&#x7684;&#x7F51;&#x7EDC;&#x8FDE;&#x63A5;&#x91CF;&#x5E76;&#x4E0D;&#x5927;. &#x5BF9;&#x4E8E;Select&#x6A21;&#x578B;&#x60F3;&#x8981;&#x7A81;&#x7834;Windows 64&#x4E2A;&#x9650;&#x5236;&#x7684;&#x8BDD;,&#x53EF;&#x4EE5;&#x91C7;&#x53D6;&#x5206;&#x6BB5;&#x8F6E;&#x8BE2;,&#x4E00;&#x6B21;&#x8F6E;&#x8BE2;64&#x4E2A;.&#x4F8B;&#x5982;&#x5957;&#x63A5;&#x5B57;&#x5217;&#x8868;&#x4E3A;128&#x4E2A;,&#x5728;&#x7B2C;&#x4E00;&#x6B21;&#x8F6E;&#x8BE2;&#x65F6;,&#x5C06;&#x524D;64&#x4E2A;&#x653E;&#x5165;&#x961F;&#x5217;&#x4E2D;&#x7528;Select&#x8FDB;&#x884C;&#x72B6;&#x6001;&#x67E5;&#x8BE2;, &#x5F85;&#x672C;&#x6B21;&#x64CD;&#x4F5C;&#x5168;&#x90E8;&#x7ED3;&#x675F;&#x540E;.&#x5C06;&#x540E;64&#x4E2A;&#x518D;&#x52A0;&#x5165;&#x8F6E;&#x8BE2;&#x961F;&#x5217;&#x4E2D;&#x8FDB;&#x884C;&#x8F6E;&#x8BE2;&#x5904;&#x7406;.&#x8FD9;&#x6837;&#x5904;&#x7406;&#x9700;&#x8981;&#x5728;&#x975E;&#x963B;&#x585E;&#x5F0F;&#x4E0B;&#x5DE5;&#x4F5C;.&#x4EE5;&#x6B64;&#x7C7B;&#x63A8;,Select&#x4E5F;&#x80FD;&#x652F;&#x6301;&#x65E0;&#x9650;&#x591A;&#x4E2A;&#x3002;</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;&amp;#x8F6C;&amp;#x81EA;: &amp;#x535A;&amp;#x5BA2;&amp;#x56ED; http://www.cnblogs.com/ggzss/archive/2011/08/25/2153746.html 2011-08-25&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Select&amp;#x5728;Socket&amp;#x7F16;&amp;#x7A0B;&amp;#x4E2D;&amp;#x8FD8;&amp;#x662F;&amp;#x6BD4;&amp;#x8F83;&amp;#x91CD;&amp;#x8981;&amp;#x7684;&amp;#xFF0C;&amp;#x5B83;&amp;#x80FD;&amp;#x591F;&amp;#x76D1;&amp;#x89C6;&amp;#x6211;&amp;#x4EEC;&amp;#x9700;&amp;#x8981;&amp;#x76D1;&amp;#x89C6;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x7684;&amp;#x53D8;&amp;#x5316;&amp;#x60C5;&amp;#x51B5;&amp;#x2014;&amp;#x2014;&amp;#x8BFB;&amp;#x5199;&amp;#x6216;&amp;#x662F;&amp;#x5F02;&amp;#x5E38;&amp;#x3002;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Select&amp;#x7684;&amp;#x51FD;&amp;#x6570;&amp;#x683C;&amp;#x5F0F;, Unix&amp;#x7CFB;&amp;#x7EDF;&amp;#x4E0B;&amp;#x7684;&amp;#x4F2F;&amp;#x514B;&amp;#x5229;socket&amp;#x7F16;&amp;#x7A0B;&amp;#xFF0C;&amp;#x548C;windows&amp;#x4E0B;&amp;#x7684;&amp;#x7565;&amp;#x6709;&amp;#x533A;&amp;#x522B;&amp;#xFF0C;&amp;#x4F53;&amp;#x73B0;&amp;#x4E24;&amp;#x4E2A;&amp;#x65B9;&amp;#x9762;&amp;#xFF1A;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;select&amp;#x51FD;&amp;#x6570;&amp;#x7684;&amp;#x7B2C;&amp;#x4E00;&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#xFF0C;&amp;#x5728;windows&amp;#x4E0B;&amp;#x53EF;&amp;#x4EE5;&amp;#x5FFD;&amp;#x7565;&amp;#xFF0C;&amp;#x4F46;&amp;#x5728;linux&amp;#x4E0B;&amp;#x5FC5;&amp;#x987B;&amp;#x8BBE;&amp;#x4E3A;&amp;#x6700;&amp;#x5927;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x52A0;1&amp;#xFF1B;&lt;/li&gt;
&lt;li&gt;&amp;#x7ED3;&amp;#x6784;fd_set&amp;#x5728;&amp;#x4E24;&amp;#x4E2A;&amp;#x7CFB;&amp;#x7EDF;&amp;#x91CC;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E0D;&amp;#x4E00;&amp;#x6837;&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; maxfdp,&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  fd_set *readfds,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  fd_set *writefds,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  fd_set *errorfds,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  &lt;span class=&quot;keyword&quot;&gt;struct&lt;/span&gt; timeval *timeout);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&amp;#x53C2;&amp;#x6570;&amp;#x5217;&amp;#x8868;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;int maxfdp&amp;#x662F;&amp;#x4E00;&amp;#x4E2A;&amp;#x6574;&amp;#x6570;&amp;#x503C;&amp;#xFF0C;&amp;#x662F;&amp;#x6307;&amp;#x96C6;&amp;#x5408;&amp;#x4E2D;&amp;#x6240;&amp;#x6709;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x7684;&amp;#x8303;&amp;#x56F4;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x5373;&amp;#x6240;&amp;#x6709;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x7684;&amp;#x6700;&amp;#x5927;&amp;#x503C;&amp;#x52A0;1&amp;#xFF0C;&amp;#x4E0D;&amp;#x80FD;&amp;#x9519;&amp;#xFF01;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x5728;Windows&amp;#x4E2D;&amp;#x8FD9;&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#x7684;&amp;#x503C;&amp;#x65E0;&amp;#x6240;&amp;#x8C13;&amp;#xFF0C;&amp;#x53EF;&amp;#x4EE5;&amp;#x8BBE;&amp;#x7F6E;&amp;#x4E0D;&amp;#x6B63;&amp;#x786E;&amp;#x3002;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;fd_set *readfds&amp;#x662F;&amp;#x6307;&amp;#x5411;fd_set&amp;#x7ED3;&amp;#x6784;&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x96C6;&amp;#x5408;&amp;#x4E2D;&amp;#x5E94;&amp;#x8BE5;&amp;#x5305;&amp;#x62EC;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x6211;&amp;#x4EEC;&amp;#x662F;&amp;#x8981;&amp;#x76D1;&amp;#x89C6;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x7684;&amp;#x8BFB;&amp;#x53D8;&amp;#x5316;&amp;#x7684;&amp;#xFF0C;&amp;#x5373;&amp;#x6211;&amp;#x4EEC;&amp;#x5173;&amp;#x5FC3;&amp;#x662F;&amp;#x5426;&amp;#x53EF;&amp;#x4EE5;&amp;#x4ECE;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6587;&amp;#x4EF6;&amp;#x4E2D;&amp;#x8BFB;&amp;#x53D6;&amp;#x6570;&amp;#x636E;&amp;#x4E86;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x96C6;&amp;#x5408;&amp;#x4E2D;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x53EF;&amp;#x8BFB;&amp;#xFF0C;select&amp;#x5C31;&amp;#x4F1A;&amp;#x8FD4;&amp;#x56DE;&amp;#x4E00;&amp;#x4E2A;&amp;#x5927;&amp;#x4E8E;0&amp;#x7684;&amp;#x503C;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x6709;&amp;#x6587;&amp;#x4EF6;&amp;#x53EF;&amp;#x8BFB;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x53EF;&amp;#x8BFB;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5219;&amp;#x6839;&amp;#x636E;timeout&amp;#x53C2;&amp;#x6570;&amp;#x518D;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x5426;&amp;#x8D85;&amp;#x65F6;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x82E5;&amp;#x8D85;&amp;#x51FA;timeout&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;select&amp;#x8FD4;&amp;#x56DE;0&amp;#xFF0C;&amp;#x82E5;&amp;#x53D1;&amp;#x751F;&amp;#x9519;&amp;#x8BEF;&amp;#x8FD4;&amp;#x56DE;&amp;#x8D1F;&amp;#x503C;&amp;#x3002;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F20;&amp;#x5165;NULL&amp;#x503C;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x4E0D;&amp;#x5173;&amp;#x5FC3;&amp;#x4EFB;&amp;#x4F55;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x8BFB;&amp;#x53D8;&amp;#x5316;&amp;#x3002;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;fd_set *writefds&amp;#x662F;&amp;#x6307;&amp;#x5411;fd_set&amp;#x7ED3;&amp;#x6784;&amp;#x7684;&amp;#x6307;&amp;#x9488;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x96C6;&amp;#x5408;&amp;#x4E2D;&amp;#x5E94;&amp;#x8BE5;&amp;#x5305;&amp;#x62EC;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x6211;&amp;#x4EEC;&amp;#x662F;&amp;#x8981;&amp;#x76D1;&amp;#x89C6;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x7684;&amp;#x5199;&amp;#x53D8;&amp;#x5316;&amp;#x7684;&amp;#xFF0C;&amp;#x5373;&amp;#x6211;&amp;#x4EEC;&amp;#x5173;&amp;#x5FC3;&amp;#x662F;&amp;#x5426;&amp;#x53EF;&amp;#x4EE5;&amp;#x5411;&amp;#x8FD9;&amp;#x4E9B;&amp;#x6587;&amp;#x4EF6;&amp;#x4E2D;&amp;#x5199;&amp;#x5165;&amp;#x6570;&amp;#x636E;&amp;#x4E86;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x5982;&amp;#x679C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x96C6;&amp;#x5408;&amp;#x4E2D;&amp;#x6709;&amp;#x4E00;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x53EF;&amp;#x5199;&amp;#xFF0C;select&amp;#x5C31;&amp;#x4F1A;&amp;#x8FD4;&amp;#x56DE;&amp;#x4E00;&amp;#x4E2A;&amp;#x5927;&amp;#x4E8E;0&amp;#x7684;&amp;#x503C;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x6709;&amp;#x6587;&amp;#x4EF6;&amp;#x53EF;&amp;#x5199;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x5982;&amp;#x679C;&amp;#x6CA1;&amp;#x6709;&amp;#x53EF;&amp;#x5199;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&amp;#xFF0C;&amp;#x5219;&amp;#x6839;&amp;#x636E;timeout&amp;#x53C2;&amp;#x6570;&amp;#x518D;&amp;#x5224;&amp;#x65AD;&amp;#x662F;&amp;#x5426;&amp;#x8D85;&amp;#x65F6;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x82E5;&amp;#x8D85;&amp;#x51FA;timeout&amp;#x7684;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;select&amp;#x8FD4;&amp;#x56DE;0&amp;#xFF0C;&amp;#x82E5;&amp;#x53D1;&amp;#x751F;&amp;#x9519;&amp;#x8BEF;&amp;#x8FD4;&amp;#x56DE;&amp;#x8D1F;&amp;#x503C;&amp;#x3002;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F20;&amp;#x5165;NULL&amp;#x503C;&amp;#xFF0C;&amp;#x8868;&amp;#x793A;&amp;#x4E0D;&amp;#x5173;&amp;#x5FC3;&amp;#x4EFB;&amp;#x4F55;&amp;#x6587;&amp;#x4EF6;&amp;#x7684;&amp;#x5199;&amp;#x53D8;&amp;#x5316;&amp;#x3002;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;fd_set *errorfds&amp;#x540C;&amp;#x4E0A;&amp;#x9762;&amp;#x4E24;&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#x7684;&amp;#x610F;&amp;#x56FE;&amp;#xFF0C;&amp;#x7528;&amp;#x6765;&amp;#x76D1;&amp;#x89C6;&amp;#x6587;&amp;#x4EF6;&amp;#x9519;&amp;#x8BEF;&amp;#x5F02;&amp;#x5E38;&amp;#x3002;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;struct timeval* timeout&amp;#x662F;select&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;&amp;#x8FD9;&amp;#x4E2A;&amp;#x53C2;&amp;#x6570;&amp;#x81F3;&amp;#x5173;&amp;#x91CD;&amp;#x8981;&amp;#xFF0C;&amp;#x5B83;&amp;#x53EF;&amp;#x4EE5;&amp;#x4F7F;select&amp;#x5904;&amp;#x4E8E;&amp;#x4E09;&amp;#x79CD;&amp;#x72B6;&amp;#x6001;&amp;#xFF1A;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;1. &amp;#x82E5;&amp;#x5C06;NULL&amp;#x4EE5;&amp;#x5F62;&amp;#x53C2;&amp;#x4F20;&amp;#x5165;&amp;#xFF0C;&amp;#x5373;&amp;#x4E0D;&amp;#x4F20;&amp;#x5165;&amp;#x65F6;&amp;#x95F4;&amp;#x7ED3;&amp;#x6784;&amp;#xFF0C;&amp;#x5C31;&amp;#x662F;&amp;#x5C06;select&amp;#x7F6E;&amp;#x4E8E;&amp;#x963B;&amp;#x585E;&amp;#x72B6;&amp;#x6001;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x4E00;&amp;#x5B9A;&amp;#x7B49;&amp;#x5230;&amp;#x76D1;&amp;#x89C6;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x96C6;&amp;#x5408;&amp;#x4E2D;&amp;#x67D0;&amp;#x4E2A;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x53D1;&amp;#x751F;&amp;#x53D8;&amp;#x5316;&amp;#x4E3A;&amp;#x6B62;&amp;#xFF1B;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2. &amp;#x82E5;&amp;#x5C06;&amp;#x65F6;&amp;#x95F4;&amp;#x503C;&amp;#x8BBE;&amp;#x4E3A;0&amp;#x79D2;0&amp;#x6BEB;&amp;#x79D2;&amp;#xFF0C;&amp;#x5C31;&amp;#x53D8;&amp;#x6210;&amp;#x4E00;&amp;#x4E2A;&amp;#x7EAF;&amp;#x7CB9;&amp;#x7684;&amp;#x975E;&amp;#x963B;&amp;#x585E;&amp;#x51FD;&amp;#x6570;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x4E0D;&amp;#x7BA1;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x662F;&amp;#x5426;&amp;#x6709;&amp;#x53D8;&amp;#x5316;&amp;#xFF0C;&amp;#x90FD;&amp;#x7ACB;&amp;#x523B;&amp;#x8FD4;&amp;#x56DE;&amp;#x7EE7;&amp;#x7EED;&amp;#x6267;&amp;#x884C;&amp;#xFF0C;&amp;#x6587;&amp;#x4EF6;&amp;#x65E0;&amp;#x53D8;&amp;#x5316;&amp;#x8FD4;&amp;#x56DE;0&amp;#xFF0C;&amp;#x6709;&amp;#x53D8;&amp;#x5316;&amp;#x8FD4;&amp;#x56DE;&amp;#x4E00;&amp;#x4E2A;&amp;#x6B63;&amp;#x503C;&amp;#xFF1B;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3. timeout&amp;#x7684;&amp;#x503C;&amp;#x5927;&amp;#x4E8E;0&amp;#xFF0C;&amp;#x8FD9;&amp;#x5C31;&amp;#x662F;&amp;#x7B49;&amp;#x5F85;&amp;#x7684;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;&amp;#xFF0C;&amp;#x5373; select&amp;#x5728;timeout&amp;#x65F6;&amp;#x95F4;&amp;#x5185;&amp;#x963B;&amp;#x585E;&amp;#xFF0C;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x8D85;&amp;#x65F6;&amp;#x65F6;&amp;#x95F4;&amp;#x4E4B;&amp;#x5185;&amp;#x6709;&amp;#x4E8B;&amp;#x4EF6;&amp;#x5230;&amp;#x6765;&amp;#x5C31;&amp;#x8FD4;&amp;#x56DE;&amp;#x4E86;&amp;#xFF0C;&amp;#x5426;&amp;#x5219;&amp;#x5728;&amp;#x8D85;&amp;#x65F6;&amp;#x540E;&amp;#x4E0D;&amp;#x7BA1;&amp;#x600E;&amp;#x6837;&amp;#x4E00;&amp;#x5B9A;&amp;#x8FD4;&amp;#x56DE;&amp;#xFF0C;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#x540C;&amp;#x4E0A;&amp;#x8FF0;&amp;#x3002;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x8FD4;&amp;#x56DE;&amp;#x503C;&amp;#xFF1A;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x8D1F;&amp;#x503C;&amp;#xFF1A;select&amp;#x9519;&amp;#x8BEF;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#x6B63;&amp;#x503C;&amp;#xFF1A;&amp;#x67D0;&amp;#x4E9B;&amp;#x6587;&amp;#x4EF6;&amp;#x53EF;&amp;#x8BFB;&amp;#x5199;&amp;#x6216;&amp;#x51FA;&amp;#x9519;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;0&amp;#xFF1A;&amp;#x7B49;&amp;#x5F85;&amp;#x8D85;&amp;#x65F6;&amp;#xFF0C;&amp;#x6CA1;&amp;#x6709;&amp;#x53EF;&amp;#x8BFB;&amp;#x5199;&amp;#x6216;&amp;#x9519;&amp;#x8BEF;&amp;#x7684;&amp;#x6587;&amp;#x4EF6;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;*/&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Network" scheme="http://snowyying.github.io/categories/Network/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="网络" scheme="http://snowyying.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
      <category term="select" scheme="http://snowyying.github.io/tags/select/"/>
    
      <category term="socket" scheme="http://snowyying.github.io/tags/socket/"/>
    
  </entry>
  
  <entry>
    <title>linux下使用libcssl库串口编程</title>
    <link href="http://snowyying.github.io/2016/linux-serial-with-libcssl/"/>
    <id>http://snowyying.github.io/2016/linux-serial-with-libcssl/</id>
    <published>2016-08-04T03:46:46.000Z</published>
    <updated>2016-08-06T15:45:56.118Z</updated>
    
    <content type="html"><![CDATA[<p>&#x4F7F;&#x7528;libcssl(&#x6700;&#x65B0;&#x7248;0.9.4)&#x8FDB;&#x884C;&#x4E32;&#x53E3;&#x901A;&#x8BAF;&#x65F6;, &#x53D1;&#x73B0;&#x5947;&#x5076;&#x6821;&#x9A8C;&#x8BBE;&#x7F6E;&#x65E0;&#x6548;, &#x67E5;&#x770B;&#x6E90;&#x7801;&#x540E;&#x53D1;&#x73B0;&#x6709;&#x4E24;&#x5904;&#x95EE;&#x9898;</p>
<h6 id="1-cssl-open-&#x4E2D;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x987A;&#x5E8F;&#x95EE;&#x9898;"><a href="#1-cssl-open-&#x4E2D;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x987A;&#x5E8F;&#x95EE;&#x9898;" class="headerlink" title="1 cssl_open()&#x4E2D;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x987A;&#x5E8F;&#x95EE;&#x9898;"></a>1 cssl_open()&#x4E2D;&#x53C2;&#x6570;&#x8C03;&#x7528;&#x987A;&#x5E8F;&#x95EE;&#x9898;</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* opens the port */</span></div><div class="line"><span class="keyword">cssl_t</span> *cssl_open(<span class="keyword">const</span> <span class="keyword">char</span> *fname,</div><div class="line">      <span class="keyword">cssl_callback_t</span> callback,</div><div class="line">      <span class="keyword">int</span> id,</div><div class="line">      <span class="keyword">int</span> baud,</div><div class="line">      <span class="keyword">int</span> bits,</div><div class="line">      <span class="keyword">int</span> parity,</div><div class="line">      <span class="keyword">int</span> stop)</div><div class="line">{</div><div class="line">    <span class="keyword">cssl_t</span> *serial;</div><div class="line"></div><div class="line">    <span class="comment">//...</span></div><div class="line"></div><div class="line">    <span class="comment">/* now we set new values */</span></div><div class="line">    <span class="comment">//cssl_setup(serial,baud,parity,bits,stop);</span></div><div class="line">    <span class="comment">// Bug fix @ 20160727 by Snowyying</span></div><div class="line">    cssl_setup(serial,baud,bits,parity,stop);</div><div class="line"></div><div class="line">    <span class="comment">//...</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> serial;</div><div class="line">}</div></pre></td></tr></table></figure>
<h6 id="2-cssl-setup-&#x4E2D;c-iflag&#x8BBE;&#x7F6E;&#x95EE;&#x9898;"><a href="#2-cssl-setup-&#x4E2D;c-iflag&#x8BBE;&#x7F6E;&#x95EE;&#x9898;" class="headerlink" title="2 cssl_setup()&#x4E2D;c_iflag&#x8BBE;&#x7F6E;&#x95EE;&#x9898;"></a>2 cssl_setup()&#x4E2D;c_iflag&#x8BBE;&#x7F6E;&#x95EE;&#x9898;</h6><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* sets up the port parameters */</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">cssl_setup</span><span class="params">(<span class="keyword">cssl_t</span> *serial,</span></span></div><div class="line">       <span class="keyword">int</span> baud,</div><div class="line">       <span class="keyword">int</span> bits,</div><div class="line">       <span class="keyword">int</span> parity,</div><div class="line">       <span class="keyword">int</span> stop)</div><div class="line">{</div><div class="line">    <span class="keyword">tcflag_t</span> baudrate;</div><div class="line">    <span class="keyword">tcflag_t</span> databits;</div><div class="line">    <span class="keyword">tcflag_t</span> stopbits;</div><div class="line">    <span class="keyword">tcflag_t</span> checkparity;</div><div class="line"></div><div class="line">    <span class="comment">//...</span></div><div class="line"></div><div class="line">    <span class="comment">/* now we setup the values in port&apos;s termios */</span></div><div class="line">    serial-&gt;tio.c_cflag=baudrate|databits|checkparity|stopbits|CLOCAL|CREAD;</div><div class="line">    <span class="comment">//serial-&gt;tio.c_iflag=IGNPAR;</span></div><div class="line">    <span class="comment">// Bug fix @ 20160727 by Snowyying</span></div><div class="line">    <span class="keyword">if</span> (parity)</div><div class="line">        serial-&gt;tio.c_iflag |= INPCK;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        serial-&gt;tio.c_iflag=IGNPAR;</div><div class="line">    serial-&gt;tio.c_oflag=<span class="number">0</span>;</div><div class="line">    serial-&gt;tio.c_lflag=<span class="number">0</span>;</div><div class="line">    serial-&gt;tio.c_cc[VMIN]=<span class="number">1</span>;</div><div class="line">    serial-&gt;tio.c_cc[VTIME]=<span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/* we flush the port */</span></div><div class="line">    tcflush(serial-&gt;fd,TCOFLUSH);</div><div class="line">    tcflush(serial-&gt;fd,TCIFLUSH);</div><div class="line"></div><div class="line">    <span class="comment">/* we send new config to the port */</span></div><div class="line">    tcsetattr(serial-&gt;fd,TCSANOW,&amp;(serial-&gt;tio));</div><div class="line"></div><div class="line">    cssl_error=CSSL_OK;</div><div class="line">}</div></pre></td></tr></table></figure>
<hr>
<p>&#x6CE8;&#x610F;: &#x7F16;&#x8BD1;&#x65F6;&#x9700;&#x4F7F;&#x7528;-D_GNU_SOURCE&#x9009;&#x9879;</p>
<p>libcssl 0.9.4 source code <a href="https://github.com/mwheels/libcssl" target="_blank" rel="external">https://github.com/mwheels/libcssl</a></p>
<p>&#x53C2;&#x8003;: developerWorks &#x4E2D;&#x56FD; Linux &#x4E0B;&#x4E32;&#x53E3;&#x7F16;&#x7A0B;&#x5165;&#x95E8;  <a href="http://www.ibm.com/developerworks/cn/linux/l-serials/" target="_blank" rel="external">http://www.ibm.com/developerworks/cn/linux/l-serials/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&amp;#x4F7F;&amp;#x7528;libcssl(&amp;#x6700;&amp;#x65B0;&amp;#x7248;0.9.4)&amp;#x8FDB;&amp;#x884C;&amp;#x4E32;&amp;#x53E3;&amp;#x901A;&amp;#x8BAF;&amp;#x65F6;, &amp;#x53D1;&amp;#x73B0;&amp;#x5947;&amp;
    
    </summary>
    
      <category term="I/O" scheme="http://snowyying.github.io/categories/I-O/"/>
    
    
      <category term="IT" scheme="http://snowyying.github.io/tags/IT/"/>
    
      <category term="linux" scheme="http://snowyying.github.io/tags/linux/"/>
    
      <category term="串口" scheme="http://snowyying.github.io/tags/%E4%B8%B2%E5%8F%A3/"/>
    
      <category term="libcssl" scheme="http://snowyying.github.io/tags/libcssl/"/>
    
  </entry>
  
  <entry>
    <title>define宏定义中的#,##,@#及\符号</title>
    <link href="http://snowyying.github.io/2016/define-symbol/"/>
    <id>http://snowyying.github.io/2016/define-symbol/</id>
    <published>2016-08-03T11:29:29.000Z</published>
    <updated>2016-08-25T04:09:32.223Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-stringizing-&#x5B57;&#x7B26;&#x4E32;&#x5316;&#x64CD;&#x4F5C;&#x7B26;"><a href="#1-stringizing-&#x5B57;&#x7B26;&#x4E32;&#x5316;&#x64CD;&#x4F5C;&#x7B26;" class="headerlink" title="1 # (stringizing) &#x5B57;&#x7B26;&#x4E32;&#x5316;&#x64CD;&#x4F5C;&#x7B26;"></a>1 # (stringizing) &#x5B57;&#x7B26;&#x4E32;&#x5316;&#x64CD;&#x4F5C;&#x7B26;</h2><p>#&#x7684;&#x4F5C;&#x7528;&#x662F;:</p>
<blockquote>
<p>&#x5C06;&#x5B8F;&#x5B9A;&#x4E49;&#x4E2D;&#x7684;&#x4F20;&#x5165;&#x53C2;&#x6570;&#x540D;&#x8F6C;&#x6362;&#x6210;&#x7528;&#x4E00;&#x5BF9;&#x53CC;&#x5F15;&#x53F7;&#x62EC;&#x8D77;&#x6765;&#x53C2;&#x6570;&#x540D;&#x5B57;&#x7B26;&#x4E32;.&#x5176;&#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x6709;&#x4F20;&#x5165;&#x53C2;&#x6570;&#x7684;&#x5B8F;&#x5B9A;&#x4E49;&#x4E2D;, &#x4E14;&#x5FC5;&#x987B;&#x7F6E;&#x4E8E;&#x5B8F;&#x5B9A;&#x4E49;&#x4F53;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x540D;&#x524D;.</p>
</blockquote>
<p>&#x5982;:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> example(instr) printf(<span class="meta-string">&quot;the input string is:\t%s\n&quot;</span>, #instr)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> example1(instr) #instr</span></div></pre></td></tr></table></figure>
<p>&#x5F53;&#x4F7F;&#x7528;&#x8BE5;&#x5B8F;&#x5B9A;&#x4E49;&#x65F6;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">example(abc);</div></pre></td></tr></table></figure>
<p>(&#x5728;&#x7F16;&#x8BD1;&#x65F6;)&#x5C06;&#x4F1A;&#x5C55;&#x5F00;&#x6210;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">printf</span>(<span class="string">&quot;the input string is:\t%s\n&quot;</span>, <span class="string">&quot;abc&quot;</span>);</div></pre></td></tr></table></figure>
<p>&#x5F53;&#x4F7F;&#x7528;&#x8BE5;&#x5B8F;&#x5B9A;&#x4E49;&#x65F6;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">string</span> str=example1(abc);</div></pre></td></tr></table></figure>
<p>&#x5C06;&#x4F1A;&#x5C55;&#x5F00;&#x6210;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">string</span> str=<span class="string">&quot;abc&quot;</span>;</div></pre></td></tr></table></figure>
<p><strong>&#x6CE8;&#x610F;:</strong></p>
<p>&#x5BF9;&#x7A7A;&#x683C;&#x7684;&#x5904;&#x7406;</p>
<p>a. &#x5FFD;&#x7565;&#x4F20;&#x5165;&#x53C2;&#x6570;&#x540D;&#x524D;&#x9762;&#x548C;&#x540E;&#x9762;&#x7684;&#x7A7A;&#x683C;</p>
<p>&#x5982;:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">str = example1(   abc   );</div></pre></td></tr></table></figure>
<p>&#x5C06;&#x4F1A;&#x88AB;&#x6269;&#x5C55;&#x6210;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">str = <span class="string">&quot;abc&quot;</span>;</div></pre></td></tr></table></figure>
<p>b. &#x5F53;&#x4F20;&#x5165;&#x53C2;&#x6570;&#x540D;&#x95F4;&#x5B58;&#x5728;&#x7A7A;&#x683C;&#x65F6;, &#x7F16;&#x8BD1;&#x5668;&#x5C06;&#x4F1A;&#x81EA;&#x52A8;&#x8FDE;&#x63A5;&#x5404;&#x4E2A;&#x5B50;&#x5B57;&#x7B26;&#x4E32;, &#x7528;&#x6BCF;&#x4E2A;&#x5B50;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x53EA;&#x4EE5;&#x4E00;&#x4E2A;&#x7A7A;&#x683C;&#x8FDE;&#x63A5;, &#x5FFD;&#x7565;&#x5176;&#x4E2D;&#x591A;&#x4F59;&#x4E00;&#x4E2A;&#x7684;&#x7A7A;&#x683C;</p>
<p>&#x5982;:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">str=exapme(   abc    def   );</div></pre></td></tr></table></figure>
<p>&#x5C06;&#x4F1A;&#x88AB;&#x6269;&#x5C55;&#x6210;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">str=<span class="string">&quot;abc def&quot;</span>;</div></pre></td></tr></table></figure>
<a id="more"></a> 
<h2 id="2-token-pasting-&#x7B26;&#x53F7;&#x8FDE;&#x63A5;&#x64CD;&#x4F5C;&#x7B26;"><a href="#2-token-pasting-&#x7B26;&#x53F7;&#x8FDE;&#x63A5;&#x64CD;&#x4F5C;&#x7B26;" class="headerlink" title="2 ## (token-pasting) &#x7B26;&#x53F7;&#x8FDE;&#x63A5;&#x64CD;&#x4F5C;&#x7B26;"></a>2 ## (token-pasting) &#x7B26;&#x53F7;&#x8FDE;&#x63A5;&#x64CD;&#x4F5C;&#x7B26;</h2><p>&#x5B8F;&#x5B9A;&#x4E49;&#x4E2D;: &#x53C2;&#x6570;&#x540D;, &#x5373;&#x4E3A;&#x5F62;&#x53C2;, &#x5982;#define sum(a, b) (a+b); &#x4E2D;a&#x548C;b&#x5747;&#x4E3A;&#x67D0;&#x4E00;&#x53C2;&#x6570;&#x7684;&#x4EE3;&#x8868;&#x7B26;&#x53F7;, &#x5373;&#x5F62;&#x5F0F;&#x53C2;&#x6570;.</p>
<p>##&#x7684;&#x4F5C;&#x7528;&#x5219;&#x662F;:</p>
<blockquote>
<p>&#x5C06;&#x5B8F;&#x5B9A;&#x4E49;&#x7684;&#x591A;&#x4E2A;&#x5F62;&#x53C2;&#x6210;&#x4E00;&#x4E2A;&#x5B9E;&#x9645;&#x53C2;&#x6570;&#x540D;.</p>
</blockquote>
<p>&#x5982;:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> exampleNum(n) num##n</span></div><div class="line"><span class="keyword">int</span> num9=<span class="number">9</span>;</div></pre></td></tr></table></figure>
<p>&#x5F53;&#x4F7F;&#x7528;&#x8BE5;&#x5B8F;&#x5B9A;&#x4E49;&#x65F6;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> num=exampleNum(<span class="number">9</span>);</div></pre></td></tr></table></figure>
<p>&#x5C06;&#x4F1A;&#x6269;&#x5C55;&#x6210;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> num=num9;</div></pre></td></tr></table></figure>
<p>&#x6CE8;&#x610F;:</p>
<p>a. &#x5F53;&#x7528;##&#x8FDE;&#x63A5;&#x5F62;&#x53C2;&#x65F6;, ##&#x524D;&#x540E;&#x7684;&#x7A7A;&#x683C;&#x53EF;&#x6709;&#x53EF;&#x65E0;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> exampleNum(n) num ## n</span></div></pre></td></tr></table></figure>
<p>&#x76F8;&#x5F53;&#x4E8E;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> exampleNum(n) num##n</span></div></pre></td></tr></table></figure>
<p>b. &#x8FDE;&#x63A5;&#x540E;&#x7684;&#x5B9E;&#x9645;&#x53C2;&#x6570;&#x540D;, &#x5FC5;&#x987B;&#x4E3A;&#x5B9E;&#x9645;&#x5B58;&#x5728;&#x7684;&#x53C2;&#x6570;&#x540D;&#x6216;&#x662F;&#x7F16;&#x8BD1;&#x5668;&#x5DF2;&#x77E5;&#x7684;&#x5B8F;&#x5B9A;&#x4E49;</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// preprocessor_token_pasting.cpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> paster( n ) printf_s( <span class="meta-string">&quot;token&quot;</span> #n <span class="meta-string">&quot; = %d&quot;</span>, token##n )</span></div><div class="line"><span class="keyword">int</span> token9 = <span class="number">9</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">{</div><div class="line">    paster(<span class="number">9</span>);</div><div class="line">}</div></pre></td></tr></table></figure>
<p>&#x8FD0;&#x884C;&#x7ED3;&#x679C;: <figure class="highlight plain"><figcaption><span>= 9```</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">## 3 @# (charizing) &#x5B57;&#x7B26;&#x5316;&#x64CD;&#x4F5C;&#x7B26;</div><div class="line"></div><div class="line">&#x53EA;&#x80FD;&#x7528;&#x4E8E;&#x6709;&#x4F20;&#x5165;&#x53C2;&#x6570;&#x7684;&#x5B8F;&#x5B9A;&#x4E49;&#x4E2D;, &#x4E14;&#x5FC5;&#x987B;&#x7F6E;&#x4E8E;&#x5B8F;&#x5B9A;&#x4E49;&#x4F53;&#x4E2D;&#x7684;&#x53C2;&#x6570;&#x540D;&#x524D;.</div><div class="line"></div><div class="line">\@#&#x4F5C;&#x7528;&#x662F;:</div><div class="line">&gt;&#x5C06;&#x4F20;&#x7684;&#x5355;&#x5B57;&#x7B26;&#x53C2;&#x6570;&#x540D;&#x8F6C;&#x6362;&#x6210;&#x5B57;&#x7B26;, &#x4EE5;&#x4E00;&#x5BF9;&#x5355;&#x5F15;&#x7528;&#x62EC;&#x8D77;&#x6765;.</div><div class="line"></div><div class="line">&#x5982;:</div><div class="line"></div><div class="line">``` c</div><div class="line">#define makechar(x) #@x</div></pre></td></tr></table></figure></p>
<p>&#x5F53;&#x4F7F;&#x7528;&#x8BE5;&#x5B8F;&#x5B9A;&#x4E49;&#x65F6; <code>a = makechar(b);</code> &#x5C55;&#x5F00;&#x540E;&#x53D8;&#x6210; <code>a= &apos;b&apos;;</code></p>
<h2 id="4-&#x884C;&#x7EE7;&#x7EED;&#x64CD;&#x4F5C;&#x7B26;"><a href="#4-&#x884C;&#x7EE7;&#x7EED;&#x64CD;&#x4F5C;&#x7B26;" class="headerlink" title="4 \ &#x884C;&#x7EE7;&#x7EED;&#x64CD;&#x4F5C;&#x7B26;"></a>4 \ &#x884C;&#x7EE7;&#x7EED;&#x64CD;&#x4F5C;&#x7B26;</h2><blockquote>
<p>&#x5F53;&#x5B9A;&#x4E49;&#x7684;&#x5B8F;&#x4E0D;&#x80FD;&#x7528;&#x4E00;&#x884C;&#x8868;&#x8FBE;&#x5B8C;&#x6574;&#x65F6;, &#x53EF;&#x4EE5;&#x7528;&#x201D;\&#x201D;&#x8868;&#x793A;&#x4E0B;&#x4E00;&#x884C;&#x7EE7;&#x7EED;&#x6B64;&#x5B8F;&#x7684;&#x5B9A;&#x4E49;.</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-stringizing-&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x5316;&amp;#x64CD;&amp;#x4F5C;&amp;#x7B26;&quot;&gt;&lt;a href=&quot;#1-stringizing-&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x5316;&amp;#x64CD;&amp;#x4F5C;&amp;#x7B26;&quot; class=&quot;headerlink&quot; title=&quot;1 # (stringizing) &amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x5316;&amp;#x64CD;&amp;#x4F5C;&amp;#x7B26;&quot;&gt;&lt;/a&gt;1 # (stringizing) &amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x5316;&amp;#x64CD;&amp;#x4F5C;&amp;#x7B26;&lt;/h2&gt;&lt;p&gt;#&amp;#x7684;&amp;#x4F5C;&amp;#x7528;&amp;#x662F;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;#x5C06;&amp;#x5B8F;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E2D;&amp;#x7684;&amp;#x4F20;&amp;#x5165;&amp;#x53C2;&amp;#x6570;&amp;#x540D;&amp;#x8F6C;&amp;#x6362;&amp;#x6210;&amp;#x7528;&amp;#x4E00;&amp;#x5BF9;&amp;#x53CC;&amp;#x5F15;&amp;#x53F7;&amp;#x62EC;&amp;#x8D77;&amp;#x6765;&amp;#x53C2;&amp;#x6570;&amp;#x540D;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;.&amp;#x5176;&amp;#x53EA;&amp;#x80FD;&amp;#x7528;&amp;#x4E8E;&amp;#x6709;&amp;#x4F20;&amp;#x5165;&amp;#x53C2;&amp;#x6570;&amp;#x7684;&amp;#x5B8F;&amp;#x5B9A;&amp;#x4E49;&amp;#x4E2D;, &amp;#x4E14;&amp;#x5FC5;&amp;#x987B;&amp;#x7F6E;&amp;#x4E8E;&amp;#x5B8F;&amp;#x5B9A;&amp;#x4E49;&amp;#x4F53;&amp;#x4E2D;&amp;#x7684;&amp;#x53C2;&amp;#x6570;&amp;#x540D;&amp;#x524D;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&amp;#x5982;:&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; example(instr) printf(&lt;span class=&quot;meta-string&quot;&gt;&amp;quot;the input string is:\t%s\n&amp;quot;&lt;/span&gt;, #instr)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; example1(instr) #instr&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x5F53;&amp;#x4F7F;&amp;#x7528;&amp;#x8BE5;&amp;#x5B8F;&amp;#x5B9A;&amp;#x4E49;&amp;#x65F6;&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;example(abc);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;(&amp;#x5728;&amp;#x7F16;&amp;#x8BD1;&amp;#x65F6;)&amp;#x5C06;&amp;#x4F1A;&amp;#x5C55;&amp;#x5F00;&amp;#x6210;&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;the input string is:\t%s\n&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;abc&amp;quot;&lt;/span&gt;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x5F53;&amp;#x4F7F;&amp;#x7528;&amp;#x8BE5;&amp;#x5B8F;&amp;#x5B9A;&amp;#x4E49;&amp;#x65F6;&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;string&lt;/span&gt; str=example1(abc);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x5C06;&amp;#x4F1A;&amp;#x5C55;&amp;#x5F00;&amp;#x6210;&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;string&lt;/span&gt; str=&lt;span class=&quot;string&quot;&gt;&amp;quot;abc&amp;quot;&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;&amp;#x6CE8;&amp;#x610F;:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&amp;#x5BF9;&amp;#x7A7A;&amp;#x683C;&amp;#x7684;&amp;#x5904;&amp;#x7406;&lt;/p&gt;
&lt;p&gt;a. &amp;#x5FFD;&amp;#x7565;&amp;#x4F20;&amp;#x5165;&amp;#x53C2;&amp;#x6570;&amp;#x540D;&amp;#x524D;&amp;#x9762;&amp;#x548C;&amp;#x540E;&amp;#x9762;&amp;#x7684;&amp;#x7A7A;&amp;#x683C;&lt;/p&gt;
&lt;p&gt;&amp;#x5982;:&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;str = example1(   abc   );&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x5C06;&amp;#x4F1A;&amp;#x88AB;&amp;#x6269;&amp;#x5C55;&amp;#x6210;&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;str = &lt;span class=&quot;string&quot;&gt;&amp;quot;abc&amp;quot;&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;b. &amp;#x5F53;&amp;#x4F20;&amp;#x5165;&amp;#x53C2;&amp;#x6570;&amp;#x540D;&amp;#x95F4;&amp;#x5B58;&amp;#x5728;&amp;#x7A7A;&amp;#x683C;&amp;#x65F6;, &amp;#x7F16;&amp;#x8BD1;&amp;#x5668;&amp;#x5C06;&amp;#x4F1A;&amp;#x81EA;&amp;#x52A8;&amp;#x8FDE;&amp;#x63A5;&amp;#x5404;&amp;#x4E2A;&amp;#x5B50;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;, &amp;#x7528;&amp;#x6BCF;&amp;#x4E2A;&amp;#x5B50;&amp;#x5B57;&amp;#x7B26;&amp;#x4E32;&amp;#x4E2D;&amp;#x53EA;&amp;#x4EE5;&amp;#x4E00;&amp;#x4E2A;&amp;#x7A7A;&amp;#x683C;&amp;#x8FDE;&amp;#x63A5;, &amp;#x5FFD;&amp;#x7565;&amp;#x5176;&amp;#x4E2D;&amp;#x591A;&amp;#x4F59;&amp;#x4E00;&amp;#x4E2A;&amp;#x7684;&amp;#x7A7A;&amp;#x683C;&lt;/p&gt;
&lt;p&gt;&amp;#x5982;:&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;str=exapme(   abc    def   );&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&amp;#x5C06;&amp;#x4F1A;&amp;#x88AB;&amp;#x6269;&amp;#x5C55;&amp;#x6210;&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;str=&lt;span class=&quot;string&quot;&gt;&amp;quot;abc def&amp;quot;&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="C/C++" scheme="http://snowyying.github.io/categories/C-C/"/>
    
    
      <category term="C" scheme="http://snowyying.github.io/tags/C/"/>
    
      <category term="define" scheme="http://snowyying.github.io/tags/define/"/>
    
  </entry>
  
</feed>
